This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.eslintrc.json
.gitignore
Header Template (2).pdf
next.config.js
package.json
postcss.config.js
project-export.txt
public/header.jpg
public/header.png
public/manifest.json
public/offline.html
public/robots.txt
public/sitemap.xml
public/sw.js
README.md
src/app/api/auth/[...nextauth]/route.ts
src/app/api/generate-text/route.ts
src/app/api/sign/route.ts
src/app/api/suggestions/route.ts
src/app/api/templates/route.ts
src/app/api/templates/user/[id]/route.ts
src/app/api/templates/user/route.ts
src/app/globals.css
src/app/layout.tsx
src/app/page.tsx
src/app/suggestions/page.tsx
src/components/AccessibilitySettings.tsx
src/components/ActionButtons.tsx
src/components/AIWritingAssistant.tsx
src/components/APIAccess.tsx
src/components/ApprovalWorkflow.tsx
src/components/AuditTrail.tsx
src/components/AuthModal.tsx
src/components/AutoSaveIndicator.tsx
src/components/BatchSend.tsx
src/components/BulkGeneration.tsx
src/components/Button.tsx
src/components/Card.tsx
src/components/CommandPalette.tsx
src/components/Confetti.tsx
src/components/ContactAutofill.tsx
src/components/CustomBranding.tsx
src/components/Dashboard.tsx
src/components/DocumentComparison.tsx
src/components/DocumentExpiration.tsx
src/components/DocumentHistory.tsx
src/components/DocumentRevisions.tsx
src/components/DocumentScheduling.tsx
src/components/DocumentSearch.tsx
src/components/DocumentTags.tsx
src/components/DragDropUpload.tsx
src/components/EmailDocument.tsx
src/components/EmptyState.tsx
src/components/ExportHistory.tsx
src/components/FavoritesPanel.tsx
src/components/features/index.ts
src/components/FindReplace.tsx
src/components/forms/DocumentBodyEditor.tsx
src/components/forms/DocumentTypeSelector.tsx
src/components/forms/FormattingOptions.tsx
src/components/forms/index.ts
src/components/forms/RecipientForm.tsx
src/components/forms/SignatorySection.tsx
src/components/Input.tsx
src/components/KeyboardShortcuts.tsx
src/components/LanguageSelector.tsx
src/components/LazyModals.tsx
src/components/MyTemplates.tsx
src/components/OnboardingTour.tsx
src/components/PageHeader.tsx
src/components/PageSettings.tsx
src/components/PDFHeaderFooter.tsx
src/components/PDFImport.tsx
src/components/PDFThemes.tsx
src/components/PomodoroTimer.tsx
src/components/PrivacySettings.tsx
src/components/ProfileManager.tsx
src/components/ProgressIndicator.tsx
src/components/Providers.tsx
src/components/PWAInstallPrompt.tsx
src/components/QuickDuplicate.tsx
src/components/QuickTemplates.tsx
src/components/SaveAsTemplate.tsx
src/components/SettingsPanel.tsx
src/components/ShareDraft.tsx
src/components/Sidebar.tsx
src/components/SignaturePlacement.tsx
src/components/SimplifiedSidebar.tsx
src/components/Skeleton.tsx
src/components/SkipToContent.tsx
src/components/SpellChecker.tsx
src/components/StatisticsPanel.tsx
src/components/StreakTracker.tsx
src/components/TeamWorkspaces.tsx
src/components/TemplateAnalytics.tsx
src/components/TemplateCategories.tsx
src/components/TemplateExplorer.tsx
src/components/TemplateGallery.tsx
src/components/TemplateVariables.tsx
src/components/TimeTracker.tsx
src/components/Tooltip.tsx
src/components/UserGuide.tsx
src/components/UserMenu.tsx
src/components/VersionHistory.tsx
src/components/WebhookIntegration.tsx
src/components/WelcomeModal.tsx
src/contexts/ThemeContext.tsx
src/data/signatories.ts
src/data/templates.ts
src/hooks/useKeyboardShortcuts.ts
src/hooks/useSoundEffects.ts
src/lib/auth.ts
src/lib/pdfGenerator.ts
src/lib/userTemplates.ts
src/store/documentStore.ts
src/utils/documentHistory.ts
src/utils/favorites.ts
src/utils/smartDate.ts
src/utils/statistics.ts
src/utils/validation.ts
tailwind.config.ts
tsconfig.json
vercel.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="project-export.txt">
# DocGen Project Code Export
Generated: 01/17/2026 11:36:36

## File Structure
public\manifest.json
public\sw.js
src\app\api\generate-text\route.ts
src\app\api\sign\route.ts
src\app\api\suggestions\route.ts
src\app\api\templates\user\[id]\route.ts
src\app\api\templates\user\route.ts
src\app\api\templates\route.ts
src\app\suggestions\page.tsx
src\app\globals.css
src\app\layout.tsx
src\app\page.tsx
src\components\features\index.ts
src\components\forms\DocumentBodyEditor.tsx
src\components\forms\DocumentTypeSelector.tsx
src\components\forms\FormattingOptions.tsx
src\components\forms\index.ts
src\components\forms\RecipientForm.tsx
src\components\forms\SignatorySection.tsx
src\components\AccessibilitySettings.tsx
src\components\ActionButtons.tsx
src\components\AIWritingAssistant.tsx
src\components\APIAccess.tsx
src\components\ApprovalWorkflow.tsx
src\components\AuditTrail.tsx
src\components\AuthModal.tsx
src\components\AutoSaveIndicator.tsx
src\components\BatchSend.tsx
src\components\BulkGeneration.tsx
src\components\Button.tsx
src\components\Card.tsx
src\components\CommandPalette.tsx
src\components\Confetti.tsx
src\components\ContactAutofill.tsx
src\components\CustomBranding.tsx
src\components\Dashboard.tsx
src\components\DocumentComparison.tsx
src\components\DocumentExpiration.tsx
src\components\DocumentHistory.tsx
src\components\DocumentRevisions.tsx
src\components\DocumentScheduling.tsx
src\components\DocumentSearch.tsx
src\components\DocumentTags.tsx
src\components\DragDropUpload.tsx
src\components\EmailDocument.tsx
src\components\EmptyState.tsx
src\components\ExportHistory.tsx
src\components\FavoritesPanel.tsx
src\components\FindReplace.tsx
src\components\Input.tsx
src\components\KeyboardShortcuts.tsx
src\components\LanguageSelector.tsx
src\components\LazyModals.tsx
src\components\MyTemplates.tsx
src\components\OnboardingTour.tsx
src\components\PageHeader.tsx
src\components\PageSettings.tsx
src\components\PDFHeaderFooter.tsx
src\components\PDFImport.tsx
src\components\PDFThemes.tsx
src\components\PomodoroTimer.tsx
src\components\PrivacySettings.tsx
src\components\ProfileManager.tsx
src\components\ProgressIndicator.tsx
src\components\Providers.tsx
src\components\PWAInstallPrompt.tsx
src\components\QuickDuplicate.tsx
src\components\QuickTemplates.tsx
src\components\SaveAsTemplate.tsx
src\components\SettingsPanel.tsx
src\components\ShareDraft.tsx
src\components\Sidebar.tsx
src\components\SignaturePlacement.tsx
src\components\SimplifiedSidebar.tsx
src\components\Skeleton.tsx
src\components\SkipToContent.tsx
src\components\SpellChecker.tsx
src\components\StatisticsPanel.tsx
src\components\StreakTracker.tsx
src\components\TeamWorkspaces.tsx
src\components\TemplateAnalytics.tsx
src\components\TemplateCategories.tsx
src\components\TemplateExplorer.tsx
src\components\TemplateGallery.tsx
src\components\TemplateVariables.tsx
src\components\TimeTracker.tsx
src\components\Tooltip.tsx
src\components\UserGuide.tsx
src\components\UserMenu.tsx
src\components\VersionHistory.tsx
src\components\WebhookIntegration.tsx
src\components\WelcomeModal.tsx
src\contexts\ThemeContext.tsx
src\data\signatories.ts
src\data\templates.ts
src\hooks\useKeyboardShortcuts.ts
src\hooks\useSoundEffects.ts
src\lib\auth.ts
src\lib\pdfGenerator.ts
src\lib\userTemplates.ts
src\store\documentStore.ts
src\utils\documentHistory.ts
src\utils\favorites.ts
src\utils\smartDate.ts
src\utils\statistics.ts
src\utils\validation.ts
.eslintrc.json
next-env.d.ts
next.config.js
package-lock.json
package.json
postcss.config.js
tailwind.config.ts
tsconfig.json
vercel.json
</file>

<file path="public/manifest.json">
{
  "name": "DocGen - Document Generator",
  "short_name": "DocGen",
  "description": "Create professional documents in minutes. Generate PDFs, letters of recommendation, employment letters, and more.",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#0f0f12",
  "theme_color": "#e07a5f",
  "orientation": "portrait-primary",
  "icons": [
    {
      "src": "/icons/icon-72x72.png",
      "sizes": "72x72",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "/icons/icon-96x96.png",
      "sizes": "96x96",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "/icons/icon-128x128.png",
      "sizes": "128x128",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "/icons/icon-144x144.png",
      "sizes": "144x144",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "/icons/icon-152x152.png",
      "sizes": "152x152",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "/icons/icon-384x384.png",
      "sizes": "384x384",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "maskable any"
    }
  ],
  "categories": ["productivity", "business", "utilities"],
  "screenshots": [
    {
      "src": "/screenshots/desktop.png",
      "sizes": "1280x720",
      "type": "image/png",
      "form_factor": "wide",
      "label": "DocGen Desktop View"
    },
    {
      "src": "/screenshots/mobile.png",
      "sizes": "750x1334",
      "type": "image/png",
      "form_factor": "narrow",
      "label": "DocGen Mobile View"
    }
  ],
  "shortcuts": [
    {
      "name": "New Document",
      "short_name": "New",
      "description": "Create a new document",
      "url": "/?action=new",
      "icons": [{ "src": "/icons/new-doc.png", "sizes": "96x96" }]
    },
    {
      "name": "Templates",
      "short_name": "Templates",
      "description": "Browse templates",
      "url": "/?action=templates",
      "icons": [{ "src": "/icons/templates.png", "sizes": "96x96" }]
    }
  ],
  "related_applications": [],
  "prefer_related_applications": false
}
</file>

<file path="public/offline.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DocGen - Offline</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Outfit', system-ui, sans-serif;
      background: #0f0f12;
      color: #f4f1ed;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .container {
      text-align: center;
      max-width: 400px;
    }

    .icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 2rem;
      background: linear-gradient(135deg, #e07a5f, #81b29a);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon svg {
      width: 40px;
      height: 40px;
      color: white;
    }

    h1 {
      font-size: 1.75rem;
      margin-bottom: 1rem;
      font-weight: 700;
    }

    p {
      color: #7a756d;
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .retry-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.875rem 1.5rem;
      background: #e07a5f;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .retry-btn:hover {
      background: #c86a52;
      transform: translateY(-2px);
    }

    .status {
      margin-top: 2rem;
      padding: 1rem;
      background: #1e1e23;
      border-radius: 12px;
      font-size: 0.875rem;
      color: #7a756d;
    }

    .status-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #e07a5f;
      border-radius: 50%;
      margin-right: 0.5rem;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414" />
      </svg>
    </div>

    <h1>You&apos;re Offline</h1>
    <p>
      It looks like you&apos;ve lost your internet connection. 
      Don&apos;t worry - your drafts are saved locally and will sync when you&apos;re back online.
    </p>

    <button class="retry-btn" onclick="window.location.reload()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
      Try Again
    </button>

    <div class="status">
      <span class="status-dot"></span>
      Waiting for connection...
    </div>
  </div>

  <script>
    // Check for online status
    window.addEventListener('online', () => {
      window.location.reload();
    });
  </script>
</body>
</html>
</file>

<file path="public/robots.txt">
# Allow all crawlers
User-agent: *
Allow: /

# Sitemap location
Sitemap: https://docusign-redone.vercel.app/sitemap.xml

# Crawl-delay for all bots
Crawl-delay: 1
</file>

<file path="public/sitemap.xml">
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:news="http://www.google.com/schemas/sitemap-news/0.9"
        xmlns:xhtml="http://www.w3.org/1999/xhtml"
        xmlns:mobile="http://www.google.com/schemas/sitemap-mobile/1.0"
        xmlns:image="http://www.google.com/schemas/sitemap-image/1.1"
        xmlns:video="http://www.google.com/schemas/sitemap-video/1.1">
  <url>
    <loc>https://docusign-redone.vercel.app/</loc>
    <lastmod>2026-01-04</lastmod>
    <changefreq>weekly</changefreq>
    <priority>1.0</priority>
  </url>
  <url>
    <loc>https://docusign-redone.vercel.app/suggestions</loc>
    <lastmod>2026-01-04</lastmod>
    <changefreq>monthly</changefreq>
    <priority>0.7</priority>
  </url>
</urlset>
</file>

<file path="public/sw.js">
// DocGen Service Worker
const CACHE_NAME = 'docgen-v1';
const STATIC_CACHE = 'docgen-static-v1';
const DYNAMIC_CACHE = 'docgen-dynamic-v1';

// Assets to cache immediately
const STATIC_ASSETS = [
  '/',
  '/manifest.json',
  '/header.png',
];

// Install event - cache static assets
self.addEventListener('install', (event) => {
  console.log('[SW] Installing service worker...');
  event.waitUntil(
    caches.open(STATIC_CACHE)
      .then((cache) => {
        console.log('[SW] Caching static assets');
        return cache.addAll(STATIC_ASSETS);
      })
      .then(() => self.skipWaiting())
  );
});

// Activate event - clean up old caches
self.addEventListener('activate', (event) => {
  console.log('[SW] Activating service worker...');
  event.waitUntil(
    caches.keys().then((keys) => {
      return Promise.all(
        keys
          .filter((key) => key !== STATIC_CACHE && key !== DYNAMIC_CACHE)
          .map((key) => {
            console.log('[SW] Removing old cache:', key);
            return caches.delete(key);
          })
      );
    }).then(() => self.clients.claim())
  );
});

// Fetch event - serve from cache, fallback to network
self.addEventListener('fetch', (event) => {
  const { request } = event;
  const url = new URL(request.url);

  // Skip non-GET requests
  if (request.method !== 'GET') return;

  // Skip external requests
  if (url.origin !== location.origin) return;

  // API requests - network first
  if (url.pathname.startsWith('/api/')) {
    event.respondWith(networkFirst(request));
    return;
  }

  // Static assets - cache first
  if (isStaticAsset(url.pathname)) {
    event.respondWith(cacheFirst(request));
    return;
  }

  // HTML pages - network first with offline fallback
  if (request.headers.get('accept')?.includes('text/html')) {
    event.respondWith(networkFirstWithOffline(request));
    return;
  }

  // Default - stale while revalidate
  event.respondWith(staleWhileRevalidate(request));
});

// Check if request is for a static asset
function isStaticAsset(pathname) {
  return /\.(js|css|png|jpg|jpeg|gif|svg|ico|woff|woff2)$/.test(pathname);
}

// Cache first strategy
async function cacheFirst(request) {
  const cached = await caches.match(request);
  if (cached) return cached;

  try {
    const response = await fetch(request);
    const cache = await caches.open(STATIC_CACHE);
    cache.put(request, response.clone());
    return response;
  } catch (error) {
    console.log('[SW] Cache first failed:', error);
    return new Response('Offline', { status: 503 });
  }
}

// Network first strategy
async function networkFirst(request) {
  try {
    const response = await fetch(request);
    const cache = await caches.open(DYNAMIC_CACHE);
    cache.put(request, response.clone());
    return response;
  } catch (error) {
    const cached = await caches.match(request);
    if (cached) return cached;
    return new Response(JSON.stringify({ error: 'Offline' }), {
      status: 503,
      headers: { 'Content-Type': 'application/json' },
    });
  }
}

// Network first with offline fallback for HTML
async function networkFirstWithOffline(request) {
  try {
    const response = await fetch(request);
    const cache = await caches.open(DYNAMIC_CACHE);
    cache.put(request, response.clone());
    return response;
  } catch (error) {
    const cached = await caches.match(request);
    if (cached) return cached;

    // Return cached home page as fallback
    const fallback = await caches.match('/');
    if (fallback) return fallback;

    return new Response('Offline - Please check your connection', {
      status: 503,
      headers: { 'Content-Type': 'text/html' },
    });
  }
}

// Stale while revalidate strategy
async function staleWhileRevalidate(request) {
  const cache = await caches.open(DYNAMIC_CACHE);
  const cached = await cache.match(request);

  const fetchPromise = fetch(request).then((response) => {
    cache.put(request, response.clone());
    return response;
  }).catch(() => cached);

  return cached || fetchPromise;
}

// Handle background sync for offline document saves
self.addEventListener('sync', (event) => {
  if (event.tag === 'sync-documents') {
    event.waitUntil(syncDocuments());
  }
});

async function syncDocuments() {
  // In a real app, this would sync offline changes to the server
  console.log('[SW] Syncing documents...');
}

// Handle push notifications
self.addEventListener('push', (event) => {
  const options = {
    body: event.data?.text() || 'New notification',
    icon: '/icons/icon-192x192.png',
    badge: '/icons/badge-72x72.png',
    vibrate: [100, 50, 100],
    data: {
      dateOfArrival: Date.now(),
    },
    actions: [
      { action: 'open', title: 'Open' },
      { action: 'close', title: 'Close' },
    ],
  };

  event.waitUntil(
    self.registration.showNotification('DocGen', options)
  );
});

// Handle notification clicks
self.addEventListener('notificationclick', (event) => {
  event.notification.close();

  if (event.action === 'open' || !event.action) {
    event.waitUntil(
      clients.openWindow('/')
    );
  }
});
</file>

<file path="src/app/api/auth/[...nextauth]/route.ts">
import NextAuth from "next-auth";
import { authOptions } from "@/lib/auth";

const handler = NextAuth(authOptions);

export { handler as GET, handler as POST };
</file>

<file path="src/app/api/templates/user/[id]/route.ts">
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";
import {
  getTemplateById,
  updateTemplate,
  deleteTemplate,
  duplicateTemplate,
} from "@/lib/userTemplates";

// GET - Get a single template
export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const template = getTemplateById(params.id);
  
  if (!template) {
    return NextResponse.json({ error: "Template not found" }, { status: 404 });
  }
  
  // Check if template is public or belongs to the user
  const session = await getServerSession(authOptions);
  const userId = session?.user ? (session.user as any).id : null;
  
  if (!template.isPublic && template.userId !== userId) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  return NextResponse.json({ template });
}

// PATCH - Update a template
export async function PATCH(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await getServerSession(authOptions);
  
  if (!session?.user) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  try {
    const body = await request.json();
    const userId = (session.user as any).id;
    
    const updated = updateTemplate(params.id, userId, body);
    
    if (!updated) {
      return NextResponse.json(
        { error: "Template not found or unauthorized" },
        { status: 404 }
      );
    }
    
    return NextResponse.json({ template: updated });
  } catch (error) {
    console.error("Error updating template:", error);
    return NextResponse.json(
      { error: "Failed to update template" },
      { status: 500 }
    );
  }
}

// DELETE - Delete a template
export async function DELETE(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await getServerSession(authOptions);
  
  if (!session?.user) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  const userId = (session.user as any).id;
  const deleted = deleteTemplate(params.id, userId);
  
  if (!deleted) {
    return NextResponse.json(
      { error: "Template not found or unauthorized" },
      { status: 404 }
    );
  }
  
  return NextResponse.json({ success: true });
}

// POST - Duplicate a template
export async function POST(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await getServerSession(authOptions);
  
  if (!session?.user) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  const userId = (session.user as any).id;
  const template = getTemplateById(params.id);
  
  if (!template) {
    return NextResponse.json({ error: "Template not found" }, { status: 404 });
  }
  
  // Allow duplicating if public or owned by user
  if (!template.isPublic && template.userId !== userId) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  const duplicated = duplicateTemplate(params.id, userId);
  
  if (!duplicated) {
    return NextResponse.json(
      { error: "Failed to duplicate template" },
      { status: 500 }
    );
  }
  
  return NextResponse.json({ template: duplicated }, { status: 201 });
}
</file>

<file path="src/app/api/templates/user/route.ts">
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";
import {
  getUserTemplates,
  createTemplate,
  getPublicTemplates,
} from "@/lib/userTemplates";

// GET - Fetch user's templates or public templates
export async function GET(request: NextRequest) {
  const session = await getServerSession(authOptions);
  const { searchParams } = new URL(request.url);
  const type = searchParams.get("type") || "user";
  
  if (type === "public") {
    const templates = getPublicTemplates();
    return NextResponse.json({ templates });
  }
  
  if (!session?.user) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  const userId = (session.user as any).id;
  const templates = getUserTemplates(userId);
  
  return NextResponse.json({ templates });
}

// POST - Create a new template
export async function POST(request: NextRequest) {
  const session = await getServerSession(authOptions);
  
  if (!session?.user) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  try {
    const body = await request.json();
    const { name, description, documentType, bodyText, category, tags, isPublic } = body;
    
    if (!name || !documentType || !bodyText) {
      return NextResponse.json(
        { error: "Name, document type, and body text are required" },
        { status: 400 }
      );
    }
    
    const userId = (session.user as any).id;
    const template = createTemplate(userId, {
      name,
      description: description || "",
      documentType,
      bodyText,
      category: category || "Custom",
      tags: tags || [],
      isPublic: isPublic || false,
    });
    
    return NextResponse.json({ template }, { status: 201 });
  } catch (error) {
    console.error("Error creating template:", error);
    return NextResponse.json(
      { error: "Failed to create template" },
      { status: 500 }
    );
  }
}
</file>

<file path="src/components/AccessibilitySettings.tsx">
"use client";

import { useState, useEffect } from "react";
import {
  X,
  Accessibility,
  Eye,
  Type,
  Contrast,
  Moon,
  Zap,
  Volume2,
  VolumeX,
  Check,
} from "lucide-react";

interface AccessibilitySettingsProps {
  isOpen: boolean;
  onClose: () => void;
}

interface AccessibilityOptions {
  highContrast: boolean;
  largeText: boolean;
  reducedMotion: boolean;
  screenReaderOptimized: boolean;
  focusIndicators: boolean;
  soundEnabled: boolean;
}

const DEFAULT_OPTIONS: AccessibilityOptions = {
  highContrast: false,
  largeText: false,
  reducedMotion: false,
  screenReaderOptimized: false,
  focusIndicators: true,
  soundEnabled: true,
};

export default function AccessibilitySettings({ isOpen, onClose }: AccessibilitySettingsProps) {
  const [options, setOptions] = useState<AccessibilityOptions>(DEFAULT_OPTIONS);

  // Load saved options
  useEffect(() => {
    if (typeof window !== "undefined") {
      const saved = localStorage.getItem("accessibilityOptions");
      if (saved) {
        try {
          setOptions(JSON.parse(saved));
        } catch {
          // ignore
        }
      }

      // Check system preferences
      const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      const prefersHighContrast = window.matchMedia("(prefers-contrast: high)").matches;

      if (prefersReducedMotion || prefersHighContrast) {
        setOptions((prev) => ({
          ...prev,
          reducedMotion: prefersReducedMotion || prev.reducedMotion,
          highContrast: prefersHighContrast || prev.highContrast,
        }));
      }
    }
  }, []);

  // Apply options
  useEffect(() => {
    if (typeof document !== "undefined") {
      const root = document.documentElement;

      // High contrast
      root.classList.toggle("high-contrast", options.highContrast);

      // Large text
      root.classList.toggle("large-text", options.largeText);

      // Reduced motion
      root.classList.toggle("reduced-motion", options.reducedMotion);

      // Focus indicators
      root.classList.toggle("enhanced-focus", options.focusIndicators);

      // Save to localStorage
      localStorage.setItem("accessibilityOptions", JSON.stringify(options));
    }
  }, [options]);

  const updateOption = (key: keyof AccessibilityOptions, value: boolean) => {
    setOptions((prev) => ({ ...prev, [key]: value }));
  };

  if (!isOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="w-full max-w-md bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center">
                <Accessibility className="w-5 h-5 text-purple-500" />
              </div>
              <div>
                <h2 className="text-lg font-semibold">Accessibility</h2>
                <p className="text-sm text-[--text-muted]">Customize your experience</p>
              </div>
            </div>
            <button
              onClick={onClose}
              className="p-2 rounded-xl hover:bg-[--bg-elevated] text-[--text-muted] hover:text-[--text-primary] transition-colors"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>

        {/* Options */}
        <div className="p-6 space-y-4">
          {/* High Contrast */}
          <SettingToggle
            icon={<Contrast className="w-5 h-5" />}
            title="High Contrast"
            description="Increase color contrast for better visibility"
            enabled={options.highContrast}
            onChange={(v) => updateOption("highContrast", v)}
            color="text-yellow-500"
          />

          {/* Large Text */}
          <SettingToggle
            icon={<Type className="w-5 h-5" />}
            title="Large Text"
            description="Increase font sizes throughout the app"
            enabled={options.largeText}
            onChange={(v) => updateOption("largeText", v)}
            color="text-blue-500"
          />

          {/* Reduced Motion */}
          <SettingToggle
            icon={<Zap className="w-5 h-5" />}
            title="Reduced Motion"
            description="Minimize animations and transitions"
            enabled={options.reducedMotion}
            onChange={(v) => updateOption("reducedMotion", v)}
            color="text-green-500"
          />

          {/* Focus Indicators */}
          <SettingToggle
            icon={<Eye className="w-5 h-5" />}
            title="Enhanced Focus"
            description="Show stronger focus indicators when navigating"
            enabled={options.focusIndicators}
            onChange={(v) => updateOption("focusIndicators", v)}
            color="text-purple-500"
          />

          {/* Sound Effects */}
          <SettingToggle
            icon={options.soundEnabled ? <Volume2 className="w-5 h-5" /> : <VolumeX className="w-5 h-5" />}
            title="Sound Effects"
            description="Play sounds for actions and notifications"
            enabled={options.soundEnabled}
            onChange={(v) => updateOption("soundEnabled", v)}
            color="text-pink-500"
          />

          {/* Keyboard Shortcuts */}
          <div className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
            <h4 className="font-medium mb-3">Quick Keyboard Shortcuts</h4>
            <div className="space-y-2 text-sm">
              <div className="flex justify-between">
                <span className="text-[--text-muted]">Save draft</span>
                <kbd className="kbd">‚åòS</kbd>
              </div>
              <div className="flex justify-between">
                <span className="text-[--text-muted]">Command palette</span>
                <kbd className="kbd">‚åòK</kbd>
              </div>
              <div className="flex justify-between">
                <span className="text-[--text-muted]">Find & replace</span>
                <kbd className="kbd">‚åòF</kbd>
              </div>
              <div className="flex justify-between">
                <span className="text-[--text-muted]">Preview PDF</span>
                <kbd className="kbd">‚åòP</kbd>
              </div>
            </div>
          </div>

          {/* Reset */}
          <button
            onClick={() => setOptions(DEFAULT_OPTIONS)}
            className="w-full text-center text-sm text-[--text-muted] hover:text-[--color-primary] transition-colors"
          >
            Reset to defaults
          </button>
        </div>

        {/* Footer */}
        <div className="p-6 border-t border-[--border-default]">
          <button
            onClick={onClose}
            className="w-full px-4 py-3 rounded-xl bg-[--color-primary] text-white hover:bg-[--color-primary-hover] transition-all font-semibold flex items-center justify-center gap-2"
          >
            <Check className="w-5 h-5" />
            Done
          </button>
        </div>
      </div>
    </div>
  );
}

// Toggle component
function SettingToggle({
  icon,
  title,
  description,
  enabled,
  onChange,
  color,
}: {
  icon: React.ReactNode;
  title: string;
  description: string;
  enabled: boolean;
  onChange: (value: boolean) => void;
  color: string;
}) {
  return (
    <div className="flex items-center justify-between p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
      <div className="flex items-center gap-3">
        <span className={color}>{icon}</span>
        <div>
          <span className="font-medium">{title}</span>
          <p className="text-xs text-[--text-muted]">{description}</p>
        </div>
      </div>
      <button
        onClick={() => onChange(!enabled)}
        className={`w-12 h-6 rounded-full transition-colors relative ${
          enabled ? "bg-[--color-primary]" : "bg-[--bg-overlay]"
        }`}
        role="switch"
        aria-checked={enabled}
      >
        <span
          className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
            enabled ? "left-7" : "left-1"
          }`}
        />
      </button>
    </div>
  );
}

// CSS to inject for accessibility modes
export const accessibilityStyles = `
/* High Contrast Mode */
.high-contrast {
  --bg-base: #000000;
  --bg-surface: #0a0a0a;
  --bg-elevated: #141414;
  --text-primary: #ffffff;
  --text-secondary: #e0e0e0;
  --text-muted: #b0b0b0;
  --border-default: #404040;
  --color-primary: #ff6b6b;
  --color-accent: #4ecdc4;
}

.high-contrast .card,
.high-contrast input,
.high-contrast textarea,
.high-contrast select {
  border-width: 2px;
}

.high-contrast a,
.high-contrast button {
  text-decoration: underline;
}

/* Large Text Mode */
.large-text {
  font-size: 18px;
}

.large-text h1 { font-size: 2.5rem !important; }
.large-text h2 { font-size: 2rem !important; }
.large-text h3 { font-size: 1.5rem !important; }
.large-text .text-sm { font-size: 1rem !important; }
.large-text .text-xs { font-size: 0.875rem !important; }

.large-text input,
.large-text textarea,
.large-text select {
  font-size: 1.125rem !important;
  padding: 1rem !important;
}

/* Reduced Motion */
.reduced-motion *,
.reduced-motion *::before,
.reduced-motion *::after {
  animation-duration: 0.01ms !important;
  animation-iteration-count: 1 !important;
  transition-duration: 0.01ms !important;
}

/* Enhanced Focus */
.enhanced-focus :focus-visible {
  outline: 3px solid var(--color-primary) !important;
  outline-offset: 3px !important;
  box-shadow: 0 0 0 6px rgba(224, 122, 95, 0.3) !important;
}
`;
</file>

<file path="src/components/ActionButtons.tsx">
"use client";

import { Download, Eye, FileText } from "lucide-react";

interface ActionButtonsProps {
  onPreview: () => void;
  onDownload: () => void;
  onExportWord: () => void;
  isGenerating: boolean;
  disabled: boolean;
}

export default function ActionButtons({
  onPreview,
  onDownload,
  onExportWord,
  isGenerating,
  disabled,
}: ActionButtonsProps) {
  return (
    <section className="flex flex-col sm:flex-row gap-3 pt-4">
      <button
        onClick={onPreview}
        disabled={isGenerating || disabled}
        className="flex-1 flex items-center justify-center gap-2 px-5 py-3 rounded-xl text-[--text-primary] bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary] hover-lift disabled:opacity-40 disabled:cursor-not-allowed font-medium transition-all"
      >
        <Eye className="w-5 h-5" />
        {isGenerating ? "Working..." : "Preview"}
      </button>

      <button
        onClick={onDownload}
        disabled={isGenerating || disabled}
        className="flex-1 flex items-center justify-center gap-2 px-5 py-3 rounded-xl text-white bg-[--color-primary] hover:bg-[--color-primary-hover] disabled:opacity-40 disabled:cursor-not-allowed font-semibold transition-all shadow-lg shadow-[--color-primary]/20 hover:shadow-xl hover:shadow-[--color-primary]/30 hover:-translate-y-0.5 animate-pulse-glow"
      >
        <Download className="w-5 h-5" />
        {isGenerating ? "Generating..." : "Download PDF"}
      </button>

      <button
        onClick={onExportWord}
        disabled={isGenerating || disabled}
        className="px-5 py-3 rounded-xl text-[--text-primary] bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-accent] hover-lift disabled:opacity-40 disabled:cursor-not-allowed font-medium transition-all flex items-center justify-center gap-2"
      >
        <FileText className="w-5 h-5" />
        Word
      </button>
    </section>
  );
}
</file>

<file path="src/components/AIWritingAssistant.tsx">
"use client";

import { useState } from "react";

interface AIWritingAssistantProps {
  isOpen: boolean;
  onClose: () => void;
  onInsert: (text: string) => void;
  selectedText?: string;
}

const QUICK_PROMPTS = [
  { icon: "‚úçÔ∏è", label: "Improve writing", action: "improve" },
  { icon: "üìù", label: "Make formal", action: "formal" },
  { icon: "üí¨", label: "Make casual", action: "casual" },
  { icon: "üìè", label: "Make shorter", action: "shorten" },
  { icon: "üìñ", label: "Make longer", action: "expand" },
  { icon: "üîß", label: "Fix grammar", action: "grammar" },
];

const TEMPLATES = [
  { category: "Opening", suggestions: [
    "I am writing to formally request...",
    "This letter serves as official notification...",
    "I hope this letter finds you well...",
    "Further to our recent conversation...",
  ]},
  { category: "Closing", suggestions: [
    "Thank you for your attention to this matter.",
    "Please do not hesitate to contact me.",
    "I look forward to your response.",
    "Your prompt attention would be appreciated.",
  ]},
  { category: "Transitions", suggestions: [
    "Furthermore, I would like to add...",
    "In addition to the above...",
    "With regards to your inquiry...",
    "As previously discussed...",
  ]},
];

export default function AIWritingAssistant({ isOpen, onClose, onInsert, selectedText }: AIWritingAssistantProps) {
  const [prompt, setPrompt] = useState("");
  const [isProcessing, setIsProcessing] = useState(false);
  const [suggestion, setSuggestion] = useState("");
  const [activeTab, setActiveTab] = useState<"assist" | "templates" | "phrases">("assist");

  // Simulate AI processing (placeholder - would connect to actual AI service)
  const handleProcess = async (action: string) => {
    setIsProcessing(true);
    
    // Simulate processing delay
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    let result = "";
    const text = selectedText || prompt;
    
    switch (action) {
      case "improve":
        result = `[Improved version would appear here]\n\nOriginal: "${text}"`;
        break;
      case "formal":
        result = `[More formal version would appear here]\n\nOriginal: "${text}"`;
        break;
      case "casual":
        result = `[More casual version would appear here]\n\nOriginal: "${text}"`;
        break;
      case "shorten":
        result = `[Shortened version would appear here]\n\nOriginal: "${text}"`;
        break;
      case "expand":
        result = `[Expanded version would appear here]\n\nOriginal: "${text}"`;
        break;
      case "grammar":
        result = `[Grammar-corrected version would appear here]\n\nOriginal: "${text}"`;
        break;
      default:
        result = `[AI response would appear here based on prompt: "${prompt}"]`;
    }
    
    setSuggestion(result);
    setIsProcessing(false);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-2xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">ü§ñ AI Writing Assistant</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        {/* Tabs */}
        <div className="flex border-b border-[#2a2a3a]">
          {[
            { id: "assist", label: "‚ú® AI Assist" },
            { id: "templates", label: "üìã Templates" },
            { id: "phrases", label: "üí¨ Phrases" },
          ].map(tab => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as typeof activeTab)}
              className={`flex-1 py-3 text-sm transition-colors ${
                activeTab === tab.id
                  ? "text-[#a78bfa] border-b-2 border-[#a78bfa]"
                  : "text-[#666680] hover:text-white"
              }`}
            >
              {tab.label}
            </button>
          ))}
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {activeTab === "assist" && (
            <div className="space-y-6">
              {/* Info Banner */}
              <div className="p-4 rounded-lg bg-gradient-to-r from-[#a78bfa]/10 to-[#f472b6]/10 border border-[#a78bfa]/30">
                <p className="text-sm text-[#a0a0a0]">
                  üöÄ <strong className="text-white">Coming Soon:</strong> Connect your own AI API key to enable full AI-powered writing assistance.
                </p>
              </div>

              {/* Selected text display */}
              {selectedText && (
                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Selected Text</label>
                  <div className="p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white text-sm max-h-24 overflow-auto">
                    {selectedText}
                  </div>
                </div>
              )}

              {/* Quick Actions */}
              <div>
                <label className="block text-sm text-[#a0a0a0] mb-2">Quick Actions</label>
                <div className="grid grid-cols-3 gap-2">
                  {QUICK_PROMPTS.map(prompt => (
                    <button
                      key={prompt.action}
                      onClick={() => handleProcess(prompt.action)}
                      disabled={isProcessing || (!selectedText && !prompt)}
                      className="p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] hover:border-[#a78bfa] transition-colors disabled:opacity-50"
                    >
                      <span className="text-xl block mb-1">{prompt.icon}</span>
                      <span className="text-xs text-[#a0a0a0]">{prompt.label}</span>
                    </button>
                  ))}
                </div>
              </div>

              {/* Custom Prompt */}
              <div>
                <label className="block text-sm text-[#a0a0a0] mb-2">Custom Prompt</label>
                <div className="flex gap-2">
                  <input
                    type="text"
                    value={prompt}
                    onChange={(e) => setPrompt(e.target.value)}
                    placeholder="e.g., Write a paragraph about..."
                    className="flex-1 px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white focus:border-[#a78bfa]"
                  />
                  <button
                    onClick={() => handleProcess("custom")}
                    disabled={isProcessing || !prompt}
                    className="px-4 py-2 rounded-lg bg-[#a78bfa] text-white hover:bg-[#9575f0] disabled:opacity-50"
                  >
                    {isProcessing ? "..." : "Generate"}
                  </button>
                </div>
              </div>

              {/* Suggestion Output */}
              {suggestion && (
                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Suggestion</label>
                  <div className="p-4 rounded-lg bg-[#1a1a24] border border-[#4ecdc4]/30 text-white">
                    <pre className="whitespace-pre-wrap text-sm">{suggestion}</pre>
                    <button
                      onClick={() => {
                        onInsert(suggestion);
                        onClose();
                      }}
                      className="mt-3 px-4 py-2 rounded-lg bg-[#4ecdc4] text-[#0a0a12] hover:bg-[#3dbdb5] text-sm"
                    >
                      Insert into Document
                    </button>
                  </div>
                </div>
              )}
            </div>
          )}

          {activeTab === "templates" && (
            <div className="space-y-6">
              {TEMPLATES.map(category => (
                <div key={category.category}>
                  <h3 className="text-sm font-medium text-[#a78bfa] mb-3">{category.category}</h3>
                  <div className="space-y-2">
                    {category.suggestions.map((text, index) => (
                      <button
                        key={index}
                        onClick={() => {
                          onInsert(text);
                          onClose();
                        }}
                        className="w-full p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] hover:border-[#a78bfa] text-left transition-colors"
                      >
                        <span className="text-white text-sm">{text}</span>
                      </button>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          )}

          {activeTab === "phrases" && (
            <div className="space-y-4">
              <p className="text-sm text-[#666680]">Click any phrase to insert it into your document.</p>
              
              <div className="grid grid-cols-2 gap-2">
                {[
                  "As per our discussion",
                  "Please find attached",
                  "For your reference",
                  "At your earliest convenience",
                  "As mentioned previously",
                  "Thank you for your time",
                  "Please be advised that",
                  "We appreciate your patience",
                  "Should you require",
                  "We regret to inform",
                  "It is our pleasure",
                  "We are pleased to confirm",
                ].map((phrase, index) => (
                  <button
                    key={index}
                    onClick={() => {
                      onInsert(phrase);
                      onClose();
                    }}
                    className="p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] hover:border-[#4ecdc4] text-white text-sm text-left transition-colors"
                  >
                    {phrase}
                  </button>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/APIAccess.tsx">
"use client";

import { useState } from "react";

interface APIAccessProps {
  isOpen: boolean;
  onClose: () => void;
}

const API_ENDPOINTS = [
  { method: "POST", path: "/api/documents", description: "Generate a new document" },
  { method: "GET", path: "/api/documents/:id", description: "Get document by ID" },
  { method: "GET", path: "/api/templates", description: "List all templates" },
  { method: "POST", path: "/api/templates", description: "Create a new template" },
  { method: "DELETE", path: "/api/templates/:id", description: "Delete a template" },
];

const SAMPLE_CODE = {
  curl: `curl -X POST https://api.docgen.app/v1/documents \\
  -H "Authorization: Bearer YOUR_API_KEY" \\
  -H "Content-Type: application/json" \\
  -d '{
    "template_id": "tmpl_123",
    "data": {
      "recipient_name": "John Doe",
      "company": "Acme Inc"
    }
  }'`,
  javascript: `const response = await fetch('https://api.docgen.app/v1/documents', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    template_id: 'tmpl_123',
    data: {
      recipient_name: 'John Doe',
      company: 'Acme Inc',
    },
  }),
});

const { document_url } = await response.json();`,
  python: `import requests

response = requests.post(
    'https://api.docgen.app/v1/documents',
    headers={
        'Authorization': 'Bearer YOUR_API_KEY',
        'Content-Type': 'application/json',
    },
    json={
        'template_id': 'tmpl_123',
        'data': {
            'recipient_name': 'John Doe',
            'company': 'Acme Inc',
        },
    },
)

document_url = response.json()['document_url']`,
};

export default function APIAccess({ isOpen, onClose }: APIAccessProps) {
  const [apiKey, setApiKey] = useState("");
  const [showKey, setShowKey] = useState(false);
  const [selectedLanguage, setSelectedLanguage] = useState<keyof typeof SAMPLE_CODE>("curl");
  const [copied, setCopied] = useState(false);

  const generateKey = () => {
    const key = `dg_live_${Array.from({ length: 32 }, () => 
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random() * 62)]
    ).join("")}`;
    setApiKey(key);
    setShowKey(true);
  };

  const copyCode = () => {
    navigator.clipboard.writeText(SAMPLE_CODE[selectedLanguage]);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-4xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üîë API Access</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {/* Coming Soon Banner */}
          <div className="mb-6 p-4 rounded-lg bg-gradient-to-r from-[#a78bfa]/10 to-[#f472b6]/10 border border-[#a78bfa]/30">
            <p className="text-[#a0a0a0]">
              <strong className="text-white">üöÄ API Access Coming Soon!</strong> This is a preview of the upcoming API functionality.
            </p>
          </div>

          {/* API Key Section */}
          <div className="mb-8">
            <h3 className="text-lg text-white font-medium mb-4">Your API Key</h3>
            <div className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
              {apiKey ? (
                <div>
                  <div className="flex items-center gap-3 mb-3">
                    <code className="flex-1 px-3 py-2 rounded bg-[#12121a] text-[#4ecdc4] font-mono text-sm">
                      {showKey ? apiKey : "‚Ä¢".repeat(40)}
                    </code>
                    <button
                      onClick={() => setShowKey(!showKey)}
                      className="px-3 py-2 rounded bg-[#2a2a3a] text-white text-sm"
                    >
                      {showKey ? "Hide" : "Show"}
                    </button>
                    <button
                      onClick={() => {
                        navigator.clipboard.writeText(apiKey);
                        setCopied(true);
                        setTimeout(() => setCopied(false), 2000);
                      }}
                      className="px-3 py-2 rounded bg-[#4ecdc4] text-[#0a0a12] text-sm"
                    >
                      {copied ? "Copied!" : "Copy"}
                    </button>
                  </div>
                  <p className="text-xs text-[#f87171]">
                    ‚ö†Ô∏è Keep this key secret. Don&apos;t share it publicly or commit it to version control.
                  </p>
                </div>
              ) : (
                <div className="text-center py-4">
                  <p className="text-[#666680] mb-4">No API key generated yet.</p>
                  <button
                    onClick={generateKey}
                    className="px-6 py-2 rounded-lg bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white"
                  >
                    Generate API Key
                  </button>
                </div>
              )}
            </div>
          </div>

          {/* Endpoints */}
          <div className="mb-8">
            <h3 className="text-lg text-white font-medium mb-4">Endpoints</h3>
            <div className="space-y-2">
              {API_ENDPOINTS.map((endpoint, index) => (
                <div key={index} className="p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] flex items-center gap-4">
                  <span className={`px-2 py-1 rounded text-xs font-mono ${
                    endpoint.method === "GET" ? "bg-[#4ade80]/20 text-[#4ade80]" :
                    endpoint.method === "POST" ? "bg-[#60a5fa]/20 text-[#60a5fa]" :
                    "bg-[#f87171]/20 text-[#f87171]"
                  }`}>
                    {endpoint.method}
                  </span>
                  <code className="text-[#a0a0a0] font-mono text-sm">{endpoint.path}</code>
                  <span className="text-sm text-[#666680] ml-auto">{endpoint.description}</span>
                </div>
              ))}
            </div>
          </div>

          {/* Code Examples */}
          <div>
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-lg text-white font-medium">Code Examples</h3>
              <div className="flex gap-2">
                {(Object.keys(SAMPLE_CODE) as Array<keyof typeof SAMPLE_CODE>).map(lang => (
                  <button
                    key={lang}
                    onClick={() => setSelectedLanguage(lang)}
                    className={`px-3 py-1 rounded text-sm capitalize ${
                      selectedLanguage === lang
                        ? "bg-[#a78bfa] text-white"
                        : "bg-[#2a2a3a] text-[#a0a0a0]"
                    }`}
                  >
                    {lang}
                  </button>
                ))}
              </div>
            </div>
            <div className="relative">
              <pre className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-sm text-[#a0a0a0] font-mono overflow-auto">
                {SAMPLE_CODE[selectedLanguage]}
              </pre>
              <button
                onClick={copyCode}
                className="absolute top-2 right-2 px-3 py-1 rounded bg-[#2a2a3a] text-white text-sm hover:bg-[#3a3a4a]"
              >
                {copied ? "Copied!" : "Copy"}
              </button>
            </div>
          </div>

          {/* Rate Limits */}
          <div className="mt-8 p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
            <h4 className="text-white font-medium mb-2">Rate Limits</h4>
            <div className="grid grid-cols-3 gap-4 text-sm">
              <div>
                <span className="text-[#666680]">Free Tier</span>
                <p className="text-white">100 requests/day</p>
              </div>
              <div>
                <span className="text-[#666680]">Pro Tier</span>
                <p className="text-[#a78bfa]">10,000 requests/day</p>
              </div>
              <div>
                <span className="text-[#666680]">Enterprise</span>
                <p className="text-[#4ecdc4]">Unlimited</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/ApprovalWorkflow.tsx">
"use client";

import { useState, useEffect } from "react";

export interface Approver {
  id: string;
  name: string;
  email: string;
  role: string;
  order: number;
}

export interface ApprovalStep {
  approverId: string;
  status: "pending" | "approved" | "rejected" | "skipped";
  timestamp?: string;
  comment?: string;
}

export interface ApprovalWorkflowData {
  id: string;
  documentId: string;
  documentName: string;
  approvers: Approver[];
  steps: ApprovalStep[];
  currentStep: number;
  status: "draft" | "in_review" | "approved" | "rejected";
  createdAt: string;
}

interface ApprovalWorkflowProps {
  isOpen: boolean;
  onClose: () => void;
  documentName: string;
  onSubmitForApproval: (approvers: Approver[]) => void;
}

const PRESET_APPROVERS: Approver[] = [
  { id: "1", name: "Manager", email: "", role: "Manager", order: 1 },
  { id: "2", name: "Legal", email: "", role: "Legal Review", order: 2 },
  { id: "3", name: "Executive", email: "", role: "Executive Approval", order: 3 },
];

export default function ApprovalWorkflow({ isOpen, onClose, documentName, onSubmitForApproval }: ApprovalWorkflowProps) {
  const [approvers, setApprovers] = useState<Approver[]>([]);
  const [newApprover, setNewApprover] = useState({ name: "", email: "", role: "" });

  const addApprover = () => {
    if (!newApprover.name || !newApprover.email) return;
    const approver: Approver = {
      id: `approver-${Date.now()}`,
      ...newApprover,
      order: approvers.length + 1,
    };
    setApprovers([...approvers, approver]);
    setNewApprover({ name: "", email: "", role: "" });
  };

  const removeApprover = (id: string) => {
    setApprovers(approvers.filter(a => a.id !== id).map((a, i) => ({ ...a, order: i + 1 })));
  };

  const moveApprover = (id: string, direction: "up" | "down") => {
    const index = approvers.findIndex(a => a.id === id);
    if (direction === "up" && index > 0) {
      const newList = [...approvers];
      [newList[index - 1], newList[index]] = [newList[index], newList[index - 1]];
      setApprovers(newList.map((a, i) => ({ ...a, order: i + 1 })));
    } else if (direction === "down" && index < approvers.length - 1) {
      const newList = [...approvers];
      [newList[index], newList[index + 1]] = [newList[index + 1], newList[index]];
      setApprovers(newList.map((a, i) => ({ ...a, order: i + 1 })));
    }
  };

  const addPresetApprover = (preset: Approver) => {
    if (approvers.some(a => a.role === preset.role)) return;
    setApprovers([...approvers, { ...preset, id: `approver-${Date.now()}`, order: approvers.length + 1 }]);
  };

  const handleSubmit = () => {
    if (approvers.length === 0) return;
    onSubmitForApproval(approvers);
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
      <div className="bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col">
        <div className="p-5 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <h2 className="text-lg font-semibold text-[--text-primary]">Approval Workflow</h2>
            <button onClick={onClose} className="text-[--text-muted] hover:text-[--text-primary]">‚úï</button>
          </div>
          <p className="text-sm text-[--text-muted] mt-1">
            Set up reviewers for: <span className="text-[--text-secondary]">{documentName}</span>
          </p>
        </div>

        <div className="flex-1 overflow-y-auto p-5 space-y-5">
          {/* Quick Add Presets */}
          <div>
            <h3 className="text-sm font-medium text-[--text-secondary] mb-2">Quick Add</h3>
            <div className="flex flex-wrap gap-2">
              {PRESET_APPROVERS.map(preset => (
                <button
                  key={preset.id}
                  onClick={() => addPresetApprover(preset)}
                  disabled={approvers.some(a => a.role === preset.role)}
                  className="px-3 py-1.5 rounded-lg text-sm bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:border-[--color-primary] disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  + {preset.role}
                </button>
              ))}
            </div>
          </div>

          {/* Current Approvers */}
          {approvers.length > 0 && (
            <div>
              <h3 className="text-sm font-medium text-[--text-secondary] mb-2">Approval Chain</h3>
              <div className="space-y-2">
                {approvers.map((approver, index) => (
                  <div key={approver.id} className="flex items-center gap-3 p-3 rounded-lg bg-[--bg-elevated] border border-[--border-default]">
                    <span className="w-6 h-6 rounded-full bg-[--color-primary] text-white text-xs flex items-center justify-center font-medium">
                      {index + 1}
                    </span>
                    <div className="flex-1">
                      <div className="font-medium text-[--text-primary]">{approver.name}</div>
                      <div className="text-xs text-[--text-muted]">{approver.role} ‚Ä¢ {approver.email || "No email"}</div>
                    </div>
                    <div className="flex gap-1">
                      <button
                        onClick={() => moveApprover(approver.id, "up")}
                        disabled={index === 0}
                        className="p-1 text-[--text-muted] hover:text-[--text-primary] disabled:opacity-30"
                      >
                        ‚Üë
                      </button>
                      <button
                        onClick={() => moveApprover(approver.id, "down")}
                        disabled={index === approvers.length - 1}
                        className="p-1 text-[--text-muted] hover:text-[--text-primary] disabled:opacity-30"
                      >
                        ‚Üì
                      </button>
                      <button
                        onClick={() => removeApprover(approver.id)}
                        className="p-1 text-red-400 hover:text-red-300"
                      >
                        ‚úï
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Add Custom Approver */}
          <div>
            <h3 className="text-sm font-medium text-[--text-secondary] mb-2">Add Custom Approver</h3>
            <div className="space-y-2">
              <input
                type="text"
                value={newApprover.name}
                onChange={(e) => setNewApprover({ ...newApprover, name: e.target.value })}
                placeholder="Name"
                className="w-full px-4 py-2 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
              />
              <input
                type="email"
                value={newApprover.email}
                onChange={(e) => setNewApprover({ ...newApprover, email: e.target.value })}
                placeholder="Email"
                className="w-full px-4 py-2 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
              />
              <input
                type="text"
                value={newApprover.role}
                onChange={(e) => setNewApprover({ ...newApprover, role: e.target.value })}
                placeholder="Role (e.g., Legal Review)"
                className="w-full px-4 py-2 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
              />
              <button
                onClick={addApprover}
                disabled={!newApprover.name || !newApprover.email}
                className="w-full px-4 py-2 rounded-lg bg-[--bg-overlay] border border-[--border-default] text-[--text-primary] hover:border-[--color-primary] disabled:opacity-50 text-sm"
              >
                Add Approver
              </button>
            </div>
          </div>
        </div>

        <div className="p-5 border-t border-[--border-default] flex gap-3">
          <button
            onClick={onClose}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:bg-[--bg-overlay]"
          >
            Cancel
          </button>
          <button
            onClick={handleSubmit}
            disabled={approvers.length === 0}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--color-primary] text-white hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Submit for Approval
          </button>
        </div>
      </div>
    </div>
  );
}

// Hook to manage approval workflows
export function useApprovalWorkflow() {
  const [workflows, setWorkflows] = useState<ApprovalWorkflowData[]>([]);

  useEffect(() => {
    const saved = localStorage.getItem("approvalWorkflows");
    if (saved) {
      try {
        setWorkflows(JSON.parse(saved));
      } catch {
        setWorkflows([]);
      }
    }
  }, []);

  const saveWorkflows = (data: ApprovalWorkflowData[]) => {
    setWorkflows(data);
    localStorage.setItem("approvalWorkflows", JSON.stringify(data));
  };

  const createWorkflow = (documentId: string, documentName: string, approvers: Approver[]): ApprovalWorkflowData => {
    const workflow: ApprovalWorkflowData = {
      id: `workflow-${Date.now()}`,
      documentId,
      documentName,
      approvers,
      steps: approvers.map(a => ({ approverId: a.id, status: "pending" })),
      currentStep: 0,
      status: "in_review",
      createdAt: new Date().toISOString(),
    };
    saveWorkflows([...workflows, workflow]);
    return workflow;
  };

  const approveStep = (workflowId: string, comment?: string) => {
    const workflow = workflows.find(w => w.id === workflowId);
    if (!workflow) return;

    const newSteps = [...workflow.steps];
    newSteps[workflow.currentStep] = {
      ...newSteps[workflow.currentStep],
      status: "approved",
      timestamp: new Date().toISOString(),
      comment,
    };

    const isComplete = workflow.currentStep >= workflow.approvers.length - 1;
    
    saveWorkflows(workflows.map(w => w.id === workflowId ? {
      ...w,
      steps: newSteps,
      currentStep: isComplete ? w.currentStep : w.currentStep + 1,
      status: isComplete ? "approved" : "in_review",
    } : w));
  };

  const rejectStep = (workflowId: string, comment: string) => {
    const workflow = workflows.find(w => w.id === workflowId);
    if (!workflow) return;

    const newSteps = [...workflow.steps];
    newSteps[workflow.currentStep] = {
      ...newSteps[workflow.currentStep],
      status: "rejected",
      timestamp: new Date().toISOString(),
      comment,
    };

    saveWorkflows(workflows.map(w => w.id === workflowId ? {
      ...w,
      steps: newSteps,
      status: "rejected",
    } : w));
  };

  return { workflows, createWorkflow, approveStep, rejectStep };
}
</file>

<file path="src/components/AuditTrail.tsx">
"use client";

import { useState, useEffect } from "react";

export interface AuditEvent {
  id: string;
  timestamp: string;
  action: string;
  details: string;
  documentType?: string;
  user?: string;
}

const STORAGE_KEY = "auditTrail";
const MAX_EVENTS = 500;

export function useAuditTrail() {
  const [events, setEvents] = useState<AuditEvent[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    loadEvents();
  }, []);

  const loadEvents = () => {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      try {
        setEvents(JSON.parse(saved));
      } catch (e) {
        console.error("Error loading audit trail:", e);
      }
    }
  };

  const logEvent = (action: string, details: string, documentType?: string) => {
    const event: AuditEvent = {
      id: `audit-${Date.now()}`,
      timestamp: new Date().toISOString(),
      action,
      details,
      documentType,
    };

    const updated = [event, ...events].slice(0, MAX_EVENTS);
    setEvents(updated);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));
  };

  const clearEvents = () => {
    setEvents([]);
    localStorage.removeItem(STORAGE_KEY);
  };

  const exportEvents = () => {
    const csv = [
      "Timestamp,Action,Details,Document Type",
      ...events.map(e => `"${e.timestamp}","${e.action}","${e.details}","${e.documentType || ""}"`)
    ].join("\n");

    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = `audit-trail-${new Date().toISOString().split("T")[0]}.csv`;
    link.click();
    URL.revokeObjectURL(url);
  };

  return { events, logEvent, clearEvents, exportEvents, mounted };
}

interface AuditTrailProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function AuditTrail({ isOpen, onClose }: AuditTrailProps) {
  const { events, clearEvents, exportEvents } = useAuditTrail();
  const [filter, setFilter] = useState<string>("all");

  if (!isOpen) return null;

  const getActionIcon = (action: string) => {
    switch (action) {
      case "create": return "üìÑ";
      case "download": return "üì•";
      case "preview": return "üëÅÔ∏è";
      case "edit": return "‚úèÔ∏è";
      case "delete": return "üóëÔ∏è";
      case "template": return "üìã";
      case "settings": return "‚öôÔ∏è";
      default: return "üìå";
    }
  };

  const getActionColor = (action: string) => {
    switch (action) {
      case "create": return "#4ade80";
      case "download": return "#60a5fa";
      case "preview": return "#a78bfa";
      case "edit": return "#f0b866";
      case "delete": return "#f87171";
      case "template": return "#4ecdc4";
      case "settings": return "#f472b6";
      default: return "#a0a0a0";
    }
  };

  const formatDate = (timestamp: string) => {
    const date = new Date(timestamp);
    const now = new Date();
    const diff = now.getTime() - date.getTime();

    if (diff < 60000) return "Just now";
    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
    if (diff < 604800000) return `${Math.floor(diff / 86400000)}d ago`;
    
    return date.toLocaleDateString();
  };

  const filteredEvents = filter === "all" 
    ? events 
    : events.filter(e => e.action === filter);

  const actionTypes = Array.from(new Set(events.map(e => e.action)));

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-3xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üìú Audit Trail</h2>
          <div className="flex items-center gap-2">
            <button
              onClick={exportEvents}
              className="px-3 py-1.5 rounded-lg text-sm text-[#4ecdc4] hover:bg-[#4ecdc4]/10 transition-colors"
            >
              Export CSV
            </button>
            <button
              onClick={clearEvents}
              className="px-3 py-1.5 rounded-lg text-sm text-[#f87171] hover:bg-[#f87171]/10 transition-colors"
            >
              Clear
            </button>
            <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
          </div>
        </div>

        {/* Filter */}
        <div className="flex gap-2 p-4 border-b border-[#2a2a3a] overflow-x-auto">
          <button
            onClick={() => setFilter("all")}
            className={`px-3 py-1.5 rounded-lg text-sm whitespace-nowrap transition-colors ${
              filter === "all" ? "bg-[#a78bfa] text-white" : "text-[#666680] hover:text-white"
            }`}
          >
            All ({events.length})
          </button>
          {actionTypes.map(action => (
            <button
              key={action}
              onClick={() => setFilter(action)}
              className={`px-3 py-1.5 rounded-lg text-sm whitespace-nowrap transition-colors ${
                filter === action ? "text-white" : "text-[#666680] hover:text-white"
              }`}
              style={{ backgroundColor: filter === action ? getActionColor(action) : "transparent" }}
            >
              {getActionIcon(action)} {action}
            </button>
          ))}
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-4">
          {filteredEvents.length === 0 ? (
            <div className="text-center py-12 text-[#666680]">
              <p>No audit events recorded yet.</p>
              <p className="text-sm mt-2">Activities will appear here as you use the app.</p>
            </div>
          ) : (
            <div className="space-y-2">
              {filteredEvents.map(event => (
                <div key={event.id} className="flex items-start gap-3 p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] hover:border-[#3a3a4a] transition-colors">
                  <div 
                    className="w-8 h-8 rounded-full flex items-center justify-center text-sm"
                    style={{ backgroundColor: `${getActionColor(event.action)}20` }}
                  >
                    {getActionIcon(event.action)}
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2">
                      <span className="text-white font-medium capitalize">{event.action}</span>
                      {event.documentType && (
                        <span className="px-2 py-0.5 rounded-full text-xs bg-[#2a2a3a] text-[#a0a0a0]">
                          {event.documentType}
                        </span>
                      )}
                    </div>
                    <p className="text-sm text-[#a0a0a0] truncate">{event.details}</p>
                  </div>
                  <span className="text-xs text-[#666680] whitespace-nowrap">{formatDate(event.timestamp)}</span>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Stats */}
        <div className="p-4 border-t border-[#2a2a3a] flex items-center justify-between">
          <span className="text-sm text-[#666680]">
            Showing {filteredEvents.length} of {events.length} events
          </span>
          <span className="text-xs text-[#666680]">
            Events are stored locally
          </span>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/AuthModal.tsx">
"use client";

import { useState } from "react";
import { signIn } from "next-auth/react";
import {
  X,
  Mail,
  Lock,
  User,
  Eye,
  EyeOff,
  Loader2,
  AlertCircle,
  CheckCircle,
  LogIn,
  UserPlus,
} from "lucide-react";
import { toast } from "react-hot-toast";

interface AuthModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSuccess?: () => void;
  defaultTab?: "login" | "signup";
}

export default function AuthModal({
  isOpen,
  onClose,
  onSuccess,
  defaultTab = "login",
}: AuthModalProps) {
  const [tab, setTab] = useState<"login" | "signup">(defaultTab);
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [name, setName] = useState("");
  const [showPassword, setShowPassword] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState("");

  const resetForm = () => {
    setEmail("");
    setPassword("");
    setName("");
    setError("");
  };

  const handleTabChange = (newTab: "login" | "signup") => {
    setTab(newTab);
    resetForm();
  };

  const validateForm = () => {
    if (!email.trim()) {
      setError("Email is required");
      return false;
    }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      setError("Please enter a valid email address");
      return false;
    }
    if (!password || password.length < 6) {
      setError("Password must be at least 6 characters");
      return false;
    }
    if (tab === "signup" && !name.trim()) {
      setError("Name is required");
      return false;
    }
    return true;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError("");

    if (!validateForm()) return;

    setIsLoading(true);

    try {
      const result = await signIn("credentials", {
        email,
        password,
        name: tab === "signup" ? name : undefined,
        action: tab,
        redirect: false,
      });

      if (result?.error) {
        setError(result.error);
      } else {
        toast.success(tab === "login" ? "Welcome back!" : "Account created successfully!");
        onSuccess?.();
        onClose();
        resetForm();
      }
    } catch (err) {
      setError("An unexpected error occurred. Please try again.");
    } finally {
      setIsLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black/70 backdrop-blur-sm z-[100] flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="w-full max-w-md bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="relative p-6 pb-0">
          <button
            onClick={onClose}
            className="absolute top-4 right-4 p-2 rounded-xl hover:bg-[--bg-elevated] text-[--text-muted] hover:text-[--text-primary] transition-colors"
          >
            <X className="w-5 h-5" />
          </button>

          {/* Tabs */}
          <div className="flex gap-1 p-1 bg-[--bg-elevated] rounded-xl mb-6">
            <button
              onClick={() => handleTabChange("login")}
              className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all ${
                tab === "login"
                  ? "bg-[--color-primary] text-white shadow-lg"
                  : "text-[--text-muted] hover:text-[--text-primary]"
              }`}
            >
              <LogIn className="w-4 h-4" />
              Sign In
            </button>
            <button
              onClick={() => handleTabChange("signup")}
              className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all ${
                tab === "signup"
                  ? "bg-[--color-primary] text-white shadow-lg"
                  : "text-[--text-muted] hover:text-[--text-primary]"
              }`}
            >
              <UserPlus className="w-4 h-4" />
              Sign Up
            </button>
          </div>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit} className="p-6 pt-0 space-y-4">
          <div className="text-center mb-6">
            <h2 className="text-2xl font-bold">
              {tab === "login" ? "Welcome Back" : "Create Account"}
            </h2>
            <p className="text-sm text-[--text-muted] mt-1">
              {tab === "login"
                ? "Sign in to access your templates"
                : "Sign up to save and sync your templates"}
            </p>
          </div>

          {/* Error Message */}
          {error && (
            <div className="flex items-center gap-2 p-3 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm">
              <AlertCircle className="w-4 h-4 flex-shrink-0" />
              {error}
            </div>
          )}

          {/* Name Field (Signup only) */}
          {tab === "signup" && (
            <div>
              <label className="block text-sm font-medium text-[--text-secondary] mb-2">
                Full Name
              </label>
              <div className="relative">
                <User className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[--text-muted]" />
                <input
                  type="text"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  placeholder="John Doe"
                  className="w-full pl-10 pr-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary] focus:ring-2 focus:ring-[--color-primary]/20"
                  disabled={isLoading}
                />
              </div>
            </div>
          )}

          {/* Email Field */}
          <div>
            <label className="block text-sm font-medium text-[--text-secondary] mb-2">
              Email Address
            </label>
            <div className="relative">
              <Mail className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[--text-muted]" />
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                placeholder="you@example.com"
                className="w-full pl-10 pr-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary] focus:ring-2 focus:ring-[--color-primary]/20"
                disabled={isLoading}
              />
            </div>
          </div>

          {/* Password Field */}
          <div>
            <label className="block text-sm font-medium text-[--text-secondary] mb-2">
              Password
            </label>
            <div className="relative">
              <Lock className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[--text-muted]" />
              <input
                type={showPassword ? "text" : "password"}
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                className="w-full pl-10 pr-12 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary] focus:ring-2 focus:ring-[--color-primary]/20"
                disabled={isLoading}
              />
              <button
                type="button"
                onClick={() => setShowPassword(!showPassword)}
                className="absolute right-3 top-1/2 -translate-y-1/2 text-[--text-muted] hover:text-[--text-primary]"
              >
                {showPassword ? (
                  <EyeOff className="w-5 h-5" />
                ) : (
                  <Eye className="w-5 h-5" />
                )}
              </button>
            </div>
            {tab === "signup" && (
              <p className="text-xs text-[--text-muted] mt-1">
                Must be at least 6 characters
              </p>
            )}
          </div>

          {/* Submit Button */}
          <button
            type="submit"
            disabled={isLoading}
            className="w-full py-3 rounded-xl bg-[--color-primary] text-white hover:bg-[--color-primary-hover] transition-all font-semibold disabled:opacity-50 flex items-center justify-center gap-2 mt-6"
          >
            {isLoading ? (
              <>
                <Loader2 className="w-5 h-5 animate-spin" />
                {tab === "login" ? "Signing in..." : "Creating account..."}
              </>
            ) : (
              <>
                {tab === "login" ? (
                  <>
                    <LogIn className="w-5 h-5" />
                    Sign In
                  </>
                ) : (
                  <>
                    <UserPlus className="w-5 h-5" />
                    Create Account
                  </>
                )}
              </>
            )}
          </button>

          {/* Features List */}
          <div className="mt-6 pt-6 border-t border-[--border-default]">
            <p className="text-xs text-[--text-muted] text-center mb-3">
              {tab === "signup" ? "What you get with an account:" : "Sign in to access:"}
            </p>
            <div className="grid grid-cols-2 gap-2 text-xs">
              {[
                "Save templates",
                "Sync across devices",
                "Share templates",
                "Template history",
              ].map((feature) => (
                <div
                  key={feature}
                  className="flex items-center gap-1.5 text-[--text-secondary]"
                >
                  <CheckCircle className="w-3.5 h-3.5 text-[--color-success]" />
                  {feature}
                </div>
              ))}
            </div>
          </div>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="src/components/AutoSaveIndicator.tsx">
"use client";

import { useState, useEffect } from "react";

interface AutoSaveIndicatorProps {
  lastSaved: Date | null;
  isSaving: boolean;
  hasChanges: boolean;
}

export default function AutoSaveIndicator({ lastSaved, isSaving, hasChanges }: AutoSaveIndicatorProps) {
  const [relativeTime, setRelativeTime] = useState("");

  useEffect(() => {
    const updateTime = () => {
      if (!lastSaved) {
        setRelativeTime("");
        return;
      }

      const now = new Date();
      const diff = now.getTime() - lastSaved.getTime();
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);

      if (seconds < 10) {
        setRelativeTime("just now");
      } else if (seconds < 60) {
        setRelativeTime(`${seconds}s ago`);
      } else if (minutes < 60) {
        setRelativeTime(`${minutes}m ago`);
      } else {
        setRelativeTime(lastSaved.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" }));
      }
    };

    updateTime();
    const interval = setInterval(updateTime, 10000); // Update every 10 seconds

    return () => clearInterval(interval);
  }, [lastSaved]);

  if (isSaving) {
    return (
      <div className="flex items-center gap-2 text-[#f0b866]">
        <div className="w-4 h-4 border-2 border-[#f0b866] border-t-transparent rounded-full animate-spin" />
        <span className="text-sm">Saving...</span>
      </div>
    );
  }

  if (hasChanges) {
    return (
      <div className="flex items-center gap-2 text-[#666680]">
        <div className="w-2 h-2 rounded-full bg-[#f0b866]" />
        <span className="text-sm">Unsaved changes</span>
      </div>
    );
  }

  if (lastSaved) {
    return (
      <div className="flex items-center gap-2 text-[#4ade80]">
        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
        </svg>
        <span className="text-sm">Saved {relativeTime}</span>
      </div>
    );
  }

  return null;
}
</file>

<file path="src/components/BatchSend.tsx">
"use client";

import { useState, useRef } from "react";

interface Recipient {
  name: string;
  email: string;
  title?: string;
  company?: string;
  address?: string;
  [key: string]: string | undefined;
}

interface BatchSendProps {
  isOpen: boolean;
  onClose: () => void;
  templateBody: string;
  onGenerateBatch: (recipients: Recipient[], filledDocuments: string[]) => void;
}

export default function BatchSend({ isOpen, onClose, templateBody, onGenerateBatch }: BatchSendProps) {
  const [recipients, setRecipients] = useState<Recipient[]>([]);
  const [csvText, setCsvText] = useState("");
  const [step, setStep] = useState<"upload" | "map" | "preview">("upload");
  const [headers, setHeaders] = useState<string[]>([]);
  const [fieldMapping, setFieldMapping] = useState<Record<string, string>>({});
  const fileInputRef = useRef<HTMLInputElement>(null);

  // Extract placeholders from template
  const placeholders = Array.from(templateBody.matchAll(/\[([^\]]+)\]/g)).map(m => m[1]);
  const uniquePlaceholders = Array.from(new Set(placeholders));

  const parseCSV = (text: string): { headers: string[]; rows: Record<string, string>[] } => {
    const lines = text.trim().split("\n");
    if (lines.length < 2) return { headers: [], rows: [] };
    
    const headers = lines[0].split(",").map(h => h.trim().replace(/^"|"$/g, ""));
    const rows = lines.slice(1).map(line => {
      const values = line.split(",").map(v => v.trim().replace(/^"|"$/g, ""));
      const row: Record<string, string> = {};
      headers.forEach((h, i) => {
        row[h] = values[i] || "";
      });
      return row;
    });
    
    return { headers, rows };
  };

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target?.result as string;
      setCsvText(text);
      const { headers: csvHeaders, rows } = parseCSV(text);
      setHeaders(csvHeaders);
      setRecipients(rows.map(r => r as unknown as Recipient));
      
      // Auto-map common fields
      const autoMap: Record<string, string> = {};
      uniquePlaceholders.forEach(placeholder => {
        const lower = placeholder.toLowerCase();
        const match = csvHeaders.find(h => h.toLowerCase().includes(lower));
        if (match) autoMap[placeholder] = match;
      });
      setFieldMapping(autoMap);
      
      setStep("map");
    };
    reader.readAsText(file);
  };

  const handlePasteCSV = () => {
    if (!csvText.trim()) return;
    const { headers: csvHeaders, rows } = parseCSV(csvText);
    setHeaders(csvHeaders);
    setRecipients(rows.map(r => r as unknown as Recipient));
    setStep("map");
  };

  const generateFilledDocuments = (): string[] => {
    return recipients.map(recipient => {
      let filled = templateBody;
      uniquePlaceholders.forEach(placeholder => {
        const csvField = fieldMapping[placeholder];
        if (csvField && recipient[csvField]) {
          filled = filled.split(`[${placeholder}]`).join(recipient[csvField] || "");
        }
      });
      return filled;
    });
  };

  const handleGenerate = () => {
    const filledDocs = generateFilledDocuments();
    onGenerateBatch(recipients, filledDocs);
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
      <div className="bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-2xl w-full max-w-3xl max-h-[85vh] flex flex-col">
        <div className="p-5 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <h2 className="text-lg font-semibold text-[--text-primary]">Batch Generate Documents</h2>
            <button onClick={onClose} className="text-[--text-muted] hover:text-[--text-primary]">‚úï</button>
          </div>
          
          {/* Steps indicator */}
          <div className="flex items-center gap-4 mt-4">
            {["upload", "map", "preview"].map((s, i) => (
              <div key={s} className="flex items-center gap-2">
                <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium ${
                  step === s ? "bg-[--color-primary] text-white" :
                  ["upload", "map", "preview"].indexOf(step) > i ? "bg-[--color-success] text-white" :
                  "bg-[--bg-elevated] text-[--text-muted]"
                }`}>
                  {i + 1}
                </div>
                <span className={`text-sm ${step === s ? "text-[--text-primary]" : "text-[--text-muted]"}`}>
                  {s === "upload" ? "Upload" : s === "map" ? "Map Fields" : "Preview"}
                </span>
              </div>
            ))}
          </div>
        </div>

        <div className="flex-1 overflow-y-auto p-5">
          {step === "upload" && (
            <div className="space-y-4">
              <div className="text-center p-8 border-2 border-dashed border-[--border-default] rounded-xl">
                <input
                  ref={fileInputRef}
                  type="file"
                  accept=".csv"
                  onChange={handleFileUpload}
                  className="hidden"
                />
                <button
                  onClick={() => fileInputRef.current?.click()}
                  className="px-6 py-3 rounded-lg bg-[--color-primary] text-white hover:opacity-90 mb-3"
                >
                  Upload CSV File
                </button>
                <p className="text-sm text-[--text-muted]">
                  or paste your CSV data below
                </p>
              </div>
              
              <textarea
                value={csvText}
                onChange={(e) => setCsvText(e.target.value)}
                placeholder="name,email,company
John Doe,john@example.com,Acme Inc
Jane Smith,jane@example.com,Tech Corp"
                rows={8}
                className="w-full px-4 py-3 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] font-mono text-sm"
              />
              
              {csvText && (
                <button
                  onClick={handlePasteCSV}
                  className="w-full px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:border-[--color-primary]"
                >
                  Parse CSV Data
                </button>
              )}
              
              <div className="p-3 rounded-lg bg-[--bg-elevated] border border-[--border-default]">
                <h4 className="text-sm font-medium text-[--text-secondary] mb-2">Template Placeholders Found:</h4>
                <div className="flex flex-wrap gap-2">
                  {uniquePlaceholders.length > 0 ? uniquePlaceholders.map(p => (
                    <span key={p} className="pill">[{p}]</span>
                  )) : (
                    <span className="text-sm text-[--text-muted]">No placeholders found</span>
                  )}
                </div>
              </div>
            </div>
          )}

          {step === "map" && (
            <div className="space-y-4">
              <p className="text-sm text-[--text-secondary]">
                Map your CSV columns to template placeholders:
              </p>
              
              <div className="space-y-3">
                {uniquePlaceholders.map(placeholder => (
                  <div key={placeholder} className="flex items-center gap-4 p-3 rounded-lg bg-[--bg-elevated] border border-[--border-default]">
                    <span className="font-mono text-sm text-[--color-primary] min-w-[120px]">[{placeholder}]</span>
                    <span className="text-[--text-muted]">‚Üí</span>
                    <select
                      value={fieldMapping[placeholder] || ""}
                      onChange={(e) => setFieldMapping({ ...fieldMapping, [placeholder]: e.target.value })}
                      className="flex-1 px-3 py-2 rounded-lg bg-[--bg-surface] border border-[--border-default] text-[--text-primary]"
                    >
                      <option value="">-- Select column --</option>
                      {headers.map(h => (
                        <option key={h} value={h}>{h}</option>
                      ))}
                    </select>
                  </div>
                ))}
              </div>
              
              <div className="p-3 rounded-lg bg-[--bg-elevated] border border-[--border-default]">
                <h4 className="text-sm font-medium text-[--text-secondary] mb-1">
                  {recipients.length} recipients loaded
                </h4>
                <p className="text-xs text-[--text-muted]">
                  Columns: {headers.join(", ")}
                </p>
              </div>
            </div>
          )}

          {step === "preview" && (
            <div className="space-y-4">
              <p className="text-sm text-[--text-secondary]">
                Preview the first document:
              </p>
              
              <div className="p-4 rounded-lg bg-[--bg-elevated] border border-[--border-default] whitespace-pre-wrap text-sm text-[--text-primary] max-h-64 overflow-y-auto">
                {generateFilledDocuments()[0] || "No preview available"}
              </div>
              
              <div className="p-3 rounded-lg bg-green-500/10 border border-green-500/30 text-green-400">
                Ready to generate {recipients.length} documents
              </div>
            </div>
          )}
        </div>

        <div className="p-5 border-t border-[--border-default] flex gap-3">
          {step !== "upload" && (
            <button
              onClick={() => setStep(step === "preview" ? "map" : "upload")}
              className="px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:bg-[--bg-overlay]"
            >
              Back
            </button>
          )}
          <button
            onClick={onClose}
            className="px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:bg-[--bg-overlay]"
          >
            Cancel
          </button>
          <div className="flex-1" />
          {step === "upload" && recipients.length > 0 && (
            <button
              onClick={() => setStep("map")}
              className="px-4 py-2.5 rounded-lg bg-[--color-primary] text-white hover:opacity-90"
            >
              Next: Map Fields
            </button>
          )}
          {step === "map" && (
            <button
              onClick={() => setStep("preview")}
              className="px-4 py-2.5 rounded-lg bg-[--color-primary] text-white hover:opacity-90"
            >
              Next: Preview
            </button>
          )}
          {step === "preview" && (
            <button
              onClick={handleGenerate}
              className="px-4 py-2.5 rounded-lg bg-[--color-primary] text-white hover:opacity-90"
            >
              Generate All ({recipients.length})
            </button>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/BulkGeneration.tsx">
"use client";

import { useState, useRef } from "react";

interface BulkRecord {
  [key: string]: string;
}

interface BulkGenerationProps {
  isOpen: boolean;
  onClose: () => void;
  templateBody: string;
  documentType: string;
  onGenerate: (records: BulkRecord[]) => void;
}

export default function BulkGeneration({ isOpen, onClose, templateBody, documentType, onGenerate }: BulkGenerationProps) {
  const [records, setRecords] = useState<BulkRecord[]>([]);
  const [headers, setHeaders] = useState<string[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [error, setError] = useState("");
  const fileInputRef = useRef<HTMLInputElement>(null);

  // Extract placeholders from template
  const placeholders = templateBody.match(/\[([^\]]+)\]/g)?.map(p => p.slice(1, -1)) || [];
  const uniquePlaceholders = Array.from(new Set(placeholders));

  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    setIsProcessing(true);
    setError("");

    try {
      const text = await file.text();
      const lines = text.split("\n").filter(line => line.trim());
      
      if (lines.length < 2) {
        setError("CSV must have at least a header row and one data row");
        return;
      }

      // Parse header
      const headerLine = lines[0];
      const csvHeaders = parseCSVLine(headerLine);
      setHeaders(csvHeaders);

      // Parse data rows
      const dataRecords: BulkRecord[] = [];
      for (let i = 1; i < lines.length; i++) {
        const values = parseCSVLine(lines[i]);
        const record: BulkRecord = {};
        csvHeaders.forEach((header, index) => {
          record[header] = values[index] || "";
        });
        dataRecords.push(record);
      }

      setRecords(dataRecords);
    } catch (err) {
      console.error("Error parsing CSV:", err);
      setError("Error parsing CSV file. Please check the format.");
    } finally {
      setIsProcessing(false);
    }
  };

  const parseCSVLine = (line: string): string[] => {
    const result: string[] = [];
    let current = "";
    let inQuotes = false;

    for (let i = 0; i < line.length; i++) {
      const char = line[i];
      if (char === '"') {
        inQuotes = !inQuotes;
      } else if (char === "," && !inQuotes) {
        result.push(current.trim());
        current = "";
      } else {
        current += char;
      }
    }
    result.push(current.trim());
    return result;
  };

  const handleGenerate = () => {
    if (records.length === 0) {
      setError("No data to generate");
      return;
    }
    onGenerate(records);
  };

  const clearData = () => {
    setRecords([]);
    setHeaders([]);
    setError("");
    if (fileInputRef.current) {
      fileInputRef.current.value = "";
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-4xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üì¶ Bulk Document Generation</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {/* Instructions */}
          <div className="mb-6 p-4 rounded-lg bg-[#a78bfa]/10 border border-[#a78bfa]/30">
            <h3 className="text-white font-medium mb-2">How it works:</h3>
            <ol className="text-sm text-[#a0a0a0] space-y-1 list-decimal list-inside">
              <li>Upload a CSV file with column headers matching your placeholders</li>
              <li>Each row will generate one document with values filled in</li>
              <li>All documents will be downloaded as separate PDFs</li>
            </ol>
          </div>

          {/* Placeholders in template */}
          {uniquePlaceholders.length > 0 && (
            <div className="mb-6">
              <h3 className="text-sm text-[#a0a0a0] mb-2">Placeholders in your template:</h3>
              <div className="flex flex-wrap gap-2">
                {uniquePlaceholders.map(placeholder => (
                  <span key={placeholder} className="px-3 py-1 rounded-full bg-[#4ecdc4]/20 text-[#4ecdc4] text-sm">
                    [{placeholder}]
                  </span>
                ))}
              </div>
            </div>
          )}

          {/* File upload */}
          <div className="mb-6">
            <input
              ref={fileInputRef}
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="hidden"
            />
            <button
              onClick={() => fileInputRef.current?.click()}
              disabled={isProcessing}
              className="w-full p-8 rounded-xl border-2 border-dashed border-[#2a2a3a] hover:border-[#a78bfa] transition-colors text-center"
            >
              {isProcessing ? (
                <span className="text-[#a0a0a0]">Processing...</span>
              ) : (
                <>
                  <span className="text-3xl block mb-2">üìÑ</span>
                  <span className="text-white block">Drop CSV file or click to upload</span>
                  <span className="text-sm text-[#666680]">Supports .csv files</span>
                </>
              )}
            </button>
          </div>

          {/* Error */}
          {error && (
            <div className="mb-6 p-4 rounded-lg bg-[#f87171]/10 border border-[#f87171]/30 text-[#f87171]">
              {error}
            </div>
          )}

          {/* Preview data */}
          {records.length > 0 && (
            <div className="mb-6">
              <div className="flex items-center justify-between mb-3">
                <h3 className="text-white font-medium">Preview ({records.length} records)</h3>
                <button onClick={clearData} className="text-sm text-[#f87171] hover:text-[#fca5a5]">
                  Clear
                </button>
              </div>
              <div className="overflow-auto max-h-60 rounded-lg border border-[#2a2a3a]">
                <table className="w-full text-sm">
                  <thead className="bg-[#1a1a24] sticky top-0">
                    <tr>
                      <th className="px-3 py-2 text-left text-[#a0a0a0]">#</th>
                      {headers.map(header => (
                        <th key={header} className="px-3 py-2 text-left text-[#a0a0a0]">{header}</th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {records.slice(0, 10).map((record, index) => (
                      <tr key={index} className="border-t border-[#2a2a3a]">
                        <td className="px-3 py-2 text-[#666680]">{index + 1}</td>
                        {headers.map(header => (
                          <td key={header} className="px-3 py-2 text-white">{record[header] || "-"}</td>
                        ))}
                      </tr>
                    ))}
                  </tbody>
                </table>
                {records.length > 10 && (
                  <div className="p-2 text-center text-sm text-[#666680] bg-[#1a1a24]">
                    ... and {records.length - 10} more records
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Sample CSV */}
          <div className="mb-6">
            <h3 className="text-sm text-[#a0a0a0] mb-2">Sample CSV format:</h3>
            <pre className="p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-xs text-[#a0a0a0] overflow-auto">
{uniquePlaceholders.length > 0 
  ? `${uniquePlaceholders.join(",")}\nJohn Doe,Manager,Acme Inc\nJane Smith,Director,Tech Corp`
  : `Name,Position,Company\nJohn Doe,Manager,Acme Inc\nJane Smith,Director,Tech Corp`}
            </pre>
          </div>
        </div>

        {/* Footer */}
        <div className="flex items-center justify-between p-4 border-t border-[#2a2a3a]">
          <span className="text-sm text-[#666680]">
            {records.length > 0 ? `${records.length} documents will be generated` : "Upload a CSV to get started"}
          </span>
          <div className="flex gap-2">
            <button onClick={onClose} className="px-4 py-2 rounded-lg bg-[#2a2a3a] text-white hover:bg-[#3a3a4a]">
              Cancel
            </button>
            <button
              onClick={handleGenerate}
              disabled={records.length === 0}
              className="px-4 py-2 rounded-lg bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white hover:opacity-90 disabled:opacity-50"
            >
              Generate {records.length > 0 ? `${records.length} PDFs` : "PDFs"}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Button.tsx">
"use client";

import { ReactNode, forwardRef } from "react";
import { Loader2 } from "lucide-react";

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  children: ReactNode;
  variant?: "primary" | "secondary" | "ghost" | "outline" | "danger";
  size?: "sm" | "md" | "lg";
  icon?: ReactNode;
  iconPosition?: "left" | "right";
  loading?: boolean;
  fullWidth?: boolean;
}

const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  (
    {
      children,
      variant = "primary",
      size = "md",
      icon,
      iconPosition = "left",
      loading = false,
      fullWidth = false,
      className = "",
      disabled,
      ...props
    },
    ref
  ) => {
    const baseClasses =
      "inline-flex items-center justify-center font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#0a0a12] disabled:opacity-50 disabled:cursor-not-allowed";

    const variantClasses = {
      primary:
        "bg-gradient-to-r from-violet-500 to-teal-400 text-white hover:from-violet-600 hover:to-teal-500 focus:ring-violet-500 shadow-lg shadow-violet-500/25 hover:shadow-xl hover:shadow-violet-500/30 hover:-translate-y-0.5",
      secondary:
        "bg-[#1f1f2e] text-white hover:bg-[#2a2a3a] focus:ring-gray-500 border border-[#2a2a3a] hover:border-[#3a3a4a]",
      ghost:
        "bg-transparent text-gray-300 hover:bg-white/10 hover:text-white focus:ring-gray-500",
      outline:
        "bg-transparent text-violet-400 border-2 border-violet-500/50 hover:bg-violet-500/10 hover:border-violet-500 focus:ring-violet-500",
      danger:
        "bg-red-500/10 text-red-400 hover:bg-red-500/20 focus:ring-red-500 border border-red-500/30 hover:border-red-500/50",
    };

    const sizeClasses = {
      sm: "px-3 py-1.5 text-sm rounded-lg gap-1.5",
      md: "px-4 py-2.5 text-sm rounded-xl gap-2",
      lg: "px-6 py-3 text-base rounded-xl gap-2.5",
    };

    const widthClass = fullWidth ? "w-full" : "";

    const iconElement = loading ? (
      <Loader2 className="w-4 h-4 animate-spin" />
    ) : (
      icon
    );

    return (
      <button
        ref={ref}
        className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${widthClass} ${className}`}
        disabled={disabled || loading}
        {...props}
      >
        {iconElement && iconPosition === "left" && <span>{iconElement}</span>}
        {children}
        {iconElement && iconPosition === "right" && <span>{iconElement}</span>}
      </button>
    );
  }
);

Button.displayName = "Button";

export default Button;

// Icon Button (circular)
interface IconButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  icon: ReactNode;
  variant?: "primary" | "secondary" | "ghost" | "outline";
  size?: "sm" | "md" | "lg";
  tooltip?: string;
}

export const IconButton = forwardRef<HTMLButtonElement, IconButtonProps>(
  ({ icon, variant = "ghost", size = "md", tooltip, className = "", ...props }, ref) => {
    const baseClasses =
      "inline-flex items-center justify-center rounded-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#0a0a12] disabled:opacity-50 disabled:cursor-not-allowed";

    const variantClasses = {
      primary:
        "bg-gradient-to-r from-violet-500 to-teal-400 text-white hover:from-violet-600 hover:to-teal-500 focus:ring-violet-500 shadow-lg shadow-violet-500/25",
      secondary:
        "bg-[#1f1f2e] text-gray-300 hover:bg-[#2a2a3a] hover:text-white focus:ring-gray-500 border border-[#2a2a3a]",
      ghost:
        "bg-transparent text-gray-400 hover:bg-white/10 hover:text-white focus:ring-gray-500",
      outline:
        "bg-transparent text-violet-400 border-2 border-violet-500/50 hover:bg-violet-500/10 hover:border-violet-500 focus:ring-violet-500",
    };

    const sizeClasses = {
      sm: "w-8 h-8",
      md: "w-10 h-10",
      lg: "w-12 h-12",
    };

    const iconSizeClasses = {
      sm: "[&>svg]:w-4 [&>svg]:h-4",
      md: "[&>svg]:w-5 [&>svg]:h-5",
      lg: "[&>svg]:w-6 [&>svg]:h-6",
    };

    return (
      <button
        ref={ref}
        className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${iconSizeClasses[size]} ${className}`}
        title={tooltip}
        {...props}
      >
        {icon}
      </button>
    );
  }
);

IconButton.displayName = "IconButton";

// Button Group
interface ButtonGroupProps {
  children: ReactNode;
  className?: string;
}

export function ButtonGroup({ children, className = "" }: ButtonGroupProps) {
  return (
    <div className={`flex items-center gap-2 ${className}`}>
      {children}
    </div>
  );
}
</file>

<file path="src/components/Card.tsx">
"use client";

import { ReactNode } from "react";

interface CardProps {
  children: ReactNode;
  className?: string;
  variant?: "default" | "glass" | "elevated" | "outline";
  accent?: "violet" | "teal" | "gold" | "none";
  padding?: "none" | "sm" | "md" | "lg";
  hover?: boolean;
  onClick?: () => void;
}

const accentColors = {
  violet: {
    border: "border-l-violet-500",
    glow: "hover:shadow-violet-500/10",
    gradient: "from-violet-500/10",
  },
  teal: {
    border: "border-l-teal-400",
    glow: "hover:shadow-teal-400/10",
    gradient: "from-teal-400/10",
  },
  gold: {
    border: "border-l-amber-400",
    glow: "hover:shadow-amber-400/10",
    gradient: "from-amber-400/10",
  },
  none: {
    border: "",
    glow: "",
    gradient: "",
  },
};

const paddingSizes = {
  none: "",
  sm: "p-3",
  md: "p-5",
  lg: "p-6",
};

export default function Card({
  children,
  className = "",
  variant = "default",
  accent = "none",
  padding = "md",
  hover = false,
  onClick,
}: CardProps) {
  const baseClasses = "rounded-2xl transition-all duration-300";
  
  const variantClasses = {
    default: "bg-[#12121a]/90 backdrop-blur-sm border border-[#1f1f2e]",
    glass: "bg-white/5 backdrop-blur-xl border border-white/10",
    elevated: "bg-[#16161f] border border-[#1f1f2e] shadow-xl shadow-black/20",
    outline: "bg-transparent border-2 border-[#2a2a3a]",
  };

  const accentClasses = accent !== "none" ? `border-l-4 ${accentColors[accent].border}` : "";
  const hoverClasses = hover ? `cursor-pointer hover:scale-[1.02] hover:shadow-2xl ${accentColors[accent].glow}` : "";
  const clickableClasses = onClick ? "cursor-pointer" : "";

  return (
    <div
      className={`${baseClasses} ${variantClasses[variant]} ${paddingSizes[padding]} ${accentClasses} ${hoverClasses} ${clickableClasses} ${className}`}
      onClick={onClick}
    >
      {children}
    </div>
  );
}

// Card Header
interface CardHeaderProps {
  title: string;
  subtitle?: string;
  icon?: ReactNode;
  action?: ReactNode;
  accent?: "violet" | "teal" | "gold";
}

export function CardHeader({ title, subtitle, icon, action, accent = "violet" }: CardHeaderProps) {
  const accentTextColors = {
    violet: "text-violet-400",
    teal: "text-teal-400",
    gold: "text-amber-400",
  };

  return (
    <div className="flex items-center justify-between mb-4">
      <div className="flex items-center gap-3">
        {icon && (
          <div className={`w-10 h-10 rounded-xl bg-gradient-to-br ${accentColors[accent].gradient} to-transparent flex items-center justify-center ${accentTextColors[accent]}`}>
            {icon}
          </div>
        )}
        <div>
          <h3 className={`font-medium ${accentTextColors[accent]}`}>{title}</h3>
          {subtitle && <p className="text-sm text-gray-500">{subtitle}</p>}
        </div>
      </div>
      {action && <div>{action}</div>}
    </div>
  );
}

// Card Body
interface CardBodyProps {
  children: ReactNode;
  className?: string;
}

export function CardBody({ children, className = "" }: CardBodyProps) {
  return <div className={className}>{children}</div>;
}

// Card Footer
interface CardFooterProps {
  children: ReactNode;
  className?: string;
  align?: "left" | "center" | "right" | "between";
}

export function CardFooter({ children, className = "", align = "right" }: CardFooterProps) {
  const alignClasses = {
    left: "justify-start",
    center: "justify-center",
    right: "justify-end",
    between: "justify-between",
  };

  return (
    <div className={`flex items-center gap-3 mt-4 pt-4 border-t border-[#1f1f2e] ${alignClasses[align]} ${className}`}>
      {children}
    </div>
  );
}

// Stats Card
interface StatsCardProps {
  value: string | number;
  label: string;
  icon?: ReactNode;
  trend?: { value: number; isPositive: boolean };
  accent?: "violet" | "teal" | "gold";
}

export function StatsCard({ value, label, icon, trend, accent = "violet" }: StatsCardProps) {
  const accentTextColors = {
    violet: "text-violet-400",
    teal: "text-teal-400",
    gold: "text-amber-400",
  };

  return (
    <Card variant="glass" padding="md" className="text-center">
      {icon && (
        <div className={`w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-br ${accentColors[accent].gradient} to-transparent flex items-center justify-center ${accentTextColors[accent]}`}>
          {icon}
        </div>
      )}
      <div className={`text-3xl font-bold ${accentTextColors[accent]}`}>{value}</div>
      <div className="text-sm text-gray-500 mt-1">{label}</div>
      {trend && (
        <div className={`text-xs mt-2 ${trend.isPositive ? "text-green-400" : "text-red-400"}`}>
          {trend.isPositive ? "‚Üë" : "‚Üì"} {Math.abs(trend.value)}%
        </div>
      )}
    </Card>
  );
}
</file>

<file path="src/components/CommandPalette.tsx">
"use client";

import { useState, useEffect, useRef, useMemo, useCallback } from "react";
import { useUIStore, useDocumentStore } from "@/store/documentStore";
import {
  Search,
  FileText,
  Star,
  History,
  Settings,
  Download,
  Eye,
  Palette,
  Users,
  Calendar,
  Key,
  HelpCircle,
  Sparkles,
  Package,
  Sun,
  Moon,
  Keyboard,
  Save,
  Trash2,
  BarChart3,
  GitBranch,
  FileDown,
  Globe,
  Link,
  Clock,
  Command,
} from "lucide-react";

interface CommandItem {
  id: string;
  label: string;
  description?: string;
  icon: React.ReactNode;
  shortcut?: string;
  action: () => void;
  category: string;
}

interface CommandPaletteProps {
  onAction?: (action: string) => void;
}

export default function CommandPalette({ onAction }: CommandPaletteProps) {
  const [query, setQuery] = useState("");
  const [selectedIndex, setSelectedIndex] = useState(0);
  const inputRef = useRef<HTMLInputElement>(null);
  const listRef = useRef<HTMLDivElement>(null);

  const { commandPaletteOpen, toggleCommandPalette, openModal, theme, setTheme } = useUIStore();
  const { clearDocument, markSaved } = useDocumentStore();

  // Define commands
  const commands: CommandItem[] = useMemo(
    () => [
      // Quick Actions
      {
        id: "preview",
        label: "Preview PDF",
        description: "Preview the current document",
        icon: <Eye className="w-4 h-4" />,
        shortcut: "‚åòP",
        action: () => onAction?.("preview"),
        category: "Quick Actions",
      },
      {
        id: "download",
        label: "Download PDF",
        description: "Generate and download PDF",
        icon: <Download className="w-4 h-4" />,
        shortcut: "‚åòD",
        action: () => onAction?.("download"),
        category: "Quick Actions",
      },
      {
        id: "save",
        label: "Save Draft",
        description: "Save current document as draft",
        icon: <Save className="w-4 h-4" />,
        shortcut: "‚åòS",
        action: () => {
          markSaved();
          onAction?.("save");
        },
        category: "Quick Actions",
      },
      {
        id: "clear",
        label: "Clear Document",
        description: "Reset all fields",
        icon: <Trash2 className="w-4 h-4" />,
        action: () => clearDocument(),
        category: "Quick Actions",
      },

      // Create
      {
        id: "templates",
        label: "Browse Templates",
        description: "Choose from template gallery",
        icon: <FileText className="w-4 h-4" />,
        shortcut: "‚åòT",
        action: () => openModal("templates"),
        category: "Create",
      },
      {
        id: "ai-assistant",
        label: "AI Writing Assistant",
        description: "Get AI help with writing",
        icon: <Sparkles className="w-4 h-4" />,
        action: () => openModal("ai"),
        category: "Create",
      },
      {
        id: "bulk",
        label: "Bulk Generation",
        description: "Generate multiple documents",
        icon: <Package className="w-4 h-4" />,
        action: () => openModal("bulk"),
        category: "Create",
      },
      {
        id: "favorites",
        label: "Favorites",
        description: "View saved favorites",
        icon: <Star className="w-4 h-4" />,
        action: () => openModal("favorites"),
        category: "Create",
      },

      // History
      {
        id: "history",
        label: "Document History",
        description: "View past documents",
        icon: <History className="w-4 h-4" />,
        action: () => openModal("history"),
        category: "History",
      },
      {
        id: "versions",
        label: "Version History",
        description: "View document versions",
        icon: <GitBranch className="w-4 h-4" />,
        action: () => openModal("versions"),
        category: "History",
      },
      {
        id: "exports",
        label: "Export History",
        description: "View exported documents",
        icon: <FileDown className="w-4 h-4" />,
        action: () => openModal("exports"),
        category: "History",
      },

      // Analytics
      {
        id: "statistics",
        label: "Statistics",
        description: "View usage statistics",
        icon: <BarChart3 className="w-4 h-4" />,
        action: () => openModal("statistics"),
        category: "Analytics",
      },
      {
        id: "time-tracking",
        label: "Time Tracking",
        description: "View time spent on documents",
        icon: <Clock className="w-4 h-4" />,
        action: () => openModal("time"),
        category: "Analytics",
      },

      // Customize
      {
        id: "themes",
        label: "PDF Themes",
        description: "Change document appearance",
        icon: <Palette className="w-4 h-4" />,
        action: () => openModal("themes"),
        category: "Customize",
      },
      {
        id: "branding",
        label: "Branding",
        description: "Custom branding settings",
        icon: <Globe className="w-4 h-4" />,
        action: () => openModal("branding"),
        category: "Customize",
      },
      {
        id: "profiles",
        label: "Profiles",
        description: "Manage sender/recipient profiles",
        icon: <Users className="w-4 h-4" />,
        action: () => openModal("profiles"),
        category: "Customize",
      },

      // Settings
      {
        id: "settings",
        label: "Settings",
        description: "Application settings",
        icon: <Settings className="w-4 h-4" />,
        shortcut: "‚åò,",
        action: () => openModal("settings"),
        category: "Settings",
      },
      {
        id: "toggle-theme",
        label: theme === "dark" ? "Switch to Light Mode" : "Switch to Dark Mode",
        description: "Toggle color theme",
        icon: theme === "dark" ? <Sun className="w-4 h-4" /> : <Moon className="w-4 h-4" />,
        action: () => setTheme(theme === "dark" ? "light" : "dark"),
        category: "Settings",
      },
      {
        id: "keyboard",
        label: "Keyboard Shortcuts",
        description: "View all shortcuts",
        icon: <Keyboard className="w-4 h-4" />,
        shortcut: "?",
        action: () => openModal("keyboard"),
        category: "Settings",
      },
      {
        id: "help",
        label: "Help & Guide",
        description: "Get help using the app",
        icon: <HelpCircle className="w-4 h-4" />,
        action: () => openModal("help"),
        category: "Settings",
      },

      // Advanced
      {
        id: "schedule",
        label: "Schedule Document",
        description: "Schedule document generation",
        icon: <Calendar className="w-4 h-4" />,
        action: () => openModal("schedule"),
        category: "Advanced",
      },
      {
        id: "teams",
        label: "Team Workspaces",
        description: "Collaborate with team",
        icon: <Users className="w-4 h-4" />,
        action: () => openModal("teams"),
        category: "Advanced",
      },
      {
        id: "webhooks",
        label: "Webhooks",
        description: "Configure integrations",
        icon: <Link className="w-4 h-4" />,
        action: () => openModal("webhooks"),
        category: "Advanced",
      },
      {
        id: "api",
        label: "API Access",
        description: "Manage API keys",
        icon: <Key className="w-4 h-4" />,
        action: () => openModal("api"),
        category: "Advanced",
      },
    ],
    [theme, openModal, clearDocument, markSaved, setTheme, onAction]
  );

  // Filter commands based on query
  const filteredCommands = useMemo(() => {
    if (!query) return commands;
    const lowerQuery = query.toLowerCase();
    return commands.filter(
      (cmd) =>
        cmd.label.toLowerCase().includes(lowerQuery) ||
        cmd.description?.toLowerCase().includes(lowerQuery) ||
        cmd.category.toLowerCase().includes(lowerQuery)
    );
  }, [commands, query]);

  // Group commands by category
  const groupedCommands = useMemo(() => {
    const groups: Record<string, CommandItem[]> = {};
    filteredCommands.forEach((cmd) => {
      if (!groups[cmd.category]) {
        groups[cmd.category] = [];
      }
      groups[cmd.category].push(cmd);
    });
    return groups;
  }, [filteredCommands]);

  // Flatten for keyboard navigation
  const flatCommands = useMemo(() => filteredCommands, [filteredCommands]);

  // Handle keyboard navigation
  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (!commandPaletteOpen) {
        // Open with Cmd/Ctrl + K
        if ((e.metaKey || e.ctrlKey) && e.key === "k") {
          e.preventDefault();
          toggleCommandPalette();
        }
        return;
      }

      switch (e.key) {
        case "ArrowDown":
          e.preventDefault();
          setSelectedIndex((i) => (i + 1) % flatCommands.length);
          break;
        case "ArrowUp":
          e.preventDefault();
          setSelectedIndex((i) => (i - 1 + flatCommands.length) % flatCommands.length);
          break;
        case "Enter":
          e.preventDefault();
          if (flatCommands[selectedIndex]) {
            flatCommands[selectedIndex].action();
            toggleCommandPalette();
          }
          break;
        case "Escape":
          e.preventDefault();
          toggleCommandPalette();
          break;
      }
    },
    [commandPaletteOpen, flatCommands, selectedIndex, toggleCommandPalette]
  );

  // Global keyboard listener
  useEffect(() => {
    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [handleKeyDown]);

  // Focus input when opened
  useEffect(() => {
    if (commandPaletteOpen) {
      setQuery("");
      setSelectedIndex(0);
      setTimeout(() => inputRef.current?.focus(), 50);
    }
  }, [commandPaletteOpen]);

  // Scroll selected item into view
  useEffect(() => {
    if (listRef.current && flatCommands[selectedIndex]) {
      const item = listRef.current.querySelector(`[data-index="${selectedIndex}"]`);
      item?.scrollIntoView({ block: "nearest" });
    }
  }, [selectedIndex, flatCommands]);

  if (!commandPaletteOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-start justify-center pt-[15vh]"
      onClick={() => toggleCommandPalette()}
    >
      <div
        className="w-full max-w-xl bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Search Input */}
        <div className="flex items-center gap-3 p-4 border-b border-[--border-default]">
          <Search className="w-5 h-5 text-[--text-muted]" />
          <input
            ref={inputRef}
            type="text"
            value={query}
            onChange={(e) => {
              setQuery(e.target.value);
              setSelectedIndex(0);
            }}
            placeholder="Type a command or search..."
            className="flex-1 bg-transparent border-none outline-none text-[--text-primary] placeholder:text-[--text-muted]"
          />
          <kbd className="kbd">‚åòK</kbd>
        </div>

        {/* Commands List */}
        <div ref={listRef} className="max-h-[60vh] overflow-auto p-2">
          {Object.entries(groupedCommands).length === 0 ? (
            <div className="py-12 text-center text-[--text-muted]">
              <Search className="w-8 h-8 mx-auto mb-2 opacity-50" />
              <p>No commands found</p>
            </div>
          ) : (
            Object.entries(groupedCommands).map(([category, items]) => (
              <div key={category} className="mb-4">
                <div className="px-3 py-2 text-xs font-medium text-[--text-muted] uppercase tracking-wider">
                  {category}
                </div>
                {items.map((cmd) => {
                  const index = flatCommands.indexOf(cmd);
                  const isSelected = index === selectedIndex;
                  return (
                    <button
                      key={cmd.id}
                      data-index={index}
                      onClick={() => {
                        cmd.action();
                        toggleCommandPalette();
                      }}
                      onMouseEnter={() => setSelectedIndex(index)}
                      className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all ${
                        isSelected
                          ? "bg-[--color-primary]/15 text-[--color-primary]"
                          : "text-[--text-primary] hover:bg-white/5"
                      }`}
                    >
                      <div
                        className={`w-8 h-8 rounded-lg flex items-center justify-center ${
                          isSelected ? "bg-[--color-primary]/20" : "bg-[--bg-elevated]"
                        }`}
                      >
                        {cmd.icon}
                      </div>
                      <div className="flex-1 text-left">
                        <div className="font-medium">{cmd.label}</div>
                        {cmd.description && (
                          <div className="text-xs text-[--text-muted]">{cmd.description}</div>
                        )}
                      </div>
                      {cmd.shortcut && <kbd className="kbd text-xs">{cmd.shortcut}</kbd>}
                    </button>
                  );
                })}
              </div>
            ))
          )}
        </div>

        {/* Footer */}
        <div className="px-4 py-3 border-t border-[--border-default] flex items-center justify-between text-xs text-[--text-muted]">
          <div className="flex items-center gap-4">
            <span className="flex items-center gap-1">
              <kbd className="kbd">‚Üë‚Üì</kbd> navigate
            </span>
            <span className="flex items-center gap-1">
              <kbd className="kbd">‚Üµ</kbd> select
            </span>
            <span className="flex items-center gap-1">
              <kbd className="kbd">esc</kbd> close
            </span>
          </div>
          <div className="flex items-center gap-1">
            <Command className="w-3 h-3" />
            <span>Command Palette</span>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Confetti.tsx">
"use client";

import { useEffect, useState } from "react";

interface ConfettiProps {
  trigger: boolean;
  onComplete?: () => void;
}

export default function Confetti({ trigger, onComplete }: ConfettiProps) {
  const [particles, setParticles] = useState<Array<{
    id: number;
    left: number;
    delay: number;
    duration: number;
    color: string;
    size: number;
  }>>([]);

  useEffect(() => {
    if (trigger) {
      const colors = [
        "#FF6B6B", // red
        "#4ECDC4", // cyan
        "#45B7D1", // blue
        "#FFA07A", // orange
        "#98D8C8", // mint
        "#F7DC6F", // yellow
        "#BB8FCE", // purple
        "#85C1E2", // light blue
      ];

      const newParticles = Array.from({ length: 50 }, (_, i) => ({
        id: i,
        left: Math.random() * 100,
        delay: Math.random() * 0.3,
        duration: 2 + Math.random() * 1,
        color: colors[Math.floor(Math.random() * colors.length)],
        size: 8 + Math.random() * 6,
      }));

      setParticles(newParticles);

      const timer = setTimeout(() => {
        setParticles([]);
        onComplete?.();
      }, 3500);

      return () => clearTimeout(timer);
    }
  }, [trigger, onComplete]);

  if (particles.length === 0) return null;

  return (
    <div className="fixed inset-0 pointer-events-none z-[9999] overflow-hidden">
      {particles.map((particle) => (
        <div
          key={particle.id}
          className="absolute top-0 animate-confetti-fall"
          style={{
            left: `${particle.left}%`,
            animationDelay: `${particle.delay}s`,
            animationDuration: `${particle.duration}s`,
          }}
        >
          <div
            className="rounded-full animate-confetti-spin"
            style={{
              width: `${particle.size}px`,
              height: `${particle.size}px`,
              backgroundColor: particle.color,
              animationDuration: `${0.5 + Math.random() * 0.5}s`,
            }}
          />
        </div>
      ))}
    </div>
  );
}
</file>

<file path="src/components/ContactAutofill.tsx">
"use client";

import { useState, useEffect, useRef } from "react";

export interface Contact {
  id: string;
  name: string;
  title?: string;
  company?: string;
  email?: string;
  phone?: string;
  address?: string;
}

interface ContactAutofillProps {
  value: string;
  onChange: (value: string) => void;
  onSelectContact: (contact: Contact) => void;
  contacts: Contact[];
  placeholder?: string;
  className?: string;
}

export default function ContactAutofill({
  value,
  onChange,
  onSelectContact,
  contacts,
  placeholder = "Start typing a name...",
  className = "",
}: ContactAutofillProps) {
  const [showSuggestions, setShowSuggestions] = useState(false);
  const [filteredContacts, setFilteredContacts] = useState<Contact[]>([]);
  const [selectedIndex, setSelectedIndex] = useState(0);
  const inputRef = useRef<HTMLInputElement>(null);
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (value.length >= 2) {
      const filtered = contacts.filter(c =>
        c.name.toLowerCase().includes(value.toLowerCase()) ||
        c.company?.toLowerCase().includes(value.toLowerCase()) ||
        c.email?.toLowerCase().includes(value.toLowerCase())
      );
      setFilteredContacts(filtered);
      setShowSuggestions(filtered.length > 0);
      setSelectedIndex(0);
    } else {
      setShowSuggestions(false);
    }
  }, [value, contacts]);

  useEffect(() => {
    const handleClickOutside = (e: MouseEvent) => {
      if (containerRef.current && !containerRef.current.contains(e.target as Node)) {
        setShowSuggestions(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (!showSuggestions) return;
    
    if (e.key === "ArrowDown") {
      e.preventDefault();
      setSelectedIndex(i => Math.min(i + 1, filteredContacts.length - 1));
    } else if (e.key === "ArrowUp") {
      e.preventDefault();
      setSelectedIndex(i => Math.max(i - 1, 0));
    } else if (e.key === "Enter" && filteredContacts[selectedIndex]) {
      e.preventDefault();
      handleSelect(filteredContacts[selectedIndex]);
    } else if (e.key === "Escape") {
      setShowSuggestions(false);
    }
  };

  const handleSelect = (contact: Contact) => {
    onChange(contact.name);
    onSelectContact(contact);
    setShowSuggestions(false);
  };

  return (
    <div ref={containerRef} className="relative">
      <input
        ref={inputRef}
        type="text"
        value={value}
        onChange={(e) => onChange(e.target.value)}
        onKeyDown={handleKeyDown}
        onFocus={() => value.length >= 2 && filteredContacts.length > 0 && setShowSuggestions(true)}
        placeholder={placeholder}
        className={className}
      />
      
      {showSuggestions && (
        <div className="absolute z-50 w-full mt-1 bg-[--bg-surface] border border-[--border-default] rounded-lg shadow-lg overflow-hidden">
          {filteredContacts.map((contact, index) => (
            <button
              key={contact.id}
              onClick={() => handleSelect(contact)}
              className={`w-full text-left px-4 py-3 transition-colors ${
                index === selectedIndex 
                  ? "bg-[--color-primary]/10 text-[--text-primary]" 
                  : "hover:bg-[--bg-elevated] text-[--text-primary]"
              }`}
            >
              <div className="font-medium">{contact.name}</div>
              {(contact.title || contact.company) && (
                <div className="text-sm text-[--text-muted]">
                  {contact.title}{contact.title && contact.company && " at "}{contact.company}
                </div>
              )}
            </button>
          ))}
        </div>
      )}
    </div>
  );
}

// Hook to manage contacts
export function useContacts() {
  const [contacts, setContacts] = useState<Contact[]>([]);

  useEffect(() => {
    const saved = localStorage.getItem("contacts");
    if (saved) {
      try {
        setContacts(JSON.parse(saved));
      } catch {
        setContacts([]);
      }
    }
  }, []);

  const saveContacts = (newContacts: Contact[]) => {
    setContacts(newContacts);
    localStorage.setItem("contacts", JSON.stringify(newContacts));
  };

  const addContact = (contact: Omit<Contact, "id">) => {
    const newContact = { ...contact, id: `contact-${Date.now()}` };
    saveContacts([...contacts, newContact]);
    return newContact;
  };

  const updateContact = (id: string, updates: Partial<Contact>) => {
    saveContacts(contacts.map(c => c.id === id ? { ...c, ...updates } : c));
  };

  const deleteContact = (id: string) => {
    saveContacts(contacts.filter(c => c.id !== id));
  };

  const importFromRecipients = (recipients: Array<{ name: string; title?: string; address?: string }>) => {
    const newContacts = recipients
      .filter(r => r.name && !contacts.some(c => c.name === r.name))
      .map(r => ({
        id: `contact-${Date.now()}-${Math.random()}`,
        name: r.name,
        title: r.title,
        address: r.address,
      }));
    if (newContacts.length > 0) {
      saveContacts([...contacts, ...newContacts]);
    }
    return newContacts.length;
  };

  return { contacts, addContact, updateContact, deleteContact, importFromRecipients };
}
</file>

<file path="src/components/CustomBranding.tsx">
"use client";

import { useState, useEffect, useRef } from "react";

export interface BrandingSettings {
  companyName: string;
  logoUrl: string;
  primaryColor: string;
  headerText: string;
  footerText: string;
  showLogo: boolean;
  logoPosition: "left" | "center" | "right";
}

const DEFAULT_BRANDING: BrandingSettings = {
  companyName: "",
  logoUrl: "",
  primaryColor: "#a78bfa",
  headerText: "",
  footerText: "Page {page}",
  showLogo: false,
  logoPosition: "left",
};

interface CustomBrandingProps {
  isOpen: boolean;
  onClose: () => void;
  branding: BrandingSettings;
  onBrandingChange: (branding: BrandingSettings) => void;
}

export function useBranding() {
  const [branding, setBranding] = useState<BrandingSettings>(DEFAULT_BRANDING);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem("brandingSettings");
    if (saved) {
      try {
        setBranding({ ...DEFAULT_BRANDING, ...JSON.parse(saved) });
      } catch (e) {
        console.error("Error loading branding:", e);
      }
    }
  }, []);

  const saveBranding = (newBranding: BrandingSettings) => {
    setBranding(newBranding);
    localStorage.setItem("brandingSettings", JSON.stringify(newBranding));
  };

  return { branding, saveBranding, mounted };
}

export default function CustomBranding({ isOpen, onClose, branding, onBrandingChange }: CustomBrandingProps) {
  const [localBranding, setLocalBranding] = useState<BrandingSettings>(branding);
  const logoInputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    setLocalBranding(branding);
  }, [branding]);

  const handleLogoUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        updateBranding("logoUrl", event.target?.result as string);
      };
      reader.readAsDataURL(file);
    }
  };

  const updateBranding = <K extends keyof BrandingSettings>(key: K, value: BrandingSettings[K]) => {
    const updated = { ...localBranding, [key]: value };
    setLocalBranding(updated);
    onBrandingChange(updated);
  };

  const resetBranding = () => {
    setLocalBranding(DEFAULT_BRANDING);
    onBrandingChange(DEFAULT_BRANDING);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-2xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üé® Custom Branding</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6 space-y-6">
          {/* Company Name */}
          <div>
            <label className="block text-sm font-medium text-[#a78bfa] mb-2">Company Name</label>
            <input
              type="text"
              value={localBranding.companyName}
              onChange={(e) => updateBranding("companyName", e.target.value)}
              placeholder="Your Company"
              className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white focus:border-[#a78bfa]"
            />
          </div>

          {/* Logo Upload */}
          <div>
            <label className="block text-sm font-medium text-[#4ecdc4] mb-2">Company Logo</label>
            <div className="flex gap-4 items-start">
              <input
                ref={logoInputRef}
                type="file"
                accept="image/*"
                onChange={handleLogoUpload}
                className="hidden"
              />
              <button
                onClick={() => logoInputRef.current?.click()}
                className="px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-[#4ecdc4] hover:border-[#4ecdc4] transition-colors"
              >
                Upload Logo
              </button>
              {localBranding.logoUrl && (
                <div className="flex items-center gap-3">
                  <img src={localBranding.logoUrl} alt="Logo preview" className="h-12 rounded" />
                  <button
                    onClick={() => updateBranding("logoUrl", "")}
                    className="text-[#f87171] hover:text-[#fca5a5] text-sm"
                  >
                    Remove
                  </button>
                </div>
              )}
            </div>

            {localBranding.logoUrl && (
              <div className="mt-3 flex items-center gap-4">
                <label className="flex items-center gap-2">
                  <input
                    type="checkbox"
                    checked={localBranding.showLogo}
                    onChange={(e) => updateBranding("showLogo", e.target.checked)}
                    className="rounded"
                  />
                  <span className="text-sm text-[#a0a0a0]">Show logo in PDF</span>
                </label>

                <select
                  value={localBranding.logoPosition}
                  onChange={(e) => updateBranding("logoPosition", e.target.value as "left" | "center" | "right")}
                  className="px-3 py-1 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white text-sm"
                >
                  <option value="left">Left</option>
                  <option value="center">Center</option>
                  <option value="right">Right</option>
                </select>
              </div>
            )}
          </div>

          {/* Brand Color */}
          <div>
            <label className="block text-sm font-medium text-[#f472b6] mb-2">Brand Color</label>
            <div className="flex items-center gap-3">
              <input
                type="color"
                value={localBranding.primaryColor}
                onChange={(e) => updateBranding("primaryColor", e.target.value)}
                className="w-12 h-12 rounded-lg cursor-pointer border-2 border-[#2a2a3a]"
              />
              <input
                type="text"
                value={localBranding.primaryColor}
                onChange={(e) => updateBranding("primaryColor", e.target.value)}
                className="px-3 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white font-mono"
                placeholder="#a78bfa"
              />
            </div>
          </div>

          {/* Header Text */}
          <div>
            <label className="block text-sm font-medium text-[#f0b866] mb-2">Header Text</label>
            <input
              type="text"
              value={localBranding.headerText}
              onChange={(e) => updateBranding("headerText", e.target.value)}
              placeholder="Appears at the top of each page"
              className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white focus:border-[#f0b866]"
            />
          </div>

          {/* Footer Text */}
          <div>
            <label className="block text-sm font-medium text-[#60a5fa] mb-2">Footer Text</label>
            <input
              type="text"
              value={localBranding.footerText}
              onChange={(e) => updateBranding("footerText", e.target.value)}
              placeholder="Use {page} for page number"
              className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white focus:border-[#60a5fa]"
            />
            <p className="mt-1 text-xs text-[#666680]">Use {"{page}"} for page number, {"{date}"} for current date</p>
          </div>

          {/* Preview */}
          <div>
            <label className="block text-sm font-medium text-[#a0a0a0] mb-2">Preview</label>
            <div className="p-6 rounded-lg bg-white text-black">
              {/* Header */}
              <div className="flex items-center justify-between border-b pb-3 mb-4" style={{ borderColor: localBranding.primaryColor }}>
                {localBranding.showLogo && localBranding.logoUrl && (
                  <img 
                    src={localBranding.logoUrl} 
                    alt="Logo" 
                    className="h-8"
                    style={{ 
                      marginLeft: localBranding.logoPosition === "center" ? "auto" : localBranding.logoPosition === "right" ? "auto" : 0,
                      marginRight: localBranding.logoPosition === "center" ? "auto" : localBranding.logoPosition === "left" ? "auto" : 0,
                    }}
                  />
                )}
                {localBranding.headerText && (
                  <span style={{ color: localBranding.primaryColor }}>{localBranding.headerText}</span>
                )}
              </div>
              
              {/* Body placeholder */}
              <div className="h-24 bg-gray-100 rounded mb-4 flex items-center justify-center text-gray-400">
                Document content...
              </div>

              {/* Footer */}
              {localBranding.footerText && (
                <div className="text-center text-sm text-gray-500 border-t pt-3" style={{ borderColor: localBranding.primaryColor }}>
                  {localBranding.footerText.replace("{page}", "1").replace("{date}", new Date().toLocaleDateString())}
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="flex items-center justify-between p-4 border-t border-[#2a2a3a]">
          <button onClick={resetBranding} className="text-sm text-[#f87171] hover:text-[#fca5a5]">
            Reset to Default
          </button>
          <button
            onClick={onClose}
            className="px-6 py-2 rounded-lg bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white hover:opacity-90"
          >
            Done
          </button>
        </div>
      </div>
    </div>
  );
}

export { DEFAULT_BRANDING };
</file>

<file path="src/components/Dashboard.tsx">
"use client";

import { useState, useEffect, useMemo } from "react";
import {
  X,
  FileText,
  TrendingUp,
  Clock,
  Star,
  Calendar,
  BarChart3,
  PieChart,
  Activity,
  Award,
  Zap,
  ArrowUpRight,
  ArrowDownRight,
} from "lucide-react";
import { getStats } from "@/utils/statistics";
import { getHistory } from "@/utils/documentHistory";

interface DashboardProps {
  isOpen: boolean;
  onClose: () => void;
  onNavigate?: (section: string) => void;
}

export default function Dashboard({ isOpen, onClose, onNavigate }: DashboardProps) {
  const [stats, setStats] = useState<any>(null);
  const [history, setHistory] = useState<any[]>([]);
  const [timeRange, setTimeRange] = useState<"week" | "month" | "all">("week");

  useEffect(() => {
    if (isOpen) {
      setStats(getStats());
      setHistory(getHistory());
    }
  }, [isOpen]);

  // Calculate metrics
  const metrics = useMemo(() => {
    if (!stats || !history) return null;

    const now = new Date();
    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
    const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);

    const thisWeek = history.filter((h) => new Date(h.timestamp) > weekAgo);
    const lastWeek = history.filter((h) => {
      const date = new Date(h.timestamp);
      return date > new Date(weekAgo.getTime() - 7 * 24 * 60 * 60 * 1000) && date <= weekAgo;
    });

    const weekChange = lastWeek.length > 0 
      ? ((thisWeek.length - lastWeek.length) / lastWeek.length) * 100 
      : thisWeek.length > 0 ? 100 : 0;

    // Calculate most productive day
    const dayCount: Record<number, number> = {};
    history.forEach((h) => {
      const day = new Date(h.timestamp).getDay();
      dayCount[day] = (dayCount[day] || 0) + 1;
    });
    const mostProductiveDay = Object.entries(dayCount).sort((a, b) => b[1] - a[1])[0];
    const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

    // Calculate document type distribution
    const typeCount: Record<string, number> = {};
    history.forEach((h) => {
      typeCount[h.documentType] = (typeCount[h.documentType] || 0) + 1;
    });
    const topTypes = Object.entries(typeCount)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 5);

    return {
      totalDocuments: stats.totalDocuments || 0,
      thisWeekCount: thisWeek.length,
      weekChange,
      avgPerWeek: history.length > 0 ? (history.length / Math.max(1, Math.ceil((now.getTime() - new Date(history[history.length - 1]?.timestamp || now).getTime()) / (7 * 24 * 60 * 60 * 1000)))).toFixed(1) : "0",
      mostProductiveDay: mostProductiveDay ? days[parseInt(mostProductiveDay[0])] : "N/A",
      streak: stats.streak || 0,
      topTypes,
      achievements: stats.achievements || [],
      dayCount,
    };
  }, [stats, history]);

  if (!isOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="w-full max-w-5xl max-h-[85vh] bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter flex flex-col"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-[--color-primary] to-[--color-accent] flex items-center justify-center">
                <BarChart3 className="w-6 h-6 text-white" />
              </div>
              <div>
                <h2 className="text-2xl font-bold">Dashboard</h2>
                <p className="text-sm text-[--text-muted]">Your productivity overview</p>
              </div>
            </div>
            <div className="flex items-center gap-3">
              <select
                value={timeRange}
                onChange={(e) => setTimeRange(e.target.value as any)}
                className="px-4 py-2 rounded-xl bg-[--bg-elevated] border border-[--border-default] text-sm"
              >
                <option value="week">This Week</option>
                <option value="month">This Month</option>
                <option value="all">All Time</option>
              </select>
              <button
                onClick={onClose}
                className="p-2 rounded-xl hover:bg-[--bg-elevated] text-[--text-muted] hover:text-[--text-primary] transition-colors"
              >
                <X className="w-6 h-6" />
              </button>
            </div>
          </div>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-y-auto p-6">
          {metrics && (
            <div className="space-y-6">
              {/* Stat Cards */}
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <StatCard
                  icon={<FileText className="w-5 h-5" />}
                  label="Total Documents"
                  value={metrics.totalDocuments.toString()}
                  color="#e07a5f"
                />
                <StatCard
                  icon={<TrendingUp className="w-5 h-5" />}
                  label="This Week"
                  value={metrics.thisWeekCount.toString()}
                  change={metrics.weekChange}
                  color="#81b29a"
                />
                <StatCard
                  icon={<Activity className="w-5 h-5" />}
                  label="Avg per Week"
                  value={metrics.avgPerWeek}
                  color="#f2cc8f"
                />
                <StatCard
                  icon={<Zap className="w-5 h-5" />}
                  label="Current Streak"
                  value={`${metrics.streak} days`}
                  color="#6b7fd7"
                />
              </div>

              {/* Charts Row */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Weekly Activity */}
                <div className="p-5 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
                  <h3 className="font-semibold mb-4 flex items-center gap-2">
                    <Calendar className="w-5 h-5 text-[--color-primary]" />
                    Weekly Activity
                  </h3>
                  <div className="h-40 flex items-end justify-between gap-2">
                    {["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"].map((day, i) => {
                      const count = metrics.dayCount[i] || 0;
                      const maxCount = Math.max(...Object.values(metrics.dayCount as Record<string, number>), 1);
                      const height = (count / maxCount) * 100;
                      return (
                        <div key={day} className="flex-1 flex flex-col items-center gap-2">
                          <div className="w-full flex flex-col justify-end h-32">
                            <div
                              className="w-full rounded-t-lg transition-all duration-500"
                              style={{
                                height: `${Math.max(height, 4)}%`,
                                background: `linear-gradient(to top, var(--color-primary), var(--color-accent))`,
                                opacity: height > 0 ? 1 : 0.2,
                              }}
                            />
                          </div>
                          <span className="text-xs text-[--text-muted]">{day}</span>
                        </div>
                      );
                    })}
                  </div>
                  <p className="text-sm text-[--text-muted] mt-4 text-center">
                    Most productive: <span className="text-[--color-primary] font-medium">{metrics.mostProductiveDay}</span>
                  </p>
                </div>

                {/* Document Types */}
                <div className="p-5 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
                  <h3 className="font-semibold mb-4 flex items-center gap-2">
                    <PieChart className="w-5 h-5 text-[--color-accent]" />
                    Top Document Types
                  </h3>
                  <div className="space-y-3">
                    {metrics.topTypes.length === 0 ? (
                      <p className="text-[--text-muted] text-center py-8">
                        No documents created yet
                      </p>
                    ) : (
                      metrics.topTypes.map(([type, count], i) => {
                        const total = metrics.topTypes.reduce((sum: number, [, c]: [string, number]) => sum + c, 0);
                        const percentage = (count / total) * 100;
                        const colors = ["#e07a5f", "#81b29a", "#f2cc8f", "#6b7fd7", "#3d405b"];
                        return (
                          <div key={type}>
                            <div className="flex items-center justify-between text-sm mb-1">
                              <span className="truncate">{type.replace("Letter of ", "")}</span>
                              <span className="text-[--text-muted]">{count}</span>
                            </div>
                            <div className="h-2 bg-[--bg-overlay] rounded-full overflow-hidden">
                              <div
                                className="h-full rounded-full transition-all duration-500"
                                style={{
                                  width: `${percentage}%`,
                                  backgroundColor: colors[i % colors.length],
                                }}
                              />
                            </div>
                          </div>
                        );
                      })
                    )}
                  </div>
                </div>
              </div>

              {/* Achievements */}
              {metrics.achievements.length > 0 && (
                <div className="p-5 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
                  <h3 className="font-semibold mb-4 flex items-center gap-2">
                    <Award className="w-5 h-5 text-[--color-warning]" />
                    Achievements
                  </h3>
                  <div className="flex flex-wrap gap-2">
                    {metrics.achievements.map((achievement: string, i: number) => (
                      <span
                        key={i}
                        className="px-3 py-1.5 rounded-full bg-[--color-warning]/10 text-[--color-warning] text-sm font-medium"
                      >
                        üèÜ {achievement}
                      </span>
                    ))}
                  </div>
                </div>
              )}

              {/* Quick Actions */}
              <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                <QuickAction
                  icon={<FileText className="w-5 h-5" />}
                  label="New Document"
                  onClick={() => {
                    onClose();
                    onNavigate?.("templates");
                  }}
                />
                <QuickAction
                  icon={<Clock className="w-5 h-5" />}
                  label="History"
                  onClick={() => {
                    onClose();
                    onNavigate?.("history");
                  }}
                />
                <QuickAction
                  icon={<Star className="w-5 h-5" />}
                  label="Favorites"
                  onClick={() => {
                    onClose();
                    onNavigate?.("favorites");
                  }}
                />
                <QuickAction
                  icon={<BarChart3 className="w-5 h-5" />}
                  label="Full Stats"
                  onClick={() => {
                    onClose();
                    onNavigate?.("statistics");
                  }}
                />
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

// Stat Card Component
function StatCard({
  icon,
  label,
  value,
  change,
  color,
}: {
  icon: React.ReactNode;
  label: string;
  value: string;
  change?: number;
  color: string;
}) {
  return (
    <div className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
      <div className="flex items-center gap-3 mb-3">
        <div
          className="w-10 h-10 rounded-xl flex items-center justify-center"
          style={{ backgroundColor: `${color}20`, color }}
        >
          {icon}
        </div>
        <span className="text-sm text-[--text-muted]">{label}</span>
      </div>
      <div className="flex items-end justify-between">
        <span className="text-3xl font-bold">{value}</span>
        {change !== undefined && (
          <span
            className={`flex items-center text-sm ${
              change >= 0 ? "text-[--color-success]" : "text-[--color-error]"
            }`}
          >
            {change >= 0 ? (
              <ArrowUpRight className="w-4 h-4" />
            ) : (
              <ArrowDownRight className="w-4 h-4" />
            )}
            {Math.abs(change).toFixed(0)}%
          </span>
        )}
      </div>
    </div>
  );
}

// Quick Action Button
function QuickAction({
  icon,
  label,
  onClick,
}: {
  icon: React.ReactNode;
  label: string;
  onClick: () => void;
}) {
  return (
    <button
      onClick={onClick}
      className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary] transition-all flex flex-col items-center gap-2 group"
    >
      <span className="text-[--text-muted] group-hover:text-[--color-primary] transition-colors">
        {icon}
      </span>
      <span className="text-sm font-medium">{label}</span>
    </button>
  );
}
</file>

<file path="src/components/DocumentComparison.tsx">
"use client";

import { useState, useMemo } from "react";

interface DocumentComparisonProps {
  isOpen: boolean;
  onClose: () => void;
  currentText: string;
}

interface Diff {
  type: "added" | "removed" | "unchanged";
  text: string;
}

export default function DocumentComparison({ isOpen, onClose, currentText }: DocumentComparisonProps) {
  const [compareText, setCompareText] = useState("");
  const [showDiff, setShowDiff] = useState(false);

  const computeDiff = (text1: string, text2: string): Diff[] => {
    const words1 = text1.split(/(\s+)/);
    const words2 = text2.split(/(\s+)/);
    const result: Diff[] = [];
    
    let i = 0, j = 0;
    
    while (i < words1.length || j < words2.length) {
      if (i >= words1.length) {
        result.push({ type: "added", text: words2[j] });
        j++;
      } else if (j >= words2.length) {
        result.push({ type: "removed", text: words1[i] });
        i++;
      } else if (words1[i] === words2[j]) {
        result.push({ type: "unchanged", text: words1[i] });
        i++;
        j++;
      } else {
        // Look ahead for match
        let foundI = -1, foundJ = -1;
        for (let k = 1; k <= 5; k++) {
          if (i + k < words1.length && words1[i + k] === words2[j]) {
            foundI = i + k;
            break;
          }
          if (j + k < words2.length && words1[i] === words2[j + k]) {
            foundJ = j + k;
            break;
          }
        }
        
        if (foundI !== -1 && (foundJ === -1 || foundI - i <= foundJ - j)) {
          while (i < foundI) {
            result.push({ type: "removed", text: words1[i] });
            i++;
          }
        } else if (foundJ !== -1) {
          while (j < foundJ) {
            result.push({ type: "added", text: words2[j] });
            j++;
          }
        } else {
          result.push({ type: "removed", text: words1[i] });
          result.push({ type: "added", text: words2[j] });
          i++;
          j++;
        }
      }
    }
    
    return result;
  };

  const diff = useMemo(() => {
    if (!showDiff || !compareText) return [];
    return computeDiff(compareText, currentText);
  }, [compareText, currentText, showDiff]);

  const stats = useMemo(() => {
    if (!showDiff) return { added: 0, removed: 0, unchanged: 0 };
    return {
      added: diff.filter(d => d.type === "added" && d.text.trim()).length,
      removed: diff.filter(d => d.type === "removed" && d.text.trim()).length,
      unchanged: diff.filter(d => d.type === "unchanged" && d.text.trim()).length,
    };
  }, [diff, showDiff]);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-5xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üìä Document Comparison</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {!showDiff ? (
            <div className="space-y-4">
              <div className="p-4 rounded-lg bg-[#a78bfa]/10 border border-[#a78bfa]/30">
                <p className="text-[#a0a0a0] text-sm">
                  Paste older version of your document below to compare with current version.
                </p>
              </div>

              <div>
                <label className="block text-sm text-[#a0a0a0] mb-2">Previous Version (paste here)</label>
                <textarea
                  value={compareText}
                  onChange={(e) => setCompareText(e.target.value)}
                  placeholder="Paste the older version of your document..."
                  className="w-full h-64 px-4 py-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white resize-none focus:border-[#a78bfa]"
                />
              </div>

              <button
                onClick={() => setShowDiff(true)}
                disabled={!compareText.trim()}
                className="w-full py-3 rounded-lg bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white hover:opacity-90 disabled:opacity-50"
              >
                Compare Documents
              </button>
            </div>
          ) : (
            <div className="space-y-4">
              {/* Stats */}
              <div className="flex gap-4">
                <div className="px-4 py-2 rounded-lg bg-[#4ade80]/10 border border-[#4ade80]/30">
                  <span className="text-[#4ade80]">+{stats.added} added</span>
                </div>
                <div className="px-4 py-2 rounded-lg bg-[#f87171]/10 border border-[#f87171]/30">
                  <span className="text-[#f87171]">-{stats.removed} removed</span>
                </div>
                <div className="px-4 py-2 rounded-lg bg-[#2a2a3a]">
                  <span className="text-[#a0a0a0]">{stats.unchanged} unchanged</span>
                </div>
                <button
                  onClick={() => setShowDiff(false)}
                  className="ml-auto text-sm text-[#a78bfa] hover:text-[#c4b5fd]"
                >
                  ‚Üê Back to input
                </button>
              </div>

              {/* Diff view */}
              <div className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] min-h-[300px] max-h-[500px] overflow-auto">
                <div className="whitespace-pre-wrap leading-relaxed">
                  {diff.map((d, i) => (
                    <span
                      key={i}
                      className={`${
                        d.type === "added" 
                          ? "bg-[#4ade80]/20 text-[#4ade80]" 
                          : d.type === "removed" 
                            ? "bg-[#f87171]/20 text-[#f87171] line-through" 
                            : "text-white"
                      }`}
                    >
                      {d.text}
                    </span>
                  ))}
                </div>
              </div>

              {/* Legend */}
              <div className="flex gap-4 text-sm text-[#666680]">
                <span className="flex items-center gap-2">
                  <span className="w-4 h-4 rounded bg-[#4ade80]/20"></span>
                  Added
                </span>
                <span className="flex items-center gap-2">
                  <span className="w-4 h-4 rounded bg-[#f87171]/20"></span>
                  Removed
                </span>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/DocumentExpiration.tsx">
"use client";

import { useState, useEffect } from "react";

interface ExpirationSettings {
  enabled: boolean;
  defaultDays: number;
  showWarning: boolean;
  warningDays: number;
}

const DEFAULT_EXPIRATION_SETTINGS: ExpirationSettings = {
  enabled: false,
  defaultDays: 30,
  showWarning: true,
  warningDays: 7,
};

interface DocumentWithExpiration {
  id: string;
  name: string;
  createdAt: string;
  expiresAt: string;
  status: "active" | "warning" | "expired";
}

export function useDocumentExpiration() {
  const [settings, setSettings] = useState<ExpirationSettings>(DEFAULT_EXPIRATION_SETTINGS);
  const [documents, setDocuments] = useState<DocumentWithExpiration[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const savedSettings = localStorage.getItem("expirationSettings");
    const savedDocs = localStorage.getItem("expiringDocuments");
    
    if (savedSettings) {
      try {
        setSettings(JSON.parse(savedSettings));
      } catch (e) {
        console.error("Error loading expiration settings:", e);
      }
    }
    
    if (savedDocs) {
      try {
        setDocuments(JSON.parse(savedDocs));
      } catch (e) {
        console.error("Error loading expiring documents:", e);
      }
    }
  }, []);

  const saveSettings = (newSettings: ExpirationSettings) => {
    setSettings(newSettings);
    localStorage.setItem("expirationSettings", JSON.stringify(newSettings));
  };

  const addDocument = (name: string, expirationDays?: number) => {
    const days = expirationDays || settings.defaultDays;
    const now = new Date();
    const expiresAt = new Date(now.getTime() + days * 24 * 60 * 60 * 1000);
    
    const newDoc: DocumentWithExpiration = {
      id: `doc-${Date.now()}`,
      name,
      createdAt: now.toISOString(),
      expiresAt: expiresAt.toISOString(),
      status: "active",
    };
    
    const updated = [...documents, newDoc];
    setDocuments(updated);
    localStorage.setItem("expiringDocuments", JSON.stringify(updated));
    
    return newDoc;
  };

  const updateDocumentStatus = () => {
    const now = new Date();
    const warningDate = new Date(now.getTime() + settings.warningDays * 24 * 60 * 60 * 1000);
    
    const updated = documents.map(doc => {
      const expires = new Date(doc.expiresAt);
      if (expires < now) {
        return { ...doc, status: "expired" as const };
      } else if (expires < warningDate) {
        return { ...doc, status: "warning" as const };
      }
      return { ...doc, status: "active" as const };
    });
    
    setDocuments(updated);
    localStorage.setItem("expiringDocuments", JSON.stringify(updated));
  };

  const removeDocument = (id: string) => {
    const updated = documents.filter(d => d.id !== id);
    setDocuments(updated);
    localStorage.setItem("expiringDocuments", JSON.stringify(updated));
  };

  const extendExpiration = (id: string, additionalDays: number) => {
    const updated = documents.map(doc => {
      if (doc.id === id) {
        const newExpiry = new Date(new Date(doc.expiresAt).getTime() + additionalDays * 24 * 60 * 60 * 1000);
        return { ...doc, expiresAt: newExpiry.toISOString(), status: "active" as const };
      }
      return doc;
    });
    
    setDocuments(updated);
    localStorage.setItem("expiringDocuments", JSON.stringify(updated));
  };

  return { 
    settings, 
    saveSettings, 
    documents, 
    addDocument, 
    updateDocumentStatus, 
    removeDocument, 
    extendExpiration,
    mounted 
  };
}

interface DocumentExpirationProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function DocumentExpiration({ isOpen, onClose }: DocumentExpirationProps) {
  const { settings, saveSettings, documents, removeDocument, extendExpiration, updateDocumentStatus } = useDocumentExpiration();
  const [activeTab, setActiveTab] = useState<"settings" | "documents">("documents");

  useEffect(() => {
    if (isOpen) {
      updateDocumentStatus();
    }
  }, [isOpen]);

  if (!isOpen) return null;

  const formatDate = (isoString: string) => {
    return new Date(isoString).toLocaleDateString();
  };

  const getDaysRemaining = (expiresAt: string) => {
    const now = new Date();
    const expires = new Date(expiresAt);
    const diff = expires.getTime() - now.getTime();
    return Math.ceil(diff / (1000 * 60 * 60 * 24));
  };

  const activeDocuments = documents.filter(d => d.status === "active");
  const warningDocuments = documents.filter(d => d.status === "warning");
  const expiredDocuments = documents.filter(d => d.status === "expired");

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-2xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">‚è≥ Document Expiration</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        {/* Tabs */}
        <div className="flex border-b border-[#2a2a3a]">
          <button
            onClick={() => setActiveTab("documents")}
            className={`flex-1 py-3 text-sm transition-colors ${
              activeTab === "documents"
                ? "text-[#a78bfa] border-b-2 border-[#a78bfa]"
                : "text-[#666680] hover:text-white"
            }`}
          >
            Documents ({documents.length})
          </button>
          <button
            onClick={() => setActiveTab("settings")}
            className={`flex-1 py-3 text-sm transition-colors ${
              activeTab === "settings"
                ? "text-[#a78bfa] border-b-2 border-[#a78bfa]"
                : "text-[#666680] hover:text-white"
            }`}
          >
            Settings
          </button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {activeTab === "documents" ? (
            <div className="space-y-6">
              {/* Warning Banner */}
              {warningDocuments.length > 0 && (
                <div className="p-4 rounded-lg bg-[#f0b866]/10 border border-[#f0b866]/30">
                  <p className="text-[#f0b866] font-medium">
                    ‚ö†Ô∏è {warningDocuments.length} document{warningDocuments.length !== 1 ? "s" : ""} expiring soon
                  </p>
                </div>
              )}

              {/* Expired */}
              {expiredDocuments.length > 0 && (
                <div>
                  <h3 className="text-sm font-medium text-[#f87171] mb-3">Expired ({expiredDocuments.length})</h3>
                  <div className="space-y-2">
                    {expiredDocuments.map(doc => (
                      <div key={doc.id} className="p-3 rounded-lg bg-[#f87171]/10 border border-[#f87171]/30 flex items-center justify-between">
                        <div>
                          <p className="text-white">{doc.name}</p>
                          <p className="text-xs text-[#f87171]">Expired {formatDate(doc.expiresAt)}</p>
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => extendExpiration(doc.id, 30)}
                            className="px-3 py-1 rounded text-sm bg-[#4ecdc4] text-[#0a0a12]"
                          >
                            Extend 30d
                          </button>
                          <button
                            onClick={() => removeDocument(doc.id)}
                            className="px-3 py-1 rounded text-sm text-[#f87171] hover:bg-[#f87171]/10"
                          >
                            Remove
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Warning */}
              {warningDocuments.length > 0 && (
                <div>
                  <h3 className="text-sm font-medium text-[#f0b866] mb-3">Expiring Soon ({warningDocuments.length})</h3>
                  <div className="space-y-2">
                    {warningDocuments.map(doc => (
                      <div key={doc.id} className="p-3 rounded-lg bg-[#f0b866]/10 border border-[#f0b866]/30 flex items-center justify-between">
                        <div>
                          <p className="text-white">{doc.name}</p>
                          <p className="text-xs text-[#f0b866]">{getDaysRemaining(doc.expiresAt)} days remaining</p>
                        </div>
                        <button
                          onClick={() => extendExpiration(doc.id, 30)}
                          className="px-3 py-1 rounded text-sm bg-[#4ecdc4] text-[#0a0a12]"
                        >
                          Extend 30d
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Active */}
              {activeDocuments.length > 0 && (
                <div>
                  <h3 className="text-sm font-medium text-[#4ade80] mb-3">Active ({activeDocuments.length})</h3>
                  <div className="space-y-2">
                    {activeDocuments.map(doc => (
                      <div key={doc.id} className="p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] flex items-center justify-between">
                        <div>
                          <p className="text-white">{doc.name}</p>
                          <p className="text-xs text-[#666680]">Expires {formatDate(doc.expiresAt)} ({getDaysRemaining(doc.expiresAt)} days)</p>
                        </div>
                        <button
                          onClick={() => removeDocument(doc.id)}
                          className="text-[#666680] hover:text-[#f87171]"
                        >
                          √ó
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {documents.length === 0 && (
                <div className="text-center py-12 text-[#666680]">
                  <p>No documents with expiration tracking.</p>
                  <p className="text-sm mt-2">Enable expiration in settings and generate new documents.</p>
                </div>
              )}
            </div>
          ) : (
            <div className="space-y-6">
              {/* Enable/Disable */}
              <label className="flex items-center justify-between p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div>
                  <p className="text-white font-medium">Enable Document Expiration</p>
                  <p className="text-sm text-[#666680]">Track when documents should be reviewed or renewed</p>
                </div>
                <button
                  onClick={() => saveSettings({ ...settings, enabled: !settings.enabled })}
                  className={`w-12 h-6 rounded-full transition-colors ${
                    settings.enabled ? "bg-[#4ade80]" : "bg-[#2a2a3a]"
                  }`}
                >
                  <div className={`w-5 h-5 rounded-full bg-white transition-transform ${
                    settings.enabled ? "translate-x-6" : "translate-x-0.5"
                  }`} />
                </button>
              </label>

              {/* Default Days */}
              <div>
                <label className="block text-sm text-[#a0a0a0] mb-2">Default Expiration (days)</label>
                <input
                  type="number"
                  value={settings.defaultDays}
                  onChange={(e) => saveSettings({ ...settings, defaultDays: parseInt(e.target.value) || 30 })}
                  min={1}
                  max={365}
                  className="w-full px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                />
              </div>

              {/* Warning Settings */}
              <label className="flex items-center justify-between p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div>
                  <p className="text-white font-medium">Show Warning</p>
                  <p className="text-sm text-[#666680]">Alert before documents expire</p>
                </div>
                <button
                  onClick={() => saveSettings({ ...settings, showWarning: !settings.showWarning })}
                  className={`w-12 h-6 rounded-full transition-colors ${
                    settings.showWarning ? "bg-[#f0b866]" : "bg-[#2a2a3a]"
                  }`}
                >
                  <div className={`w-5 h-5 rounded-full bg-white transition-transform ${
                    settings.showWarning ? "translate-x-6" : "translate-x-0.5"
                  }`} />
                </button>
              </label>

              {settings.showWarning && (
                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Warning Days Before Expiration</label>
                  <input
                    type="number"
                    value={settings.warningDays}
                    onChange={(e) => saveSettings({ ...settings, warningDays: parseInt(e.target.value) || 7 })}
                    min={1}
                    max={30}
                    className="w-full px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                  />
                </div>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/DocumentRevisions.tsx">
"use client";

import { useState, useEffect, useMemo } from "react";

export interface Revision {
  id: string;
  documentId: string;
  version: number;
  content: string;
  changes: string;
  createdAt: string;
  createdBy: string;
}

interface DocumentRevisionsProps {
  isOpen: boolean;
  onClose: () => void;
  documentId: string;
  currentContent: string;
  onRestoreRevision: (content: string) => void;
}

// Compute diff between two strings
function computeDiff(oldText: string, newText: string): { added: number; removed: number; summary: string } {
  const oldWords = oldText.split(/\s+/);
  const newWords = newText.split(/\s+/);
  
  const oldSet = new Set(oldWords);
  const newSet = new Set(newWords);
  
  let added = 0;
  let removed = 0;
  
  for (const word of newWords) {
    if (!oldSet.has(word)) added++;
  }
  for (const word of oldWords) {
    if (!newSet.has(word)) removed++;
  }
  
  if (added === 0 && removed === 0) return { added, removed, summary: "No changes" };
  
  const parts = [];
  if (added > 0) parts.push(`+${added} words`);
  if (removed > 0) parts.push(`-${removed} words`);
  
  return { added, removed, summary: parts.join(", ") };
}

export default function DocumentRevisions({ 
  isOpen, 
  onClose, 
  documentId, 
  currentContent,
  onRestoreRevision 
}: DocumentRevisionsProps) {
  const [revisions, setRevisions] = useState<Revision[]>([]);
  const [selectedRevision, setSelectedRevision] = useState<Revision | null>(null);
  const [compareMode, setCompareMode] = useState(false);

  useEffect(() => {
    if (isOpen) {
      loadRevisions();
    }
  }, [isOpen, documentId]);

  const loadRevisions = () => {
    const saved = localStorage.getItem(`revisions-${documentId}`);
    if (saved) {
      try {
        setRevisions(JSON.parse(saved));
      } catch {
        setRevisions([]);
      }
    }
  };

  const handleRestore = () => {
    if (selectedRevision) {
      onRestoreRevision(selectedRevision.content);
      onClose();
    }
  };

  // Calculate diff stats for each revision
  const revisionsWithDiff = useMemo(() => {
    return revisions.map((rev, index) => {
      const prevContent = index < revisions.length - 1 ? revisions[index + 1].content : "";
      const diff = computeDiff(prevContent, rev.content);
      return { ...rev, diff };
    });
  }, [revisions]);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
      <div className="bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-2xl w-full max-w-4xl max-h-[80vh] flex flex-col">
        <div className="p-5 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <h2 className="text-lg font-semibold text-[--text-primary]">Document Revisions</h2>
            <button onClick={onClose} className="text-[--text-muted] hover:text-[--text-primary]">‚úï</button>
          </div>
          <p className="text-sm text-[--text-muted] mt-1">
            {revisions.length} revision{revisions.length !== 1 ? "s" : ""} saved
          </p>
        </div>

        <div className="flex-1 flex overflow-hidden">
          {/* Revision List */}
          <div className="w-72 border-r border-[--border-default] overflow-y-auto">
            {revisionsWithDiff.length === 0 ? (
              <div className="p-4 text-center text-[--text-muted]">
                No revisions yet
              </div>
            ) : (
              <div className="p-2">
                {revisionsWithDiff.map((rev) => (
                  <button
                    key={rev.id}
                    onClick={() => setSelectedRevision(rev)}
                    className={`w-full text-left p-3 rounded-lg mb-1 transition-colors ${
                      selectedRevision?.id === rev.id
                        ? "bg-[--color-primary]/10 border border-[--color-primary]/30"
                        : "hover:bg-[--bg-elevated]"
                    }`}
                  >
                    <div className="flex items-center justify-between mb-1">
                      <span className="font-medium text-[--text-primary]">Version {rev.version}</span>
                      <span className={`text-xs ${
                        rev.diff.added > 0 ? "text-green-400" : 
                        rev.diff.removed > 0 ? "text-red-400" : "text-[--text-muted]"
                      }`}>
                        {rev.diff.summary}
                      </span>
                    </div>
                    <div className="text-xs text-[--text-muted]">
                      {new Date(rev.createdAt).toLocaleString()}
                    </div>
                    {rev.changes && (
                      <div className="text-xs text-[--text-secondary] mt-1 truncate">
                        {rev.changes}
                      </div>
                    )}
                  </button>
                ))}
              </div>
            )}
          </div>

          {/* Preview Panel */}
          <div className="flex-1 flex flex-col overflow-hidden">
            {selectedRevision ? (
              <>
                <div className="p-4 border-b border-[--border-default] flex items-center justify-between">
                  <div>
                    <h3 className="font-medium text-[--text-primary]">Version {selectedRevision.version}</h3>
                    <p className="text-sm text-[--text-muted]">
                      {new Date(selectedRevision.createdAt).toLocaleString()}
                    </p>
                  </div>
                  <label className="flex items-center gap-2 text-sm text-[--text-secondary]">
                    <input
                      type="checkbox"
                      checked={compareMode}
                      onChange={(e) => setCompareMode(e.target.checked)}
                    />
                    Compare with current
                  </label>
                </div>
                
                <div className="flex-1 overflow-y-auto p-4">
                  {compareMode ? (
                    <div className="grid grid-cols-2 gap-4 h-full">
                      <div>
                        <h4 className="text-sm font-medium text-[--text-secondary] mb-2">Selected Version</h4>
                        <div className="p-4 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-sm text-[--text-primary] whitespace-pre-wrap h-64 overflow-y-auto">
                          {selectedRevision.content}
                        </div>
                      </div>
                      <div>
                        <h4 className="text-sm font-medium text-[--text-secondary] mb-2">Current Version</h4>
                        <div className="p-4 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-sm text-[--text-primary] whitespace-pre-wrap h-64 overflow-y-auto">
                          {currentContent}
                        </div>
                      </div>
                    </div>
                  ) : (
                    <div className="p-4 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-sm text-[--text-primary] whitespace-pre-wrap">
                      {selectedRevision.content}
                    </div>
                  )}
                </div>
              </>
            ) : (
              <div className="flex-1 flex items-center justify-center text-[--text-muted]">
                Select a revision to preview
              </div>
            )}
          </div>
        </div>

        <div className="p-5 border-t border-[--border-default] flex justify-between">
          <button
            onClick={onClose}
            className="px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:bg-[--bg-overlay]"
          >
            Close
          </button>
          {selectedRevision && (
            <button
              onClick={handleRestore}
              className="px-4 py-2.5 rounded-lg bg-[--color-primary] text-white hover:opacity-90"
            >
              Restore This Version
            </button>
          )}
        </div>
      </div>
    </div>
  );
}

// Hook to manage revisions
export function useDocumentRevisions(documentId: string) {
  const saveRevision = (content: string, changes?: string) => {
    const key = `revisions-${documentId}`;
    const saved = localStorage.getItem(key);
    let revisions: Revision[] = [];
    
    try {
      revisions = saved ? JSON.parse(saved) : [];
    } catch {
      revisions = [];
    }
    
    // Don't save if content is identical to last revision
    if (revisions.length > 0 && revisions[0].content === content) {
      return;
    }
    
    const newRevision: Revision = {
      id: `rev-${Date.now()}`,
      documentId,
      version: revisions.length + 1,
      content,
      changes: changes || "Manual save",
      createdAt: new Date().toISOString(),
      createdBy: "User",
    };
    
    // Keep last 50 revisions
    const updatedRevisions = [newRevision, ...revisions].slice(0, 50);
    localStorage.setItem(key, JSON.stringify(updatedRevisions));
  };

  const getRevisionCount = (): number => {
    const saved = localStorage.getItem(`revisions-${documentId}`);
    if (!saved) return 0;
    try {
      return JSON.parse(saved).length;
    } catch {
      return 0;
    }
  };

  return { saveRevision, getRevisionCount };
}
</file>

<file path="src/components/DocumentScheduling.tsx">
"use client";

import { useState, useEffect } from "react";

interface ScheduledDocument {
  id: string;
  documentType: string;
  bodyText: string;
  recipientName: string;
  scheduledFor: string;
  status: "pending" | "completed" | "failed";
  createdAt: string;
}

interface DocumentSchedulingProps {
  isOpen: boolean;
  onClose: () => void;
  currentDocumentType: string;
  currentBodyText: string;
  currentRecipientName: string;
  onGenerate: () => void;
}

export function useScheduledDocuments() {
  const [documents, setDocuments] = useState<ScheduledDocument[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem("scheduledDocuments");
    if (saved) {
      try {
        setDocuments(JSON.parse(saved));
      } catch (e) {
        console.error("Error loading scheduled documents:", e);
      }
    }
  }, []);

  const saveDocuments = (updated: ScheduledDocument[]) => {
    setDocuments(updated);
    localStorage.setItem("scheduledDocuments", JSON.stringify(updated));
  };

  const addScheduledDocument = (doc: Omit<ScheduledDocument, "id" | "status" | "createdAt">) => {
    const newDoc: ScheduledDocument = {
      ...doc,
      id: `scheduled-${Date.now()}`,
      status: "pending",
      createdAt: new Date().toISOString(),
    };
    saveDocuments([...documents, newDoc]);
    return newDoc;
  };

  const updateStatus = (id: string, status: ScheduledDocument["status"]) => {
    saveDocuments(documents.map(d => d.id === id ? { ...d, status } : d));
  };

  const deleteDocument = (id: string) => {
    saveDocuments(documents.filter(d => d.id !== id));
  };

  return { documents, addScheduledDocument, updateStatus, deleteDocument, mounted };
}

export default function DocumentScheduling({ 
  isOpen, 
  onClose, 
  currentDocumentType,
  currentBodyText,
  currentRecipientName,
  onGenerate
}: DocumentSchedulingProps) {
  const { documents, addScheduledDocument, updateStatus, deleteDocument } = useScheduledDocuments();
  const [showScheduleForm, setShowScheduleForm] = useState(false);
  const [scheduleDate, setScheduleDate] = useState("");
  const [scheduleTime, setScheduleTime] = useState("");
  const [repeatOption, setRepeatOption] = useState<"none" | "daily" | "weekly" | "monthly">("none");

  // Check for due documents
  useEffect(() => {
    const interval = setInterval(() => {
      const now = new Date();
      documents.forEach(doc => {
        if (doc.status === "pending") {
          const scheduledTime = new Date(doc.scheduledFor);
          if (scheduledTime <= now) {
            // In a real app, this would generate the PDF
            console.log(`[Scheduler] Document ${doc.id} is due!`);
            updateStatus(doc.id, "completed");
          }
        }
      });
    }, 60000); // Check every minute

    return () => clearInterval(interval);
  }, [documents, updateStatus]);

  const handleSchedule = () => {
    if (!scheduleDate || !scheduleTime) return;
    
    const scheduledFor = new Date(`${scheduleDate}T${scheduleTime}`).toISOString();
    
    addScheduledDocument({
      documentType: currentDocumentType,
      bodyText: currentBodyText,
      recipientName: currentRecipientName,
      scheduledFor,
    });
    
    setScheduleDate("");
    setScheduleTime("");
    setShowScheduleForm(false);
  };

  const getMinDate = () => {
    const today = new Date();
    return today.toISOString().split("T")[0];
  };

  const formatScheduledTime = (isoString: string) => {
    const date = new Date(isoString);
    return date.toLocaleString();
  };

  const getTimeUntil = (isoString: string) => {
    const now = new Date();
    const scheduled = new Date(isoString);
    const diff = scheduled.getTime() - now.getTime();
    
    if (diff < 0) return "Past due";
    
    const hours = Math.floor(diff / 3600000);
    const minutes = Math.floor((diff % 3600000) / 60000);
    
    if (hours > 24) {
      const days = Math.floor(hours / 24);
      return `In ${days} day${days !== 1 ? "s" : ""}`;
    }
    if (hours > 0) {
      return `In ${hours}h ${minutes}m`;
    }
    return `In ${minutes}m`;
  };

  if (!isOpen) return null;

  const pendingDocs = documents.filter(d => d.status === "pending");
  const completedDocs = documents.filter(d => d.status === "completed");

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-3xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">‚è∞ Document Scheduling</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {/* Current Document Info */}
          <div className="mb-6 p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
            <h3 className="text-sm text-[#a0a0a0] mb-2">Current Document</h3>
            <div className="flex items-center justify-between">
              <div>
                <p className="text-white font-medium">{currentDocumentType || "No type selected"}</p>
                <p className="text-sm text-[#666680]">
                  {currentBodyText ? `${currentBodyText.split(/\s+/).length} words` : "No content"}
                </p>
              </div>
              <div className="flex gap-2">
                <button
                  onClick={onGenerate}
                  className="px-4 py-2 rounded-lg bg-[#4ecdc4] text-[#0a0a12] text-sm"
                >
                  Generate Now
                </button>
                <button
                  onClick={() => setShowScheduleForm(true)}
                  disabled={!currentBodyText}
                  className="px-4 py-2 rounded-lg bg-[#a78bfa] text-white text-sm disabled:opacity-50"
                >
                  Schedule
                </button>
              </div>
            </div>
          </div>

          {/* Schedule Form */}
          {showScheduleForm && (
            <div className="mb-6 p-4 rounded-lg bg-[#a78bfa]/10 border border-[#a78bfa]/30">
              <h3 className="text-white font-medium mb-4">Schedule Generation</h3>
              
              <div className="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-1">Date</label>
                  <input
                    type="date"
                    value={scheduleDate}
                    onChange={(e) => setScheduleDate(e.target.value)}
                    min={getMinDate()}
                    className="w-full px-4 py-2 rounded-lg bg-[#12121a] border border-[#2a2a3a] text-white"
                  />
                </div>
                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-1">Time</label>
                  <input
                    type="time"
                    value={scheduleTime}
                    onChange={(e) => setScheduleTime(e.target.value)}
                    className="w-full px-4 py-2 rounded-lg bg-[#12121a] border border-[#2a2a3a] text-white"
                  />
                </div>
              </div>

              <div className="mb-4">
                <label className="block text-sm text-[#a0a0a0] mb-1">Repeat</label>
                <select
                  value={repeatOption}
                  onChange={(e) => setRepeatOption(e.target.value as typeof repeatOption)}
                  className="w-full px-4 py-2 rounded-lg bg-[#12121a] border border-[#2a2a3a] text-white"
                >
                  <option value="none">No repeat</option>
                  <option value="daily">Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                </select>
              </div>

              <div className="flex gap-2">
                <button
                  onClick={() => setShowScheduleForm(false)}
                  className="flex-1 py-2 rounded-lg bg-[#2a2a3a] text-white"
                >
                  Cancel
                </button>
                <button
                  onClick={handleSchedule}
                  disabled={!scheduleDate || !scheduleTime}
                  className="flex-1 py-2 rounded-lg bg-[#a78bfa] text-white disabled:opacity-50"
                >
                  Schedule
                </button>
              </div>
            </div>
          )}

          {/* Pending Documents */}
          <div className="mb-6">
            <h3 className="text-sm font-medium text-[#f0b866] mb-3">
              Pending ({pendingDocs.length})
            </h3>
            {pendingDocs.length === 0 ? (
              <div className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-center text-[#666680]">
                No scheduled documents
              </div>
            ) : (
              <div className="space-y-2">
                {pendingDocs.map(doc => (
                  <div key={doc.id} className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] flex items-center justify-between">
                    <div>
                      <p className="text-white font-medium">{doc.documentType}</p>
                      <p className="text-sm text-[#666680]">{formatScheduledTime(doc.scheduledFor)}</p>
                    </div>
                    <div className="flex items-center gap-4">
                      <span className="px-3 py-1 rounded-full text-xs bg-[#f0b866]/20 text-[#f0b866]">
                        {getTimeUntil(doc.scheduledFor)}
                      </span>
                      <button
                        onClick={() => deleteDocument(doc.id)}
                        className="text-[#f87171] hover:text-[#fca5a5]"
                      >
                        Cancel
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Completed Documents */}
          {completedDocs.length > 0 && (
            <div>
              <h3 className="text-sm font-medium text-[#4ade80] mb-3">
                Completed ({completedDocs.length})
              </h3>
              <div className="space-y-2">
                {completedDocs.slice(0, 5).map(doc => (
                  <div key={doc.id} className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] flex items-center justify-between opacity-60">
                    <div>
                      <p className="text-white font-medium">{doc.documentType}</p>
                      <p className="text-sm text-[#666680]">Generated {formatScheduledTime(doc.scheduledFor)}</p>
                    </div>
                    <span className="px-3 py-1 rounded-full text-xs bg-[#4ade80]/20 text-[#4ade80]">
                      ‚úì Done
                    </span>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/DocumentSearch.tsx">
"use client";

import { useState, useEffect, useMemo } from "react";
import { DocumentHistoryItem, getHistory } from "@/utils/documentHistory";

interface DocumentSearchProps {
  isOpen: boolean;
  onClose: () => void;
  onSelect: (doc: DocumentHistoryItem) => void;
}

export default function DocumentSearch({ isOpen, onClose, onSelect }: DocumentSearchProps) {
  const [history, setHistory] = useState<DocumentHistoryItem[]>([]);
  const [search, setSearch] = useState("");
  const [filterType, setFilterType] = useState<string>("all");
  const [sortBy, setSortBy] = useState<"date" | "name">("date");
  const [sortOrder, setSortOrder] = useState<"asc" | "desc">("desc");

  useEffect(() => {
    if (isOpen) {
      setHistory(getHistory());
      setSearch("");
    }
  }, [isOpen]);

  const documentTypes = useMemo(() => {
    const types = new Set(history.map(d => d.documentType));
    return Array.from(types);
  }, [history]);

  const filteredDocs = useMemo(() => {
    let docs = history;
    
    // Filter by search
    if (search) {
      const searchLower = search.toLowerCase();
      docs = docs.filter(doc =>
        doc.documentType.toLowerCase().includes(searchLower) ||
        doc.recipientName?.toLowerCase().includes(searchLower) ||
        doc.bodyText?.toLowerCase().includes(searchLower) ||
        doc.signatoryName?.toLowerCase().includes(searchLower)
      );
    }
    
    // Filter by type
    if (filterType !== "all") {
      docs = docs.filter(doc => doc.documentType === filterType);
    }
    
    // Sort
    docs = [...docs].sort((a, b) => {
      if (sortBy === "date") {
        return sortOrder === "desc" 
          ? new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()
          : new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime();
      } else {
        return sortOrder === "desc"
          ? b.documentType.localeCompare(a.documentType)
          : a.documentType.localeCompare(b.documentType);
      }
    });
    
    return docs;
  }, [history, search, filterType, sortBy, sortOrder]);

  const highlightMatch = (text: string, query: string) => {
    if (!query) return text;
    const parts = text.split(new RegExp(`(${query})`, 'gi'));
    return parts.map((part, i) => 
      part.toLowerCase() === query.toLowerCase() 
        ? <mark key={i} className="bg-yellow-300/30 text-inherit">{part}</mark>
        : part
    );
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
      <div className="bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-2xl w-full max-w-3xl max-h-[85vh] flex flex-col">
        {/* Header */}
        <div className="p-5 border-b border-[--border-default]">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-lg font-semibold text-[--text-primary]">Search Documents</h2>
            <button onClick={onClose} className="text-[--text-muted] hover:text-[--text-primary]">‚úï</button>
          </div>
          
          {/* Search input */}
          <div className="relative">
            <input
              type="text"
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              placeholder="Search by content, recipient, document type..."
              autoFocus
              className="w-full pl-10 pr-4 py-3 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] placeholder:text-[--text-muted]"
            />
            <span className="absolute left-3 top-1/2 -translate-y-1/2 text-[--text-muted]">üîç</span>
          </div>

          {/* Filters */}
          <div className="flex items-center gap-4 mt-4">
            <select
              value={filterType}
              onChange={(e) => setFilterType(e.target.value)}
              className="px-3 py-1.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
            >
              <option value="all">All Types</option>
              {documentTypes.map(type => (
                <option key={type} value={type}>{type}</option>
              ))}
            </select>
            
            <select
              value={sortBy}
              onChange={(e) => setSortBy(e.target.value as "date" | "name")}
              className="px-3 py-1.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
            >
              <option value="date">Sort by Date</option>
              <option value="name">Sort by Type</option>
            </select>
            
            <button
              onClick={() => setSortOrder(o => o === "asc" ? "desc" : "asc")}
              className="px-3 py-1.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
            >
              {sortOrder === "desc" ? "‚Üì Newest" : "‚Üë Oldest"}
            </button>
            
            <span className="ml-auto text-sm text-[--text-muted]">
              {filteredDocs.length} document{filteredDocs.length !== 1 ? "s" : ""}
            </span>
          </div>
        </div>

        {/* Results */}
        <div className="flex-1 overflow-y-auto p-5">
          {filteredDocs.length === 0 ? (
            <div className="text-center py-12 text-[--text-muted]">
              <p className="text-lg mb-2">No documents found</p>
              <p className="text-sm">Try adjusting your search or filters</p>
            </div>
          ) : (
            <div className="space-y-3">
              {filteredDocs.map((doc) => (
                <button
                  key={doc.id}
                  onClick={() => { onSelect(doc); onClose(); }}
                  className="w-full text-left p-4 rounded-lg bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary] transition-colors group"
                >
                  <div className="flex items-start justify-between gap-4">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-medium text-[--text-primary]">
                          {highlightMatch(doc.documentType, search)}
                        </span>
                        <span className="text-xs px-2 py-0.5 rounded-full bg-[--bg-overlay] text-[--text-muted]">
                          {new Date(doc.createdAt).toLocaleDateString()}
                        </span>
                      </div>
                      {doc.recipientName && (
                        <p className="text-sm text-[--text-secondary] mb-1">
                          To: {highlightMatch(doc.recipientName, search)}
                        </p>
                      )}
                      <p className="text-sm text-[--text-muted] line-clamp-2">
                        {doc.bodyText?.substring(0, 200) || doc.preview || "No preview"}
                      </p>
                    </div>
                    <span className="text-[--color-primary] opacity-0 group-hover:opacity-100 transition-opacity">
                      Open ‚Üí
                    </span>
                  </div>
                </button>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/DocumentTags.tsx">
"use client";

import { useState, useEffect } from "react";

interface Tag {
  id: string;
  name: string;
  color: string;
}

const DEFAULT_COLORS = [
  "#a78bfa", "#4ecdc4", "#f472b6", "#f0b866", "#60a5fa", 
  "#4ade80", "#f87171", "#fb923c", "#c084fc", "#22d3ee"
];

interface DocumentTagsProps {
  selectedTags: string[];
  onTagsChange: (tags: string[]) => void;
  compact?: boolean;
}

export function useDocumentTags() {
  const [tags, setTags] = useState<Tag[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem("documentTags");
    if (saved) {
      try {
        setTags(JSON.parse(saved));
      } catch (e) {
        console.error("Error loading tags:", e);
      }
    }
  }, []);

  const saveTags = (newTags: Tag[]) => {
    setTags(newTags);
    localStorage.setItem("documentTags", JSON.stringify(newTags));
  };

  const addTag = (name: string) => {
    const color = DEFAULT_COLORS[tags.length % DEFAULT_COLORS.length];
    const newTag: Tag = {
      id: `tag-${Date.now()}`,
      name,
      color,
    };
    saveTags([...tags, newTag]);
    return newTag;
  };

  const deleteTag = (id: string) => {
    saveTags(tags.filter(t => t.id !== id));
  };

  const updateTagColor = (id: string, color: string) => {
    saveTags(tags.map(t => t.id === id ? { ...t, color } : t));
  };

  return { tags, addTag, deleteTag, updateTagColor, mounted };
}

export default function DocumentTags({ selectedTags, onTagsChange, compact = false }: DocumentTagsProps) {
  const { tags, addTag, deleteTag } = useDocumentTags();
  const [showAdd, setShowAdd] = useState(false);
  const [newTagName, setNewTagName] = useState("");

  const handleAddTag = () => {
    if (!newTagName.trim()) return;
    const tag = addTag(newTagName.trim());
    onTagsChange([...selectedTags, tag.id]);
    setNewTagName("");
    setShowAdd(false);
  };

  const toggleTag = (tagId: string) => {
    if (selectedTags.includes(tagId)) {
      onTagsChange(selectedTags.filter(id => id !== tagId));
    } else {
      onTagsChange([...selectedTags, tagId]);
    }
  };

  if (compact) {
    return (
      <div className="flex flex-wrap gap-1">
        {tags.filter(t => selectedTags.includes(t.id)).map(tag => (
          <span
            key={tag.id}
            className="px-2 py-0.5 rounded-full text-xs text-white"
            style={{ backgroundColor: tag.color }}
          >
            {tag.name}
          </span>
        ))}
      </div>
    );
  }

  return (
    <div className="space-y-3">
      <div className="flex items-center justify-between">
        <label className="text-sm text-[#a0a0a0]">Tags</label>
        <button
          onClick={() => setShowAdd(!showAdd)}
          className="text-xs text-[#a78bfa] hover:text-[#c4b5fd] transition-colors"
        >
          + Add Tag
        </button>
      </div>

      {/* Add new tag */}
      {showAdd && (
        <div className="flex gap-2">
          <input
            type="text"
            value={newTagName}
            onChange={(e) => setNewTagName(e.target.value)}
            onKeyDown={(e) => e.key === "Enter" && handleAddTag()}
            placeholder="Tag name..."
            className="flex-1 px-3 py-1.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white text-sm focus:border-[#a78bfa]"
            autoFocus
          />
          <button
            onClick={handleAddTag}
            className="px-3 py-1.5 rounded-lg bg-[#a78bfa] text-white text-sm hover:bg-[#9575f0]"
          >
            Add
          </button>
        </div>
      )}

      {/* Tag list */}
      <div className="flex flex-wrap gap-2">
        {tags.map(tag => (
          <button
            key={tag.id}
            onClick={() => toggleTag(tag.id)}
            className={`px-3 py-1.5 rounded-full text-sm transition-all ${
              selectedTags.includes(tag.id)
                ? "text-white shadow-lg"
                : "text-white/70 opacity-50 hover:opacity-100"
            }`}
            style={{ 
              backgroundColor: selectedTags.includes(tag.id) ? tag.color : `${tag.color}40`,
              boxShadow: selectedTags.includes(tag.id) ? `0 4px 12px ${tag.color}40` : "none"
            }}
          >
            {tag.name}
          </button>
        ))}
        {tags.length === 0 && !showAdd && (
          <span className="text-sm text-[#666680]">No tags yet. Create one to organize documents.</span>
        )}
      </div>
    </div>
  );
}

// Tag Manager Modal
interface TagManagerProps {
  isOpen: boolean;
  onClose: () => void;
}

export function TagManager({ isOpen, onClose }: TagManagerProps) {
  const { tags, addTag, deleteTag, updateTagColor } = useDocumentTags();
  const [newTagName, setNewTagName] = useState("");

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={onClose}>
      <div 
        className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-md w-full border border-[#2a2a3a] shadow-2xl"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üè∑Ô∏è Manage Tags</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        <div className="p-4 space-y-4">
          {/* Add new tag */}
          <div className="flex gap-2">
            <input
              type="text"
              value={newTagName}
              onChange={(e) => setNewTagName(e.target.value)}
              onKeyDown={(e) => {
                if (e.key === "Enter" && newTagName.trim()) {
                  addTag(newTagName.trim());
                  setNewTagName("");
                }
              }}
              placeholder="New tag name..."
              className="flex-1 px-3 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white focus:border-[#a78bfa]"
            />
            <button
              onClick={() => {
                if (newTagName.trim()) {
                  addTag(newTagName.trim());
                  setNewTagName("");
                }
              }}
              className="px-4 py-2 rounded-lg bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white"
            >
              Add
            </button>
          </div>

          {/* Tag list */}
          <div className="space-y-2 max-h-60 overflow-auto">
            {tags.map(tag => (
              <div key={tag.id} className="flex items-center justify-between p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div className="flex items-center gap-3">
                  <input
                    type="color"
                    value={tag.color}
                    onChange={(e) => updateTagColor(tag.id, e.target.value)}
                    className="w-6 h-6 rounded cursor-pointer"
                  />
                  <span className="text-white">{tag.name}</span>
                </div>
                <button
                  onClick={() => deleteTag(tag.id)}
                  className="text-[#f87171] hover:text-[#fca5a5] transition-colors"
                >
                  Delete
                </button>
              </div>
            ))}
            {tags.length === 0 && (
              <p className="text-center text-[#666680] py-4">No tags created yet</p>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/DragDropUpload.tsx">
"use client";

import { useState, useCallback, useRef } from "react";

interface DragDropUploadProps {
  onFileDrop: (file: File) => void;
  acceptedTypes?: string[];
  children: React.ReactNode;
  className?: string;
}

export default function DragDropUpload({ 
  onFileDrop, 
  acceptedTypes = [".pdf", ".docx", ".doc"], 
  children, 
  className = "" 
}: DragDropUploadProps) {
  const [isDragging, setIsDragging] = useState(false);
  const dragCounter = useRef(0);

  const handleDrag = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
  }, []);

  const handleDragIn = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    dragCounter.current++;
    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {
      setIsDragging(true);
    }
  }, []);

  const handleDragOut = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    dragCounter.current--;
    if (dragCounter.current === 0) {
      setIsDragging(false);
    }
  }, []);

  const handleDrop = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);
    dragCounter.current = 0;

    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
      const file = e.dataTransfer.files[0];
      const fileName = file.name.toLowerCase();
      const isAccepted = acceptedTypes.some(type => fileName.endsWith(type.toLowerCase()));
      
      if (isAccepted) {
        onFileDrop(file);
      }
      e.dataTransfer.clearData();
    }
  }, [onFileDrop, acceptedTypes]);

  return (
    <div
      onDragEnter={handleDragIn}
      onDragLeave={handleDragOut}
      onDragOver={handleDrag}
      onDrop={handleDrop}
      className={`relative ${className}`}
    >
      {children}
      
      {/* Drag overlay */}
      {isDragging && (
        <div className="absolute inset-0 bg-[#a78bfa]/20 border-2 border-dashed border-[#a78bfa] rounded-xl flex items-center justify-center z-50 backdrop-blur-sm">
          <div className="text-center">
            <div className="text-4xl mb-2">üìÅ</div>
            <p className="text-white font-medium">Drop file here</p>
            <p className="text-sm text-[#a0a0a0]">{acceptedTypes.join(", ")}</p>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/EmailDocument.tsx">
"use client";

import { useState } from "react";
import {
  X,
  Mail,
  Send,
  Paperclip,
  User,
  FileText,
  Check,
  Loader2,
  AlertCircle,
} from "lucide-react";
import { toast } from "react-hot-toast";

interface EmailDocumentProps {
  isOpen: boolean;
  onClose: () => void;
  documentType: string;
  bodyText: string;
  recipientName?: string;
  onGeneratePDF: () => Promise<Blob>;
}

export default function EmailDocument({
  isOpen,
  onClose,
  documentType,
  bodyText,
  recipientName,
  onGeneratePDF,
}: EmailDocumentProps) {
  const [to, setTo] = useState("");
  const [cc, setCc] = useState("");
  const [subject, setSubject] = useState(`Document: ${documentType}`);
  const [message, setMessage] = useState(
    `Hi${recipientName ? ` ${recipientName}` : ""},\n\nPlease find the attached document.\n\nBest regards`
  );
  const [attachPDF, setAttachPDF] = useState(true);
  const [isSending, setIsSending] = useState(false);
  const [showCc, setShowCc] = useState(false);

  const validateEmail = (email: string) => {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  };

  const handleSend = async () => {
    // Validate
    if (!to.trim()) {
      toast.error("Please enter a recipient email");
      return;
    }

    const emails = to.split(",").map((e) => e.trim());
    const invalidEmails = emails.filter((e) => !validateEmail(e));
    if (invalidEmails.length > 0) {
      toast.error(`Invalid email: ${invalidEmails[0]}`);
      return;
    }

    setIsSending(true);

    try {
      // Generate PDF if attaching
      let pdfBlob: Blob | null = null;
      if (attachPDF) {
        pdfBlob = await onGeneratePDF();
      }

      // In a real app, this would send via an API
      // For demo, we'll use mailto with the message
      // (PDF attachment requires server-side implementation)

      if (pdfBlob && typeof window !== "undefined") {
        // Create download link for PDF
        const url = URL.createObjectURL(pdfBlob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `${documentType.replace(/\s+/g, "-")}.pdf`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      // Open email client
      const mailtoUrl = `mailto:${to}${cc ? `?cc=${cc}` : ""}${cc ? "&" : "?"}subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(message + "\n\n[PDF document downloaded separately]")}`;
      window.open(mailtoUrl);

      toast.success("Email client opened! PDF downloaded for attachment.");
      onClose();
    } catch (error) {
      console.error("Error sending:", error);
      toast.error("Failed to prepare email");
    } finally {
      setIsSending(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="w-full max-w-lg bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center">
                <Mail className="w-5 h-5 text-blue-500" />
              </div>
              <div>
                <h2 className="text-lg font-semibold">Email Document</h2>
                <p className="text-sm text-[--text-muted]">Send via email client</p>
              </div>
            </div>
            <button
              onClick={onClose}
              className="p-2 rounded-xl hover:bg-[--bg-elevated] text-[--text-muted] hover:text-[--text-primary] transition-colors"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>

        {/* Form */}
        <div className="p-6 space-y-4">
          {/* To */}
          <div>
            <label className="block text-sm font-medium text-[--text-secondary] mb-2">
              To *
            </label>
            <div className="relative">
              <User className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[--text-muted]" />
              <input
                type="email"
                value={to}
                onChange={(e) => setTo(e.target.value)}
                placeholder="recipient@email.com"
                className="w-full pl-10 pr-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary]"
              />
            </div>
            <p className="text-xs text-[--text-muted] mt-1">
              Separate multiple emails with commas
            </p>
          </div>

          {/* CC Toggle */}
          {!showCc ? (
            <button
              onClick={() => setShowCc(true)}
              className="text-sm text-[--color-primary] hover:underline"
            >
              + Add CC
            </button>
          ) : (
            <div>
              <label className="block text-sm font-medium text-[--text-secondary] mb-2">
                CC
              </label>
              <input
                type="email"
                value={cc}
                onChange={(e) => setCc(e.target.value)}
                placeholder="cc@email.com"
                className="w-full px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary]"
              />
            </div>
          )}

          {/* Subject */}
          <div>
            <label className="block text-sm font-medium text-[--text-secondary] mb-2">
              Subject
            </label>
            <input
              type="text"
              value={subject}
              onChange={(e) => setSubject(e.target.value)}
              className="w-full px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary]"
            />
          </div>

          {/* Message */}
          <div>
            <label className="block text-sm font-medium text-[--text-secondary] mb-2">
              Message
            </label>
            <textarea
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              rows={4}
              className="w-full px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary] resize-none"
            />
          </div>

          {/* Attach PDF */}
          <div className="flex items-center justify-between p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
            <div className="flex items-center gap-3">
              <Paperclip className="w-5 h-5 text-[--text-muted]" />
              <div>
                <span className="font-medium">Attach PDF</span>
                <p className="text-xs text-[--text-muted]">
                  Download PDF to attach manually
                </p>
              </div>
            </div>
            <button
              onClick={() => setAttachPDF(!attachPDF)}
              className={`w-12 h-6 rounded-full transition-colors relative ${
                attachPDF ? "bg-[--color-primary]" : "bg-[--bg-overlay]"
              }`}
            >
              <span
                className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                  attachPDF ? "left-7" : "left-1"
                }`}
              />
            </button>
          </div>

          {/* Document Preview */}
          <div className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
            <div className="flex items-center gap-2 mb-2">
              <FileText className="w-4 h-4 text-[--color-primary]" />
              <span className="text-sm font-medium">{documentType}</span>
            </div>
            <p className="text-xs text-[--text-muted] line-clamp-2">
              {bodyText.slice(0, 150)}...
            </p>
          </div>

          {/* Info */}
          <div className="flex items-start gap-2 text-xs text-[--text-muted] p-3 rounded-lg bg-blue-500/5 border border-blue-500/20">
            <AlertCircle className="w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5" />
            <span>
              This will open your default email client. The PDF will be downloaded
              separately for you to attach.
            </span>
          </div>
        </div>

        {/* Footer */}
        <div className="p-6 border-t border-[--border-default] flex gap-3">
          <button
            onClick={onClose}
            className="flex-1 px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:bg-[--bg-overlay] transition-colors font-medium"
          >
            Cancel
          </button>
          <button
            onClick={handleSend}
            disabled={isSending || !to.trim()}
            className="flex-1 px-4 py-3 rounded-xl bg-blue-500 text-white hover:bg-blue-600 transition-all font-semibold disabled:opacity-50 flex items-center justify-center gap-2"
          >
            {isSending ? (
              <>
                <Loader2 className="w-5 h-5 animate-spin" />
                Preparing...
              </>
            ) : (
              <>
                <Send className="w-5 h-5" />
                Send Email
              </>
            )}
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/EmptyState.tsx">
"use client";

import { ReactNode } from "react";
import { FileText, Star, History, Search, FolderOpen, Inbox } from "lucide-react";

interface EmptyStateProps {
  icon?: ReactNode;
  title: string;
  description?: string;
  action?: {
    label: string;
    onClick: () => void;
  };
  variant?: "default" | "compact";
}

export default function EmptyState({
  icon,
  title,
  description,
  action,
  variant = "default",
}: EmptyStateProps) {
  const isCompact = variant === "compact";

  return (
    <div
      className={`flex flex-col items-center justify-center text-center ${
        isCompact ? "py-8 px-4" : "py-16 px-6"
      }`}
    >
      {icon && (
        <div
          className={`mb-4 text-[--text-muted] opacity-30 ${
            isCompact ? "w-10 h-10" : "w-16 h-16"
          }`}
        >
          {icon}
        </div>
      )}
      <h3
        className={`font-semibold text-[--text-primary] mb-2 ${
          isCompact ? "text-base" : "text-lg"
        }`}
      >
        {title}
      </h3>
      {description && (
        <p
          className={`text-[--text-muted] max-w-xs ${
            isCompact ? "text-xs" : "text-sm"
          }`}
        >
          {description}
        </p>
      )}
      {action && (
        <button
          onClick={action.onClick}
          className="mt-4 px-4 py-2 text-sm font-medium text-white bg-[--color-primary] rounded-lg hover:bg-[--color-primary-hover] transition-colors"
        >
          {action.label}
        </button>
      )}
    </div>
  );
}

// Preset empty states
export function NoDocumentsEmpty({ onAction }: { onAction?: () => void }) {
  return (
    <EmptyState
      icon={<FileText className="w-full h-full" />}
      title="No documents yet"
      description="Create your first document to get started"
      action={onAction ? { label: "Create Document", onClick: onAction } : undefined}
    />
  );
}

export function NoFavoritesEmpty({ onAction }: { onAction?: () => void }) {
  return (
    <EmptyState
      icon={<Star className="w-full h-full" />}
      title="No favorites saved"
      description="Save your frequently used settings as favorites for quick access"
      action={onAction ? { label: "Save Current as Favorite", onClick: onAction } : undefined}
    />
  );
}

export function NoHistoryEmpty() {
  return (
    <EmptyState
      icon={<History className="w-full h-full" />}
      title="No history yet"
      description="Your generated documents will appear here"
    />
  );
}

export function NoSearchResultsEmpty({ query }: { query: string }) {
  return (
    <EmptyState
      icon={<Search className="w-full h-full" />}
      title="No results found"
      description={`No matches for "${query}". Try a different search term.`}
    />
  );
}

export function NoTemplatesEmpty({ onAction }: { onAction?: () => void }) {
  return (
    <EmptyState
      icon={<FolderOpen className="w-full h-full" />}
      title="No templates available"
      description="Browse the template gallery to find templates"
      action={onAction ? { label: "Browse Templates", onClick: onAction } : undefined}
    />
  );
}

export function EmptyInboxState() {
  return (
    <EmptyState
      icon={<Inbox className="w-full h-full" />}
      title="All caught up!"
      description="No pending items to review"
      variant="compact"
    />
  );
}
</file>

<file path="src/components/ExportHistory.tsx">
"use client";

import { useState, useEffect } from "react";

export interface ExportRecord {
  id: string;
  timestamp: string;
  documentType: string;
  fileName: string;
  recipientName?: string;
  signatoryName: string;
  wordCount: number;
  format: "pdf" | "docx";
}

const STORAGE_KEY = "exportHistory";
const MAX_RECORDS = 100;

export function useExportHistory() {
  const [records, setRecords] = useState<ExportRecord[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      try {
        setRecords(JSON.parse(saved));
      } catch (e) {
        console.error("Error loading export history:", e);
      }
    }
  }, []);

  const addRecord = (record: Omit<ExportRecord, "id" | "timestamp">) => {
    const newRecord: ExportRecord = {
      ...record,
      id: `export-${Date.now()}`,
      timestamp: new Date().toISOString(),
    };
    const updated = [newRecord, ...records].slice(0, MAX_RECORDS);
    setRecords(updated);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));
  };

  const clearHistory = () => {
    setRecords([]);
    localStorage.removeItem(STORAGE_KEY);
  };

  const exportToCSV = () => {
    const csv = [
      "Date,Document Type,File Name,Recipient,Signatory,Words,Format",
      ...records.map(r => 
        `"${new Date(r.timestamp).toLocaleString()}","${r.documentType}","${r.fileName}","${r.recipientName || ""}","${r.signatoryName}","${r.wordCount}","${r.format}"`
      )
    ].join("\n");

    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = `export-history-${new Date().toISOString().split("T")[0]}.csv`;
    link.click();
    URL.revokeObjectURL(url);
  };

  return { records, addRecord, clearHistory, exportToCSV, mounted };
}

interface ExportHistoryProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function ExportHistory({ isOpen, onClose }: ExportHistoryProps) {
  const { records, clearHistory, exportToCSV } = useExportHistory();
  const [filter, setFilter] = useState<string>("all");
  const [sortBy, setSortBy] = useState<"date" | "type" | "words">("date");

  if (!isOpen) return null;

  const documentTypes = Array.from(new Set(records.map(r => r.documentType)));

  const filteredRecords = records.filter(r => 
    filter === "all" || r.documentType === filter
  );

  const sortedRecords = [...filteredRecords].sort((a, b) => {
    switch (sortBy) {
      case "date":
        return new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime();
      case "type":
        return a.documentType.localeCompare(b.documentType);
      case "words":
        return b.wordCount - a.wordCount;
      default:
        return 0;
    }
  });

  const totalExports = records.length;
  const totalWords = records.reduce((sum, r) => sum + r.wordCount, 0);
  const avgWords = totalExports > 0 ? Math.round(totalWords / totalExports) : 0;

  const formatDate = (timestamp: string) => {
    const date = new Date(timestamp);
    return date.toLocaleDateString() + " " + date.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  };

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-4xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üìã Export History</h2>
          <div className="flex items-center gap-2">
            <button
              onClick={exportToCSV}
              className="px-3 py-1.5 rounded-lg text-sm text-[#4ecdc4] hover:bg-[#4ecdc4]/10 transition-colors"
            >
              Download CSV
            </button>
            <button
              onClick={clearHistory}
              className="px-3 py-1.5 rounded-lg text-sm text-[#f87171] hover:bg-[#f87171]/10 transition-colors"
            >
              Clear
            </button>
            <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
          </div>
        </div>

        {/* Stats */}
        <div className="grid grid-cols-3 gap-4 p-4 border-b border-[#2a2a3a]">
          <div className="text-center p-3 rounded-lg bg-[#1a1a24]">
            <div className="text-2xl font-bold text-[#a78bfa]">{totalExports}</div>
            <div className="text-xs text-[#666680]">Total Exports</div>
          </div>
          <div className="text-center p-3 rounded-lg bg-[#1a1a24]">
            <div className="text-2xl font-bold text-[#4ecdc4]">{totalWords.toLocaleString()}</div>
            <div className="text-xs text-[#666680]">Total Words</div>
          </div>
          <div className="text-center p-3 rounded-lg bg-[#1a1a24]">
            <div className="text-2xl font-bold text-[#f472b6]">{avgWords}</div>
            <div className="text-xs text-[#666680]">Avg Words/Doc</div>
          </div>
        </div>

        {/* Filters */}
        <div className="flex items-center gap-4 p-4 border-b border-[#2a2a3a]">
          <select
            value={filter}
            onChange={(e) => setFilter(e.target.value)}
            className="px-3 py-1.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white text-sm"
          >
            <option value="all">All Types</option>
            {documentTypes.map(type => (
              <option key={type} value={type}>{type}</option>
            ))}
          </select>

          <select
            value={sortBy}
            onChange={(e) => setSortBy(e.target.value as typeof sortBy)}
            className="px-3 py-1.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white text-sm"
          >
            <option value="date">Sort by Date</option>
            <option value="type">Sort by Type</option>
            <option value="words">Sort by Words</option>
          </select>

          <span className="text-sm text-[#666680] ml-auto">
            {sortedRecords.length} records
          </span>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-4">
          {sortedRecords.length === 0 ? (
            <div className="text-center py-12 text-[#666680]">
              <p>No export history yet.</p>
              <p className="text-sm mt-2">Generated documents will appear here.</p>
            </div>
          ) : (
            <div className="space-y-2">
              {sortedRecords.map(record => (
                <div key={record.id} className="flex items-center gap-4 p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                  <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${
                    record.format === "pdf" ? "bg-[#f87171]/20 text-[#f87171]" : "bg-[#60a5fa]/20 text-[#60a5fa]"
                  }`}>
                    {record.format === "pdf" ? "PDF" : "DOC"}
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="text-white font-medium truncate">{record.fileName}</div>
                    <div className="text-sm text-[#666680]">
                      {record.documentType} ‚Ä¢ {record.wordCount} words
                      {record.recipientName && ` ‚Ä¢ To: ${record.recipientName}`}
                    </div>
                  </div>
                  <div className="text-right">
                    <div className="text-sm text-[#a0a0a0]">{record.signatoryName}</div>
                    <div className="text-xs text-[#666680]">{formatDate(record.timestamp)}</div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/FavoritesPanel.tsx">
"use client";

import { useState, useEffect } from "react";
import { FavoriteSettings, getFavorites, deleteFavorite } from "@/utils/favorites";

interface FavoritesPanelProps {
  isOpen: boolean;
  onClose: () => void;
  onLoad: (favorite: FavoriteSettings) => void;
}

export default function FavoritesPanel({ isOpen, onClose, onLoad }: FavoritesPanelProps) {
  const [favorites, setFavorites] = useState<FavoriteSettings[]>([]);

  useEffect(() => {
    if (isOpen) {
      setFavorites(getFavorites());
    }
  }, [isOpen]);

  const handleDelete = (id: string) => {
    deleteFavorite(id);
    setFavorites(getFavorites());
  };

  const handleLoad = (favorite: FavoriteSettings) => {
    onLoad(favorite);
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div className="bg-white dark:bg-gray-800 rounded-2xl max-w-4xl w-full max-h-[80vh] flex flex-col shadow-2xl">
        <div className="flex items-center justify-between p-6 border-b dark:border-gray-700">
          <div>
            <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
              ‚≠ê Favorite Settings
            </h2>
            <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
              Load your saved configurations
            </p>
          </div>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700"
          >
            ‚úï
          </button>
        </div>
        
        <div className="flex-1 overflow-auto p-6">
          {favorites.length === 0 ? (
            <div className="text-center py-12">
              <div className="text-6xl mb-4">‚≠ê</div>
              <h3 className="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">
                No favorites yet
              </h3>
              <p className="text-gray-600 dark:text-gray-400">
                Save your commonly used settings as favorites for quick access!
              </p>
            </div>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {favorites.map((favorite) => (
                <div
                  key={favorite.id}
                  className="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-600 p-4 rounded-xl border-2 border-purple-200 dark:border-purple-500 hover:shadow-lg transition-all"
                >
                  <div className="flex items-start justify-between mb-3">
                    <div className="flex-1">
                      <h3 className="font-bold text-gray-900 dark:text-white text-lg">
                        {favorite.name}
                      </h3>
                      <p className="text-sm text-gray-600 dark:text-gray-300 mt-1">
                        {favorite.documentType}
                      </p>
                    </div>
                    <button
                      onClick={() => handleDelete(favorite.id)}
                      className="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-xl"
                      title="Delete favorite"
                    >
                      üóëÔ∏è
                    </button>
                  </div>
                  
                  <div className="space-y-2 text-sm text-gray-700 dark:text-gray-300 mb-4">
                    <div>
                      <span className="font-semibold">Signatory:</span>{" "}
                      {favorite.useCustomSignatory
                        ? favorite.customSignatoryName
                        : favorite.selectedSignatory}
                    </div>
                    {favorite.recipientName && (
                      <div>
                        <span className="font-semibold">Recipient:</span> {favorite.recipientName}
                      </div>
                    )}
                    <div className="text-xs text-gray-500 dark:text-gray-400">
                      Saved: {new Date(favorite.createdAt).toLocaleDateString()}
                    </div>
                  </div>
                  
                  <button
                    onClick={() => handleLoad(favorite)}
                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-2 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all shadow-md hover:shadow-lg"
                  >
                    Load Settings
                  </button>
                </div>
              ))}
            </div>
          )}
        </div>
        
        <div className="p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900 rounded-b-2xl">
          <button
            onClick={onClose}
            className="w-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/features/index.ts">
// Feature components barrel export
export { default as WelcomeModal, useIsNewUser } from "../WelcomeModal";
export { default as TemplateCategories } from "../TemplateCategories";
export { default as SaveAsTemplate, useUserTemplates } from "../SaveAsTemplate";
export { default as Dashboard } from "../Dashboard";
export { default as ShareDraft } from "../ShareDraft";
export { default as EmailDocument } from "../EmailDocument";
export { default as AccessibilitySettings } from "../AccessibilitySettings";
</file>

<file path="src/components/FindReplace.tsx">
"use client";

import { useState, useEffect, useCallback } from "react";

interface FindReplaceProps {
  isOpen: boolean;
  onClose: () => void;
  text: string;
  onTextChange: (newText: string) => void;
}

export default function FindReplace({ isOpen, onClose, text, onTextChange }: FindReplaceProps) {
  const [findText, setFindText] = useState("");
  const [replaceText, setReplaceText] = useState("");
  const [matchCase, setMatchCase] = useState(false);
  const [matchCount, setMatchCount] = useState(0);
  const [currentMatch, setCurrentMatch] = useState(0);

  // Count matches
  useEffect(() => {
    if (!findText) {
      setMatchCount(0);
      setCurrentMatch(0);
      return;
    }

    const flags = matchCase ? "g" : "gi";
    const regex = new RegExp(escapeRegex(findText), flags);
    const matches = text.match(regex);
    setMatchCount(matches ? matches.length : 0);
    setCurrentMatch(matches ? 1 : 0);
  }, [findText, text, matchCase]);

  const escapeRegex = (str: string) => {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  };

  const handleReplaceOne = () => {
    if (!findText || matchCount === 0) return;

    const flags = matchCase ? "" : "i";
    const regex = new RegExp(escapeRegex(findText), flags);
    const newText = text.replace(regex, replaceText);
    onTextChange(newText);
  };

  const handleReplaceAll = () => {
    if (!findText || matchCount === 0) return;

    const flags = matchCase ? "g" : "gi";
    const regex = new RegExp(escapeRegex(findText), flags);
    const newText = text.replace(regex, replaceText);
    onTextChange(newText);
  };

  // Keyboard shortcut to close
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape") onClose();
    };
    if (isOpen) {
      window.addEventListener("keydown", handleKeyDown);
      return () => window.removeEventListener("keydown", handleKeyDown);
    }
  }, [isOpen, onClose]);

  if (!isOpen) return null;

  return (
    <div className="fixed top-20 right-4 z-50 w-80 bg-[#12121a]/95 backdrop-blur-md rounded-xl border border-[#2a2a3a] shadow-2xl shadow-[#a78bfa]/10 p-4">
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-white font-medium">Find & Replace</h3>
        <button onClick={onClose} className="text-[#666680] hover:text-white">√ó</button>
      </div>

      <div className="space-y-3">
        {/* Find */}
        <div>
          <label className="text-xs text-[#666680] block mb-1">Find</label>
          <input
            type="text"
            value={findText}
            onChange={(e) => setFindText(e.target.value)}
            placeholder="Search text..."
            className="w-full px-3 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white text-sm focus:border-[#a78bfa]"
            autoFocus
          />
        </div>

        {/* Replace */}
        <div>
          <label className="text-xs text-[#666680] block mb-1">Replace with</label>
          <input
            type="text"
            value={replaceText}
            onChange={(e) => setReplaceText(e.target.value)}
            placeholder="Replacement text..."
            className="w-full px-3 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white text-sm focus:border-[#4ecdc4]"
          />
        </div>

        {/* Options */}
        <label className="flex items-center gap-2 text-sm text-[#a0a0a0]">
          <input
            type="checkbox"
            checked={matchCase}
            onChange={(e) => setMatchCase(e.target.checked)}
            className="rounded"
          />
          Match case
        </label>

        {/* Match count */}
        <div className="text-sm text-[#666680]">
          {findText ? (
            matchCount > 0 ? (
              <span className="text-[#4ade80]">{matchCount} match{matchCount !== 1 ? "es" : ""} found</span>
            ) : (
              <span className="text-[#f87171]">No matches found</span>
            )
          ) : (
            "Enter text to search"
          )}
        </div>

        {/* Actions */}
        <div className="flex gap-2 pt-2">
          <button
            onClick={handleReplaceOne}
            disabled={matchCount === 0}
            className="flex-1 px-3 py-2 rounded-lg text-sm bg-[#4ecdc4] text-[#0a0a12] hover:bg-[#3dbdb5] disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            Replace
          </button>
          <button
            onClick={handleReplaceAll}
            disabled={matchCount === 0}
            className="flex-1 px-3 py-2 rounded-lg text-sm bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            Replace All
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/forms/DocumentBodyEditor.tsx">
"use client";

import { useRef, useState, useCallback } from "react";
import { useDocumentStore } from "@/store/documentStore";
import { toast } from "react-hot-toast";
import {
  FileText,
  Calendar,
  Minus,
  SeparatorHorizontal,
  PenLine,
  Search,
  Copy,
  Undo2,
  Type,
  Target,
  Sparkles,
} from "lucide-react";

interface DocumentBodyEditorProps {
  theme?: "dark" | "light";
  spellCheckEnabled?: boolean;
  onOpenAI?: () => void;
  onOpenFindReplace?: () => void;
}

export default function DocumentBodyEditor({
  theme = "dark",
  spellCheckEnabled = true,
  onOpenAI,
  onOpenFindReplace,
}: DocumentBodyEditorProps) {
  const textareaRef = useRef<HTMLTextAreaElement>(null);
  const [wordCountGoal, setWordCountGoal] = useState(0);
  const [autoCapitalize, setAutoCapitalize] = useState(false);

  const { bodyText, setBodyText, undo } = useDocumentStore();

  const bgElevated = theme === "light" ? "bg-[#f5f2ed]" : "bg-[--bg-elevated]";
  const borderColor = theme === "light" ? "border-[#e5e0d8]" : "border-[--border-default]";
  const textMuted = theme === "light" ? "text-[#8f897f]" : "text-[--text-muted]";

  const wordCount = bodyText.trim() ? bodyText.trim().split(/\s+/).length : 0;
  const characterCount = bodyText.length;

  // Insert text at cursor position
  const insertAtCursor = useCallback(
    (text: string) => {
      const textarea = textareaRef.current;
      if (!textarea) {
        setBodyText(bodyText + text);
        return;
      }
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const newText = bodyText.substring(0, start) + text + bodyText.substring(end);
      setBodyText(newText);
      setTimeout(() => {
        textarea.selectionStart = textarea.selectionEnd = start + text.length;
        textarea.focus();
      }, 0);
    },
    [bodyText, setBodyText]
  );

  const insertDate = () =>
    insertAtCursor(
      new Date().toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
      })
    );

  const insertHorizontalLine = () =>
    insertAtCursor("\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n");

  const insertPageBreak = () => insertAtCursor("\n\n--- PAGE BREAK ---\n\n");

  const insertSignatureBlock = () => {
    const block = `\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nSIGNATURE\n\nSign: ___________________________\n\nPrint Name: _____________________\n\nTitle: __________________________\n\nDate: ___________________________\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ`;
    insertAtCursor(block);
  };

  const findNextPlaceholder = () => {
    const textarea = textareaRef.current;
    if (!textarea) return;
    const regex = /\[[^\]]+\]/g;
    const matches: { index: number; text: string }[] = [];
    let match;
    while ((match = regex.exec(bodyText)) !== null) {
      matches.push({ index: match.index, text: match[0] });
    }
    if (matches.length === 0) {
      toast("No placeholders found", { icon: "‚ÑπÔ∏è" });
      return;
    }
    const currentPos = textarea.selectionEnd;
    const nextMatch = matches.find((m) => m.index >= currentPos) || matches[0];
    if (nextMatch) {
      textarea.focus();
      textarea.setSelectionRange(nextMatch.index, nextMatch.index + nextMatch.text.length);
    }
  };

  const handleCopyText = () => {
    if (bodyText.trim()) {
      navigator.clipboard.writeText(bodyText);
      toast.success("Copied to clipboard");
    }
  };

  const handleUndo = () => {
    const result = undo();
    if (result !== null) {
      toast.success("Undone");
    } else {
      toast("Nothing to undo", { icon: "‚ÑπÔ∏è" });
    }
  };

  const handleBodyTextChange = (value: string) => {
    if (autoCapitalize && value.length > bodyText.length) {
      const diff = value.substring(bodyText.length);
      if (diff === " " || diff === "\n") {
        const sentences = value.split(/([.!?]\s+)/);
        const capitalized = sentences
          .map((s, i) => {
            if (i % 2 === 0 && s.length > 0) {
              return s.charAt(0).toUpperCase() + s.slice(1);
            }
            return s;
          })
          .join("");
        setBodyText(capitalized);
        return;
      }
    }
    setBodyText(value);
  };

  const setGoal = (goal: number) => {
    setWordCountGoal(goal);
    if (goal > 0) {
      toast.success(`Word goal set to ${goal}`);
    }
  };

  const goalProgress = wordCountGoal > 0 ? Math.min(100, (wordCount / wordCountGoal) * 100) : 0;

  return (
    <section className="form-section card p-5 rounded-xl">
      <div className="flex items-center justify-between mb-3">
        <label htmlFor="bodyText" className="section-label flex items-center gap-2">
          <FileText className="w-4 h-4 text-[--color-primary]" />
          Document Body
        </label>
        <div className="flex items-center gap-4">
          {wordCountGoal > 0 && (
            <div className="flex items-center gap-2">
              <div className={`w-20 h-1.5 rounded-full ${bgElevated} overflow-hidden`}>
                <div
                  className="h-full bg-gradient-to-r from-[--color-primary] to-[--color-accent] transition-all duration-300"
                  style={{ width: `${goalProgress}%` }}
                />
              </div>
              <span className={`text-xs font-mono ${textMuted}`}>
                {wordCount}/{wordCountGoal}
              </span>
            </div>
          )}
          <span className={`text-xs font-mono ${textMuted}`}>
            {wordCount} words ¬∑ {characterCount} chars
          </span>
        </div>
      </div>

      {/* Quick Insert Toolbar */}
      <div
        className={`flex flex-wrap gap-1 mb-3 p-2 rounded-xl ${bgElevated} border ${borderColor}`}
      >
        <ToolbarButton
          icon={<Calendar className="w-3.5 h-3.5" />}
          label="Date"
          onClick={insertDate}
          color="text-blue-400"
        />
        <ToolbarButton
          icon={<Minus className="w-3.5 h-3.5" />}
          label="Line"
          onClick={insertHorizontalLine}
          color="text-teal-400"
        />
        <ToolbarButton
          icon={<SeparatorHorizontal className="w-3.5 h-3.5" />}
          label="Page Break"
          onClick={insertPageBreak}
          color="text-violet-400"
        />
        <ToolbarButton
          icon={<PenLine className="w-3.5 h-3.5" />}
          label="Signature"
          onClick={insertSignatureBlock}
          color="text-pink-400"
        />

        <div className={`w-px h-5 ${borderColor} mx-1 self-center`} />

        <ToolbarButton
          icon={<Search className="w-3.5 h-3.5" />}
          label="Find [...]"
          onClick={findNextPlaceholder}
          color="text-amber-400"
        />
        <ToolbarButton
          icon={<Copy className="w-3.5 h-3.5" />}
          label="Copy"
          onClick={handleCopyText}
          color="text-emerald-400"
        />
        <ToolbarButton
          icon={<Undo2 className="w-3.5 h-3.5" />}
          label="Undo"
          onClick={handleUndo}
          color="text-red-400"
        />

        <div className="flex-1" />

        {onOpenFindReplace && (
          <ToolbarButton
            icon={<Search className="w-3.5 h-3.5" />}
            label="Find"
            onClick={onOpenFindReplace}
            color="text-blue-400"
            tooltip="Ctrl+F"
          />
        )}

        {onOpenAI && (
          <ToolbarButton
            icon={<Sparkles className="w-3.5 h-3.5" />}
            label="AI"
            onClick={onOpenAI}
            color="text-violet-400"
            tooltip="AI Writing Assistant"
          />
        )}

        <ToolbarButton
          icon={<Type className="w-3.5 h-3.5" />}
          label="Aa"
          onClick={() => setAutoCapitalize(!autoCapitalize)}
          active={autoCapitalize}
          tooltip="Auto-capitalize sentences"
        />
        <ToolbarButton
          icon={<Target className="w-3.5 h-3.5" />}
          label="Goal"
          onClick={() => {
            const goal = prompt("Word count goal (0 to disable):", wordCountGoal.toString());
            if (goal !== null) setGoal(parseInt(goal) || 0);
          }}
          color="text-teal-400"
          tooltip="Set word count goal"
        />
      </div>

      {/* Text Area */}
      <div className="relative">
        <textarea
          ref={textareaRef}
          id="bodyText"
          value={bodyText}
          onChange={(e) => handleBodyTextChange(e.target.value)}
          rows={14}
          className={`w-full px-4 py-3 rounded-xl resize-y ${
            bodyText.trim() && wordCount < 20 ? "border-red-400/50 focus:border-red-400" : ""
          }`}
          placeholder="Start writing your document...&#10;&#10;Use [brackets] for placeholders that can be easily found and replaced."
          spellCheck={spellCheckEnabled}
        />

        {/* Empty state overlay */}
        {!bodyText && (
          <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
            <FileText className={`w-16 h-16 mb-4 ${textMuted} opacity-20`} />
            <p className={`${textMuted} opacity-50 text-center`}>
              Start typing or select a template from the sidebar
            </p>
          </div>
        )}
      </div>

      {/* Warning for short content */}
      {bodyText.trim() && wordCount < 20 && (
        <p className="mt-2 text-sm text-red-400 flex items-center gap-2">
          <span className="w-1.5 h-1.5 rounded-full bg-red-400" />
          Consider adding more content for a professional document.
        </p>
      )}
    </section>
  );
}

// Toolbar button component
interface ToolbarButtonProps {
  icon: React.ReactNode;
  label: string;
  onClick: () => void;
  color?: string;
  active?: boolean;
  tooltip?: string;
}

function ToolbarButton({
  icon,
  label,
  onClick,
  color = "text-[--text-muted]",
  active = false,
  tooltip,
}: ToolbarButtonProps) {
  return (
    <button
      onClick={onClick}
      className={`px-2.5 py-1.5 text-xs rounded-lg transition-all flex items-center gap-1.5 ${
        active
          ? "bg-gradient-to-r from-[--color-primary] to-[--color-accent] text-white"
          : `${color} hover:bg-white/10`
      }`}
      title={tooltip || label}
    >
      {icon}
      <span className="hidden sm:inline">{label}</span>
    </button>
  );
}
</file>

<file path="src/components/forms/DocumentTypeSelector.tsx">
"use client";

import { useState, useEffect } from "react";
import { useDocumentStore } from "@/store/documentStore";
import { FileText, ChevronDown, Clock } from "lucide-react";

const documentTypes = [
  "Letter of Recommendation",
  "Letter of Termination",
  "Letter of Employment",
  "Letter of Reference",
  "Letter of Introduction",
  "Letter of Resignation",
  "Letter of Acceptance",
  "Letter of Rejection",
  "Letter of Apology",
  "Letter of Complaint",
  "Letter of Inquiry",
  "Letter of Request",
  "Letter of Confirmation",
  "Letter of Agreement",
  "Letter of Authorization",
  "Custom Document",
];

interface DocumentTypeSelectorProps {
  theme?: "dark" | "light";
}

export default function DocumentTypeSelector({ theme = "dark" }: DocumentTypeSelectorProps) {
  const { documentType, setDocumentType } = useDocumentStore();
  const [recentTypes, setRecentTypes] = useState<string[]>([]);

  const bgElevated = theme === "light" ? "bg-[#f5f2ed]" : "bg-[--bg-elevated]";
  const borderColor = theme === "light" ? "border-[#e5e0d8]" : "border-[--border-default]";
  const textMuted = theme === "light" ? "text-[#8f897f]" : "text-[--text-muted]";

  // Load recent types from localStorage
  useEffect(() => {
    if (typeof window !== "undefined") {
      const saved = localStorage.getItem("recentDocTypes");
      if (saved) {
        try {
          setRecentTypes(JSON.parse(saved));
        } catch {
          // ignore
        }
      }
    }
  }, []);

  // Update recent types when selection changes
  useEffect(() => {
    if (documentType && typeof window !== "undefined") {
      setRecentTypes((prev) => {
        const updated = [documentType, ...prev.filter((t) => t !== documentType)].slice(0, 5);
        localStorage.setItem("recentDocTypes", JSON.stringify(updated));
        return updated;
      });
    }
  }, [documentType]);

  const accentColors = [
    "border-[--color-accent] text-[--color-accent]",
    "border-pink-400 text-pink-400",
    "border-blue-400 text-blue-400",
    "border-amber-400 text-amber-400",
  ];

  return (
    <section className="form-section card p-5 rounded-xl">
      <label htmlFor="documentType" className="section-label mb-3 flex items-center gap-2">
        <FileText className="w-4 h-4 text-[--color-primary]" />
        Document Type
      </label>

      <div className="relative">
        <select
          id="documentType"
          value={documentType}
          onChange={(e) => setDocumentType(e.target.value)}
          className={`w-full px-4 py-3 pr-10 rounded-xl appearance-none cursor-pointer ${bgElevated} border ${borderColor} focus:border-[--color-primary]`}
        >
          {documentTypes.map((type) => (
            <option key={type} value={type}>
              {type}
            </option>
          ))}
        </select>
        <ChevronDown
          className={`absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 ${textMuted} pointer-events-none`}
        />
      </div>

      {/* Recent Types */}
      {recentTypes.length > 1 && (
        <div className="mt-4 flex flex-wrap items-center gap-2">
          <span className={`text-xs ${textMuted} flex items-center gap-1`}>
            <Clock className="w-3 h-3" />
            Recent:
          </span>
          {recentTypes.slice(1, 4).map((type, idx) => (
            <button
              key={type}
              onClick={() => setDocumentType(type)}
              className={`text-xs px-2.5 py-1 rounded-lg ${bgElevated} border transition-all hover:scale-105 ${accentColors[idx % accentColors.length]}`}
            >
              {type.replace("Letter of ", "")}
            </button>
          ))}
        </div>
      )}
    </section>
  );
}
</file>

<file path="src/components/forms/FormattingOptions.tsx">
"use client";

import { useDocumentStore } from "@/store/documentStore";
import { Sliders, Type, AlignJustify } from "lucide-react";

interface FormattingOptionsProps {
  theme?: "dark" | "light";
}

export default function FormattingOptions({ theme = "dark" }: FormattingOptionsProps) {
  const { formatting, setFormatting } = useDocumentStore();

  const textMuted = theme === "light" ? "text-[#8f897f]" : "text-[--text-muted]";

  return (
    <section className="form-section card p-5 rounded-xl">
      <h2 className="section-label mb-4 flex items-center gap-2">
        <Sliders className="w-4 h-4 text-[--color-accent]" />
        Formatting
      </h2>

      <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div>
          <label htmlFor="fontSize" className={`flex items-center gap-2 text-sm ${textMuted} mb-3`}>
            <Type className="w-4 h-4" />
            Font Size:{" "}
            <span className="text-[--color-primary] font-mono font-medium">
              {formatting.fontSize}pt
            </span>
          </label>
          <input
            type="range"
            id="fontSize"
            min="9"
            max="14"
            value={formatting.fontSize}
            onChange={(e) => setFormatting({ fontSize: Number(e.target.value) })}
            className="w-full accent-[--color-primary]"
          />
          <div className={`flex justify-between text-xs ${textMuted} mt-1`}>
            <span>9pt</span>
            <span>14pt</span>
          </div>
        </div>

        <div>
          <label
            htmlFor="lineSpacing"
            className={`flex items-center gap-2 text-sm ${textMuted} mb-3`}
          >
            <AlignJustify className="w-4 h-4" />
            Line Spacing:{" "}
            <span className="text-[--color-accent] font-mono font-medium">
              {formatting.lineSpacing.toFixed(1)}
            </span>
          </label>
          <input
            type="range"
            id="lineSpacing"
            min="1"
            max="2.5"
            step="0.1"
            value={formatting.lineSpacing}
            onChange={(e) => setFormatting({ lineSpacing: Number(e.target.value) })}
            className="w-full accent-[--color-accent]"
          />
          <div className={`flex justify-between text-xs ${textMuted} mt-1`}>
            <span>1.0</span>
            <span>2.5</span>
          </div>
        </div>
      </div>
    </section>
  );
}
</file>

<file path="src/components/forms/index.ts">
// Form components barrel export
export { default as DocumentTypeSelector } from "./DocumentTypeSelector";
export { default as RecipientForm } from "./RecipientForm";
export { default as SignatorySection } from "./SignatorySection";
export { default as DocumentBodyEditor } from "./DocumentBodyEditor";
export { default as FormattingOptions } from "./FormattingOptions";
</file>

<file path="src/components/forms/RecipientForm.tsx">
"use client";

import { useState } from "react";
import { useDocumentStore, SavedRecipient } from "@/store/documentStore";
import { BookUser, Plus, Trash2, User, Briefcase, MapPin } from "lucide-react";
import { toast } from "react-hot-toast";

interface RecipientFormProps {
  theme?: "dark" | "light";
}

export default function RecipientForm({ theme = "dark" }: RecipientFormProps) {
  const [showAddressBook, setShowAddressBook] = useState(false);

  const {
    recipient,
    setRecipient,
    subject,
    setSubject,
    savedRecipients,
    addSavedRecipient,
    removeSavedRecipient,
  } = useDocumentStore();

  const bgElevated = theme === "light" ? "bg-[#f5f2ed]" : "bg-[--bg-elevated]";
  const borderColor = theme === "light" ? "border-[#e5e0d8]" : "border-[--border-default]";
  const textMuted = theme === "light" ? "text-[#8f897f]" : "text-[--text-muted]";

  const handleSaveRecipient = () => {
    if (!recipient.name.trim()) {
      toast.error("Enter a recipient name first");
      return;
    }
    const newRecipient: SavedRecipient = {
      id: `recipient-${Date.now()}`,
      name: recipient.name,
      title: recipient.title,
      address: recipient.address,
    };
    addSavedRecipient(newRecipient);
    toast.success("Recipient saved to address book");
  };

  const handleLoadRecipient = (saved: SavedRecipient) => {
    setRecipient({
      name: saved.name,
      title: saved.title,
      address: saved.address,
    });
    setShowAddressBook(false);
    toast.success(`Loaded: ${saved.name}`);
  };

  return (
    <>
      <section className="form-section card p-5 rounded-xl">
        <div className="flex items-center justify-between mb-4">
          <h2 className="section-label flex items-center gap-2">
            <User className="w-4 h-4 text-[--color-accent]" />
            Recipient Details
          </h2>
          <div className="flex gap-2">
            <button
              onClick={() => setShowAddressBook(true)}
              className={`text-xs px-3 py-1.5 ${bgElevated} border ${borderColor} rounded-lg hover:border-[--color-accent] hover:text-[--color-accent] transition-all ${textMuted} flex items-center gap-1.5`}
            >
              <BookUser className="w-3.5 h-3.5" />
              Address Book ({savedRecipients.length})
            </button>
            {recipient.name && (
              <button
                onClick={handleSaveRecipient}
                className="text-xs px-3 py-1.5 bg-[--color-accent] text-white rounded-lg hover:opacity-90 transition-all font-medium flex items-center gap-1.5"
              >
                <Plus className="w-3.5 h-3.5" />
                Save
              </button>
            )}
          </div>
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="relative">
            <label htmlFor="recipientName" className={`block text-sm ${textMuted} mb-1.5`}>
              Name
            </label>
            <div className="relative">
              <User className={`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${textMuted}`} />
              <input
                type="text"
                id="recipientName"
                value={recipient.name}
                onChange={(e) => setRecipient({ name: e.target.value })}
                className="w-full pl-10 pr-4 py-2.5 rounded-lg"
                placeholder="John Smith"
              />
            </div>
          </div>

          <div>
            <label htmlFor="recipientTitle" className={`block text-sm ${textMuted} mb-1.5`}>
              Title
            </label>
            <div className="relative">
              <Briefcase className={`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${textMuted}`} />
              <input
                type="text"
                id="recipientTitle"
                value={recipient.title}
                onChange={(e) => setRecipient({ title: e.target.value })}
                className="w-full pl-10 pr-4 py-2.5 rounded-lg"
                placeholder="HR Manager"
              />
            </div>
          </div>

          <div className="sm:col-span-2">
            <label htmlFor="recipientAddress" className={`block text-sm ${textMuted} mb-1.5`}>
              Address
            </label>
            <div className="relative">
              <MapPin className={`absolute left-3 top-3 w-4 h-4 ${textMuted}`} />
              <textarea
                id="recipientAddress"
                value={recipient.address}
                onChange={(e) => setRecipient({ address: e.target.value })}
                rows={2}
                className="w-full pl-10 pr-4 py-2.5 rounded-lg resize-none"
                placeholder="123 Business Ave, City, State 12345"
              />
            </div>
          </div>

          <div className="sm:col-span-2">
            <label htmlFor="subject" className={`block text-sm ${textMuted} mb-1.5`}>
              Subject Line
            </label>
            <input
              type="text"
              id="subject"
              value={subject}
              onChange={(e) => setSubject(e.target.value)}
              className="w-full px-4 py-2.5 rounded-lg"
              placeholder="Re: Letter of Recommendation for..."
            />
          </div>
        </div>
      </section>

      {/* Address Book Modal */}
      {showAddressBook && (
        <div
          className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={() => setShowAddressBook(false)}
        >
          <div
            className="card max-w-md w-full rounded-2xl overflow-hidden modal-enter"
            onClick={(e) => e.stopPropagation()}
          >
            <div className="flex items-center justify-between p-5 border-b border-[--border-default]">
              <h2 className="text-lg font-semibold flex items-center gap-2">
                <BookUser className="w-5 h-5 text-[--color-accent]" />
                Address Book
              </h2>
              <button
                onClick={() => setShowAddressBook(false)}
                className="text-[--text-muted] hover:text-[--text-primary] text-xl leading-none"
              >
                √ó
              </button>
            </div>

            <div className="p-5 max-h-[60vh] overflow-auto">
              {savedRecipients.length === 0 ? (
                <div className="text-center py-12">
                  <BookUser className="w-12 h-12 mx-auto mb-4 text-[--text-muted] opacity-50" />
                  <p className="text-[--text-muted]">No saved recipients yet.</p>
                  <p className="text-sm text-[--text-muted] mt-1">
                    Fill in recipient details and click &quot;Save&quot; to add one.
                  </p>
                </div>
              ) : (
                <div className="space-y-2">
                  {savedRecipients.map((r) => (
                    <div
                      key={r.id}
                      className={`p-4 rounded-xl ${bgElevated} border ${borderColor} flex items-center justify-between hover:border-[--color-accent] transition-all cursor-pointer group`}
                      onClick={() => handleLoadRecipient(r)}
                    >
                      <div className="flex-1">
                        <div className="font-medium group-hover:text-[--color-accent] transition-colors">
                          {r.name}
                        </div>
                        {r.title && (
                          <div className={`text-sm ${textMuted}`}>{r.title}</div>
                        )}
                      </div>
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          removeSavedRecipient(r.id);
                          toast.success("Recipient removed");
                        }}
                        className={`${textMuted} hover:text-red-400 p-2 rounded-lg hover:bg-red-500/10 transition-all opacity-0 group-hover:opacity-100`}
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      )}
    </>
  );
}
</file>

<file path="src/components/forms/SignatorySection.tsx">
"use client";

import { useDocumentStore } from "@/store/documentStore";
import { signatories } from "@/data/signatories";
import { PenLine, Building2, Phone, Mail, User, Briefcase } from "lucide-react";

interface SignatorySectionProps {
  theme?: "dark" | "light";
}

export default function SignatorySection({ theme = "dark" }: SignatorySectionProps) {
  const {
    selectedSignatoryId,
    useCustomSignatory,
    customSignatory,
    setSelectedSignatory,
    setUseCustomSignatory,
    setCustomSignatory,
  } = useDocumentStore();

  const bgElevated = theme === "light" ? "bg-[#f5f2ed]" : "bg-[--bg-elevated]";
  const borderColor = theme === "light" ? "border-[#e5e0d8]" : "border-[--border-default]";
  const textMuted = theme === "light" ? "text-[#8f897f]" : "text-[--text-muted]";

  return (
    <section className="form-section card p-5 rounded-xl">
      <h2 className="section-label mb-4 flex items-center gap-2">
        <PenLine className="w-4 h-4 text-[--color-primary]" />
        Signatory
      </h2>

      <div className="space-y-2">
        {signatories.map((signatory) => {
          const isSelected = !useCustomSignatory && selectedSignatoryId === signatory.id;
          return (
            <label
              key={signatory.id}
              className={`flex items-center p-4 rounded-xl cursor-pointer transition-all border ${
                isSelected
                  ? `${bgElevated} border-[--color-primary] shadow-lg shadow-[--color-primary]/10`
                  : `${bgElevated} ${borderColor} hover:border-[--color-primary]/50`
              }`}
            >
              <input
                type="radio"
                name="signatory"
                value={signatory.id}
                checked={isSelected}
                onChange={() => setSelectedSignatory(signatory.id)}
                className="sr-only"
              />
              <div
                className={`w-5 h-5 rounded-full border-2 mr-4 flex items-center justify-center transition-colors ${
                  isSelected ? "border-[--color-primary]" : "border-[--text-muted]"
                }`}
              >
                {isSelected && (
                  <div className="w-2.5 h-2.5 rounded-full bg-[--color-primary]" />
                )}
              </div>
              <div className="flex-1">
                <div className="font-medium">{signatory.name}</div>
                <div className={`text-sm ${textMuted}`}>{signatory.title}</div>
              </div>
              {signatory.company && (
                <div className={`text-xs ${textMuted} hidden sm:block`}>
                  {signatory.company}
                </div>
              )}
            </label>
          );
        })}

        {/* Custom Signatory */}
        <div
          className={`p-4 rounded-xl border transition-all ${
            useCustomSignatory
              ? `${bgElevated} border-[--color-primary] shadow-lg shadow-[--color-primary]/10`
              : `${bgElevated} ${borderColor}`
          }`}
        >
          <label className="flex items-center cursor-pointer">
            <input
              type="radio"
              name="signatory"
              checked={useCustomSignatory}
              onChange={() => setUseCustomSignatory(true)}
              className="sr-only"
            />
            <div
              className={`w-5 h-5 rounded-full border-2 mr-4 flex items-center justify-center transition-colors ${
                useCustomSignatory ? "border-[--color-primary]" : "border-[--text-muted]"
              }`}
            >
              {useCustomSignatory && (
                <div className="w-2.5 h-2.5 rounded-full bg-[--color-primary]" />
              )}
            </div>
            <span className="font-medium">Custom Signatory</span>
          </label>

          {useCustomSignatory && (
            <div className="mt-5 space-y-4 pl-9 animate-slide-up">
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div className="relative">
                  <User className={`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${textMuted}`} />
                  <input
                    type="text"
                    value={customSignatory.name}
                    onChange={(e) => setCustomSignatory({ name: e.target.value })}
                    placeholder="Full Name *"
                    className="w-full pl-10 pr-3 py-2.5 rounded-lg text-sm"
                  />
                </div>
                <div className="relative">
                  <Briefcase className={`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${textMuted}`} />
                  <input
                    type="text"
                    value={customSignatory.title}
                    onChange={(e) => setCustomSignatory({ title: e.target.value })}
                    placeholder="Title"
                    className="w-full pl-10 pr-3 py-2.5 rounded-lg text-sm"
                  />
                </div>
              </div>

              <div className="relative">
                <Building2 className={`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${textMuted}`} />
                <input
                  type="text"
                  value={customSignatory.company}
                  onChange={(e) => setCustomSignatory({ company: e.target.value })}
                  placeholder="Company"
                  className="w-full pl-10 pr-3 py-2.5 rounded-lg text-sm"
                />
              </div>

              <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div className="relative">
                  <Phone className={`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${textMuted}`} />
                  <input
                    type="text"
                    value={customSignatory.phone}
                    onChange={(e) => setCustomSignatory({ phone: e.target.value })}
                    placeholder="Phone"
                    className="w-full pl-10 pr-3 py-2.5 rounded-lg text-sm"
                  />
                </div>
                <div className="relative">
                  <Mail className={`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 ${textMuted}`} />
                  <input
                    type="email"
                    value={customSignatory.email}
                    onChange={(e) => setCustomSignatory({ email: e.target.value })}
                    placeholder="Email"
                    className="w-full pl-10 pr-3 py-2.5 rounded-lg text-sm"
                  />
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    </section>
  );
}
</file>

<file path="src/components/Input.tsx">
"use client";

import { forwardRef, ReactNode, useState } from "react";
import { Eye, EyeOff, Search, X } from "lucide-react";

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
  hint?: string;
  icon?: ReactNode;
  iconPosition?: "left" | "right";
  variant?: "default" | "filled" | "ghost";
}

const Input = forwardRef<HTMLInputElement, InputProps>(
  (
    {
      label,
      error,
      hint,
      icon,
      iconPosition = "left",
      variant = "default",
      className = "",
      type,
      ...props
    },
    ref
  ) => {
    const [showPassword, setShowPassword] = useState(false);
    const isPassword = type === "password";
    const inputType = isPassword && showPassword ? "text" : type;

    const baseClasses =
      "w-full transition-all duration-200 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed";

    const variantClasses = {
      default:
        "bg-[#12121a] border border-[#2a2a3a] text-white placeholder-gray-500 focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20",
      filled:
        "bg-[#1f1f2e] border-transparent text-white placeholder-gray-500 focus:bg-[#2a2a3a] focus:ring-2 focus:ring-violet-500/20",
      ghost:
        "bg-transparent border-b border-[#2a2a3a] text-white placeholder-gray-500 focus:border-violet-500 rounded-none",
    };

    const sizeClasses = icon
      ? iconPosition === "left"
        ? "pl-11 pr-4 py-3 rounded-xl"
        : "pl-4 pr-11 py-3 rounded-xl"
      : "px-4 py-3 rounded-xl";

    const errorClasses = error
      ? "border-red-500 focus:border-red-500 focus:ring-red-500/20"
      : "";

    return (
      <div className="space-y-1.5">
        {label && (
          <label className="block text-sm font-medium text-gray-300">
            {label}
          </label>
        )}
        <div className="relative">
          {icon && iconPosition === "left" && (
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">
              {icon}
            </div>
          )}
          <input
            ref={ref}
            type={inputType}
            className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses} ${errorClasses} ${className}`}
            {...props}
          />
          {icon && iconPosition === "right" && !isPassword && (
            <div className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">
              {icon}
            </div>
          )}
          {isPassword && (
            <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
              className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors"
            >
              {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
            </button>
          )}
        </div>
        {error && <p className="text-sm text-red-400">{error}</p>}
        {hint && !error && <p className="text-sm text-gray-500">{hint}</p>}
      </div>
    );
  }
);

Input.displayName = "Input";

export default Input;

// Search Input
interface SearchInputProps extends Omit<InputProps, "icon" | "iconPosition"> {
  onClear?: () => void;
}

export const SearchInput = forwardRef<HTMLInputElement, SearchInputProps>(
  ({ onClear, value, ...props }, ref) => {
    const hasValue = value && String(value).length > 0;

    return (
      <div className="relative">
        <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500" />
        <input
          ref={ref}
          type="text"
          value={value}
          className="w-full pl-11 pr-10 py-3 rounded-xl bg-[#12121a] border border-[#2a2a3a] text-white placeholder-gray-500 focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 focus:outline-none transition-all duration-200"
          {...props}
        />
        {hasValue && onClear && (
          <button
            type="button"
            onClick={onClear}
            className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors"
          >
            <X className="w-5 h-5" />
          </button>
        )}
      </div>
    );
  }
);

SearchInput.displayName = "SearchInput";

// Textarea
interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {
  label?: string;
  error?: string;
  hint?: string;
  variant?: "default" | "filled" | "ghost";
}

export const Textarea = forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ label, error, hint, variant = "default", className = "", ...props }, ref) => {
    const baseClasses =
      "w-full transition-all duration-200 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed resize-y min-h-[120px]";

    const variantClasses = {
      default:
        "bg-[#12121a] border border-[#2a2a3a] text-white placeholder-gray-500 focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 px-4 py-3 rounded-xl",
      filled:
        "bg-[#1f1f2e] border-transparent text-white placeholder-gray-500 focus:bg-[#2a2a3a] focus:ring-2 focus:ring-violet-500/20 px-4 py-3 rounded-xl",
      ghost:
        "bg-transparent border border-[#2a2a3a] text-white placeholder-gray-500 focus:border-violet-500 px-4 py-3 rounded-xl",
    };

    const errorClasses = error
      ? "border-red-500 focus:border-red-500 focus:ring-red-500/20"
      : "";

    return (
      <div className="space-y-1.5">
        {label && (
          <label className="block text-sm font-medium text-gray-300">
            {label}
          </label>
        )}
        <textarea
          ref={ref}
          className={`${baseClasses} ${variantClasses[variant]} ${errorClasses} ${className}`}
          {...props}
        />
        {error && <p className="text-sm text-red-400">{error}</p>}
        {hint && !error && <p className="text-sm text-gray-500">{hint}</p>}
      </div>
    );
  }
);

Textarea.displayName = "Textarea";

// Select
interface SelectProps extends React.SelectHTMLAttributes<HTMLSelectElement> {
  label?: string;
  error?: string;
  options: { value: string; label: string }[];
}

export const Select = forwardRef<HTMLSelectElement, SelectProps>(
  ({ label, error, options, className = "", ...props }, ref) => {
    return (
      <div className="space-y-1.5">
        {label && (
          <label className="block text-sm font-medium text-gray-300">
            {label}
          </label>
        )}
        <select
          ref={ref}
          className={`w-full px-4 py-3 rounded-xl bg-[#12121a] border border-[#2a2a3a] text-white focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 focus:outline-none transition-all duration-200 cursor-pointer ${
            error ? "border-red-500" : ""
          } ${className}`}
          {...props}
        >
          {options.map((option) => (
            <option key={option.value} value={option.value}>
              {option.label}
            </option>
          ))}
        </select>
        {error && <p className="text-sm text-red-400">{error}</p>}
      </div>
    );
  }
);

Select.displayName = "Select";
</file>

<file path="src/components/KeyboardShortcuts.tsx">
"use client";

interface KeyboardShortcutsProps {
  isOpen: boolean;
  onClose: () => void;
}

const SHORTCUTS = [
  { category: "General", shortcuts: [
    { keys: ["Ctrl", "S"], action: "Save draft" },
    { keys: ["Ctrl", "P"], action: "Preview PDF" },
    { keys: ["Ctrl", "Z"], action: "Undo" },
    { keys: ["Ctrl", "F"], action: "Find & Replace" },
    { keys: ["Esc"], action: "Close modal" },
  ]},
  { category: "Navigation", shortcuts: [
    { keys: ["Tab"], action: "Next field" },
    { keys: ["Shift", "Tab"], action: "Previous field" },
    { keys: ["Ctrl", "‚Üë"], action: "Previous placeholder" },
    { keys: ["Ctrl", "‚Üì"], action: "Next placeholder" },
  ]},
  { category: "Editor", shortcuts: [
    { keys: ["Ctrl", "B"], action: "Bold text" },
    { keys: ["Ctrl", "I"], action: "Italic text" },
    { keys: ["Ctrl", "A"], action: "Select all" },
    { keys: ["Ctrl", "C"], action: "Copy" },
    { keys: ["Ctrl", "V"], action: "Paste" },
  ]},
  { category: "Quick Actions", shortcuts: [
    { keys: ["Ctrl", "1"], action: "Templates" },
    { keys: ["Ctrl", "2"], action: "History" },
    { keys: ["Ctrl", "3"], action: "Statistics" },
    { keys: ["Ctrl", ","], action: "Settings" },
    { keys: ["?"], action: "Show shortcuts" },
  ]},
];

export default function KeyboardShortcuts({ isOpen, onClose }: KeyboardShortcutsProps) {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={onClose}>
      <div 
        className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-2xl w-full max-h-[80vh] overflow-auto border border-[#2a2a3a] shadow-2xl"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="sticky top-0 bg-[#12121a] flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">‚å®Ô∏è Keyboard Shortcuts</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white transition-colors text-2xl">√ó</button>
        </div>

        {/* Content */}
        <div className="p-4 grid grid-cols-1 md:grid-cols-2 gap-6">
          {SHORTCUTS.map((category) => (
            <div key={category.category}>
              <h3 className="text-sm font-medium text-[#a78bfa] mb-3">{category.category}</h3>
              <div className="space-y-2">
                {category.shortcuts.map((shortcut, index) => (
                  <div key={index} className="flex items-center justify-between p-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                    <div className="flex items-center gap-1">
                      {shortcut.keys.map((key, i) => (
                        <span key={i}>
                          <kbd className="px-2 py-1 rounded bg-[#2a2a3a] text-[#4ecdc4] text-xs font-mono">
                            {key}
                          </kbd>
                          {i < shortcut.keys.length - 1 && <span className="text-[#666680] mx-1">+</span>}
                        </span>
                      ))}
                    </div>
                    <span className="text-sm text-[#a0a0a0]">{shortcut.action}</span>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>

        {/* Footer */}
        <div className="p-4 border-t border-[#2a2a3a] text-center">
          <p className="text-xs text-[#666680]">Press <kbd className="px-1.5 py-0.5 rounded bg-[#2a2a3a] text-[#a78bfa]">?</kbd> anytime to show this dialog</p>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/LanguageSelector.tsx">
"use client";

import { useState, useEffect, createContext, useContext, ReactNode } from "react";

type Language = "en" | "es" | "fr" | "de" | "pt" | "zh" | "ja";

interface LanguageOption {
  code: Language;
  name: string;
  nativeName: string;
  flag: string;
}

const LANGUAGES: LanguageOption[] = [
  { code: "en", name: "English", nativeName: "English", flag: "üá∫üá∏" },
  { code: "es", name: "Spanish", nativeName: "Espa√±ol", flag: "üá™üá∏" },
  { code: "fr", name: "French", nativeName: "Fran√ßais", flag: "üá´üá∑" },
  { code: "de", name: "German", nativeName: "Deutsch", flag: "üá©üá™" },
  { code: "pt", name: "Portuguese", nativeName: "Portugu√™s", flag: "üáßüá∑" },
  { code: "zh", name: "Chinese", nativeName: "‰∏≠Êñá", flag: "üá®üá≥" },
  { code: "ja", name: "Japanese", nativeName: "Êó•Êú¨Ë™û", flag: "üáØüáµ" },
];

// Translations
const translations: Record<Language, Record<string, string>> = {
  en: {
    "app.title": "Document Generator",
    "nav.templates": "Templates",
    "nav.history": "History",
    "nav.settings": "Settings",
    "form.documentType": "Document Type",
    "form.recipient": "Recipient",
    "form.body": "Document Body",
    "form.signatory": "Signatory",
    "action.generate": "Generate PDF",
    "action.preview": "Preview",
    "action.save": "Save Draft",
    "status.saved": "Saved",
    "status.generating": "Generating...",
  },
  es: {
    "app.title": "Generador de Documentos",
    "nav.templates": "Plantillas",
    "nav.history": "Historial",
    "nav.settings": "Configuraci√≥n",
    "form.documentType": "Tipo de Documento",
    "form.recipient": "Destinatario",
    "form.body": "Cuerpo del Documento",
    "form.signatory": "Firmante",
    "action.generate": "Generar PDF",
    "action.preview": "Vista Previa",
    "action.save": "Guardar Borrador",
    "status.saved": "Guardado",
    "status.generating": "Generando...",
  },
  fr: {
    "app.title": "G√©n√©rateur de Documents",
    "nav.templates": "Mod√®les",
    "nav.history": "Historique",
    "nav.settings": "Param√®tres",
    "form.documentType": "Type de Document",
    "form.recipient": "Destinataire",
    "form.body": "Corps du Document",
    "form.signatory": "Signataire",
    "action.generate": "G√©n√©rer PDF",
    "action.preview": "Aper√ßu",
    "action.save": "Enregistrer le brouillon",
    "status.saved": "Enregistr√©",
    "status.generating": "G√©n√©ration...",
  },
  de: {
    "app.title": "Dokumentengenerator",
    "nav.templates": "Vorlagen",
    "nav.history": "Verlauf",
    "nav.settings": "Einstellungen",
    "form.documentType": "Dokumenttyp",
    "form.recipient": "Empf√§nger",
    "form.body": "Dokumentinhalt",
    "form.signatory": "Unterzeichner",
    "action.generate": "PDF Erstellen",
    "action.preview": "Vorschau",
    "action.save": "Entwurf Speichern",
    "status.saved": "Gespeichert",
    "status.generating": "Wird generiert...",
  },
  pt: {
    "app.title": "Gerador de Documentos",
    "nav.templates": "Modelos",
    "nav.history": "Hist√≥rico",
    "nav.settings": "Configura√ß√µes",
    "form.documentType": "Tipo de Documento",
    "form.recipient": "Destinat√°rio",
    "form.body": "Corpo do Documento",
    "form.signatory": "Signat√°rio",
    "action.generate": "Gerar PDF",
    "action.preview": "Visualizar",
    "action.save": "Salvar Rascunho",
    "status.saved": "Salvo",
    "status.generating": "Gerando...",
  },
  zh: {
    "app.title": "ÊñáÊ°£ÁîüÊàêÂô®",
    "nav.templates": "Ê®°Êùø",
    "nav.history": "ÂéÜÂè≤",
    "nav.settings": "ËÆæÁΩÆ",
    "form.documentType": "ÊñáÊ°£Á±ªÂûã",
    "form.recipient": "Êî∂‰ª∂‰∫∫",
    "form.body": "ÊñáÊ°£Ê≠£Êñá",
    "form.signatory": "Á≠æÁΩ≤‰∫∫",
    "action.generate": "ÁîüÊàêPDF",
    "action.preview": "È¢ÑËßà",
    "action.save": "‰øùÂ≠òËçâÁ®ø",
    "status.saved": "Â∑≤‰øùÂ≠ò",
    "status.generating": "ÁîüÊàê‰∏≠...",
  },
  ja: {
    "app.title": "ÊñáÊõ∏„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº",
    "nav.templates": "„ÉÜ„É≥„Éó„É¨„Éº„Éà",
    "nav.history": "Â±•Ê≠¥",
    "nav.settings": "Ë®≠ÂÆö",
    "form.documentType": "ÊñáÊõ∏„Çø„Ç§„Éó",
    "form.recipient": "Âèó‰ø°ËÄÖ",
    "form.body": "ÊñáÊõ∏Êú¨Êñá",
    "form.signatory": "ÁΩ≤ÂêçËÄÖ",
    "action.generate": "PDFÁîüÊàê",
    "action.preview": "„Éó„É¨„Éì„É•„Éº",
    "action.save": "‰∏ãÊõ∏„Åç‰øùÂ≠ò",
    "status.saved": "‰øùÂ≠òÊ∏à„Åø",
    "status.generating": "ÁîüÊàê‰∏≠...",
  },
};

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
}

const LanguageContext = createContext<LanguageContextType | null>(null);

export function LanguageProvider({ children }: { children: ReactNode }) {
  const [language, setLanguageState] = useState<Language>("en");
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem("language") as Language | null;
    if (saved && LANGUAGES.some(l => l.code === saved)) {
      setLanguageState(saved);
    } else {
      // Detect browser language
      const browserLang = navigator.language.split("-")[0] as Language;
      if (LANGUAGES.some(l => l.code === browserLang)) {
        setLanguageState(browserLang);
      }
    }
  }, []);

  const setLanguage = (lang: Language) => {
    setLanguageState(lang);
    localStorage.setItem("language", lang);
  };

  const t = (key: string): string => {
    return translations[language][key] || translations.en[key] || key;
  };

  if (!mounted) return <>{children}</>;

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
}

export function useLanguage() {
  const context = useContext(LanguageContext);
  if (!context) {
    return {
      language: "en" as Language,
      setLanguage: () => {},
      t: (key: string) => key,
    };
  }
  return context;
}

interface LanguageSelectorProps {
  compact?: boolean;
}

export default function LanguageSelector({ compact = false }: LanguageSelectorProps) {
  const { language, setLanguage } = useLanguage();
  const [isOpen, setIsOpen] = useState(false);

  const currentLang = LANGUAGES.find(l => l.code === language) || LANGUAGES[0];

  if (compact) {
    return (
      <div className="relative">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="p-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white hover:border-[#a78bfa] transition-colors"
        >
          {currentLang.flag}
        </button>

        {isOpen && (
          <>
            <div className="fixed inset-0 z-40" onClick={() => setIsOpen(false)} />
            <div className="absolute top-full right-0 mt-2 w-48 bg-[#12121a] border border-[#2a2a3a] rounded-lg shadow-xl z-50 overflow-hidden">
              {LANGUAGES.map(lang => (
                <button
                  key={lang.code}
                  onClick={() => {
                    setLanguage(lang.code);
                    setIsOpen(false);
                  }}
                  className={`w-full px-4 py-2 text-left flex items-center gap-3 hover:bg-[#1a1a24] transition-colors ${
                    language === lang.code ? "bg-[#a78bfa]/10 text-[#a78bfa]" : "text-white"
                  }`}
                >
                  <span>{lang.flag}</span>
                  <span>{lang.nativeName}</span>
                </button>
              ))}
            </div>
          </>
        )}
      </div>
    );
  }

  return (
    <div className="space-y-3">
      <label className="block text-sm text-[#a0a0a0]">Language</label>
      <div className="grid grid-cols-2 gap-2">
        {LANGUAGES.map(lang => (
          <button
            key={lang.code}
            onClick={() => setLanguage(lang.code)}
            className={`p-3 rounded-lg text-left flex items-center gap-3 transition-colors ${
              language === lang.code
                ? "bg-[#a78bfa]/20 border border-[#a78bfa] text-white"
                : "bg-[#1a1a24] border border-[#2a2a3a] text-[#a0a0a0] hover:border-[#3a3a4a]"
            }`}
          >
            <span className="text-xl">{lang.flag}</span>
            <div>
              <div className="font-medium">{lang.nativeName}</div>
              <div className="text-xs opacity-60">{lang.name}</div>
            </div>
          </button>
        ))}
      </div>
    </div>
  );
}

export { LANGUAGES };
</file>

<file path="src/components/LazyModals.tsx">
"use client";

import dynamic from "next/dynamic";
import { Skeleton } from "./Skeleton";

// Loading component for modals
const ModalLoading = () => (
  <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div className="card max-w-lg w-full p-8 rounded-2xl">
      <Skeleton className="h-6 w-32 mb-4" />
      <Skeleton className="h-4 w-full mb-2" />
      <Skeleton className="h-4 w-3/4 mb-6" />
      <div className="space-y-3">
        <Skeleton className="h-12 w-full" />
        <Skeleton className="h-12 w-full" />
        <Skeleton className="h-12 w-full" />
      </div>
    </div>
  </div>
);

// Lazy load infrequently used modals
export const LazyTeamWorkspaces = dynamic(
  () => import("./TeamWorkspaces"),
  { loading: () => <ModalLoading /> }
);

export const LazyAPIAccess = dynamic(
  () => import("./APIAccess"),
  { loading: () => <ModalLoading /> }
);

export const LazyWebhookIntegration = dynamic(
  () => import("./WebhookIntegration"),
  { loading: () => <ModalLoading /> }
);

export const LazyDocumentScheduling = dynamic(
  () => import("./DocumentScheduling"),
  { loading: () => <ModalLoading /> }
);

export const LazyApprovalWorkflow = dynamic(
  () => import("./ApprovalWorkflow"),
  { loading: () => <ModalLoading /> }
);

export const LazyBatchSend = dynamic(
  () => import("./BatchSend"),
  { loading: () => <ModalLoading /> }
);

export const LazyDocumentComparison = dynamic(
  () => import("./DocumentComparison"),
  { loading: () => <ModalLoading /> }
);

export const LazyAuditTrail = dynamic(
  () => import("./AuditTrail"),
  { loading: () => <ModalLoading /> }
);

export const LazyBulkGeneration = dynamic(
  () => import("./BulkGeneration"),
  { loading: () => <ModalLoading /> }
);

export const LazyPDFImport = dynamic(
  () => import("./PDFImport"),
  { loading: () => <ModalLoading /> }
);

export const LazyTemplateVariables = dynamic(
  () => import("./TemplateVariables"),
  { loading: () => <ModalLoading /> }
);

export const LazySignaturePlacement = dynamic(
  () => import("./SignaturePlacement"),
  { loading: () => <ModalLoading /> }
);

export const LazyDocumentRevisions = dynamic(
  () => import("./DocumentRevisions"),
  { loading: () => <ModalLoading /> }
);

export const LazyExportHistory = dynamic(
  () => import("./ExportHistory"),
  { loading: () => <ModalLoading /> }
);

export const LazyDocumentExpiration = dynamic(
  () => import("./DocumentExpiration"),
  { loading: () => <ModalLoading /> }
);
</file>

<file path="src/components/MyTemplates.tsx">
"use client";

import { useState, useEffect } from "react";
import { useSession } from "next-auth/react";
import {
  X,
  FileText,
  Search,
  Plus,
  Trash2,
  Edit3,
  Copy,
  Globe,
  Lock,
  MoreVertical,
  Clock,
  Tag,
  FolderOpen,
  AlertCircle,
  Loader2,
} from "lucide-react";
import { toast } from "react-hot-toast";
import { UserTemplate } from "@/lib/userTemplates";

interface MyTemplatesProps {
  isOpen: boolean;
  onClose: () => void;
  onSelectTemplate: (template: UserTemplate) => void;
  onCreateNew: () => void;
}

export default function MyTemplates({
  isOpen,
  onClose,
  onSelectTemplate,
  onCreateNew,
}: MyTemplatesProps) {
  const { data: session } = useSession();
  const [templates, setTemplates] = useState<UserTemplate[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState("");
  const [selectedCategory, setSelectedCategory] = useState("all");
  const [activeMenu, setActiveMenu] = useState<string | null>(null);
  const [editingTemplate, setEditingTemplate] = useState<UserTemplate | null>(null);

  // Fetch user templates
  useEffect(() => {
    if (isOpen && session?.user) {
      fetchTemplates();
    }
  }, [isOpen, session]);

  const fetchTemplates = async () => {
    setIsLoading(true);
    try {
      const res = await fetch("/api/templates/user");
      if (res.ok) {
        const data = await res.json();
        setTemplates(data.templates || []);
      }
    } catch (error) {
      console.error("Failed to fetch templates:", error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleDelete = async (templateId: string) => {
    if (!confirm("Are you sure you want to delete this template?")) return;

    try {
      const res = await fetch(`/api/templates/user/${templateId}`, {
        method: "DELETE",
      });

      if (res.ok) {
        setTemplates(templates.filter((t) => t.id !== templateId));
        toast.success("Template deleted");
      } else {
        toast.error("Failed to delete template");
      }
    } catch (error) {
      toast.error("Failed to delete template");
    }
  };

  const handleDuplicate = async (templateId: string) => {
    try {
      const res = await fetch(`/api/templates/user/${templateId}`, {
        method: "POST",
      });

      if (res.ok) {
        const data = await res.json();
        setTemplates([...templates, data.template]);
        toast.success("Template duplicated");
      } else {
        toast.error("Failed to duplicate template");
      }
    } catch (error) {
      toast.error("Failed to duplicate template");
    }
  };

  const handleTogglePublic = async (template: UserTemplate) => {
    try {
      const res = await fetch(`/api/templates/user/${template.id}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ isPublic: !template.isPublic }),
      });

      if (res.ok) {
        setTemplates(
          templates.map((t) =>
            t.id === template.id ? { ...t, isPublic: !t.isPublic } : t
          )
        );
        toast.success(
          template.isPublic ? "Template is now private" : "Template is now public"
        );
      }
    } catch (error) {
      toast.error("Failed to update template");
    }
  };

  // Filter templates
  const filteredTemplates = templates.filter((t) => {
    const matchesSearch =
      !searchQuery ||
      t.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      t.documentType.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesCategory =
      selectedCategory === "all" || t.category === selectedCategory;
    return matchesSearch && matchesCategory;
  });

  // Get unique categories
  const categories = ["all", ...Array.from(new Set(templates.map((t) => t.category)))];

  if (!isOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="w-full max-w-4xl max-h-[85vh] bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter flex flex-col"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 rounded-xl bg-[--color-primary]/10 flex items-center justify-center">
                <FolderOpen className="w-6 h-6 text-[--color-primary]" />
              </div>
              <div>
                <h2 className="text-2xl font-bold">My Templates</h2>
                <p className="text-sm text-[--text-muted]">
                  {templates.length} template{templates.length !== 1 ? "s" : ""} saved
                </p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <button
                onClick={onCreateNew}
                className="flex items-center gap-2 px-4 py-2 rounded-xl bg-[--color-primary] text-white hover:bg-[--color-primary-hover] transition-all text-sm font-medium"
              >
                <Plus className="w-4 h-4" />
                New Template
              </button>
              <button
                onClick={onClose}
                className="p-2 rounded-xl hover:bg-[--bg-elevated] text-[--text-muted] hover:text-[--text-primary] transition-colors"
              >
                <X className="w-6 h-6" />
              </button>
            </div>
          </div>

          {/* Search & Filter */}
          <div className="flex flex-wrap gap-3">
            <div className="relative flex-1 min-w-[200px]">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[--text-muted]" />
              <input
                type="text"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                placeholder="Search templates..."
                className="w-full pl-10 pr-4 py-2.5 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary]"
              />
            </div>

            <select
              value={selectedCategory}
              onChange={(e) => setSelectedCategory(e.target.value)}
              className="px-4 py-2.5 rounded-xl bg-[--bg-elevated] border border-[--border-default] text-sm"
            >
              {categories.map((cat) => (
                <option key={cat} value={cat}>
                  {cat === "all" ? "All Categories" : cat}
                </option>
              ))}
            </select>
          </div>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-y-auto p-6">
          {isLoading ? (
            <div className="flex items-center justify-center py-12">
              <Loader2 className="w-8 h-8 animate-spin text-[--color-primary]" />
            </div>
          ) : filteredTemplates.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-12 text-center">
              {templates.length === 0 ? (
                <>
                  <FileText className="w-16 h-16 text-[--text-muted] opacity-30 mb-4" />
                  <h3 className="text-lg font-semibold mb-2">No templates yet</h3>
                  <p className="text-[--text-muted] mb-4">
                    Create your first template to get started
                  </p>
                  <button
                    onClick={onCreateNew}
                    className="flex items-center gap-2 px-4 py-2 rounded-xl bg-[--color-primary] text-white hover:bg-[--color-primary-hover] transition-all"
                  >
                    <Plus className="w-4 h-4" />
                    Create Template
                  </button>
                </>
              ) : (
                <>
                  <Search className="w-16 h-16 text-[--text-muted] opacity-30 mb-4" />
                  <h3 className="text-lg font-semibold mb-2">No matches found</h3>
                  <p className="text-[--text-muted]">
                    Try a different search term
                  </p>
                </>
              )}
            </div>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {filteredTemplates.map((template) => (
                <div
                  key={template.id}
                  className="group relative p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary] transition-all"
                >
                  {/* Template Card */}
                  <div
                    className="cursor-pointer"
                    onClick={() => {
                      onSelectTemplate(template);
                      onClose();
                    }}
                  >
                    {/* Header */}
                    <div className="flex items-start gap-3 mb-3">
                      <div className="w-10 h-10 rounded-lg bg-[--color-primary]/10 flex items-center justify-center flex-shrink-0">
                        <FileText className="w-5 h-5 text-[--color-primary]" />
                      </div>
                      <div className="flex-1 min-w-0">
                        <h4 className="font-semibold truncate group-hover:text-[--color-primary] transition-colors">
                          {template.name}
                        </h4>
                        <p className="text-sm text-[--text-muted] truncate">
                          {template.documentType}
                        </p>
                      </div>
                      {template.isPublic ? (
                        <span title="Public">
                          <Globe className="w-4 h-4 text-[--color-accent]" />
                        </span>
                      ) : (
                        <span title="Private">
                          <Lock className="w-4 h-4 text-[--text-muted]" />
                        </span>
                      )}
                    </div>

                    {/* Description */}
                    {template.description && (
                      <p className="text-sm text-[--text-muted] line-clamp-2 mb-3">
                        {template.description}
                      </p>
                    )}

                    {/* Meta */}
                    <div className="flex items-center gap-4 text-xs text-[--text-muted]">
                      <span className="flex items-center gap-1">
                        <Clock className="w-3 h-3" />
                        {new Date(template.updatedAt).toLocaleDateString()}
                      </span>
                      <span className="flex items-center gap-1">
                        <Tag className="w-3 h-3" />
                        {template.category}
                      </span>
                      {template.useCount > 0 && (
                        <span>Used {template.useCount}x</span>
                      )}
                    </div>
                  </div>

                  {/* Actions Menu */}
                  <div className="absolute top-3 right-3">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        setActiveMenu(activeMenu === template.id ? null : template.id);
                      }}
                      className="p-1.5 rounded-lg hover:bg-[--bg-overlay] text-[--text-muted] hover:text-[--text-primary] transition-colors opacity-0 group-hover:opacity-100"
                    >
                      <MoreVertical className="w-4 h-4" />
                    </button>

                    {activeMenu === template.id && (
                      <div className="absolute right-0 top-full mt-1 w-44 bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-lg z-10 overflow-hidden">
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            handleDuplicate(template.id);
                            setActiveMenu(null);
                          }}
                          className="w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-[--bg-elevated] transition-colors"
                        >
                          <Copy className="w-4 h-4" />
                          Duplicate
                        </button>
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            handleTogglePublic(template);
                            setActiveMenu(null);
                          }}
                          className="w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-[--bg-elevated] transition-colors"
                        >
                          {template.isPublic ? (
                            <>
                              <Lock className="w-4 h-4" />
                              Make Private
                            </>
                          ) : (
                            <>
                              <Globe className="w-4 h-4" />
                              Make Public
                            </>
                          )}
                        </button>
                        <div className="border-t border-[--border-default]" />
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            handleDelete(template.id);
                            setActiveMenu(null);
                          }}
                          className="w-full flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:bg-red-500/10 transition-colors"
                        >
                          <Trash2 className="w-4 h-4" />
                          Delete
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/PageSettings.tsx">
"use client";

import { useState } from "react";

export interface PageConfig {
  pageBreaks: boolean;
  showPageNumbers: boolean;
  pageNumberPosition: "bottom-center" | "bottom-right" | "top-right";
  headerText: string;
  footerText: string;
  showHeader: boolean;
  showFooter: boolean;
  margins: {
    top: number;
    bottom: number;
    left: number;
    right: number;
  };
}

export const DEFAULT_PAGE_CONFIG: PageConfig = {
  pageBreaks: true,
  showPageNumbers: true,
  pageNumberPosition: "bottom-center",
  headerText: "",
  footerText: "",
  showHeader: false,
  showFooter: false,
  margins: { top: 1, bottom: 1, left: 1, right: 1 },
};

interface PageSettingsProps {
  config: PageConfig;
  onChange: (config: PageConfig) => void;
  isOpen: boolean;
  onClose: () => void;
}

export default function PageSettings({ config, onChange, isOpen, onClose }: PageSettingsProps) {
  const [localConfig, setLocalConfig] = useState<PageConfig>(config);

  const handleSave = () => {
    onChange(localConfig);
    onClose();
  };

  const updateConfig = (updates: Partial<PageConfig>) => {
    setLocalConfig(prev => ({ ...prev, ...updates }));
  };

  const updateMargins = (key: keyof PageConfig["margins"], value: number) => {
    setLocalConfig(prev => ({
      ...prev,
      margins: { ...prev.margins, [key]: value }
    }));
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
      <div className="bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-2xl w-full max-w-md">
        <div className="p-5 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <h2 className="text-lg font-semibold text-[--text-primary]">Page Settings</h2>
            <button onClick={onClose} className="text-[--text-muted] hover:text-[--text-primary]">‚úï</button>
          </div>
        </div>

        <div className="p-5 space-y-5 max-h-[60vh] overflow-y-auto">
          {/* Page Numbers */}
          <div>
            <label className="flex items-center gap-3 cursor-pointer">
              <input
                type="checkbox"
                checked={localConfig.showPageNumbers}
                onChange={(e) => updateConfig({ showPageNumbers: e.target.checked })}
                className="w-4 h-4 rounded"
              />
              <span className="text-[--text-primary]">Show page numbers</span>
            </label>
            {localConfig.showPageNumbers && (
              <select
                value={localConfig.pageNumberPosition}
                onChange={(e) => updateConfig({ pageNumberPosition: e.target.value as PageConfig["pageNumberPosition"] })}
                className="mt-2 w-full px-3 py-2 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
              >
                <option value="bottom-center">Bottom Center</option>
                <option value="bottom-right">Bottom Right</option>
                <option value="top-right">Top Right</option>
              </select>
            )}
          </div>

          {/* Header */}
          <div>
            <label className="flex items-center gap-3 cursor-pointer mb-2">
              <input
                type="checkbox"
                checked={localConfig.showHeader}
                onChange={(e) => updateConfig({ showHeader: e.target.checked })}
                className="w-4 h-4 rounded"
              />
              <span className="text-[--text-primary]">Show header on each page</span>
            </label>
            {localConfig.showHeader && (
              <input
                type="text"
                value={localConfig.headerText}
                onChange={(e) => updateConfig({ headerText: e.target.value })}
                placeholder="Header text..."
                className="w-full px-3 py-2 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
              />
            )}
          </div>

          {/* Footer */}
          <div>
            <label className="flex items-center gap-3 cursor-pointer mb-2">
              <input
                type="checkbox"
                checked={localConfig.showFooter}
                onChange={(e) => updateConfig({ showFooter: e.target.checked })}
                className="w-4 h-4 rounded"
              />
              <span className="text-[--text-primary]">Show footer on each page</span>
            </label>
            {localConfig.showFooter && (
              <input
                type="text"
                value={localConfig.footerText}
                onChange={(e) => updateConfig({ footerText: e.target.value })}
                placeholder="Footer text..."
                className="w-full px-3 py-2 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
              />
            )}
          </div>

          {/* Margins */}
          <div>
            <h3 className="text-sm font-medium text-[--text-secondary] mb-3">Margins (inches)</h3>
            <div className="grid grid-cols-2 gap-3">
              {(["top", "bottom", "left", "right"] as const).map((side) => (
                <div key={side}>
                  <label className="block text-xs text-[--text-muted] mb-1 capitalize">{side}</label>
                  <input
                    type="number"
                    min="0.25"
                    max="2"
                    step="0.25"
                    value={localConfig.margins[side]}
                    onChange={(e) => updateMargins(side, parseFloat(e.target.value) || 1)}
                    className="w-full px-3 py-2 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
                  />
                </div>
              ))}
            </div>
          </div>

          {/* Page Break Hint */}
          <div className="p-3 rounded-lg bg-[--bg-elevated] border border-[--border-default]">
            <p className="text-sm text-[--text-secondary]">
              <strong>Tip:</strong> Type <code className="px-1.5 py-0.5 bg-[--bg-overlay] rounded text-xs">---pagebreak---</code> in your document to insert a manual page break.
            </p>
          </div>
        </div>

        <div className="p-5 border-t border-[--border-default] flex gap-3">
          <button
            onClick={onClose}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:bg-[--bg-overlay]"
          >
            Cancel
          </button>
          <button
            onClick={handleSave}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--color-primary] text-white hover:opacity-90"
          >
            Save Settings
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/PDFHeaderFooter.tsx">
"use client";

import { useState, useEffect } from "react";
import {
  X,
  FileText,
  Image,
  Calendar,
  Hash,
  AlignLeft,
  AlignCenter,
  AlignRight,
  Upload,
  Trash2,
  Eye,
} from "lucide-react";
import { toast } from "react-hot-toast";

export interface HeaderFooterConfig {
  header: {
    enabled: boolean;
    left: string;
    center: string;
    right: string;
    showLogo: boolean;
    logoUrl?: string;
    height: number;
  };
  footer: {
    enabled: boolean;
    left: string;
    center: string;
    right: string;
    showPageNumbers: boolean;
    pageNumberFormat: "simple" | "detailed";
    height: number;
  };
  margins: {
    top: number;
    bottom: number;
  };
}

export const DEFAULT_HEADER_FOOTER_CONFIG: HeaderFooterConfig = {
  header: {
    enabled: false,
    left: "",
    center: "",
    right: "",
    showLogo: false,
    logoUrl: undefined,
    height: 50,
  },
  footer: {
    enabled: true,
    left: "",
    center: "Page {page} of {pages}",
    right: "",
    showPageNumbers: true,
    pageNumberFormat: "simple",
    height: 40,
  },
  margins: {
    top: 20,
    bottom: 20,
  },
};

// Placeholder tokens
const TOKENS = [
  { token: "{date}", label: "Current Date", icon: <Calendar className="w-3.5 h-3.5" /> },
  { token: "{page}", label: "Page Number", icon: <Hash className="w-3.5 h-3.5" /> },
  { token: "{pages}", label: "Total Pages", icon: <Hash className="w-3.5 h-3.5" /> },
  { token: "{title}", label: "Document Title", icon: <FileText className="w-3.5 h-3.5" /> },
];

interface PDFHeaderFooterProps {
  isOpen: boolean;
  onClose: () => void;
  config: HeaderFooterConfig;
  onChange: (config: HeaderFooterConfig) => void;
}

export default function PDFHeaderFooter({
  isOpen,
  onClose,
  config,
  onChange,
}: PDFHeaderFooterProps) {
  const [localConfig, setLocalConfig] = useState<HeaderFooterConfig>(config);
  const [activeSection, setActiveSection] = useState<"header" | "footer">("header");
  const [showPreview, setShowPreview] = useState(false);

  useEffect(() => {
    if (isOpen) {
      setLocalConfig(config);
    }
  }, [isOpen, config]);

  const updateHeader = (updates: Partial<HeaderFooterConfig["header"]>) => {
    setLocalConfig((prev) => ({
      ...prev,
      header: { ...prev.header, ...updates },
    }));
  };

  const updateFooter = (updates: Partial<HeaderFooterConfig["footer"]>) => {
    setLocalConfig((prev) => ({
      ...prev,
      footer: { ...prev.footer, ...updates },
    }));
  };

  const handleLogoUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    if (!file.type.startsWith("image/")) {
      toast.error("Please upload an image file");
      return;
    }

    if (file.size > 500000) {
      toast.error("Image must be less than 500KB");
      return;
    }

    const reader = new FileReader();
    reader.onload = (event) => {
      updateHeader({ logoUrl: event.target?.result as string, showLogo: true });
    };
    reader.readAsDataURL(file);
  };

  const insertToken = (token: string, field: "left" | "center" | "right") => {
    const section = activeSection === "header" ? localConfig.header : localConfig.footer;
    const currentValue = section[field];
    const updatedValue = currentValue ? `${currentValue} ${token}` : token;

    if (activeSection === "header") {
      updateHeader({ [field]: updatedValue });
    } else {
      updateFooter({ [field]: updatedValue });
    }
  };

  const handleSave = () => {
    onChange(localConfig);
    toast.success("Header/Footer settings saved");
    onClose();
  };

  if (!isOpen) return null;

  const currentSection = activeSection === "header" ? localConfig.header : localConfig.footer;

  return (
    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="w-full max-w-2xl max-h-[90vh] bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter flex flex-col">
        {/* Header */}
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-[--color-primary]/20 flex items-center justify-center">
                <FileText className="w-5 h-5 text-[--color-primary]" />
              </div>
              <div>
                <h2 className="text-lg font-bold">PDF Header & Footer</h2>
                <p className="text-sm text-[--text-muted]">Customize document headers and footers</p>
              </div>
            </div>
            <button
              onClick={onClose}
              className="p-2 rounded-xl hover:bg-[--bg-elevated] transition-colors"
            >
              <X className="w-5 h-5" />
            </button>
          </div>

          {/* Section Tabs */}
          <div className="flex gap-2 mt-4">
            <button
              onClick={() => setActiveSection("header")}
              className={`flex-1 py-2.5 rounded-xl font-medium transition-colors ${
                activeSection === "header"
                  ? "bg-[--color-primary] text-white"
                  : "bg-[--bg-elevated] hover:bg-[--bg-overlay]"
              }`}
            >
              Header
            </button>
            <button
              onClick={() => setActiveSection("footer")}
              className={`flex-1 py-2.5 rounded-xl font-medium transition-colors ${
                activeSection === "footer"
                  ? "bg-[--color-primary] text-white"
                  : "bg-[--bg-elevated] hover:bg-[--bg-overlay]"
              }`}
            >
              Footer
            </button>
          </div>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-y-auto p-6 space-y-6">
          {/* Enable Toggle */}
          <div className="flex items-center justify-between p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
            <div>
              <div className="font-medium">Enable {activeSection === "header" ? "Header" : "Footer"}</div>
              <div className="text-sm text-[--text-muted]">
                Show on every page of the document
              </div>
            </div>
            <button
              onClick={() => {
                if (activeSection === "header") {
                  updateHeader({ enabled: !localConfig.header.enabled });
                } else {
                  updateFooter({ enabled: !localConfig.footer.enabled });
                }
              }}
              className={`w-12 h-6 rounded-full transition-colors relative ${
                currentSection.enabled ? "bg-[--color-primary]" : "bg-[--bg-overlay]"
              }`}
            >
              <span
                className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                  currentSection.enabled ? "left-7" : "left-1"
                }`}
              />
            </button>
          </div>

          {currentSection.enabled && (
            <>
              {/* Logo Upload (Header only) */}
              {activeSection === "header" && (
                <div className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
                  <div className="flex items-center justify-between mb-3">
                    <div className="font-medium flex items-center gap-2">
                      <Image className="w-4 h-4" />
                      Logo
                    </div>
                    <button
                      onClick={() => updateHeader({ showLogo: !localConfig.header.showLogo })}
                      className={`w-12 h-6 rounded-full transition-colors relative ${
                        localConfig.header.showLogo ? "bg-[--color-primary]" : "bg-[--bg-overlay]"
                      }`}
                    >
                      <span
                        className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                          localConfig.header.showLogo ? "left-7" : "left-1"
                        }`}
                      />
                    </button>
                  </div>

                  {localConfig.header.showLogo && (
                    <div className="flex items-center gap-3">
                      {localConfig.header.logoUrl ? (
                        <div className="relative">
                          {/* eslint-disable-next-line @next/next/no-img-element */}
                          <img
                            src={localConfig.header.logoUrl}
                            alt="Logo preview"
                            className="h-12 object-contain rounded-lg border border-[--border-default]"
                          />
                          <button
                            onClick={() => updateHeader({ logoUrl: undefined })}
                            className="absolute -top-2 -right-2 p-1 rounded-full bg-red-500 text-white"
                          >
                            <Trash2 className="w-3 h-3" />
                          </button>
                        </div>
                      ) : (
                        <label className="flex items-center gap-2 px-4 py-2 rounded-xl bg-[--bg-overlay] border border-dashed border-[--border-default] cursor-pointer hover:border-[--color-primary] transition-colors">
                          <Upload className="w-4 h-4" />
                          <span className="text-sm">Upload Logo</span>
                          <input
                            type="file"
                            accept="image/*"
                            onChange={handleLogoUpload}
                            className="hidden"
                          />
                        </label>
                      )}
                    </div>
                  )}
                </div>
              )}

              {/* Content Fields */}
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <h3 className="font-medium">Content</h3>
                  <div className="flex gap-1">
                    {TOKENS.map((t) => (
                      <button
                        key={t.token}
                        onClick={() => insertToken(t.token, "center")}
                        className="px-2 py-1 rounded-lg bg-[--bg-overlay] text-xs flex items-center gap-1 hover:bg-[--border-default] transition-colors"
                        title={`Insert ${t.label}`}
                      >
                        {t.icon}
                        {t.token}
                      </button>
                    ))}
                  </div>
                </div>

                <div className="grid grid-cols-3 gap-3">
                  <div>
                    <label className="block text-sm text-[--text-muted] mb-1.5 flex items-center gap-1">
                      <AlignLeft className="w-3.5 h-3.5" />
                      Left
                    </label>
                    <input
                      type="text"
                      value={currentSection.left}
                      onChange={(e) => {
                        if (activeSection === "header") {
                          updateHeader({ left: e.target.value });
                        } else {
                          updateFooter({ left: e.target.value });
                        }
                      }}
                      className="w-full px-3 py-2 rounded-lg bg-[--bg-surface] border border-[--border-default] text-sm"
                      placeholder="Left content..."
                    />
                  </div>
                  <div>
                    <label className="block text-sm text-[--text-muted] mb-1.5 flex items-center gap-1">
                      <AlignCenter className="w-3.5 h-3.5" />
                      Center
                    </label>
                    <input
                      type="text"
                      value={currentSection.center}
                      onChange={(e) => {
                        if (activeSection === "header") {
                          updateHeader({ center: e.target.value });
                        } else {
                          updateFooter({ center: e.target.value });
                        }
                      }}
                      className="w-full px-3 py-2 rounded-lg bg-[--bg-surface] border border-[--border-default] text-sm"
                      placeholder="Center content..."
                    />
                  </div>
                  <div>
                    <label className="block text-sm text-[--text-muted] mb-1.5 flex items-center gap-1">
                      <AlignRight className="w-3.5 h-3.5" />
                      Right
                    </label>
                    <input
                      type="text"
                      value={currentSection.right}
                      onChange={(e) => {
                        if (activeSection === "header") {
                          updateHeader({ right: e.target.value });
                        } else {
                          updateFooter({ right: e.target.value });
                        }
                      }}
                      className="w-full px-3 py-2 rounded-lg bg-[--bg-surface] border border-[--border-default] text-sm"
                      placeholder="Right content..."
                    />
                  </div>
                </div>
              </div>

              {/* Height */}
              <div>
                <label className="block text-sm text-[--text-muted] mb-2">
                  Height: {currentSection.height}px
                </label>
                <input
                  type="range"
                  min="20"
                  max="100"
                  value={currentSection.height}
                  onChange={(e) => {
                    if (activeSection === "header") {
                      updateHeader({ height: Number(e.target.value) });
                    } else {
                      updateFooter({ height: Number(e.target.value) });
                    }
                  }}
                  className="w-full"
                />
              </div>
            </>
          )}

          {/* Preview */}
          <div className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
            <div className="flex items-center justify-between mb-3">
              <div className="font-medium flex items-center gap-2">
                <Eye className="w-4 h-4" />
                Preview
              </div>
            </div>
            <div className="bg-white rounded-lg p-4 text-black text-xs">
              {/* Header Preview */}
              {localConfig.header.enabled && (
                <div
                  className="border-b border-gray-200 pb-2 mb-4 flex items-center justify-between"
                  style={{ minHeight: `${localConfig.header.height / 2}px` }}
                >
                  <div>{localConfig.header.left || <span className="text-gray-300">Left</span>}</div>
                  <div>{localConfig.header.center || <span className="text-gray-300">Center</span>}</div>
                  <div>{localConfig.header.right || <span className="text-gray-300">Right</span>}</div>
                </div>
              )}
              
              {/* Document Body Placeholder */}
              <div className="h-20 flex items-center justify-center text-gray-400 border border-dashed border-gray-200 rounded">
                Document Content
              </div>

              {/* Footer Preview */}
              {localConfig.footer.enabled && (
                <div
                  className="border-t border-gray-200 pt-2 mt-4 flex items-center justify-between"
                  style={{ minHeight: `${localConfig.footer.height / 2}px` }}
                >
                  <div>{localConfig.footer.left || <span className="text-gray-300">Left</span>}</div>
                  <div>{localConfig.footer.center || <span className="text-gray-300">Page 1 of 1</span>}</div>
                  <div>{localConfig.footer.right || <span className="text-gray-300">Right</span>}</div>
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="p-6 border-t border-[--border-default] flex gap-3">
          <button
            onClick={() => setLocalConfig(DEFAULT_HEADER_FOOTER_CONFIG)}
            className="px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] font-medium hover:bg-[--bg-overlay] transition-colors"
          >
            Reset
          </button>
          <button
            onClick={onClose}
            className="flex-1 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] font-medium hover:bg-[--bg-overlay] transition-colors"
          >
            Cancel
          </button>
          <button
            onClick={handleSave}
            className="flex-1 py-3 rounded-xl bg-[--color-primary] text-white font-semibold hover:bg-[--color-primary-hover] transition-colors"
          >
            Save Changes
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/PDFImport.tsx">
"use client";

import { useState, useRef } from "react";

interface PDFImportProps {
  isOpen: boolean;
  onClose: () => void;
  onImport: (text: string) => void;
}

export default function PDFImport({ isOpen, onClose, onImport }: PDFImportProps) {
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [extractedText, setExtractedText] = useState("");
  const [fileName, setFileName] = useState("");
  const fileInputRef = useRef<HTMLInputElement>(null);

  const extractTextFromPDF = async (file: File): Promise<string> => {
    try {
      const pdfjsLib = await import("pdfjs-dist");
      const PDFJS_VERSION = "4.0.379";
      pdfjsLib.GlobalWorkerOptions.workerSrc = `https://unpkg.com/pdfjs-dist@${PDFJS_VERSION}/build/pdf.worker.min.mjs`;

      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      
      let fullText = "";
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        const pageText = content.items
          .map((item: unknown) => {
            const textItem = item as { str?: string };
            return textItem.str || "";
          })
          .join(" ");
        fullText += pageText + "\n\n";
      }
      
      return fullText.trim();
    } catch (err) {
      console.error("PDF extraction error:", err);
      throw new Error("Failed to extract text from PDF. The file may be image-based or corrupted.");
    }
  };

  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;
    
    setError(null);
    setIsLoading(true);
    setFileName(file.name);
    
    try {
      if (file.type === "application/pdf") {
        const text = await extractTextFromPDF(file);
        if (!text.trim()) {
          throw new Error("No text could be extracted. The PDF may contain only images.");
        }
        setExtractedText(text);
      } else if (file.name.endsWith(".docx")) {
        const mammoth = await import("mammoth");
        const arrayBuffer = await file.arrayBuffer();
        const result = await mammoth.extractRawText({ arrayBuffer });
        setExtractedText(result.value);
      } else if (file.name.endsWith(".txt")) {
        const text = await file.text();
        setExtractedText(text);
      } else {
        throw new Error("Unsupported file type. Please use PDF, DOCX, or TXT files.");
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : "Failed to process file");
      setExtractedText("");
    } finally {
      setIsLoading(false);
    }
  };

  const handleImport = () => {
    if (extractedText) {
      onImport(extractedText);
      onClose();
      // Reset state
      setExtractedText("");
      setFileName("");
      setError(null);
    }
  };

  const handleClose = () => {
    onClose();
    setExtractedText("");
    setFileName("");
    setError(null);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
      <div className="bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col">
        <div className="p-5 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <h2 className="text-lg font-semibold text-[--text-primary]">Import Document</h2>
            <button onClick={handleClose} className="text-[--text-muted] hover:text-[--text-primary]">‚úï</button>
          </div>
          <p className="text-sm text-[--text-muted] mt-1">
            Import text from PDF, Word, or text files
          </p>
        </div>

        <div className="flex-1 overflow-y-auto p-5">
          {/* File Upload */}
          <div className="text-center p-8 border-2 border-dashed border-[--border-default] rounded-xl mb-4">
            <input
              ref={fileInputRef}
              type="file"
              accept=".pdf,.docx,.txt"
              onChange={handleFileUpload}
              className="hidden"
            />
            <button
              onClick={() => fileInputRef.current?.click()}
              disabled={isLoading}
              className="px-6 py-3 rounded-lg bg-[--color-primary] text-white hover:opacity-90 disabled:opacity-50 mb-3"
            >
              {isLoading ? "Processing..." : "Choose File"}
            </button>
            <p className="text-sm text-[--text-muted]">
              Supports PDF, DOCX, and TXT files
            </p>
          </div>

          {/* Error message */}
          {error && (
            <div className="p-4 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 mb-4">
              {error}
            </div>
          )}

          {/* Loading state */}
          {isLoading && (
            <div className="p-8 text-center">
              <div className="inline-block w-8 h-8 border-2 border-[--color-primary] border-t-transparent rounded-full animate-spin mb-4" />
              <p className="text-[--text-muted]">Extracting text...</p>
            </div>
          )}

          {/* Extracted text preview */}
          {extractedText && (
            <div>
              <div className="flex items-center justify-between mb-2">
                <h3 className="text-sm font-medium text-[--text-secondary]">
                  Extracted from: {fileName}
                </h3>
                <span className="text-xs text-[--text-muted]">
                  {extractedText.length.toLocaleString()} characters
                </span>
              </div>
              <textarea
                value={extractedText}
                onChange={(e) => setExtractedText(e.target.value)}
                rows={12}
                className="w-full px-4 py-3 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm resize-none"
                placeholder="Extracted text will appear here..."
              />
              <p className="text-xs text-[--text-muted] mt-2">
                You can edit the text above before importing
              </p>
            </div>
          )}
        </div>

        <div className="p-5 border-t border-[--border-default] flex gap-3">
          <button
            onClick={handleClose}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:bg-[--bg-overlay]"
          >
            Cancel
          </button>
          <button
            onClick={handleImport}
            disabled={!extractedText}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--color-primary] text-white hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Import to Document
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/PDFThemes.tsx">
"use client";

import { useState, useEffect } from "react";

export interface PDFTheme {
  id: string;
  name: string;
  fontFamily: string;
  fontSize: number;
  lineHeight: number;
  headerStyle: "classic" | "modern" | "minimal" | "bold";
  accentColor: string;
  paperStyle: "white" | "cream" | "blue-tint";
}

const PRESET_THEMES: PDFTheme[] = [
  {
    id: "classic",
    name: "Classic",
    fontFamily: "Times New Roman",
    fontSize: 12,
    lineHeight: 1.5,
    headerStyle: "classic",
    accentColor: "#1a1a1a",
    paperStyle: "white",
  },
  {
    id: "modern",
    name: "Modern",
    fontFamily: "Helvetica",
    fontSize: 11,
    lineHeight: 1.6,
    headerStyle: "modern",
    accentColor: "#3b82f6",
    paperStyle: "white",
  },
  {
    id: "elegant",
    name: "Elegant",
    fontFamily: "Georgia",
    fontSize: 11,
    lineHeight: 1.7,
    headerStyle: "minimal",
    accentColor: "#6b7280",
    paperStyle: "cream",
  },
  {
    id: "professional",
    name: "Professional",
    fontFamily: "Arial",
    fontSize: 11,
    lineHeight: 1.5,
    headerStyle: "bold",
    accentColor: "#1e40af",
    paperStyle: "white",
  },
  {
    id: "creative",
    name: "Creative",
    fontFamily: "Verdana",
    fontSize: 10,
    lineHeight: 1.6,
    headerStyle: "modern",
    accentColor: "#8b5cf6",
    paperStyle: "blue-tint",
  },
  {
    id: "legal",
    name: "Legal",
    fontFamily: "Times New Roman",
    fontSize: 12,
    lineHeight: 2.0,
    headerStyle: "classic",
    accentColor: "#1a1a1a",
    paperStyle: "white",
  },
];

interface PDFThemesProps {
  isOpen: boolean;
  onClose: () => void;
  selectedTheme: PDFTheme;
  onThemeChange: (theme: PDFTheme) => void;
}

export function usePDFThemes() {
  const [selectedTheme, setSelectedTheme] = useState<PDFTheme>(PRESET_THEMES[0]);
  const [customThemes, setCustomThemes] = useState<PDFTheme[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const savedTheme = localStorage.getItem("selectedPDFTheme");
    const savedCustom = localStorage.getItem("customPDFThemes");
    
    if (savedTheme) {
      try {
        setSelectedTheme(JSON.parse(savedTheme));
      } catch (e) {
        console.error("Error loading theme:", e);
      }
    }
    
    if (savedCustom) {
      try {
        setCustomThemes(JSON.parse(savedCustom));
      } catch (e) {
        console.error("Error loading custom themes:", e);
      }
    }
  }, []);

  const selectTheme = (theme: PDFTheme) => {
    setSelectedTheme(theme);
    localStorage.setItem("selectedPDFTheme", JSON.stringify(theme));
  };

  const saveCustomTheme = (theme: PDFTheme) => {
    const updated = [...customThemes, { ...theme, id: `custom-${Date.now()}` }];
    setCustomThemes(updated);
    localStorage.setItem("customPDFThemes", JSON.stringify(updated));
  };

  const deleteCustomTheme = (id: string) => {
    const updated = customThemes.filter(t => t.id !== id);
    setCustomThemes(updated);
    localStorage.setItem("customPDFThemes", JSON.stringify(updated));
  };

  return { selectedTheme, selectTheme, customThemes, saveCustomTheme, deleteCustomTheme, allThemes: [...PRESET_THEMES, ...customThemes], mounted };
}

export default function PDFThemes({ isOpen, onClose, selectedTheme, onThemeChange }: PDFThemesProps) {
  const { allThemes, saveCustomTheme, deleteCustomTheme } = usePDFThemes();
  const [showCustomize, setShowCustomize] = useState(false);
  const [customTheme, setCustomTheme] = useState<PDFTheme>(selectedTheme);

  if (!isOpen) return null;

  const handleSaveCustom = () => {
    const theme = { ...customTheme, id: `custom-${Date.now()}`, name: customTheme.name || "Custom Theme" };
    saveCustomTheme(theme);
    onThemeChange(theme);
    setShowCustomize(false);
  };

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-3xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üé® PDF Themes</h2>
          <div className="flex items-center gap-2">
            <button
              onClick={() => setShowCustomize(!showCustomize)}
              className="px-3 py-1.5 rounded-lg text-sm text-[#a78bfa] hover:bg-[#a78bfa]/10 transition-colors"
            >
              {showCustomize ? "View Themes" : "Customize"}
            </button>
            <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
          </div>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {showCustomize ? (
            /* Custom Theme Editor */
            <div className="space-y-6">
              <div>
                <label className="block text-sm text-[#a0a0a0] mb-2">Theme Name</label>
                <input
                  type="text"
                  value={customTheme.name}
                  onChange={(e) => setCustomTheme({ ...customTheme, name: e.target.value })}
                  placeholder="My Custom Theme"
                  className="w-full px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Font Family</label>
                  <select
                    value={customTheme.fontFamily}
                    onChange={(e) => setCustomTheme({ ...customTheme, fontFamily: e.target.value })}
                    className="w-full px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                  >
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Courier New">Courier New</option>
                  </select>
                </div>

                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Font Size: {customTheme.fontSize}pt</label>
                  <input
                    type="range"
                    min="9"
                    max="14"
                    value={customTheme.fontSize}
                    onChange={(e) => setCustomTheme({ ...customTheme, fontSize: parseInt(e.target.value) })}
                    className="w-full"
                  />
                </div>

                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Line Height: {customTheme.lineHeight.toFixed(1)}</label>
                  <input
                    type="range"
                    min="1"
                    max="2.5"
                    step="0.1"
                    value={customTheme.lineHeight}
                    onChange={(e) => setCustomTheme({ ...customTheme, lineHeight: parseFloat(e.target.value) })}
                    className="w-full"
                  />
                </div>

                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Header Style</label>
                  <select
                    value={customTheme.headerStyle}
                    onChange={(e) => setCustomTheme({ ...customTheme, headerStyle: e.target.value as PDFTheme["headerStyle"] })}
                    className="w-full px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                  >
                    <option value="classic">Classic</option>
                    <option value="modern">Modern</option>
                    <option value="minimal">Minimal</option>
                    <option value="bold">Bold</option>
                  </select>
                </div>

                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Accent Color</label>
                  <input
                    type="color"
                    value={customTheme.accentColor}
                    onChange={(e) => setCustomTheme({ ...customTheme, accentColor: e.target.value })}
                    className="w-full h-10 rounded-lg cursor-pointer"
                  />
                </div>

                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Paper Style</label>
                  <select
                    value={customTheme.paperStyle}
                    onChange={(e) => setCustomTheme({ ...customTheme, paperStyle: e.target.value as PDFTheme["paperStyle"] })}
                    className="w-full px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                  >
                    <option value="white">White</option>
                    <option value="cream">Cream</option>
                    <option value="blue-tint">Blue Tint</option>
                  </select>
                </div>
              </div>

              <button
                onClick={handleSaveCustom}
                className="w-full px-4 py-3 rounded-lg bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white hover:opacity-90"
              >
                Save Custom Theme
              </button>
            </div>
          ) : (
            /* Theme Grid */
            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
              {allThemes.map(theme => (
                <button
                  key={theme.id}
                  onClick={() => onThemeChange(theme)}
                  className={`p-4 rounded-xl border-2 transition-all text-left ${
                    selectedTheme.id === theme.id
                      ? "border-[#a78bfa] bg-[#a78bfa]/10"
                      : "border-[#2a2a3a] hover:border-[#3a3a4a]"
                  }`}
                >
                  {/* Preview */}
                  <div 
                    className="mb-3 p-3 rounded-lg text-xs"
                    style={{ 
                      backgroundColor: theme.paperStyle === "cream" ? "#f5f5dc" : theme.paperStyle === "blue-tint" ? "#f0f8ff" : "#fff",
                      fontFamily: theme.fontFamily,
                      color: "#1a1a1a",
                      lineHeight: theme.lineHeight,
                    }}
                  >
                    <div className="font-bold mb-1" style={{ color: theme.accentColor }}>Sample Header</div>
                    <div style={{ fontSize: `${theme.fontSize * 0.6}px` }}>Lorem ipsum dolor sit amet...</div>
                  </div>

                  <div className="flex items-center justify-between">
                    <span className="text-white font-medium">{theme.name}</span>
                    {theme.id.startsWith("custom-") && (
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          deleteCustomTheme(theme.id);
                        }}
                        className="text-[#f87171] hover:text-[#fca5a5] text-xs"
                      >
                        Delete
                      </button>
                    )}
                  </div>
                  <div className="text-xs text-[#666680] mt-1">
                    {theme.fontFamily} ‚Ä¢ {theme.fontSize}pt
                  </div>
                </button>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

export { PRESET_THEMES };
</file>

<file path="src/components/PomodoroTimer.tsx">
"use client";

import { useState, useEffect, useCallback } from "react";

interface PomodoroTimerProps {
  minutes: number;
  isEnabled: boolean;
  onComplete: () => void;
  soundEnabled: boolean;
}

export default function PomodoroTimer({ minutes, isEnabled, onComplete, soundEnabled }: PomodoroTimerProps) {
  const [timeLeft, setTimeLeft] = useState(minutes * 60);
  const [isRunning, setIsRunning] = useState(false);
  const [isBreak, setIsBreak] = useState(false);

  const playSound = useCallback((type: "complete" | "start" | "tick") => {
    if (!soundEnabled) return;
    
    // Create audio context for simple beeps
    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    if (type === "complete") {
      oscillator.frequency.value = 880; // A5 note
      gainNode.gain.value = 0.3;
      oscillator.start();
      setTimeout(() => {
        oscillator.frequency.value = 1046.5; // C6 note
      }, 150);
      setTimeout(() => {
        oscillator.stop();
        audioContext.close();
      }, 300);
    } else if (type === "start") {
      oscillator.frequency.value = 523.25; // C5 note
      gainNode.gain.value = 0.2;
      oscillator.start();
      setTimeout(() => {
        oscillator.stop();
        audioContext.close();
      }, 100);
    }
  }, [soundEnabled]);

  useEffect(() => {
    if (!isEnabled) {
      setIsRunning(false);
      setTimeLeft(minutes * 60);
      return;
    }
  }, [isEnabled, minutes]);

  useEffect(() => {
    if (!isRunning || !isEnabled) return;

    const interval = setInterval(() => {
      setTimeLeft((prev) => {
        if (prev <= 1) {
          playSound("complete");
          if (isBreak) {
            setIsBreak(false);
            setIsRunning(false);
            onComplete();
            return minutes * 60;
          } else {
            // Start 5 min break
            setIsBreak(true);
            return 5 * 60;
          }
        }
        return prev - 1;
      });
    }, 1000);

    return () => clearInterval(interval);
  }, [isRunning, isEnabled, isBreak, minutes, onComplete, playSound]);

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
  };

  const progress = isBreak 
    ? ((5 * 60 - timeLeft) / (5 * 60)) * 100
    : ((minutes * 60 - timeLeft) / (minutes * 60)) * 100;

  const handleStart = () => {
    playSound("start");
    setIsRunning(true);
  };

  const handlePause = () => {
    setIsRunning(false);
  };

  const handleReset = () => {
    setIsRunning(false);
    setIsBreak(false);
    setTimeLeft(minutes * 60);
  };

  if (!isEnabled) return null;

  return (
    <div className="fixed bottom-4 right-4 z-40">
      <div className={`p-4 rounded-xl backdrop-blur-md border shadow-lg ${
        isBreak 
          ? "bg-[#4ecdc4]/20 border-[#4ecdc4]/30 shadow-[#4ecdc4]/20" 
          : "bg-[#f87171]/20 border-[#f87171]/30 shadow-[#f87171]/20"
      }`}>
        <div className="flex items-center gap-3">
          {/* Progress Ring */}
          <div className="relative w-16 h-16">
            <svg className="w-16 h-16 transform -rotate-90">
              <circle
                cx="32"
                cy="32"
                r="28"
                className="fill-none stroke-[#2a2a3a]"
                strokeWidth="4"
              />
              <circle
                cx="32"
                cy="32"
                r="28"
                className={`fill-none ${isBreak ? "stroke-[#4ecdc4]" : "stroke-[#f87171]"}`}
                strokeWidth="4"
                strokeLinecap="round"
                strokeDasharray={`${2 * Math.PI * 28}`}
                strokeDashoffset={`${2 * Math.PI * 28 * (1 - progress / 100)}`}
                style={{ transition: "stroke-dashoffset 0.5s" }}
              />
            </svg>
            <div className="absolute inset-0 flex items-center justify-center">
              <span className="text-white text-sm font-mono">{formatTime(timeLeft)}</span>
            </div>
          </div>

          {/* Controls */}
          <div className="flex flex-col gap-1">
            <span className={`text-xs font-medium ${isBreak ? "text-[#4ecdc4]" : "text-[#f87171]"}`}>
              {isBreak ? "‚òï Break Time" : "üçÖ Focus"}
            </span>
            <div className="flex gap-1">
              {!isRunning ? (
                <button
                  onClick={handleStart}
                  className={`px-2 py-1 rounded text-xs text-white transition-colors ${
                    isBreak ? "bg-[#4ecdc4] hover:bg-[#3dbdb5]" : "bg-[#f87171] hover:bg-[#ef4444]"
                  }`}
                >
                  Start
                </button>
              ) : (
                <button
                  onClick={handlePause}
                  className="px-2 py-1 rounded text-xs bg-[#3a3a4a] text-white hover:bg-[#4a4a5a] transition-colors"
                >
                  Pause
                </button>
              )}
              <button
                onClick={handleReset}
                className="px-2 py-1 rounded text-xs bg-[#2a2a3a] text-[#a0a0a0] hover:bg-[#3a3a4a] transition-colors"
              >
                Reset
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/ProfileManager.tsx">
"use client";

import { useState, useEffect } from "react";

export interface SenderProfile {
  id: string;
  name: string;
  title: string;
  company: string;
  phone: string;
  email: string;
  isDefault: boolean;
}

export interface RecipientProfile {
  id: string;
  name: string;
  title: string;
  address: string;
  company: string;
}

interface ProfileManagerProps {
  isOpen: boolean;
  onClose: () => void;
  onSelectSender: (profile: SenderProfile) => void;
  onSelectRecipient: (profile: RecipientProfile) => void;
}

export function useProfiles() {
  const [senderProfiles, setSenderProfiles] = useState<SenderProfile[]>([]);
  const [recipientProfiles, setRecipientProfiles] = useState<RecipientProfile[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const savedSenders = localStorage.getItem("senderProfiles");
    const savedRecipients = localStorage.getItem("recipientProfiles");
    
    if (savedSenders) {
      try {
        setSenderProfiles(JSON.parse(savedSenders));
      } catch (e) {
        console.error("Error loading sender profiles:", e);
      }
    }
    
    if (savedRecipients) {
      try {
        setRecipientProfiles(JSON.parse(savedRecipients));
      } catch (e) {
        console.error("Error loading recipient profiles:", e);
      }
    }
  }, []);

  const saveSenderProfile = (profile: Omit<SenderProfile, "id">) => {
    const newProfile = { ...profile, id: `sender-${Date.now()}` };
    const updated = [...senderProfiles, newProfile];
    setSenderProfiles(updated);
    localStorage.setItem("senderProfiles", JSON.stringify(updated));
    return newProfile;
  };

  const saveRecipientProfile = (profile: Omit<RecipientProfile, "id">) => {
    const newProfile = { ...profile, id: `recipient-${Date.now()}` };
    const updated = [...recipientProfiles, newProfile];
    setRecipientProfiles(updated);
    localStorage.setItem("recipientProfiles", JSON.stringify(updated));
    return newProfile;
  };

  const deleteSenderProfile = (id: string) => {
    const updated = senderProfiles.filter((p) => p.id !== id);
    setSenderProfiles(updated);
    localStorage.setItem("senderProfiles", JSON.stringify(updated));
  };

  const deleteRecipientProfile = (id: string) => {
    const updated = recipientProfiles.filter((p) => p.id !== id);
    setRecipientProfiles(updated);
    localStorage.setItem("recipientProfiles", JSON.stringify(updated));
  };

  const setDefaultSender = (id: string) => {
    const updated = senderProfiles.map((p) => ({ ...p, isDefault: p.id === id }));
    setSenderProfiles(updated);
    localStorage.setItem("senderProfiles", JSON.stringify(updated));
  };

  const getDefaultSender = () => senderProfiles.find((p) => p.isDefault);

  return {
    senderProfiles,
    recipientProfiles,
    saveSenderProfile,
    saveRecipientProfile,
    deleteSenderProfile,
    deleteRecipientProfile,
    setDefaultSender,
    getDefaultSender,
    mounted,
  };
}

export default function ProfileManager({ isOpen, onClose, onSelectSender, onSelectRecipient }: ProfileManagerProps) {
  const { senderProfiles, recipientProfiles, saveSenderProfile, saveRecipientProfile, deleteSenderProfile, deleteRecipientProfile, setDefaultSender } = useProfiles();
  const [activeTab, setActiveTab] = useState<"sender" | "recipient">("sender");
  const [showForm, setShowForm] = useState(false);
  
  // Form state
  const [formData, setFormData] = useState({
    name: "",
    title: "",
    company: "",
    phone: "",
    email: "",
    address: "",
  });

  const handleSave = () => {
    if (!formData.name.trim()) return;

    if (activeTab === "sender") {
      saveSenderProfile({
        name: formData.name,
        title: formData.title,
        company: formData.company,
        phone: formData.phone,
        email: formData.email,
        isDefault: senderProfiles.length === 0,
      });
    } else {
      saveRecipientProfile({
        name: formData.name,
        title: formData.title,
        company: formData.company,
        address: formData.address,
      });
    }
    
    setFormData({ name: "", title: "", company: "", phone: "", email: "", address: "" });
    setShowForm(false);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-2xl w-full max-h-[80vh] flex flex-col border border-[#2a2a3a] shadow-2xl shadow-[#a78bfa]/10">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">Profiles</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white transition-colors text-2xl">√ó</button>
        </div>

        {/* Tabs */}
        <div className="flex gap-2 p-2 border-b border-[#2a2a3a]">
          <button
            onClick={() => { setActiveTab("sender"); setShowForm(false); }}
            className={`px-4 py-2 rounded-lg text-sm transition-all ${
              activeTab === "sender"
                ? "bg-[#a78bfa] text-white"
                : "text-[#666680] hover:text-white hover:bg-[#1a1a24]"
            }`}
          >
            üë§ Sender Profiles
          </button>
          <button
            onClick={() => { setActiveTab("recipient"); setShowForm(false); }}
            className={`px-4 py-2 rounded-lg text-sm transition-all ${
              activeTab === "recipient"
                ? "bg-[#4ecdc4] text-white"
                : "text-[#666680] hover:text-white hover:bg-[#1a1a24]"
            }`}
          >
            üì¨ Recipient Profiles
          </button>
          <div className="flex-1" />
          <button
            onClick={() => setShowForm(!showForm)}
            className="px-4 py-2 rounded-lg text-sm bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white"
          >
            + Add New
          </button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-4">
          {showForm ? (
            <div className="max-w-md mx-auto space-y-4">
              <h3 className="text-white mb-4">New {activeTab === "sender" ? "Sender" : "Recipient"} Profile</h3>
              <input
                type="text"
                value={formData.name}
                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                placeholder="Name *"
                className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
              />
              <input
                type="text"
                value={formData.title}
                onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                placeholder="Title"
                className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
              />
              <input
                type="text"
                value={formData.company}
                onChange={(e) => setFormData({ ...formData, company: e.target.value })}
                placeholder="Company"
                className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
              />
              {activeTab === "sender" ? (
                <>
                  <input
                    type="text"
                    value={formData.phone}
                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                    placeholder="Phone"
                    className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                  />
                  <input
                    type="email"
                    value={formData.email}
                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                    placeholder="Email"
                    className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                  />
                </>
              ) : (
                <textarea
                  value={formData.address}
                  onChange={(e) => setFormData({ ...formData, address: e.target.value })}
                  placeholder="Address"
                  rows={3}
                  className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white resize-none"
                />
              )}
              <div className="flex gap-2">
                <button
                  onClick={handleSave}
                  className="flex-1 px-4 py-2.5 rounded-lg bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white"
                >
                  Save Profile
                </button>
                <button
                  onClick={() => setShowForm(false)}
                  className="px-4 py-2.5 rounded-lg bg-[#2a2a3a] text-[#a0a0a0]"
                >
                  Cancel
                </button>
              </div>
            </div>
          ) : (
            <div className="grid grid-cols-2 gap-3">
              {activeTab === "sender" ? (
                senderProfiles.length === 0 ? (
                  <div className="col-span-2 text-center py-12 text-[#666680]">
                    No sender profiles yet. Create one to auto-fill your details!
                  </div>
                ) : (
                  senderProfiles.map((profile) => (
                    <div
                      key={profile.id}
                      className={`p-4 rounded-xl border transition-all ${
                        profile.isDefault
                          ? "bg-[#a78bfa]/10 border-[#a78bfa]/30"
                          : "bg-[#1a1a24] border-[#2a2a3a] hover:border-[#3a3a4a]"
                      }`}
                    >
                      <div className="flex items-start justify-between mb-2">
                        <div>
                          <div className="text-white font-medium">{profile.name}</div>
                          <div className="text-sm text-[#666680]">{profile.title}</div>
                        </div>
                        {profile.isDefault && (
                          <span className="text-xs px-2 py-0.5 rounded-full bg-[#a78bfa] text-white">Default</span>
                        )}
                      </div>
                      <div className="text-xs text-[#666680] mb-3">
                        {profile.company && <div>{profile.company}</div>}
                        {profile.email && <div>{profile.email}</div>}
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={() => {
                            onSelectSender(profile);
                            onClose();
                          }}
                          className="flex-1 px-3 py-1.5 rounded text-xs bg-[#a78bfa] text-white hover:bg-[#9575f0]"
                        >
                          Use
                        </button>
                        {!profile.isDefault && (
                          <button
                            onClick={() => setDefaultSender(profile.id)}
                            className="px-3 py-1.5 rounded text-xs bg-[#2a2a3a] text-[#a0a0a0] hover:bg-[#3a3a4a]"
                          >
                            Set Default
                          </button>
                        )}
                        <button
                          onClick={() => deleteSenderProfile(profile.id)}
                          className="px-3 py-1.5 rounded text-xs text-[#f87171] hover:bg-[#f87171]/10"
                        >
                          √ó
                        </button>
                      </div>
                    </div>
                  ))
                )
              ) : (
                recipientProfiles.length === 0 ? (
                  <div className="col-span-2 text-center py-12 text-[#666680]">
                    No recipient profiles yet. Save frequent recipients for quick access!
                  </div>
                ) : (
                  recipientProfiles.map((profile) => (
                    <div
                      key={profile.id}
                      className="p-4 rounded-xl bg-[#1a1a24] border border-[#2a2a3a] hover:border-[#3a3a4a] transition-all"
                    >
                      <div className="mb-2">
                        <div className="text-white font-medium">{profile.name}</div>
                        <div className="text-sm text-[#666680]">{profile.title}</div>
                      </div>
                      <div className="text-xs text-[#666680] mb-3">
                        {profile.company && <div>{profile.company}</div>}
                        {profile.address && <div className="truncate">{profile.address}</div>}
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={() => {
                            onSelectRecipient(profile);
                            onClose();
                          }}
                          className="flex-1 px-3 py-1.5 rounded text-xs bg-[#4ecdc4] text-[#0a0a12] hover:bg-[#3dbdb5]"
                        >
                          Use
                        </button>
                        <button
                          onClick={() => deleteRecipientProfile(profile.id)}
                          className="px-3 py-1.5 rounded text-xs text-[#f87171] hover:bg-[#f87171]/10"
                        >
                          √ó
                        </button>
                      </div>
                    </div>
                  ))
                )
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Providers.tsx">
"use client";

import { SessionProvider } from "next-auth/react";
import { ThemeProvider } from "@/contexts/ThemeContext";

interface ProvidersProps {
  children: React.ReactNode;
}

export default function Providers({ children }: ProvidersProps) {
  return (
    <SessionProvider>
      <ThemeProvider>{children}</ThemeProvider>
    </SessionProvider>
  );
}
</file>

<file path="src/components/PWAInstallPrompt.tsx">
"use client";

import { useState, useEffect } from "react";
import { X, Download, Smartphone, Monitor, Check } from "lucide-react";

interface BeforeInstallPromptEvent extends Event {
  prompt: () => Promise<void>;
  userChoice: Promise<{ outcome: "accepted" | "dismissed" }>;
}

export default function PWAInstallPrompt() {
  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);
  const [showPrompt, setShowPrompt] = useState(false);
  const [isInstalled, setIsInstalled] = useState(false);
  const [dismissed, setDismissed] = useState(false);

  useEffect(() => {
    // Check if already installed
    if (typeof window !== "undefined") {
      const isStandalone = window.matchMedia("(display-mode: standalone)").matches;
      setIsInstalled(isStandalone);

      // Check if previously dismissed
      const wasDismissed = localStorage.getItem("pwaPromptDismissed");
      if (wasDismissed) {
        const dismissedDate = new Date(wasDismissed);
        const daysSinceDismissed = (Date.now() - dismissedDate.getTime()) / (1000 * 60 * 60 * 24);
        if (daysSinceDismissed < 7) {
          setDismissed(true);
        }
      }
    }

    // Listen for install prompt
    const handleBeforeInstallPrompt = (e: Event) => {
      e.preventDefault();
      setDeferredPrompt(e as BeforeInstallPromptEvent);
      // Show prompt after a delay
      setTimeout(() => {
        if (!dismissed) setShowPrompt(true);
      }, 3000);
    };

    // Listen for successful install
    const handleAppInstalled = () => {
      setIsInstalled(true);
      setShowPrompt(false);
      setDeferredPrompt(null);
    };

    window.addEventListener("beforeinstallprompt", handleBeforeInstallPrompt);
    window.addEventListener("appinstalled", handleAppInstalled);

    return () => {
      window.removeEventListener("beforeinstallprompt", handleBeforeInstallPrompt);
      window.removeEventListener("appinstalled", handleAppInstalled);
    };
  }, [dismissed]);

  const handleInstall = async () => {
    if (!deferredPrompt) return;

    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;

    if (outcome === "accepted") {
      setIsInstalled(true);
    }

    setDeferredPrompt(null);
    setShowPrompt(false);
  };

  const handleDismiss = () => {
    setShowPrompt(false);
    setDismissed(true);
    localStorage.setItem("pwaPromptDismissed", new Date().toISOString());
  };

  if (!showPrompt || isInstalled || !deferredPrompt) return null;

  return (
    <div className="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden z-50 animate-slide-up">
      {/* Gradient accent */}
      <div className="h-1 bg-gradient-to-r from-[--color-primary] to-[--color-accent]" />

      <div className="p-5">
        <div className="flex items-start gap-4">
          <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-[--color-primary] to-[--color-accent] flex items-center justify-center flex-shrink-0">
            <Download className="w-6 h-6 text-white" />
          </div>

          <div className="flex-1 min-w-0">
            <h3 className="font-semibold mb-1">Install DocGen</h3>
            <p className="text-sm text-[--text-muted] mb-3">
              Add to your home screen for quick access and offline support.
            </p>

            <div className="flex items-center gap-2 text-xs text-[--text-muted] mb-4">
              <div className="flex items-center gap-1">
                <Monitor className="w-3.5 h-3.5" />
                Desktop
              </div>
              <span>‚Ä¢</span>
              <div className="flex items-center gap-1">
                <Smartphone className="w-3.5 h-3.5" />
                Mobile
              </div>
            </div>

            <div className="flex gap-2">
              <button
                onClick={handleInstall}
                className="flex-1 py-2.5 rounded-xl bg-[--color-primary] text-white font-medium hover:bg-[--color-primary-hover] transition-colors flex items-center justify-center gap-2"
              >
                <Download className="w-4 h-4" />
                Install
              </button>
              <button
                onClick={handleDismiss}
                className="px-4 py-2.5 rounded-xl bg-[--bg-elevated] border border-[--border-default] font-medium hover:bg-[--bg-overlay] transition-colors"
              >
                Later
              </button>
            </div>
          </div>

          <button
            onClick={handleDismiss}
            className="p-1 rounded-lg hover:bg-[--bg-elevated] transition-colors"
          >
            <X className="w-4 h-4 text-[--text-muted]" />
          </button>
        </div>
      </div>
    </div>
  );
}

// Hook for service worker registration
export function useServiceWorker() {
  const [isReady, setIsReady] = useState(false);
  const [updateAvailable, setUpdateAvailable] = useState(false);

  useEffect(() => {
    if (typeof window !== "undefined" && "serviceWorker" in navigator) {
      navigator.serviceWorker
        .register("/sw.js")
        .then((registration) => {
          console.log("Service Worker registered:", registration);
          setIsReady(true);

          // Check for updates
          registration.addEventListener("updatefound", () => {
            const newWorker = registration.installing;
            if (newWorker) {
              newWorker.addEventListener("statechange", () => {
                if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
                  setUpdateAvailable(true);
                }
              });
            }
          });
        })
        .catch((error) => {
          console.error("Service Worker registration failed:", error);
        });
    }
  }, []);

  const update = () => {
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.getRegistration().then((registration) => {
        registration?.update();
        window.location.reload();
      });
    }
  };

  return { isReady, updateAvailable, update };
}
</file>

<file path="src/components/QuickDuplicate.tsx">
"use client";

import { useState, useEffect } from "react";
import { DocumentHistoryItem, getHistory } from "@/utils/documentHistory";

interface QuickDuplicateProps {
  isOpen: boolean;
  onClose: () => void;
  onDuplicate: (doc: DocumentHistoryItem, newRecipient: { name: string; title: string; address: string }) => void;
}

export default function QuickDuplicate({ isOpen, onClose, onDuplicate }: QuickDuplicateProps) {
  const [history, setHistory] = useState<DocumentHistoryItem[]>([]);
  const [selectedDoc, setSelectedDoc] = useState<DocumentHistoryItem | null>(null);
  const [newRecipient, setNewRecipient] = useState({ name: "", title: "", address: "" });
  const [search, setSearch] = useState("");

  useEffect(() => {
    if (isOpen) {
      setHistory(getHistory());
      setSelectedDoc(null);
      setNewRecipient({ name: "", title: "", address: "" });
    }
  }, [isOpen]);

  const filteredHistory = history.filter(doc => 
    doc.documentType.toLowerCase().includes(search.toLowerCase()) ||
    doc.recipientName?.toLowerCase().includes(search.toLowerCase()) ||
    doc.bodyText?.toLowerCase().includes(search.toLowerCase())
  );

  const handleDuplicate = () => {
    if (selectedDoc) {
      onDuplicate(selectedDoc, newRecipient);
      onClose();
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
      <div className="bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col">
        <div className="p-5 border-b border-[--border-default]">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-lg font-semibold text-[--text-primary]">Quick Duplicate</h2>
            <button onClick={onClose} className="text-[--text-muted] hover:text-[--text-primary]">‚úï</button>
          </div>
          <input
            type="text"
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            placeholder="Search previous documents..."
            className="w-full px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] placeholder:text-[--text-muted]"
          />
        </div>

        <div className="flex-1 overflow-y-auto">
          {!selectedDoc ? (
            <div className="p-4">
              <h3 className="text-sm font-medium text-[--text-secondary] mb-3">Select a document to duplicate</h3>
              {filteredHistory.length === 0 ? (
                <p className="text-center py-8 text-[--text-muted]">No documents found</p>
              ) : (
                <div className="space-y-2">
                  {filteredHistory.map((doc) => (
                    <button
                      key={doc.id}
                      onClick={() => setSelectedDoc(doc)}
                      className="w-full text-left p-4 rounded-lg bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary] transition-colors"
                    >
                      <div className="flex items-center justify-between mb-1">
                        <span className="font-medium text-[--text-primary]">{doc.documentType}</span>
                        <span className="text-xs text-[--text-muted]">
                          {new Date(doc.createdAt).toLocaleDateString()}
                        </span>
                      </div>
                      {doc.recipientName && (
                        <p className="text-sm text-[--text-secondary]">To: {doc.recipientName}</p>
                      )}
                      <p className="text-sm text-[--text-muted] truncate mt-1">
                        {doc.bodyText?.substring(0, 100) || doc.preview || "No preview"}...
                      </p>
                    </button>
                  ))}
                </div>
              )}
            </div>
          ) : (
            <div className="p-5">
              <button
                onClick={() => setSelectedDoc(null)}
                className="text-sm text-[--color-primary] hover:underline mb-4"
              >
                ‚Üê Choose different document
              </button>
              
              <div className="p-4 rounded-lg bg-[--bg-elevated] border border-[--border-default] mb-4">
                <h4 className="font-medium text-[--text-primary] mb-1">{selectedDoc.documentType}</h4>
                <p className="text-sm text-[--text-muted]">
                  Original recipient: {selectedDoc.recipientName || "None"}
                </p>
              </div>

              <h3 className="text-sm font-medium text-[--text-secondary] mb-3">New Recipient Details</h3>
              <div className="space-y-3">
                <div>
                  <label className="block text-xs text-[--text-muted] mb-1">Name</label>
                  <input
                    type="text"
                    value={newRecipient.name}
                    onChange={(e) => setNewRecipient({ ...newRecipient, name: e.target.value })}
                    placeholder="Recipient name"
                    className="w-full px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary]"
                  />
                </div>
                <div>
                  <label className="block text-xs text-[--text-muted] mb-1">Title</label>
                  <input
                    type="text"
                    value={newRecipient.title}
                    onChange={(e) => setNewRecipient({ ...newRecipient, title: e.target.value })}
                    placeholder="Recipient title"
                    className="w-full px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary]"
                  />
                </div>
                <div>
                  <label className="block text-xs text-[--text-muted] mb-1">Address</label>
                  <textarea
                    value={newRecipient.address}
                    onChange={(e) => setNewRecipient({ ...newRecipient, address: e.target.value })}
                    placeholder="Recipient address"
                    rows={2}
                    className="w-full px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] resize-none"
                  />
                </div>
              </div>
            </div>
          )}
        </div>

        <div className="p-5 border-t border-[--border-default] flex gap-3">
          <button
            onClick={onClose}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:bg-[--bg-overlay]"
          >
            Cancel
          </button>
          <button
            onClick={handleDuplicate}
            disabled={!selectedDoc}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--color-primary] text-white hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Duplicate Document
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/QuickTemplates.tsx">
"use client";

import { useState, useEffect } from "react";
import { DocumentTemplate } from "@/data/templates";

interface QuickTemplatesProps {
  templates: DocumentTemplate[];
  onSelectTemplate: (template: DocumentTemplate) => void;
}

export function usePinnedTemplates() {
  const [pinnedIds, setPinnedIds] = useState<string[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem("pinnedTemplates");
    if (saved) {
      try {
        setPinnedIds(JSON.parse(saved));
      } catch (e) {
        console.error("Error loading pinned templates:", e);
      }
    }
  }, []);

  const togglePin = (templateId: string) => {
    const newPinned = pinnedIds.includes(templateId)
      ? pinnedIds.filter((id) => id !== templateId)
      : [...pinnedIds, templateId].slice(0, 5); // Max 5 pinned
    
    setPinnedIds(newPinned);
    localStorage.setItem("pinnedTemplates", JSON.stringify(newPinned));
  };

  const isPinned = (templateId: string) => pinnedIds.includes(templateId);

  return { pinnedIds, togglePin, isPinned, mounted };
}

export default function QuickTemplates({ templates, onSelectTemplate }: QuickTemplatesProps) {
  const { pinnedIds, mounted } = usePinnedTemplates();

  if (!mounted || pinnedIds.length === 0) return null;

  const pinnedTemplates = templates.filter((t) => pinnedIds.includes(t.id));

  return (
    <div className="mb-4">
      <div className="flex items-center gap-2 text-xs text-[#666680] mb-2">
        <span>üìå</span>
        <span>Quick Access</span>
      </div>
      <div className="flex flex-wrap gap-2">
        {pinnedTemplates.map((template) => (
          <button
            key={template.id}
            onClick={() => onSelectTemplate(template)}
            className="px-3 py-1.5 rounded-lg bg-gradient-to-r from-[#a78bfa]/20 to-[#f472b6]/20 border border-[#a78bfa]/30 text-[#a78bfa] text-sm hover:border-[#a78bfa] transition-all"
          >
            {template.name}
          </button>
        ))}
      </div>
    </div>
  );
}
</file>

<file path="src/components/SaveAsTemplate.tsx">
"use client";

import { useState, useEffect } from "react";
import { useSession } from "next-auth/react";
import {
  X,
  FileText,
  Save,
  Tag,
  Sparkles,
  Globe,
  Lock,
  Loader2,
  Cloud,
  HardDrive,
  User,
} from "lucide-react";
import { DocumentTemplate } from "@/data/templates";
import { toast } from "react-hot-toast";

interface SaveAsTemplateProps {
  isOpen: boolean;
  onClose: () => void;
  currentDocumentType: string;
  currentBodyText: string;
  onSave: (template: DocumentTemplate) => void;
  onShowAuth?: () => void;
}

export default function SaveAsTemplate({
  isOpen,
  onClose,
  currentDocumentType,
  currentBodyText,
  onSave,
  onShowAuth,
}: SaveAsTemplateProps) {
  const { data: session, status } = useSession();
  const [name, setName] = useState("");
  const [description, setDescription] = useState("");
  const [category, setCategory] = useState("Custom");
  const [isPublic, setIsPublic] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [saveToCloud, setSaveToCloud] = useState(true);

  useEffect(() => {
    if (isOpen) {
      setName(`My ${currentDocumentType}`);
      setDescription("");
      setSaveToCloud(!!session?.user);
    }
  }, [isOpen, currentDocumentType, session]);

  const handleSave = async () => {
    if (!name.trim()) {
      toast.error("Please enter a template name");
      return;
    }
    if (!currentBodyText.trim()) {
      toast.error("Document body is empty");
      return;
    }

    setIsSaving(true);

    try {
      // If user is logged in and wants to save to cloud
      if (session?.user && saveToCloud) {
        const res = await fetch("/api/templates/user", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: name.trim(),
            description: description || `Custom template: ${name.trim()}`,
            documentType: currentDocumentType,
            bodyText: currentBodyText,
            category,
            isPublic,
          }),
        });

        if (!res.ok) {
          throw new Error("Failed to save template");
        }

        const data = await res.json();
        toast.success("Template saved to your account!");
        
        // Also create a local DocumentTemplate for immediate use
        const template: DocumentTemplate = {
          id: data.template.id,
          name: name.trim(),
          documentType: currentDocumentType,
          bodyText: currentBodyText,
          description: description || `Custom template: ${name.trim()}`,
          category,
        };
        onSave(template);
      } else {
        // Save locally
        const template: DocumentTemplate = {
          id: `local-${Date.now()}`,
          name: name.trim(),
          documentType: currentDocumentType,
          bodyText: currentBodyText,
          description: description || `Custom template: ${name.trim()}`,
          category,
        };

        const existingTemplates = JSON.parse(
          localStorage.getItem("localTemplates") || "[]"
        );
        existingTemplates.push({
          ...template,
          createdAt: new Date().toISOString(),
        });
        localStorage.setItem("localTemplates", JSON.stringify(existingTemplates));

        onSave(template);
        toast.success("Template saved locally!");
      }

      onClose();
    } catch (error) {
      console.error("Error saving template:", error);
      toast.error("Failed to save template");
    } finally {
      setIsSaving(false);
    }
  };

  if (!isOpen) return null;

  const isLoggedIn = status === "authenticated" && session?.user;

  return (
    <div
      className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="w-full max-w-md bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-[--color-primary]/10 flex items-center justify-center">
                <Save className="w-5 h-5 text-[--color-primary]" />
              </div>
              <div>
                <h2 className="text-lg font-semibold">Save as Template</h2>
                <p className="text-sm text-[--text-muted]">Reuse this document later</p>
              </div>
            </div>
            <button
              onClick={onClose}
              className="p-2 rounded-xl hover:bg-[--bg-elevated] text-[--text-muted] hover:text-[--text-primary] transition-colors"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>

        {/* Form */}
        <div className="p-6 space-y-4">
          {/* Login prompt for non-authenticated users */}
          {!isLoggedIn && (
            <div className="p-4 rounded-xl bg-[--color-primary]/5 border border-[--color-primary]/20">
              <div className="flex items-start gap-3">
                <User className="w-5 h-5 text-[--color-primary] flex-shrink-0 mt-0.5" />
                <div className="flex-1">
                  <p className="text-sm font-medium">Sign in for cloud sync</p>
                  <p className="text-xs text-[--text-muted] mt-1">
                    Save templates to your account and access them anywhere.
                  </p>
                  {onShowAuth && (
                    <button
                      onClick={() => {
                        onClose();
                        onShowAuth();
                      }}
                      className="mt-2 text-sm text-[--color-primary] hover:underline font-medium"
                    >
                      Sign in or create account ‚Üí
                    </button>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* Storage Location (only show if logged in) */}
          {isLoggedIn && (
            <div>
              <label className="block text-sm font-medium text-[--text-secondary] mb-2">
                Save to
              </label>
              <div className="grid grid-cols-2 gap-2">
                <button
                  type="button"
                  onClick={() => setSaveToCloud(true)}
                  className={`flex items-center gap-2 p-3 rounded-xl border transition-all ${
                    saveToCloud
                      ? "bg-[--color-primary]/10 border-[--color-primary] text-[--color-primary]"
                      : "bg-[--bg-elevated] border-[--border-default] text-[--text-secondary]"
                  }`}
                >
                  <Cloud className="w-5 h-5" />
                  <span className="text-sm font-medium">My Account</span>
                </button>
                <button
                  type="button"
                  onClick={() => setSaveToCloud(false)}
                  className={`flex items-center gap-2 p-3 rounded-xl border transition-all ${
                    !saveToCloud
                      ? "bg-[--color-primary]/10 border-[--color-primary] text-[--color-primary]"
                      : "bg-[--bg-elevated] border-[--border-default] text-[--text-secondary]"
                  }`}
                >
                  <HardDrive className="w-5 h-5" />
                  <span className="text-sm font-medium">Local Only</span>
                </button>
              </div>
            </div>
          )}

          {/* Name */}
          <div>
            <label className="block text-sm font-medium text-[--text-secondary] mb-2">
              Template Name *
            </label>
            <div className="relative">
              <FileText className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[--text-muted]" />
              <input
                type="text"
                value={name}
                onChange={(e) => setName(e.target.value)}
                placeholder="Enter template name"
                className="w-full pl-10 pr-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary]"
              />
            </div>
          </div>

          {/* Description */}
          <div>
            <label className="block text-sm font-medium text-[--text-secondary] mb-2">
              Description (optional)
            </label>
            <textarea
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              placeholder="Describe when to use this template"
              rows={3}
              className="w-full px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary] resize-none"
            />
          </div>

          {/* Category */}
          <div>
            <label className="block text-sm font-medium text-[--text-secondary] mb-2">
              Category
            </label>
            <div className="relative">
              <Tag className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[--text-muted]" />
              <select
                value={category}
                onChange={(e) => setCategory(e.target.value)}
                className="w-full pl-10 pr-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] appearance-none cursor-pointer"
              >
                <option value="Custom">Custom</option>
                <option value="HR">HR & Employment</option>
                <option value="Legal">Legal</option>
                <option value="Business">Business</option>
                <option value="Personal">Personal</option>
                <option value="Academic">Academic</option>
              </select>
            </div>
          </div>

          {/* Public/Private Toggle (only for cloud saves) */}
          {isLoggedIn && saveToCloud && (
            <div className="flex items-center justify-between p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
              <div className="flex items-center gap-3">
                {isPublic ? (
                  <Globe className="w-5 h-5 text-[--color-accent]" />
                ) : (
                  <Lock className="w-5 h-5 text-[--text-muted]" />
                )}
                <div>
                  <span className="font-medium">
                    {isPublic ? "Public Template" : "Private Template"}
                  </span>
                  <p className="text-xs text-[--text-muted]">
                    {isPublic
                      ? "Others can discover and use this"
                      : "Only you can see this template"}
                  </p>
                </div>
              </div>
              <button
                type="button"
                onClick={() => setIsPublic(!isPublic)}
                className={`w-12 h-6 rounded-full transition-colors relative ${
                  isPublic ? "bg-[--color-accent]" : "bg-[--bg-overlay]"
                }`}
              >
                <span
                  className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                    isPublic ? "left-7" : "left-1"
                  }`}
                />
              </button>
            </div>
          )}

          {/* Preview */}
          <div className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
            <div className="flex items-center gap-2 mb-2">
              <Sparkles className="w-4 h-4 text-[--color-primary]" />
              <span className="text-sm font-medium">Preview</span>
            </div>
            <div className="text-xs text-[--text-muted] line-clamp-3">
              {currentBodyText.slice(0, 200)}
              {currentBodyText.length > 200 ? "..." : ""}
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="p-6 border-t border-[--border-default] flex gap-3">
          <button
            onClick={onClose}
            className="flex-1 px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:bg-[--bg-overlay] transition-colors font-medium"
          >
            Cancel
          </button>
          <button
            onClick={handleSave}
            disabled={isSaving}
            className="flex-1 px-4 py-3 rounded-xl bg-[--color-primary] text-white hover:bg-[--color-primary-hover] transition-colors font-semibold flex items-center justify-center gap-2 disabled:opacity-50"
          >
            {isSaving ? (
              <>
                <Loader2 className="w-4 h-4 animate-spin" />
                Saving...
              </>
            ) : (
              <>
                {isLoggedIn && saveToCloud ? (
                  <Cloud className="w-4 h-4" />
                ) : (
                  <Save className="w-4 h-4" />
                )}
                Save Template
              </>
            )}
          </button>
        </div>
      </div>
    </div>
  );
}

// Hook to manage user templates (both local and cloud)
export function useUserTemplates() {
  const { data: session } = useSession();
  const [templates, setTemplates] = useState<DocumentTemplate[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    loadTemplates();
  }, [session]);

  const loadTemplates = async () => {
    setIsLoading(true);
    try {
      // Load local templates
      const localTemplates = JSON.parse(
        localStorage.getItem("localTemplates") || "[]"
      );

      // If logged in, also fetch cloud templates
      if (session?.user) {
        const res = await fetch("/api/templates/user");
        if (res.ok) {
          const data = await res.json();
          const cloudTemplates = (data.templates || []).map((t: any) => ({
            id: t.id,
            name: t.name,
            documentType: t.documentType,
            bodyText: t.bodyText,
            description: t.description,
            category: t.category,
            isCloud: true,
          }));
          setTemplates([...cloudTemplates, ...localTemplates]);
        } else {
          setTemplates(localTemplates);
        }
      } else {
        setTemplates(localTemplates);
      }
    } catch (error) {
      console.error("Error loading templates:", error);
      // Fall back to local templates
      const localTemplates = JSON.parse(
        localStorage.getItem("localTemplates") || "[]"
      );
      setTemplates(localTemplates);
    } finally {
      setIsLoading(false);
    }
  };

  const addTemplate = (template: DocumentTemplate) => {
    setTemplates((prev) => [...prev, template]);
  };

  const removeTemplate = async (id: string) => {
    const template = templates.find((t) => t.id === id);
    
    if (template && (template as any).isCloud && session?.user) {
      // Delete from cloud
      try {
        await fetch(`/api/templates/user/${id}`, { method: "DELETE" });
      } catch (error) {
        console.error("Error deleting cloud template:", error);
      }
    } else {
      // Delete from local storage
      const localTemplates = JSON.parse(
        localStorage.getItem("localTemplates") || "[]"
      ).filter((t: any) => t.id !== id);
      localStorage.setItem("localTemplates", JSON.stringify(localTemplates));
    }
    
    setTemplates(templates.filter((t) => t.id !== id));
  };

  const refreshTemplates = () => {
    loadTemplates();
  };

  return { templates, addTemplate, removeTemplate, refreshTemplates, isLoading };
}
</file>

<file path="src/components/SettingsPanel.tsx">
"use client";

import { useState, useEffect, useRef } from "react";

// Preset accent colors
const ACCENT_PRESETS = [
  { name: "Violet", color: "#a78bfa" },
  { name: "Teal", color: "#4ecdc4" },
  { name: "Pink", color: "#f472b6" },
  { name: "Gold", color: "#f0b866" },
  { name: "Blue", color: "#60a5fa" },
  { name: "Green", color: "#4ade80" },
  { name: "Red", color: "#f87171" },
  { name: "Orange", color: "#fb923c" },
];

// Font options
const FONT_OPTIONS = [
  { name: "DM Sans", value: "'DM Sans', sans-serif" },
  { name: "Inter", value: "'Inter', sans-serif" },
  { name: "Merriweather", value: "'Merriweather', serif" },
  { name: "Playfair Display", value: "'Playfair Display', serif" },
  { name: "Roboto", value: "'Roboto', sans-serif" },
  { name: "Source Sans Pro", value: "'Source Sans Pro', sans-serif" },
  { name: "Lato", value: "'Lato', sans-serif" },
  { name: "Open Sans", value: "'Open Sans', sans-serif" },
];

// Seasonal themes
const SEASONAL_THEMES = [
  { name: "Default", colors: { primary: "#a78bfa", secondary: "#4ecdc4", accent: "#f472b6" } },
  { name: "Spring", colors: { primary: "#86efac", secondary: "#fcd34d", accent: "#f9a8d4" } },
  { name: "Summer", colors: { primary: "#38bdf8", secondary: "#fbbf24", accent: "#fb923c" } },
  { name: "Autumn", colors: { primary: "#f97316", secondary: "#eab308", accent: "#dc2626" } },
  { name: "Winter", colors: { primary: "#93c5fd", secondary: "#c4b5fd", accent: "#e0e7ff" } },
  { name: "Ocean", colors: { primary: "#06b6d4", secondary: "#0ea5e9", accent: "#22d3ee" } },
  { name: "Forest", colors: { primary: "#22c55e", secondary: "#84cc16", accent: "#a3e635" } },
  { name: "Sunset", colors: { primary: "#f43f5e", secondary: "#fb7185", accent: "#fda4af" } },
];

// Page sizes
const PAGE_SIZES = [
  { name: "Letter (8.5 √ó 11 in)", value: "letter" },
  { name: "A4 (210 √ó 297 mm)", value: "a4" },
  { name: "Legal (8.5 √ó 14 in)", value: "legal" },
];

// Locale options
const LOCALE_OPTIONS = [
  { name: "English (US)", value: "en-US", dateFormat: "MM/DD/YYYY" },
  { name: "English (UK)", value: "en-GB", dateFormat: "DD/MM/YYYY" },
  { name: "German", value: "de-DE", dateFormat: "DD.MM.YYYY" },
  { name: "French", value: "fr-FR", dateFormat: "DD/MM/YYYY" },
  { name: "Spanish", value: "es-ES", dateFormat: "DD/MM/YYYY" },
];

export interface AppSettings {
  // Visual
  accentColor: string;
  documentFont: string;
  animatedBackground: boolean;
  compactMode: boolean;
  seasonalTheme: string;
  
  // Fun
  soundEffects: boolean;
  confettiEnabled: boolean;
  
  // Productivity
  focusMode: boolean;
  pomodoroEnabled: boolean;
  pomodoroMinutes: number;
  aiSuggestions: boolean;
  
  // Document
  watermark: string;
  watermarkEnabled: boolean;
  headerText: string;
  footerText: string;
  pageSize: string;
  marginTop: number;
  marginBottom: number;
  marginLeft: number;
  marginRight: number;
  letterheadUrl: string;
  
  // Advanced
  locale: string;
  offlineMode: boolean;
  versionHistoryEnabled: boolean;
}

const DEFAULT_SETTINGS: AppSettings = {
  accentColor: "#a78bfa",
  documentFont: "'DM Sans', sans-serif",
  animatedBackground: true,
  compactMode: false,
  seasonalTheme: "Default",
  soundEffects: false,
  confettiEnabled: true,
  focusMode: false,
  pomodoroEnabled: false,
  pomodoroMinutes: 25,
  aiSuggestions: false,
  watermark: "",
  watermarkEnabled: false,
  headerText: "",
  footerText: "",
  pageSize: "letter",
  marginTop: 1,
  marginBottom: 1,
  marginLeft: 1,
  marginRight: 1,
  letterheadUrl: "",
  locale: "en-US",
  offlineMode: false,
  versionHistoryEnabled: true,
};

interface SettingsPanelProps {
  isOpen: boolean;
  onClose: () => void;
  settings: AppSettings;
  onSettingsChange: (settings: AppSettings) => void;
}

export default function SettingsPanel({ isOpen, onClose, settings, onSettingsChange }: SettingsPanelProps) {
  const [activeTab, setActiveTab] = useState<"visual" | "fun" | "productivity" | "document" | "advanced">("visual");
  const [localSettings, setLocalSettings] = useState<AppSettings>(settings);
  const letterheadInputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    setLocalSettings(settings);
  }, [settings]);

  const updateSetting = <K extends keyof AppSettings>(key: K, value: AppSettings[K]) => {
    const newSettings = { ...localSettings, [key]: value };
    setLocalSettings(newSettings);
    onSettingsChange(newSettings);
  };

  const handleLetterheadUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        updateSetting("letterheadUrl", event.target?.result as string);
      };
      reader.readAsDataURL(file);
    }
  };

  if (!isOpen) return null;

  const tabs = [
    { id: "visual", label: "Visual", icon: "üé®" },
    { id: "fun", label: "Fun", icon: "üéÆ" },
    { id: "productivity", label: "Productivity", icon: "‚ö°" },
    { id: "document", label: "Document", icon: "üìÑ" },
    { id: "advanced", label: "Advanced", icon: "üîß" },
  ];

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-3xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl shadow-[#a78bfa]/10">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">Settings</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white transition-colors text-2xl">√ó</button>
        </div>

        {/* Tabs */}
        <div className="flex gap-1 p-2 border-b border-[#2a2a3a] overflow-x-auto">
          {tabs.map((tab) => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as typeof activeTab)}
              className={`px-4 py-2 text-sm rounded-lg transition-all whitespace-nowrap ${
                activeTab === tab.id
                  ? "bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white"
                  : "text-[#666680] hover:text-white hover:bg-[#1a1a24]"
              }`}
            >
              {tab.icon} {tab.label}
            </button>
          ))}
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {/* Visual Settings */}
          {activeTab === "visual" && (
            <div className="space-y-6">
              {/* Accent Color */}
              <div>
                <label className="block text-sm font-medium text-[#a78bfa] mb-3">Accent Color</label>
                <div className="flex flex-wrap gap-2">
                  {ACCENT_PRESETS.map((preset) => (
                    <button
                      key={preset.name}
                      onClick={() => updateSetting("accentColor", preset.color)}
                      className={`w-10 h-10 rounded-lg transition-all ${
                        localSettings.accentColor === preset.color
                          ? "ring-2 ring-white ring-offset-2 ring-offset-[#12121a] scale-110"
                          : "hover:scale-105"
                      }`}
                      style={{ backgroundColor: preset.color }}
                      title={preset.name}
                    />
                  ))}
                  <input
                    type="color"
                    value={localSettings.accentColor}
                    onChange={(e) => updateSetting("accentColor", e.target.value)}
                    className="w-10 h-10 rounded-lg cursor-pointer"
                    title="Custom color"
                  />
                </div>
              </div>

              {/* Document Font */}
              <div>
                <label className="block text-sm font-medium text-[#4ecdc4] mb-3">Document Font</label>
                <select
                  value={localSettings.documentFont}
                  onChange={(e) => updateSetting("documentFont", e.target.value)}
                  className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white focus:border-[#4ecdc4]"
                >
                  {FONT_OPTIONS.map((font) => (
                    <option key={font.name} value={font.value} style={{ fontFamily: font.value }}>
                      {font.name}
                    </option>
                  ))}
                </select>
              </div>

              {/* Seasonal Theme */}
              <div>
                <label className="block text-sm font-medium text-[#f472b6] mb-3">Seasonal Theme</label>
                <div className="grid grid-cols-4 gap-2">
                  {SEASONAL_THEMES.map((theme) => (
                    <button
                      key={theme.name}
                      onClick={() => updateSetting("seasonalTheme", theme.name)}
                      className={`p-3 rounded-lg border transition-all text-xs ${
                        localSettings.seasonalTheme === theme.name
                          ? "border-[#f472b6] bg-[#f472b6]/10"
                          : "border-[#2a2a3a] hover:border-[#3a3a4a]"
                      }`}
                    >
                      <div className="flex gap-1 mb-1 justify-center">
                        <div className="w-3 h-3 rounded-full" style={{ backgroundColor: theme.colors.primary }} />
                        <div className="w-3 h-3 rounded-full" style={{ backgroundColor: theme.colors.secondary }} />
                        <div className="w-3 h-3 rounded-full" style={{ backgroundColor: theme.colors.accent }} />
                      </div>
                      <span className="text-[#a0a0a0]">{theme.name}</span>
                    </button>
                  ))}
                </div>
              </div>

              {/* Toggles */}
              <div className="space-y-3">
                <label className="flex items-center justify-between p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                  <span className="text-white">Animated Background</span>
                  <button
                    onClick={() => updateSetting("animatedBackground", !localSettings.animatedBackground)}
                    className={`w-12 h-6 rounded-full transition-colors relative ${
                      localSettings.animatedBackground ? "bg-[#4ecdc4]" : "bg-[#3a3a4a]"
                    }`}
                  >
                    <span className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                      localSettings.animatedBackground ? "left-7" : "left-1"
                    }`} />
                  </button>
                </label>

                <label className="flex items-center justify-between p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                  <span className="text-white">Compact Mode</span>
                  <button
                    onClick={() => updateSetting("compactMode", !localSettings.compactMode)}
                    className={`w-12 h-6 rounded-full transition-colors relative ${
                      localSettings.compactMode ? "bg-[#4ecdc4]" : "bg-[#3a3a4a]"
                    }`}
                  >
                    <span className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                      localSettings.compactMode ? "left-7" : "left-1"
                    }`} />
                  </button>
                </label>
              </div>
            </div>
          )}

          {/* Fun Settings */}
          {activeTab === "fun" && (
            <div className="space-y-6">
              {/* Sound Effects */}
              <label className="flex items-center justify-between p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div>
                  <span className="text-white block">üîä Sound Effects</span>
                  <span className="text-[#666680] text-sm">Typewriter clicks, success sounds</span>
                </div>
                <button
                  onClick={() => updateSetting("soundEffects", !localSettings.soundEffects)}
                  className={`w-12 h-6 rounded-full transition-colors relative ${
                    localSettings.soundEffects ? "bg-[#a78bfa]" : "bg-[#3a3a4a]"
                  }`}
                >
                  <span className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                    localSettings.soundEffects ? "left-7" : "left-1"
                  }`} />
                </button>
              </label>

              {/* Confetti */}
              <label className="flex items-center justify-between p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div>
                  <span className="text-white block">üéä Confetti Celebrations</span>
                  <span className="text-[#666680] text-sm">Celebrate achievements with confetti</span>
                </div>
                <button
                  onClick={() => updateSetting("confettiEnabled", !localSettings.confettiEnabled)}
                  className={`w-12 h-6 rounded-full transition-colors relative ${
                    localSettings.confettiEnabled ? "bg-[#f472b6]" : "bg-[#3a3a4a]"
                  }`}
                >
                  <span className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                    localSettings.confettiEnabled ? "left-7" : "left-1"
                  }`} />
                </button>
              </label>

              {/* Streak Display */}
              <div className="p-4 rounded-lg bg-gradient-to-r from-[#a78bfa]/20 to-[#f472b6]/20 border border-[#a78bfa]/30">
                <div className="flex items-center justify-between">
                  <div>
                    <span className="text-white block text-lg">üî• Document Streak</span>
                    <span className="text-[#a0a0a0] text-sm">Keep creating documents daily!</span>
                  </div>
                  <div className="text-center">
                    <div className="text-3xl font-bold gradient-text">0</div>
                    <div className="text-xs text-[#666680]">days</div>
                  </div>
                </div>
              </div>

              {/* Achievements Preview */}
              <div>
                <label className="block text-sm font-medium text-[#f0b866] mb-3">üèÜ Recent Achievements</label>
                <div className="grid grid-cols-3 gap-2">
                  {["First Document", "Speed Writer", "Template Master"].map((badge) => (
                    <div key={badge} className="p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-center opacity-50">
                      <div className="text-2xl mb-1">üîí</div>
                      <div className="text-xs text-[#666680]">{badge}</div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* Productivity Settings */}
          {activeTab === "productivity" && (
            <div className="space-y-6">
              {/* Focus Mode */}
              <label className="flex items-center justify-between p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div>
                  <span className="text-white block">üéØ Focus Mode</span>
                  <span className="text-[#666680] text-sm">Hide all UI except the editor</span>
                </div>
                <button
                  onClick={() => updateSetting("focusMode", !localSettings.focusMode)}
                  className={`w-12 h-6 rounded-full transition-colors relative ${
                    localSettings.focusMode ? "bg-[#4ecdc4]" : "bg-[#3a3a4a]"
                  }`}
                >
                  <span className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                    localSettings.focusMode ? "left-7" : "left-1"
                  }`} />
                </button>
              </label>

              {/* Pomodoro Timer */}
              <div className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div className="flex items-center justify-between mb-3">
                  <div>
                    <span className="text-white block">üçÖ Pomodoro Timer</span>
                    <span className="text-[#666680] text-sm">Stay focused with timed sessions</span>
                  </div>
                  <button
                    onClick={() => updateSetting("pomodoroEnabled", !localSettings.pomodoroEnabled)}
                    className={`w-12 h-6 rounded-full transition-colors relative ${
                      localSettings.pomodoroEnabled ? "bg-[#f87171]" : "bg-[#3a3a4a]"
                    }`}
                  >
                    <span className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                      localSettings.pomodoroEnabled ? "left-7" : "left-1"
                    }`} />
                  </button>
                </div>
                {localSettings.pomodoroEnabled && (
                  <div className="flex items-center gap-3">
                    <label className="text-[#a0a0a0] text-sm">Duration:</label>
                    <input
                      type="range"
                      min="5"
                      max="60"
                      value={localSettings.pomodoroMinutes}
                      onChange={(e) => updateSetting("pomodoroMinutes", parseInt(e.target.value))}
                      className="flex-1"
                    />
                    <span className="text-white w-16 text-right">{localSettings.pomodoroMinutes} min</span>
                  </div>
                )}
              </div>

              {/* AI Suggestions */}
              <label className="flex items-center justify-between p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div>
                  <span className="text-white block">‚ú® AI Writing Suggestions</span>
                  <span className="text-[#666680] text-sm">Get smart phrase suggestions (coming soon)</span>
                </div>
                <button
                  onClick={() => updateSetting("aiSuggestions", !localSettings.aiSuggestions)}
                  className={`w-12 h-6 rounded-full transition-colors relative ${
                    localSettings.aiSuggestions ? "bg-[#a78bfa]" : "bg-[#3a3a4a]"
                  }`}
                >
                  <span className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                    localSettings.aiSuggestions ? "left-7" : "left-1"
                  }`} />
                </button>
              </label>

              {/* Keyboard Shortcuts */}
              <div>
                <label className="block text-sm font-medium text-[#60a5fa] mb-3">‚å®Ô∏è Keyboard Shortcuts</label>
                <div className="grid grid-cols-2 gap-2 text-sm">
                  {[
                    { keys: "Ctrl + S", action: "Save draft" },
                    { keys: "Ctrl + P", action: "Preview PDF" },
                    { keys: "Ctrl + Z", action: "Undo" },
                    { keys: "Ctrl + B", action: "Bold (in editor)" },
                    { keys: "Esc", action: "Close modal" },
                    { keys: "Tab", action: "Next field" },
                  ].map((shortcut) => (
                    <div key={shortcut.keys} className="flex items-center justify-between p-2 rounded bg-[#1a1a24] border border-[#2a2a3a]">
                      <kbd className="px-2 py-0.5 rounded bg-[#2a2a3a] text-[#a78bfa] text-xs">{shortcut.keys}</kbd>
                      <span className="text-[#a0a0a0]">{shortcut.action}</span>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* Document Settings */}
          {activeTab === "document" && (
            <div className="space-y-6">
              {/* Watermark */}
              <div className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div className="flex items-center justify-between mb-3">
                  <span className="text-white">üíß Watermark</span>
                  <button
                    onClick={() => updateSetting("watermarkEnabled", !localSettings.watermarkEnabled)}
                    className={`w-12 h-6 rounded-full transition-colors relative ${
                      localSettings.watermarkEnabled ? "bg-[#4ecdc4]" : "bg-[#3a3a4a]"
                    }`}
                  >
                    <span className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                      localSettings.watermarkEnabled ? "left-7" : "left-1"
                    }`} />
                  </button>
                </div>
                {localSettings.watermarkEnabled && (
                  <div className="flex gap-2">
                    {["DRAFT", "CONFIDENTIAL", "COPY"].map((preset) => (
                      <button
                        key={preset}
                        onClick={() => updateSetting("watermark", preset)}
                        className={`px-3 py-1.5 rounded text-sm transition-colors ${
                          localSettings.watermark === preset
                            ? "bg-[#4ecdc4] text-[#0a0a12]"
                            : "bg-[#2a2a3a] text-[#a0a0a0] hover:bg-[#3a3a4a]"
                        }`}
                      >
                        {preset}
                      </button>
                    ))}
                    <input
                      type="text"
                      value={localSettings.watermark}
                      onChange={(e) => updateSetting("watermark", e.target.value)}
                      placeholder="Custom..."
                      className="flex-1 px-3 py-1.5 rounded bg-[#2a2a3a] border border-[#3a3a4a] text-white text-sm"
                    />
                  </div>
                )}
              </div>

              {/* Header/Footer */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-[#a78bfa] mb-2">Header Text</label>
                  <input
                    type="text"
                    value={localSettings.headerText}
                    onChange={(e) => updateSetting("headerText", e.target.value)}
                    placeholder="Company Name"
                    className="w-full px-3 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-[#a78bfa] mb-2">Footer Text</label>
                  <input
                    type="text"
                    value={localSettings.footerText}
                    onChange={(e) => updateSetting("footerText", e.target.value)}
                    placeholder="Page {page} of {pages}"
                    className="w-full px-3 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white"
                  />
                </div>
              </div>

              {/* Page Size */}
              <div>
                <label className="block text-sm font-medium text-[#f472b6] mb-2">üìè Page Size</label>
                <div className="flex gap-2">
                  {PAGE_SIZES.map((size) => (
                    <button
                      key={size.value}
                      onClick={() => updateSetting("pageSize", size.value)}
                      className={`flex-1 px-3 py-2 rounded-lg text-sm transition-colors ${
                        localSettings.pageSize === size.value
                          ? "bg-[#f472b6] text-white"
                          : "bg-[#1a1a24] border border-[#2a2a3a] text-[#a0a0a0] hover:border-[#f472b6]"
                      }`}
                    >
                      {size.name}
                    </button>
                  ))}
                </div>
              </div>

              {/* Margins */}
              <div>
                <label className="block text-sm font-medium text-[#4ecdc4] mb-3">üìê Margins (inches)</label>
                <div className="grid grid-cols-4 gap-3">
                  {[
                    { key: "marginTop", label: "Top" },
                    { key: "marginBottom", label: "Bottom" },
                    { key: "marginLeft", label: "Left" },
                    { key: "marginRight", label: "Right" },
                  ].map(({ key, label }) => (
                    <div key={key}>
                      <label className="text-xs text-[#666680] block mb-1">{label}</label>
                      <input
                        type="number"
                        step="0.25"
                        min="0.25"
                        max="2"
                        value={localSettings[key as keyof AppSettings] as number}
                        onChange={(e) => updateSetting(key as keyof AppSettings, parseFloat(e.target.value))}
                        className="w-full px-2 py-1.5 rounded bg-[#1a1a24] border border-[#2a2a3a] text-white text-sm"
                      />
                    </div>
                  ))}
                </div>
              </div>

              {/* Letterhead */}
              <div>
                <label className="block text-sm font-medium text-[#f0b866] mb-2">üè¢ Letterhead</label>
                <div className="flex gap-3 items-center">
                  <input
                    ref={letterheadInputRef}
                    type="file"
                    accept="image/*"
                    onChange={handleLetterheadUpload}
                    className="hidden"
                  />
                  <button
                    onClick={() => letterheadInputRef.current?.click()}
                    className="px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-[#f0b866] hover:border-[#f0b866] transition-colors"
                  >
                    Upload Image
                  </button>
                  {localSettings.letterheadUrl && (
                    <>
                      <img src={localSettings.letterheadUrl} alt="Letterhead preview" className="h-10 rounded" />
                      <button
                        onClick={() => updateSetting("letterheadUrl", "")}
                        className="text-[#f87171] hover:text-[#fca5a5]"
                      >
                        Remove
                      </button>
                    </>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* Advanced Settings */}
          {activeTab === "advanced" && (
            <div className="space-y-6">
              {/* Locale */}
              <div>
                <label className="block text-sm font-medium text-[#60a5fa] mb-2">üåê Language & Locale</label>
                <select
                  value={localSettings.locale}
                  onChange={(e) => updateSetting("locale", e.target.value)}
                  className="w-full px-4 py-2.5 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white focus:border-[#60a5fa]"
                >
                  {LOCALE_OPTIONS.map((locale) => (
                    <option key={locale.value} value={locale.value}>
                      {locale.name} ({locale.dateFormat})
                    </option>
                  ))}
                </select>
              </div>

              {/* Version History */}
              <label className="flex items-center justify-between p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div>
                  <span className="text-white block">üìú Version History</span>
                  <span className="text-[#666680] text-sm">Keep track of document changes</span>
                </div>
                <button
                  onClick={() => updateSetting("versionHistoryEnabled", !localSettings.versionHistoryEnabled)}
                  className={`w-12 h-6 rounded-full transition-colors relative ${
                    localSettings.versionHistoryEnabled ? "bg-[#4ecdc4]" : "bg-[#3a3a4a]"
                  }`}
                >
                  <span className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                    localSettings.versionHistoryEnabled ? "left-7" : "left-1"
                  }`} />
                </button>
              </label>

              {/* Offline Mode Indicator */}
              <div className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                <div className="flex items-center justify-between">
                  <div>
                    <span className="text-white block">üì¥ Offline Mode</span>
                    <span className="text-[#666680] text-sm">Work without internet connection</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className={`w-2 h-2 rounded-full ${navigator.onLine ? "bg-[#4ade80]" : "bg-[#f87171]"}`} />
                    <span className="text-sm text-[#a0a0a0]">{navigator.onLine ? "Online" : "Offline"}</span>
                  </div>
                </div>
              </div>

              {/* Cloud Backup */}
              <div className="p-4 rounded-lg bg-gradient-to-r from-[#60a5fa]/10 to-[#a78bfa]/10 border border-[#60a5fa]/30">
                <div className="flex items-center justify-between">
                  <div>
                    <span className="text-white block">‚òÅÔ∏è Cloud Backup</span>
                    <span className="text-[#666680] text-sm">Sync with Google Drive or Dropbox</span>
                  </div>
                  <button className="px-4 py-2 rounded-lg bg-[#60a5fa] text-white text-sm hover:bg-[#3b82f6] transition-colors">
                    Connect
                  </button>
                </div>
              </div>

              {/* Collaboration */}
              <div className="p-4 rounded-lg bg-gradient-to-r from-[#f472b6]/10 to-[#f0b866]/10 border border-[#f472b6]/30">
                <div className="flex items-center justify-between">
                  <div>
                    <span className="text-white block">üë• Collaboration</span>
                    <span className="text-[#666680] text-sm">Share documents with team members</span>
                  </div>
                  <button className="px-4 py-2 rounded-lg bg-[#f472b6] text-white text-sm hover:bg-[#ec4899] transition-colors">
                    Invite
                  </button>
                </div>
              </div>

              {/* Reset */}
              <div className="pt-4 border-t border-[#2a2a3a]">
                <button
                  onClick={() => {
                    setLocalSettings(DEFAULT_SETTINGS);
                    onSettingsChange(DEFAULT_SETTINGS);
                  }}
                  className="px-4 py-2 rounded-lg border border-[#f87171] text-[#f87171] hover:bg-[#f87171] hover:text-white transition-colors"
                >
                  Reset All Settings
                </button>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

export { DEFAULT_SETTINGS };
</file>

<file path="src/components/ShareDraft.tsx">
"use client";

import { useState, useEffect } from "react";
import {
  X,
  Link2,
  Copy,
  Check,
  Mail,
  MessageSquare,
  QrCode,
  Clock,
  Eye,
  Lock,
  Globe,
  Share2,
} from "lucide-react";
import { toast } from "react-hot-toast";
import { QRCodeSVG } from "qrcode.react";

interface ShareDraftProps {
  isOpen: boolean;
  onClose: () => void;
  documentType: string;
  bodyText: string;
  recipientName?: string;
}

interface ShareLink {
  id: string;
  url: string;
  createdAt: string;
  expiresAt?: string;
  views: number;
  isProtected: boolean;
}

export default function ShareDraft({
  isOpen,
  onClose,
  documentType,
  bodyText,
  recipientName,
}: ShareDraftProps) {
  const [shareLink, setShareLink] = useState<ShareLink | null>(null);
  const [isGenerating, setIsGenerating] = useState(false);
  const [copied, setCopied] = useState(false);
  const [showQR, setShowQR] = useState(false);
  const [expiration, setExpiration] = useState<"1h" | "24h" | "7d" | "never">("24h");
  const [isProtected, setIsProtected] = useState(false);
  const [password, setPassword] = useState("");

  const generateShareLink = async () => {
    setIsGenerating(true);

    // In a real app, this would call an API to create a share link
    // For demo purposes, we'll create a local share link
    const id = Math.random().toString(36).substring(2, 10);
    const baseUrl = typeof window !== "undefined" ? window.location.origin : "";
    
    // Calculate expiration
    let expiresAt: string | undefined;
    const now = new Date();
    switch (expiration) {
      case "1h":
        expiresAt = new Date(now.getTime() + 60 * 60 * 1000).toISOString();
        break;
      case "24h":
        expiresAt = new Date(now.getTime() + 24 * 60 * 60 * 1000).toISOString();
        break;
      case "7d":
        expiresAt = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString();
        break;
    }

    // Store share data locally (in a real app, this would be stored on a server)
    const shareData = {
      id,
      documentType,
      bodyText,
      recipientName,
      createdAt: now.toISOString(),
      expiresAt,
      isProtected,
      password: isProtected ? password : undefined,
    };
    
    const existingShares = JSON.parse(localStorage.getItem("shareLinks") || "[]");
    existingShares.push(shareData);
    localStorage.setItem("shareLinks", JSON.stringify(existingShares));

    const link: ShareLink = {
      id,
      url: `${baseUrl}/share/${id}`,
      createdAt: now.toISOString(),
      expiresAt,
      views: 0,
      isProtected,
    };

    setTimeout(() => {
      setShareLink(link);
      setIsGenerating(false);
    }, 500);
  };

  const copyToClipboard = async () => {
    if (!shareLink) return;
    
    try {
      await navigator.clipboard.writeText(shareLink.url);
      setCopied(true);
      toast.success("Link copied to clipboard!");
      setTimeout(() => setCopied(false), 2000);
    } catch {
      toast.error("Failed to copy link");
    }
  };

  const shareViaEmail = () => {
    if (!shareLink) return;
    const subject = encodeURIComponent(`Document: ${documentType}`);
    const body = encodeURIComponent(`I'd like to share this document with you:\n\n${shareLink.url}`);
    window.open(`mailto:?subject=${subject}&body=${body}`);
  };

  const getExpirationText = () => {
    if (!shareLink?.expiresAt) return "Never expires";
    const expDate = new Date(shareLink.expiresAt);
    const now = new Date();
    const diff = expDate.getTime() - now.getTime();
    
    if (diff < 60 * 60 * 1000) {
      return `Expires in ${Math.round(diff / 60000)} minutes`;
    } else if (diff < 24 * 60 * 60 * 1000) {
      return `Expires in ${Math.round(diff / 3600000)} hours`;
    } else {
      return `Expires in ${Math.round(diff / 86400000)} days`;
    }
  };

  if (!isOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="w-full max-w-md bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-[--color-accent]/10 flex items-center justify-center">
                <Share2 className="w-5 h-5 text-[--color-accent]" />
              </div>
              <div>
                <h2 className="text-lg font-semibold">Share Draft</h2>
                <p className="text-sm text-[--text-muted]">Create a shareable link</p>
              </div>
            </div>
            <button
              onClick={onClose}
              className="p-2 rounded-xl hover:bg-[--bg-elevated] text-[--text-muted] hover:text-[--text-primary] transition-colors"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>

        {/* Content */}
        <div className="p-6">
          {!shareLink ? (
            <div className="space-y-4">
              {/* Document Preview */}
              <div className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
                <div className="flex items-center gap-2 mb-2">
                  <Eye className="w-4 h-4 text-[--text-muted]" />
                  <span className="text-sm font-medium">{documentType}</span>
                </div>
                <p className="text-xs text-[--text-muted] line-clamp-2">
                  {bodyText.slice(0, 150)}...
                </p>
              </div>

              {/* Expiration */}
              <div>
                <label className="block text-sm font-medium text-[--text-secondary] mb-2">
                  Link Expiration
                </label>
                <div className="grid grid-cols-4 gap-2">
                  {[
                    { value: "1h", label: "1 hour" },
                    { value: "24h", label: "24 hours" },
                    { value: "7d", label: "7 days" },
                    { value: "never", label: "Never" },
                  ].map((option) => (
                    <button
                      key={option.value}
                      onClick={() => setExpiration(option.value as any)}
                      className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                        expiration === option.value
                          ? "bg-[--color-primary] text-white"
                          : "bg-[--bg-elevated] text-[--text-secondary] hover:bg-[--bg-overlay]"
                      }`}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>

              {/* Password Protection */}
              <div className="flex items-center justify-between p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
                <div className="flex items-center gap-3">
                  <Lock className="w-5 h-5 text-[--text-muted]" />
                  <div>
                    <span className="font-medium">Password Protection</span>
                    <p className="text-xs text-[--text-muted]">Require password to view</p>
                  </div>
                </div>
                <button
                  onClick={() => setIsProtected(!isProtected)}
                  className={`w-12 h-6 rounded-full transition-colors relative ${
                    isProtected ? "bg-[--color-primary]" : "bg-[--bg-overlay]"
                  }`}
                >
                  <span
                    className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${
                      isProtected ? "left-7" : "left-1"
                    }`}
                  />
                </button>
              </div>

              {isProtected && (
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="Enter password"
                  className="w-full px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary]"
                />
              )}

              {/* Generate Button */}
              <button
                onClick={generateShareLink}
                disabled={isGenerating || (isProtected && !password)}
                className="w-full px-4 py-3 rounded-xl bg-[--color-primary] text-white hover:bg-[--color-primary-hover] transition-all font-semibold disabled:opacity-50 flex items-center justify-center gap-2"
              >
                {isGenerating ? (
                  <>
                    <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                    Generating...
                  </>
                ) : (
                  <>
                    <Link2 className="w-5 h-5" />
                    Generate Share Link
                  </>
                )}
              </button>
            </div>
          ) : (
            <div className="space-y-4">
              {/* Success */}
              <div className="text-center py-4">
                <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-[--color-success]/10 flex items-center justify-center">
                  <Check className="w-8 h-8 text-[--color-success]" />
                </div>
                <h3 className="font-semibold text-lg mb-1">Link Created!</h3>
                <p className="text-sm text-[--text-muted]">{getExpirationText()}</p>
              </div>

              {/* Link Input */}
              <div className="flex gap-2">
                <input
                  type="text"
                  value={shareLink.url}
                  readOnly
                  className="flex-1 px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] text-sm font-mono"
                />
                <button
                  onClick={copyToClipboard}
                  className={`px-4 py-3 rounded-xl transition-all ${
                    copied
                      ? "bg-[--color-success] text-white"
                      : "bg-[--bg-elevated] hover:bg-[--bg-overlay]"
                  }`}
                >
                  {copied ? <Check className="w-5 h-5" /> : <Copy className="w-5 h-5" />}
                </button>
              </div>

              {/* QR Code Toggle */}
              <button
                onClick={() => setShowQR(!showQR)}
                className="w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:bg-[--bg-overlay] transition-colors"
              >
                <QrCode className="w-5 h-5" />
                {showQR ? "Hide QR Code" : "Show QR Code"}
              </button>

              {showQR && (
                <div className="flex justify-center p-4 bg-white rounded-xl">
                  <QRCodeSVG value={shareLink.url} size={180} />
                </div>
              )}

              {/* Share Options */}
              <div className="flex gap-2">
                <button
                  onClick={shareViaEmail}
                  className="flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:bg-[--bg-overlay] transition-colors"
                >
                  <Mail className="w-5 h-5" />
                  Email
                </button>
                <button
                  onClick={() => {
                    if (navigator.share) {
                      navigator.share({
                        title: documentType,
                        url: shareLink.url,
                      });
                    }
                  }}
                  className="flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:bg-[--bg-overlay] transition-colors"
                >
                  <Share2 className="w-5 h-5" />
                  Share
                </button>
              </div>

              {/* Info */}
              <div className="flex items-center gap-2 text-xs text-[--text-muted] justify-center">
                {shareLink.isProtected && (
                  <span className="flex items-center gap-1">
                    <Lock className="w-3 h-3" />
                    Password protected
                  </span>
                )}
                <span>‚Ä¢</span>
                <span className="flex items-center gap-1">
                  <Eye className="w-3 h-3" />
                  {shareLink.views} views
                </span>
              </div>

              {/* Create New Link */}
              <button
                onClick={() => setShareLink(null)}
                className="w-full text-center text-sm text-[--color-primary] hover:underline"
              >
                Create another link
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Sidebar.tsx">
"use client";

import { useState, useEffect } from "react";
import {
  FileText,
  Star,
  History,
  BarChart3,
  Users,
  GitBranch,
  Package,
  Bot,
  Palette,
  Calendar,
  Settings,
  ChevronLeft,
  ChevronRight,
  Flame,
  Clock,
  Eye,
  Save,
  Trash2,
  HelpCircle,
  Layout,
  Keyboard,
  Link,
  Key,
  Timer,
  Shield,
  Sparkles,
} from "lucide-react";

interface SidebarItem {
  id: string;
  icon: React.ReactNode;
  label: string;
  color: string;
  onClick: () => void;
  badge?: number;
}

interface SidebarSection {
  title: string;
  items: SidebarItem[];
}

interface SidebarProps {
  sections: SidebarSection[];
  isOpen: boolean;
  onToggle: () => void;
  theme: "dark" | "light";
}

export default function Sidebar({ sections, isOpen, onToggle, theme }: SidebarProps) {
  const [hoveredItem, setHoveredItem] = useState<string | null>(null);

  const bgColor = theme === "light" ? "bg-white/95" : "bg-[#0d0d14]/95";
  const borderColor = theme === "light" ? "border-gray-200" : "border-[#1f1f2e]";
  const textColor = theme === "light" ? "text-gray-700" : "text-gray-300";
  const mutedColor = theme === "light" ? "text-gray-400" : "text-gray-500";

  return (
    <>
      {/* Sidebar */}
      <aside
        className={`fixed left-0 top-0 h-full ${bgColor} backdrop-blur-xl border-r ${borderColor} z-40 transition-all duration-300 ease-out ${
          isOpen ? "w-64" : "w-16"
        }`}
      >
        {/* Header */}
        <div className={`h-16 flex items-center ${isOpen ? "px-4 justify-between" : "justify-center"} border-b ${borderColor}`}>
          {isOpen && (
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-violet-500 to-teal-400 flex items-center justify-center">
                <FileText className="w-4 h-4 text-white" />
              </div>
              <span className="font-semibold bg-gradient-to-r from-violet-400 to-teal-400 bg-clip-text text-transparent">
                DocGen
              </span>
            </div>
          )}
          <button
            onClick={onToggle}
            className={`p-2 rounded-lg hover:bg-white/10 transition-colors ${mutedColor}`}
          >
            {isOpen ? <ChevronLeft className="w-4 h-4" /> : <ChevronRight className="w-4 h-4" />}
          </button>
        </div>

        {/* Navigation */}
        <nav className="p-2 space-y-6 overflow-y-auto h-[calc(100vh-4rem)]">
          {sections.map((section, sectionIndex) => (
            <div key={sectionIndex}>
              {isOpen && (
                <h3 className={`px-3 mb-2 text-xs font-medium uppercase tracking-wider ${mutedColor}`}>
                  {section.title}
                </h3>
              )}
              <div className="space-y-1">
                {section.items.map((item) => (
                  <button
                    key={item.id}
                    onClick={item.onClick}
                    onMouseEnter={() => setHoveredItem(item.id)}
                    onMouseLeave={() => setHoveredItem(null)}
                    className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all duration-200 group relative ${
                      hoveredItem === item.id
                        ? "bg-white/10 shadow-lg"
                        : "hover:bg-white/5"
                    }`}
                    style={{
                      boxShadow: hoveredItem === item.id ? `0 4px 20px ${item.color}20` : "none",
                    }}
                  >
                    <div
                      className="w-8 h-8 rounded-lg flex items-center justify-center transition-all duration-200"
                      style={{
                        backgroundColor: hoveredItem === item.id ? `${item.color}20` : "transparent",
                        color: item.color,
                      }}
                    >
                      {item.icon}
                    </div>
                    {isOpen && (
                      <>
                        <span className={`flex-1 text-left text-sm ${textColor} group-hover:text-white transition-colors`}>
                          {item.label}
                        </span>
                        {item.badge !== undefined && item.badge > 0 && (
                          <span
                            className="px-2 py-0.5 rounded-full text-xs text-white"
                            style={{ backgroundColor: item.color }}
                          >
                            {item.badge}
                          </span>
                        )}
                      </>
                    )}
                    
                    {/* Tooltip for collapsed state */}
                    {!isOpen && hoveredItem === item.id && (
                      <div
                        className="absolute left-full ml-2 px-3 py-2 rounded-lg text-sm text-white whitespace-nowrap z-50"
                        style={{ backgroundColor: item.color }}
                      >
                        {item.label}
                        <div
                          className="absolute left-0 top-1/2 -translate-x-1 -translate-y-1/2 w-2 h-2 rotate-45"
                          style={{ backgroundColor: item.color }}
                        />
                      </div>
                    )}
                  </button>
                ))}
              </div>
            </div>
          ))}
        </nav>
      </aside>

      {/* Main content offset */}
      <div className={`transition-all duration-300 ${isOpen ? "ml-64" : "ml-16"}`} />
    </>
  );
}

// Icon mapping helper
export const SidebarIcons = {
  templates: FileText,
  favorites: Star,
  history: History,
  stats: BarChart3,
  profiles: Users,
  versions: GitBranch,
  bulk: Package,
  ai: Bot,
  themes: Palette,
  schedule: Calendar,
  settings: Settings,
  streak: Flame,
  time: Clock,
  preview: Eye,
  save: Save,
  clear: Trash2,
  help: HelpCircle,
  layout: Layout,
  keyboard: Keyboard,
  webhooks: Link,
  api: Key,
  timer: Timer,
  privacy: Shield,
  sparkles: Sparkles,
};
</file>

<file path="src/components/SignaturePlacement.tsx">
"use client";

import { useState, useRef, useEffect } from "react";

export interface SignatureField {
  id: string;
  type: "signature" | "initials" | "date" | "text";
  x: number;
  y: number;
  width: number;
  height: number;
  label: string;
  required: boolean;
  assignee: string;
}

interface SignaturePlacementProps {
  isOpen: boolean;
  onClose: () => void;
  onSave: (fields: SignatureField[]) => void;
  existingFields?: SignatureField[];
}

const FIELD_TYPES = [
  { type: "signature", label: "Signature", icon: "‚úçÔ∏è", defaultSize: { w: 200, h: 50 } },
  { type: "initials", label: "Initials", icon: "üî§", defaultSize: { w: 80, h: 40 } },
  { type: "date", label: "Date", icon: "üìÖ", defaultSize: { w: 120, h: 30 } },
  { type: "text", label: "Text Field", icon: "üìù", defaultSize: { w: 150, h: 30 } },
] as const;

export default function SignaturePlacement({ isOpen, onClose, onSave, existingFields = [] }: SignaturePlacementProps) {
  const [fields, setFields] = useState<SignatureField[]>(existingFields);
  const [selectedField, setSelectedField] = useState<string | null>(null);
  const [dragging, setDragging] = useState<string | null>(null);
  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
  const canvasRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (isOpen) {
      setFields(existingFields);
    }
  }, [isOpen, existingFields]);

  const addField = (type: SignatureField["type"]) => {
    const fieldType = FIELD_TYPES.find(f => f.type === type)!;
    const newField: SignatureField = {
      id: `field-${Date.now()}`,
      type,
      x: 50,
      y: 50 + fields.length * 60,
      width: fieldType.defaultSize.w,
      height: fieldType.defaultSize.h,
      label: fieldType.label,
      required: true,
      assignee: "Signer 1",
    };
    setFields([...fields, newField]);
    setSelectedField(newField.id);
  };

  const updateField = (id: string, updates: Partial<SignatureField>) => {
    setFields(fields.map(f => f.id === id ? { ...f, ...updates } : f));
  };

  const deleteField = (id: string) => {
    setFields(fields.filter(f => f.id !== id));
    if (selectedField === id) setSelectedField(null);
  };

  const handleMouseDown = (e: React.MouseEvent, fieldId: string) => {
    const field = fields.find(f => f.id === fieldId);
    if (!field) return;
    
    setDragging(fieldId);
    setSelectedField(fieldId);
    const rect = canvasRef.current?.getBoundingClientRect();
    if (rect) {
      setDragOffset({
        x: e.clientX - rect.left - field.x,
        y: e.clientY - rect.top - field.y,
      });
    }
  };

  const handleMouseMove = (e: React.MouseEvent) => {
    if (!dragging || !canvasRef.current) return;
    
    const rect = canvasRef.current.getBoundingClientRect();
    const x = Math.max(0, Math.min(rect.width - 100, e.clientX - rect.left - dragOffset.x));
    const y = Math.max(0, Math.min(rect.height - 30, e.clientY - rect.top - dragOffset.y));
    
    updateField(dragging, { x, y });
  };

  const handleMouseUp = () => {
    setDragging(null);
  };

  const handleSave = () => {
    onSave(fields);
    onClose();
  };

  const selectedFieldData = fields.find(f => f.id === selectedField);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
      <div className="bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-2xl w-full max-w-4xl h-[80vh] flex flex-col">
        {/* Header */}
        <div className="p-4 border-b border-[--border-default] flex items-center justify-between">
          <h2 className="text-lg font-semibold text-[--text-primary]">Signature Field Placement</h2>
          <button onClick={onClose} className="text-[--text-muted] hover:text-[--text-primary]">‚úï</button>
        </div>

        <div className="flex-1 flex overflow-hidden">
          {/* Toolbar */}
          <div className="w-48 border-r border-[--border-default] p-4 space-y-3">
            <h3 className="text-sm font-medium text-[--text-secondary] mb-3">Add Fields</h3>
            {FIELD_TYPES.map(({ type, label, icon }) => (
              <button
                key={type}
                onClick={() => addField(type)}
                className="w-full flex items-center gap-2 px-3 py-2 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:border-[--color-primary] text-sm"
              >
                <span>{icon}</span>
                <span>{label}</span>
              </button>
            ))}

            {/* Selected Field Properties */}
            {selectedFieldData && (
              <div className="pt-4 mt-4 border-t border-[--border-default]">
                <h3 className="text-sm font-medium text-[--text-secondary] mb-3">Properties</h3>
                <div className="space-y-3">
                  <div>
                    <label className="block text-xs text-[--text-muted] mb-1">Label</label>
                    <input
                      type="text"
                      value={selectedFieldData.label}
                      onChange={(e) => updateField(selectedFieldData.id, { label: e.target.value })}
                      className="w-full px-2 py-1.5 rounded bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
                    />
                  </div>
                  <div>
                    <label className="block text-xs text-[--text-muted] mb-1">Assignee</label>
                    <select
                      value={selectedFieldData.assignee}
                      onChange={(e) => updateField(selectedFieldData.id, { assignee: e.target.value })}
                      className="w-full px-2 py-1.5 rounded bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] text-sm"
                    >
                      <option>Signer 1</option>
                      <option>Signer 2</option>
                      <option>Signer 3</option>
                    </select>
                  </div>
                  <label className="flex items-center gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={selectedFieldData.required}
                      onChange={(e) => updateField(selectedFieldData.id, { required: e.target.checked })}
                    />
                    <span className="text-sm text-[--text-secondary]">Required</span>
                  </label>
                  <button
                    onClick={() => deleteField(selectedFieldData.id)}
                    className="w-full px-3 py-1.5 rounded bg-red-500/10 border border-red-500/30 text-red-400 text-sm hover:bg-red-500/20"
                  >
                    Delete Field
                  </button>
                </div>
              </div>
            )}
          </div>

          {/* Canvas */}
          <div className="flex-1 bg-[--bg-elevated] p-4 overflow-auto">
            <div
              ref={canvasRef}
              className="relative bg-white rounded-lg shadow-lg mx-auto"
              style={{ width: 612, height: 792, minHeight: 792 }}
              onMouseMove={handleMouseMove}
              onMouseUp={handleMouseUp}
              onMouseLeave={handleMouseUp}
            >
              {/* Page content preview */}
              <div className="absolute inset-0 p-12 text-gray-300 text-sm pointer-events-none">
                <div className="border-2 border-dashed border-gray-200 h-full flex items-center justify-center">
                  Document Preview Area
                </div>
              </div>

              {/* Signature fields */}
              {fields.map((field) => {
                const isSelected = field.id === selectedField;
                const fieldType = FIELD_TYPES.find(f => f.type === field.type)!;
                return (
                  <div
                    key={field.id}
                    className={`absolute cursor-move flex items-center justify-center text-xs font-medium transition-shadow ${
                      isSelected ? "ring-2 ring-[--color-primary] shadow-lg" : "hover:ring-1 hover:ring-[--color-primary]"
                    }`}
                    style={{
                      left: field.x,
                      top: field.y,
                      width: field.width,
                      height: field.height,
                      backgroundColor: field.type === "signature" ? "#fef3c7" : 
                                       field.type === "initials" ? "#dbeafe" :
                                       field.type === "date" ? "#dcfce7" : "#f3e8ff",
                      border: `2px dashed ${
                        field.type === "signature" ? "#f59e0b" : 
                        field.type === "initials" ? "#3b82f6" :
                        field.type === "date" ? "#22c55e" : "#a855f7"
                      }`,
                      borderRadius: 4,
                    }}
                    onMouseDown={(e) => handleMouseDown(e, field.id)}
                  >
                    <span className="pointer-events-none">
                      {fieldType.icon} {field.label}
                    </span>
                  </div>
                );
              })}
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="p-4 border-t border-[--border-default] flex items-center justify-between">
          <span className="text-sm text-[--text-muted]">
            {fields.length} field{fields.length !== 1 ? "s" : ""} added
          </span>
          <div className="flex gap-3">
            <button
              onClick={onClose}
              className="px-4 py-2 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:bg-[--bg-overlay]"
            >
              Cancel
            </button>
            <button
              onClick={handleSave}
              className="px-4 py-2 rounded-lg bg-[--color-primary] text-white hover:opacity-90"
            >
              Save Placements
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/SimplifiedSidebar.tsx">
"use client";

import { useState } from "react";
import { useUIStore } from "@/store/documentStore";
import {
  FileText,
  Star,
  History,
  Settings,
  ChevronLeft,
  ChevronRight,
  HelpCircle,
  MoreHorizontal,
  Sparkles,
  Package,
  Palette,
  Users,
  BarChart3,
  Calendar,
  Key,
  Link,
  Command,
} from "lucide-react";

interface SidebarItemConfig {
  id: string;
  icon: React.ReactNode;
  label: string;
  color: string;
}

interface SimplifiedSidebarProps {
  onNavigate: (section: string) => void;
}

export default function SimplifiedSidebar({ onNavigate }: SimplifiedSidebarProps) {
  const { sidebarOpen, toggleSidebar, theme, toggleCommandPalette } = useUIStore();
  const [showMore, setShowMore] = useState(false);

  const bgColor = theme === "light" ? "bg-white/95" : "bg-[#0f0f14]/95";
  const borderColor = theme === "light" ? "border-[#e5e0d8]" : "border-[#1f1f2e]";
  const textColor = theme === "light" ? "text-[#2d2a26]" : "text-[#f4f1ed]";
  const textMuted = theme === "light" ? "text-[#8f897f]" : "text-[#7a756d]";

  // Primary navigation items (always visible)
  const primaryItems: SidebarItemConfig[] = [
    { id: "templates", icon: <FileText className="w-5 h-5" />, label: "Templates", color: "#e07a5f" },
    { id: "favorites", icon: <Star className="w-5 h-5" />, label: "Favorites", color: "#f2cc8f" },
    { id: "ai", icon: <Sparkles className="w-5 h-5" />, label: "AI Assistant", color: "#81b29a" },
    { id: "history", icon: <History className="w-5 h-5" />, label: "History", color: "#3d405b" },
  ];

  // Secondary items (shown in "More" section)
  const secondaryItems: SidebarItemConfig[] = [
    { id: "bulk", icon: <Package className="w-5 h-5" />, label: "Bulk Generate", color: "#81b29a" },
    { id: "themes", icon: <Palette className="w-5 h-5" />, label: "PDF Themes", color: "#e07a5f" },
    { id: "profiles", icon: <Users className="w-5 h-5" />, label: "Profiles", color: "#f2cc8f" },
    { id: "statistics", icon: <BarChart3 className="w-5 h-5" />, label: "Statistics", color: "#3d405b" },
    { id: "schedule", icon: <Calendar className="w-5 h-5" />, label: "Schedule", color: "#e07a5f" },
    { id: "teams", icon: <Users className="w-5 h-5" />, label: "Teams", color: "#81b29a" },
    { id: "webhooks", icon: <Link className="w-5 h-5" />, label: "Webhooks", color: "#3d405b" },
    { id: "api", icon: <Key className="w-5 h-5" />, label: "API Access", color: "#f2cc8f" },
  ];

  // Utility items (always at bottom)
  const utilityItems: SidebarItemConfig[] = [
    { id: "settings", icon: <Settings className="w-5 h-5" />, label: "Settings", color: "#7a756d" },
    { id: "help", icon: <HelpCircle className="w-5 h-5" />, label: "Help", color: "#7a756d" },
  ];

  const NavItem = ({ item, showLabel }: { item: SidebarItemConfig; showLabel: boolean }) => {
    const [hovered, setHovered] = useState(false);

    return (
      <button
        onClick={() => onNavigate(item.id)}
        onMouseEnter={() => setHovered(true)}
        onMouseLeave={() => setHovered(false)}
        className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all duration-200 group relative ${
          hovered ? "bg-white/10" : "hover:bg-white/5"
        }`}
        style={{
          boxShadow: hovered ? `0 4px 20px ${item.color}15` : "none",
        }}
      >
        <div
          className="w-9 h-9 rounded-xl flex items-center justify-center transition-all duration-200"
          style={{
            backgroundColor: hovered ? `${item.color}20` : "transparent",
            color: item.color,
          }}
        >
          {item.icon}
        </div>
        {showLabel && (
          <span
            className={`flex-1 text-left text-sm font-medium transition-colors ${
              hovered ? "text-white" : textColor
            }`}
          >
            {item.label}
          </span>
        )}

        {/* Tooltip for collapsed state */}
        {!showLabel && hovered && (
          <div
            className="absolute left-full ml-3 px-3 py-2 rounded-lg text-sm text-white whitespace-nowrap z-50 shadow-lg"
            style={{ backgroundColor: item.color }}
          >
            {item.label}
            <div
              className="absolute left-0 top-1/2 -translate-x-1 -translate-y-1/2 w-2 h-2 rotate-45"
              style={{ backgroundColor: item.color }}
            />
          </div>
        )}
      </button>
    );
  };

  return (
    <aside
      className={`fixed left-0 top-0 h-full ${bgColor} backdrop-blur-xl border-r ${borderColor} z-40 transition-all duration-300 ease-out flex flex-col ${
        sidebarOpen ? "w-64" : "w-[72px]"
      }`}
    >
      {/* Header */}
      <div
        className={`h-16 flex items-center ${
          sidebarOpen ? "px-4 justify-between" : "justify-center"
        } border-b ${borderColor}`}
      >
        {sidebarOpen && (
          <div className="flex items-center gap-3">
            <div className="w-9 h-9 rounded-xl bg-gradient-to-br from-[#e07a5f] to-[#81b29a] flex items-center justify-center shadow-lg">
              <FileText className="w-5 h-5 text-white" />
            </div>
            <span className="font-semibold text-lg bg-gradient-to-r from-[#e07a5f] to-[#81b29a] bg-clip-text text-transparent">
              DocGen
            </span>
          </div>
        )}
        <button
          onClick={toggleSidebar}
          className={`p-2 rounded-xl hover:bg-white/10 transition-colors ${textMuted}`}
        >
          {sidebarOpen ? (
            <ChevronLeft className="w-5 h-5" />
          ) : (
            <ChevronRight className="w-5 h-5" />
          )}
        </button>
      </div>

      {/* Command Palette Trigger */}
      <div className="p-3">
        <button
          onClick={toggleCommandPalette}
          className={`w-full flex items-center gap-2 px-3 py-2.5 rounded-xl bg-[--bg-elevated] border ${borderColor} hover:border-[--color-primary]/50 transition-all ${textMuted}`}
        >
          <Command className="w-4 h-4" />
          {sidebarOpen && (
            <>
              <span className="flex-1 text-left text-sm">Search...</span>
              <kbd className="kbd text-xs">‚åòK</kbd>
            </>
          )}
        </button>
      </div>

      {/* Main Navigation */}
      <nav className="flex-1 p-3 space-y-1 overflow-y-auto">
        {/* Primary Section */}
        <div className="space-y-1">
          {sidebarOpen && (
            <h3 className={`px-3 mb-2 text-xs font-semibold uppercase tracking-wider ${textMuted}`}>
              Create
            </h3>
          )}
          {primaryItems.map((item) => (
            <NavItem key={item.id} item={item} showLabel={sidebarOpen} />
          ))}
        </div>

        {/* More Section */}
        <div className="pt-4 space-y-1">
          {sidebarOpen ? (
            <>
              <button
                onClick={() => setShowMore(!showMore)}
                className={`w-full flex items-center gap-3 px-3 py-2 rounded-xl ${textMuted} hover:bg-white/5 transition-colors`}
              >
                <MoreHorizontal className="w-5 h-5" />
                <span className="flex-1 text-left text-xs font-semibold uppercase tracking-wider">
                  {showMore ? "Less" : "More Features"}
                </span>
              </button>
              {showMore && (
                <div className="space-y-1 animate-slide-up">
                  {secondaryItems.map((item) => (
                    <NavItem key={item.id} item={item} showLabel={sidebarOpen} />
                  ))}
                </div>
              )}
            </>
          ) : (
            <button
              onClick={() => setShowMore(!showMore)}
              className={`w-full flex items-center justify-center p-2.5 rounded-xl ${textMuted} hover:bg-white/5 transition-colors relative group`}
            >
              <MoreHorizontal className="w-5 h-5" />
              {/* Tooltip */}
              <div className="absolute left-full ml-3 px-3 py-2 rounded-lg text-sm text-white whitespace-nowrap z-50 shadow-lg bg-[#3d405b] opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                More Features
                <div className="absolute left-0 top-1/2 -translate-x-1 -translate-y-1/2 w-2 h-2 rotate-45 bg-[#3d405b]" />
              </div>
            </button>
          )}
        </div>
      </nav>

      {/* Utility Section */}
      <div className={`p-3 border-t ${borderColor} space-y-1`}>
        {utilityItems.map((item) => (
          <NavItem key={item.id} item={item} showLabel={sidebarOpen} />
        ))}
      </div>
    </aside>
  );
}
</file>

<file path="src/components/Skeleton.tsx">
"use client";

interface SkeletonProps {
  className?: string;
  variant?: "text" | "circular" | "rectangular" | "rounded";
  width?: string | number;
  height?: string | number;
  animation?: "pulse" | "wave" | "none";
}

export function Skeleton({
  className = "",
  variant = "text",
  width,
  height,
  animation = "pulse",
}: SkeletonProps) {
  const baseClasses = "bg-gradient-to-r from-gray-800 via-gray-700 to-gray-800";
  
  const variantClasses = {
    text: "rounded h-4 w-full",
    circular: "rounded-full",
    rectangular: "rounded-none",
    rounded: "rounded-xl",
  };

  const animationClasses = {
    pulse: "animate-pulse",
    wave: "skeleton-wave",
    none: "",
  };

  const style: React.CSSProperties = {};
  if (width) style.width = typeof width === "number" ? `${width}px` : width;
  if (height) style.height = typeof height === "number" ? `${height}px` : height;

  return (
    <div
      className={`${baseClasses} ${variantClasses[variant]} ${animationClasses[animation]} ${className}`}
      style={style}
    />
  );
}

// Skeleton for document cards
export function DocumentCardSkeleton() {
  return (
    <div className="p-5 rounded-xl bg-gray-900/50 border border-gray-800 space-y-4">
      <div className="flex items-center gap-3">
        <Skeleton variant="circular" width={40} height={40} />
        <div className="flex-1 space-y-2">
          <Skeleton width="60%" height={16} />
          <Skeleton width="40%" height={12} />
        </div>
      </div>
      <Skeleton height={80} variant="rounded" />
      <div className="flex gap-2">
        <Skeleton width={80} height={32} variant="rounded" />
        <Skeleton width={80} height={32} variant="rounded" />
      </div>
    </div>
  );
}

// Skeleton for form sections
export function FormSectionSkeleton() {
  return (
    <div className="p-5 rounded-xl bg-gray-900/50 border border-gray-800 space-y-4">
      <Skeleton width={120} height={20} />
      <Skeleton height={44} variant="rounded" />
    </div>
  );
}

// Skeleton for stats cards
export function StatsCardSkeleton() {
  return (
    <div className="p-4 rounded-xl bg-gray-900/50 border border-gray-800 text-center space-y-2">
      <Skeleton width={60} height={32} className="mx-auto" />
      <Skeleton width={80} height={14} className="mx-auto" />
    </div>
  );
}

// Skeleton for table rows
export function TableRowSkeleton({ columns = 4 }: { columns?: number }) {
  return (
    <div className="flex items-center gap-4 p-3 border-b border-gray-800">
      {Array.from({ length: columns }).map((_, i) => (
        <Skeleton key={i} width={`${100 / columns}%`} height={16} />
      ))}
    </div>
  );
}

// Skeleton for modal content
export function ModalSkeleton() {
  return (
    <div className="space-y-6">
      <div className="space-y-2">
        <Skeleton width={200} height={24} />
        <Skeleton width="100%" height={16} />
      </div>
      <div className="space-y-3">
        <FormSectionSkeleton />
        <FormSectionSkeleton />
      </div>
      <div className="flex gap-3">
        <Skeleton width={120} height={44} variant="rounded" />
        <Skeleton width={120} height={44} variant="rounded" />
      </div>
    </div>
  );
}

// Loading state wrapper
interface LoadingWrapperProps {
  isLoading: boolean;
  skeleton: React.ReactNode;
  children: React.ReactNode;
}

export function LoadingWrapper({ isLoading, skeleton, children }: LoadingWrapperProps) {
  if (isLoading) return <>{skeleton}</>;
  return <>{children}</>;
}

export default Skeleton;
</file>

<file path="src/components/SkipToContent.tsx">
"use client";

export default function SkipToContent() {
  const handleSkip = (e: React.MouseEvent<HTMLAnchorElement>) => {
    e.preventDefault();
    const mainContent = document.getElementById("main-content");
    if (mainContent) {
      mainContent.focus();
      mainContent.scrollIntoView();
    }
  };

  return (
    <a
      href="#main-content"
      onClick={handleSkip}
      className="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[10000] focus:bg-blue-600 focus:text-white focus:px-4 focus:py-2 focus:rounded-lg focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
    >
      Skip to main content
    </a>
  );
}
</file>

<file path="src/components/SpellChecker.tsx">
"use client";

import { useState, useEffect, useCallback, useRef } from "react";

interface SpellError {
  word: string;
  index: number;
  suggestions: string[];
}

interface SpellCheckResult {
  errors: SpellError[];
  errorCount: number;
}

// Common misspellings dictionary
const COMMON_MISSPELLINGS: Record<string, string[]> = {
  "teh": ["the"],
  "recieve": ["receive"],
  "occured": ["occurred"],
  "seperate": ["separate"],
  "definately": ["definitely"],
  "accomodate": ["accommodate"],
  "occurence": ["occurrence"],
  "succesful": ["successful"],
  "neccessary": ["necessary"],
  "untill": ["until"],
  "wierd": ["weird"],
  "beleive": ["believe"],
  "freind": ["friend"],
  "begining": ["beginning"],
  "goverment": ["government"],
  "enviroment": ["environment"],
  "independant": ["independent"],
  "privelege": ["privilege"],
  "refered": ["referred"],
  "apparant": ["apparent"],
  "arguement": ["argument"],
  "calender": ["calendar"],
  "commitee": ["committee"],
  "concious": ["conscious"],
  "existance": ["existence"],
  "grammer": ["grammar"],
  "harrass": ["harass"],
  "immediatly": ["immediately"],
  "judgement": ["judgment", "judgement"],
  "liason": ["liaison"],
  "maintainance": ["maintenance"],
  "millenium": ["millennium"],
  "mispell": ["misspell"],
  "noticable": ["noticeable"],
  "paralell": ["parallel"],
  "persue": ["pursue"],
  "posession": ["possession"],
  "recomend": ["recommend"],
  "rythm": ["rhythm"],
  "sieze": ["seize"],
  "tendancy": ["tendency"],
  "thier": ["their"],
  "tommorow": ["tomorrow"],
  "truely": ["truly"],
  "vaccuum": ["vacuum"],
  "wether": ["whether", "weather"],
  "writting": ["writing"],
  "youre": ["you're", "your"],
  "alot": ["a lot"],
  "thankyou": ["thank you"],
  "aswell": ["as well"],
  "incase": ["in case"],
  "infact": ["in fact"],
};

// Business/formal writing suggestions
const INFORMAL_WORDS: Record<string, string[]> = {
  "gonna": ["going to"],
  "wanna": ["want to"],
  "gotta": ["got to", "have to"],
  "kinda": ["kind of", "somewhat"],
  "sorta": ["sort of"],
  "dunno": ["don't know"],
  "yeah": ["yes"],
  "nope": ["no"],
  "ok": ["okay", "acceptable"],
  "stuff": ["items", "materials", "content"],
  "things": ["items", "matters", "aspects"],
  "guy": ["person", "individual"],
  "guys": ["people", "everyone", "team"],
  "kids": ["children"],
  "cool": ["excellent", "acceptable", "impressive"],
  "awesome": ["excellent", "outstanding", "impressive"],
  "pretty": ["quite", "fairly", "rather"],
  "really": ["very", "truly", "certainly"],
  "basically": ["essentially", "fundamentally"],
  "actually": ["in fact", "indeed"],
  "literally": ["exactly", "precisely"],
  "obviously": ["clearly", "evidently"],
  "huge": ["significant", "substantial", "considerable"],
  "big": ["large", "significant", "major"],
  "good": ["excellent", "satisfactory", "beneficial"],
  "bad": ["poor", "unsatisfactory", "negative"],
  "nice": ["pleasant", "satisfactory", "appropriate"],
  "get": ["obtain", "receive", "acquire"],
  "got": ["received", "obtained", "acquired"],
  "a lot": ["many", "numerous", "significantly"],
};

export function useSpellCheck(text: string, enabled: boolean = true) {
  const [result, setResult] = useState<SpellCheckResult>({ errors: [], errorCount: 0 });
  const [isChecking, setIsChecking] = useState(false);
  const debounceRef = useRef<NodeJS.Timeout | null>(null);

  const checkSpelling = useCallback((inputText: string) => {
    if (!enabled || !inputText.trim()) {
      setResult({ errors: [], errorCount: 0 });
      return;
    }

    setIsChecking(true);

    // Extract words from text
    const words = inputText.match(/\b[a-zA-Z']+\b/g) || [];
    const errors: SpellError[] = [];
    const seenWords = new Set<string>();

    words.forEach((word) => {
      const lowerWord = word.toLowerCase();
      
      // Skip if already checked this word
      if (seenWords.has(lowerWord)) return;
      seenWords.add(lowerWord);

      // Check common misspellings
      if (COMMON_MISSPELLINGS[lowerWord]) {
        const index = inputText.toLowerCase().indexOf(lowerWord);
        if (index !== -1) {
          errors.push({
            word,
            index,
            suggestions: COMMON_MISSPELLINGS[lowerWord],
          });
        }
      }
    });

    setResult({ errors, errorCount: errors.length });
    setIsChecking(false);
  }, [enabled]);

  useEffect(() => {
    if (debounceRef.current) {
      clearTimeout(debounceRef.current);
    }

    debounceRef.current = setTimeout(() => {
      checkSpelling(text);
    }, 500);

    return () => {
      if (debounceRef.current) {
        clearTimeout(debounceRef.current);
      }
    };
  }, [text, checkSpelling]);

  return { result, isChecking };
}

export function useToneCheck(text: string, enabled: boolean = true) {
  const [informalWords, setInformalWords] = useState<{ word: string; suggestions: string[] }[]>([]);

  useEffect(() => {
    if (!enabled || !text.trim()) {
      setInformalWords([]);
      return;
    }

    const words = text.match(/\b[a-zA-Z']+\b/g) || [];
    const found: { word: string; suggestions: string[] }[] = [];
    const seenWords = new Set<string>();

    words.forEach((word) => {
      const lowerWord = word.toLowerCase();
      if (seenWords.has(lowerWord)) return;
      seenWords.add(lowerWord);

      if (INFORMAL_WORDS[lowerWord]) {
        found.push({
          word,
          suggestions: INFORMAL_WORDS[lowerWord],
        });
      }
    });

    setInformalWords(found);
  }, [text, enabled]);

  return { informalWords };
}

interface SpellCheckPanelProps {
  text: string;
  enabled: boolean;
  onReplaceWord: (oldWord: string, newWord: string) => void;
  compact?: boolean;
}

export default function SpellCheckPanel({ text, enabled, onReplaceWord, compact = false }: SpellCheckPanelProps) {
  const { result, isChecking } = useSpellCheck(text, enabled);
  const { informalWords } = useToneCheck(text, enabled);
  const [showToneCheck, setShowToneCheck] = useState(true);

  if (!enabled) return null;

  const totalIssues = result.errorCount + (showToneCheck ? informalWords.length : 0);

  if (compact) {
    return (
      <div className={`flex items-center gap-2 px-3 py-1.5 rounded-lg transition-colors ${
        totalIssues > 0 
          ? "bg-[#f0b866]/20 border border-[#f0b866]/30" 
          : "bg-[#4ade80]/20 border border-[#4ade80]/30"
      }`}>
        {isChecking ? (
          <span className="text-[#a0a0a0] text-sm">Checking...</span>
        ) : totalIssues > 0 ? (
          <>
            <span className="text-[#f0b866]">‚ö†Ô∏è</span>
            <span className="text-[#f0b866] text-sm">{totalIssues} issue{totalIssues !== 1 ? "s" : ""}</span>
          </>
        ) : (
          <>
            <span className="text-[#4ade80]">‚úì</span>
            <span className="text-[#4ade80] text-sm">No issues</span>
          </>
        )}
      </div>
    );
  }

  return (
    <div className="p-4 rounded-xl bg-[#12121a] border border-[#2a2a3a]">
      <div className="flex items-center justify-between mb-3">
        <h3 className="text-white font-medium">Writing Check</h3>
        <div className="flex items-center gap-2">
          <button
            onClick={() => setShowToneCheck(!showToneCheck)}
            className={`px-2 py-1 text-xs rounded transition-colors ${
              showToneCheck 
                ? "bg-[#a78bfa] text-white" 
                : "bg-[#2a2a3a] text-[#a0a0a0]"
            }`}
          >
            Tone
          </button>
        </div>
      </div>

      {isChecking ? (
        <div className="text-center py-4 text-[#666680]">
          <div className="inline-block w-4 h-4 border-2 border-[#a78bfa] border-t-transparent rounded-full animate-spin mr-2" />
          Checking...
        </div>
      ) : totalIssues === 0 ? (
        <div className="text-center py-4">
          <span className="text-[#4ade80] text-2xl">‚úì</span>
          <p className="text-[#4ade80] mt-1">No issues found</p>
        </div>
      ) : (
        <div className="space-y-3 max-h-60 overflow-auto">
          {/* Spelling Errors */}
          {result.errors.map((error, index) => (
            <div key={`spell-${index}`} className="p-3 rounded-lg bg-[#f87171]/10 border border-[#f87171]/30">
              <div className="flex items-center gap-2 mb-2">
                <span className="text-[#f87171]">üî§</span>
                <span className="text-white">Spelling: <span className="text-[#f87171] line-through">{error.word}</span></span>
              </div>
              <div className="flex flex-wrap gap-1">
                {error.suggestions.map((suggestion, i) => (
                  <button
                    key={i}
                    onClick={() => onReplaceWord(error.word, suggestion)}
                    className="px-2 py-1 text-xs rounded bg-[#4ade80]/20 text-[#4ade80] hover:bg-[#4ade80]/30 transition-colors"
                  >
                    {suggestion}
                  </button>
                ))}
              </div>
            </div>
          ))}

          {/* Informal Words */}
          {showToneCheck && informalWords.map((item, index) => (
            <div key={`tone-${index}`} className="p-3 rounded-lg bg-[#f0b866]/10 border border-[#f0b866]/30">
              <div className="flex items-center gap-2 mb-2">
                <span className="text-[#f0b866]">üíº</span>
                <span className="text-white">Informal: <span className="text-[#f0b866]">{item.word}</span></span>
              </div>
              <div className="flex flex-wrap gap-1">
                {item.suggestions.map((suggestion, i) => (
                  <button
                    key={i}
                    onClick={() => onReplaceWord(item.word, suggestion)}
                    className="px-2 py-1 text-xs rounded bg-[#4ecdc4]/20 text-[#4ecdc4] hover:bg-[#4ecdc4]/30 transition-colors"
                  >
                    {suggestion}
                  </button>
                ))}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// Readability score calculator
export function calculateReadability(text: string): { score: number; grade: string; description: string } {
  if (!text.trim()) {
    return { score: 0, grade: "-", description: "No text" };
  }

  // Count sentences, words, syllables
  const sentences = text.split(/[.!?]+/).filter(s => s.trim()).length || 1;
  const words = text.match(/\b\w+\b/g) || [];
  const wordCount = words.length || 1;
  
  // Estimate syllables (simple approximation)
  const syllableCount = words.reduce((count, word) => {
    return count + countSyllables(word);
  }, 0);

  // Flesch Reading Ease formula
  const avgSentenceLength = wordCount / sentences;
  const avgSyllablesPerWord = syllableCount / wordCount;
  const fleschScore = 206.835 - (1.015 * avgSentenceLength) - (84.6 * avgSyllablesPerWord);
  const score = Math.max(0, Math.min(100, Math.round(fleschScore)));

  // Convert to grade level
  let grade: string;
  let description: string;
  
  if (score >= 90) { grade = "5th"; description = "Very Easy"; }
  else if (score >= 80) { grade = "6th"; description = "Easy"; }
  else if (score >= 70) { grade = "7th"; description = "Fairly Easy"; }
  else if (score >= 60) { grade = "8-9th"; description = "Standard"; }
  else if (score >= 50) { grade = "10-12th"; description = "Fairly Difficult"; }
  else if (score >= 30) { grade = "College"; description = "Difficult"; }
  else { grade = "Graduate"; description = "Very Difficult"; }

  return { score, grade, description };
}

function countSyllables(word: string): number {
  word = word.toLowerCase();
  if (word.length <= 3) return 1;
  
  word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '');
  word = word.replace(/^y/, '');
  const matches = word.match(/[aeiouy]{1,2}/g);
  return matches ? matches.length : 1;
}

interface ReadabilityIndicatorProps {
  text: string;
}

export function ReadabilityIndicator({ text }: ReadabilityIndicatorProps) {
  const [readability, setReadability] = useState({ score: 0, grade: "-", description: "No text" });

  useEffect(() => {
    const result = calculateReadability(text);
    setReadability(result);
  }, [text]);

  const getColor = () => {
    if (readability.score >= 70) return "#4ade80";
    if (readability.score >= 50) return "#f0b866";
    return "#f87171";
  };

  return (
    <div className="flex items-center gap-3 px-3 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
      <div 
        className="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold"
        style={{ backgroundColor: `${getColor()}20`, color: getColor() }}
      >
        {readability.score}
      </div>
      <div>
        <div className="text-white text-sm">{readability.description}</div>
        <div className="text-[#666680] text-xs">{readability.grade} grade level</div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/StreakTracker.tsx">
"use client";

import { useState, useEffect } from "react";

interface StreakData {
  currentStreak: number;
  longestStreak: number;
  lastDocumentDate: string | null;
  totalDocuments: number;
  achievements: string[];
}

const DEFAULT_STREAK: StreakData = {
  currentStreak: 0,
  longestStreak: 0,
  lastDocumentDate: null,
  totalDocuments: 0,
  achievements: [],
};

const ACHIEVEMENTS = [
  { id: "first_doc", name: "First Document", description: "Create your first document", icon: "üìÑ", requirement: (data: StreakData) => data.totalDocuments >= 1 },
  { id: "streak_3", name: "Getting Started", description: "3 day streak", icon: "üî•", requirement: (data: StreakData) => data.currentStreak >= 3 },
  { id: "streak_7", name: "Week Warrior", description: "7 day streak", icon: "‚ö°", requirement: (data: StreakData) => data.currentStreak >= 7 },
  { id: "streak_30", name: "Month Master", description: "30 day streak", icon: "üèÜ", requirement: (data: StreakData) => data.currentStreak >= 30 },
  { id: "docs_10", name: "Prolific Writer", description: "Create 10 documents", icon: "‚úçÔ∏è", requirement: (data: StreakData) => data.totalDocuments >= 10 },
  { id: "docs_50", name: "Document Pro", description: "Create 50 documents", icon: "üìö", requirement: (data: StreakData) => data.totalDocuments >= 50 },
  { id: "docs_100", name: "Century Club", description: "Create 100 documents", icon: "üíØ", requirement: (data: StreakData) => data.totalDocuments >= 100 },
];

export function useStreak() {
  const [streak, setStreak] = useState<StreakData>(DEFAULT_STREAK);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem("streakData");
    if (saved) {
      try {
        const data = JSON.parse(saved);
        // Check if streak should be reset
        const today = new Date().toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        
        if (data.lastDocumentDate) {
          const lastDate = new Date(data.lastDocumentDate).toDateString();
          if (lastDate !== today && lastDate !== yesterday) {
            // Streak broken
            data.currentStreak = 0;
          }
        }
        setStreak(data);
      } catch (e) {
        console.error("Error loading streak:", e);
      }
    }
  }, []);

  const recordDocument = () => {
    const today = new Date().toDateString();
    const newStreak = { ...streak };
    
    if (newStreak.lastDocumentDate) {
      const lastDate = new Date(newStreak.lastDocumentDate).toDateString();
      const yesterday = new Date(Date.now() - 86400000).toDateString();
      
      if (lastDate === today) {
        // Already recorded today
        newStreak.totalDocuments += 1;
      } else if (lastDate === yesterday) {
        // Continue streak
        newStreak.currentStreak += 1;
        newStreak.totalDocuments += 1;
      } else {
        // Streak broken, start new
        newStreak.currentStreak = 1;
        newStreak.totalDocuments += 1;
      }
    } else {
      // First document
      newStreak.currentStreak = 1;
      newStreak.totalDocuments = 1;
    }
    
    newStreak.lastDocumentDate = new Date().toISOString();
    newStreak.longestStreak = Math.max(newStreak.longestStreak, newStreak.currentStreak);
    
    // Check for new achievements
    const newAchievements: string[] = [];
    ACHIEVEMENTS.forEach((achievement) => {
      if (achievement.requirement(newStreak) && !newStreak.achievements.includes(achievement.id)) {
        newStreak.achievements.push(achievement.id);
        newAchievements.push(achievement.name);
      }
    });
    
    setStreak(newStreak);
    localStorage.setItem("streakData", JSON.stringify(newStreak));
    
    return newAchievements;
  };

  return { streak, recordDocument, mounted, ACHIEVEMENTS };
}

interface StreakDisplayProps {
  compact?: boolean;
}

export default function StreakDisplay({ compact = false }: StreakDisplayProps) {
  const { streak, mounted, ACHIEVEMENTS } = useStreak();

  if (!mounted) return null;

  if (compact) {
    return (
      <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gradient-to-r from-[#f87171]/20 to-[#f0b866]/20 border border-[#f87171]/30">
        <span className="text-lg">üî•</span>
        <span className="text-white font-bold">{streak.currentStreak}</span>
        <span className="text-[#a0a0a0] text-sm">day streak</span>
      </div>
    );
  }

  return (
    <div className="p-6 rounded-xl bg-[#12121a] border border-[#2a2a3a]">
      {/* Streak Info */}
      <div className="flex items-center justify-between mb-6">
        <div>
          <h3 className="text-lg text-white mb-1">Document Streak</h3>
          <p className="text-sm text-[#666680]">Keep creating documents daily!</p>
        </div>
        <div className="text-center">
          <div className="text-4xl font-bold gradient-text">{streak.currentStreak}</div>
          <div className="text-xs text-[#666680]">current</div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-3 gap-4 mb-6">
        <div className="text-center p-3 rounded-lg bg-[#1a1a24]">
          <div className="text-xl font-bold text-[#f0b866]">{streak.longestStreak}</div>
          <div className="text-xs text-[#666680]">Best Streak</div>
        </div>
        <div className="text-center p-3 rounded-lg bg-[#1a1a24]">
          <div className="text-xl font-bold text-[#4ecdc4]">{streak.totalDocuments}</div>
          <div className="text-xs text-[#666680]">Total Docs</div>
        </div>
        <div className="text-center p-3 rounded-lg bg-[#1a1a24]">
          <div className="text-xl font-bold text-[#a78bfa]">{streak.achievements.length}</div>
          <div className="text-xs text-[#666680]">Badges</div>
        </div>
      </div>

      {/* Achievements */}
      <div>
        <h4 className="text-sm font-medium text-[#a78bfa] mb-3">Achievements</h4>
        <div className="grid grid-cols-4 gap-2">
          {ACHIEVEMENTS.map((achievement) => {
            const unlocked = streak.achievements.includes(achievement.id);
            return (
              <div
                key={achievement.id}
                className={`p-2 rounded-lg text-center transition-all ${
                  unlocked
                    ? "bg-gradient-to-br from-[#a78bfa]/20 to-[#f472b6]/20 border border-[#a78bfa]/30"
                    : "bg-[#1a1a24] border border-[#2a2a3a] opacity-50"
                }`}
                title={`${achievement.name}: ${achievement.description}`}
              >
                <div className="text-2xl mb-1">{unlocked ? achievement.icon : "üîí"}</div>
                <div className="text-[10px] text-[#a0a0a0] truncate">{achievement.name}</div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/TeamWorkspaces.tsx">
"use client";

import { useState } from "react";

interface TeamMember {
  id: string;
  name: string;
  email: string;
  role: "admin" | "editor" | "viewer";
  avatar?: string;
}

interface Workspace {
  id: string;
  name: string;
  members: TeamMember[];
  templatesCount: number;
  documentsCount: number;
}

// Mock data for UI demonstration
const MOCK_WORKSPACES: Workspace[] = [
  {
    id: "personal",
    name: "Personal",
    members: [{ id: "1", name: "You", email: "you@example.com", role: "admin" }],
    templatesCount: 12,
    documentsCount: 47,
  },
];

interface TeamWorkspacesProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function TeamWorkspaces({ isOpen, onClose }: TeamWorkspacesProps) {
  const [workspaces, setWorkspaces] = useState<Workspace[]>(MOCK_WORKSPACES);
  const [activeWorkspace, setActiveWorkspace] = useState<string>("personal");
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [showInviteModal, setShowInviteModal] = useState(false);
  const [newWorkspaceName, setNewWorkspaceName] = useState("");
  const [inviteEmail, setInviteEmail] = useState("");
  const [inviteRole, setInviteRole] = useState<TeamMember["role"]>("editor");

  const handleCreateWorkspace = () => {
    if (!newWorkspaceName.trim()) return;
    
    const newWorkspace: Workspace = {
      id: `workspace-${Date.now()}`,
      name: newWorkspaceName,
      members: [{ id: "1", name: "You", email: "you@example.com", role: "admin" }],
      templatesCount: 0,
      documentsCount: 0,
    };
    
    setWorkspaces([...workspaces, newWorkspace]);
    setActiveWorkspace(newWorkspace.id);
    setNewWorkspaceName("");
    setShowCreateModal(false);
  };

  const handleInvite = () => {
    if (!inviteEmail.trim()) return;
    
    const newMember: TeamMember = {
      id: `member-${Date.now()}`,
      name: inviteEmail.split("@")[0],
      email: inviteEmail,
      role: inviteRole,
    };
    
    setWorkspaces(workspaces.map(w => 
      w.id === activeWorkspace 
        ? { ...w, members: [...w.members, newMember] }
        : w
    ));
    
    setInviteEmail("");
    setShowInviteModal(false);
  };

  const getRoleColor = (role: TeamMember["role"]) => {
    switch (role) {
      case "admin": return "#f87171";
      case "editor": return "#4ecdc4";
      case "viewer": return "#a0a0a0";
    }
  };

  if (!isOpen) return null;

  const currentWorkspace = workspaces.find(w => w.id === activeWorkspace);

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-4xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üë• Team Workspaces</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        {/* Content */}
        <div className="flex flex-1 overflow-hidden">
          {/* Sidebar */}
          <div className="w-64 border-r border-[#2a2a3a] p-4">
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-sm font-medium text-[#a0a0a0]">Workspaces</h3>
              <button
                onClick={() => setShowCreateModal(true)}
                className="text-[#a78bfa] hover:text-[#c4b5fd] text-sm"
              >
                + New
              </button>
            </div>
            
            <div className="space-y-2">
              {workspaces.map(workspace => (
                <button
                  key={workspace.id}
                  onClick={() => setActiveWorkspace(workspace.id)}
                  className={`w-full p-3 rounded-lg text-left transition-colors ${
                    activeWorkspace === workspace.id
                      ? "bg-[#a78bfa]/20 border border-[#a78bfa]/50"
                      : "hover:bg-[#1a1a24]"
                  }`}
                >
                  <div className="text-white font-medium">{workspace.name}</div>
                  <div className="text-xs text-[#666680]">
                    {workspace.members.length} member{workspace.members.length !== 1 ? "s" : ""}
                  </div>
                </button>
              ))}
            </div>

            {/* Pro Banner */}
            <div className="mt-6 p-4 rounded-lg bg-gradient-to-br from-[#a78bfa]/20 to-[#f472b6]/20 border border-[#a78bfa]/30">
              <div className="text-sm font-medium text-white mb-1">‚≠ê Upgrade to Pro</div>
              <div className="text-xs text-[#a0a0a0] mb-3">Unlock unlimited workspaces and team features</div>
              <button className="w-full py-2 rounded-lg bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white text-sm">
                Upgrade
              </button>
            </div>
          </div>

          {/* Main Content */}
          <div className="flex-1 p-6 overflow-auto">
            {currentWorkspace && (
              <>
                {/* Workspace Header */}
                <div className="flex items-center justify-between mb-6">
                  <div>
                    <h3 className="text-2xl text-white font-semibold">{currentWorkspace.name}</h3>
                    <p className="text-sm text-[#666680]">
                      {currentWorkspace.templatesCount} templates ‚Ä¢ {currentWorkspace.documentsCount} documents
                    </p>
                  </div>
                  <button
                    onClick={() => setShowInviteModal(true)}
                    className="px-4 py-2 rounded-lg bg-[#4ecdc4] text-[#0a0a12] hover:bg-[#3dbdb5] transition-colors"
                  >
                    + Invite
                  </button>
                </div>

                {/* Members */}
                <div className="mb-6">
                  <h4 className="text-sm font-medium text-[#a0a0a0] mb-3">Team Members</h4>
                  <div className="space-y-2">
                    {currentWorkspace.members.map(member => (
                      <div key={member.id} className="flex items-center justify-between p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-full bg-gradient-to-br from-[#a78bfa] to-[#f472b6] flex items-center justify-center text-white font-medium">
                            {member.name.charAt(0).toUpperCase()}
                          </div>
                          <div>
                            <div className="text-white">{member.name}</div>
                            <div className="text-sm text-[#666680]">{member.email}</div>
                          </div>
                        </div>
                        <span 
                          className="px-3 py-1 rounded-full text-xs capitalize"
                          style={{ backgroundColor: `${getRoleColor(member.role)}20`, color: getRoleColor(member.role) }}
                        >
                          {member.role}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Feature Placeholder */}
                <div className="p-6 rounded-xl border-2 border-dashed border-[#2a2a3a] text-center">
                  <p className="text-[#666680]">üöÄ Team collaboration features coming soon!</p>
                  <p className="text-sm text-[#4a4a5a] mt-1">Share templates, track changes, and work together in real-time.</p>
                </div>
              </>
            )}
          </div>
        </div>
      </div>

      {/* Create Workspace Modal */}
      {showCreateModal && (
        <div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4" onClick={() => setShowCreateModal(false)}>
          <div className="bg-[#12121a] rounded-xl p-6 max-w-md w-full border border-[#2a2a3a]" onClick={(e) => e.stopPropagation()}>
            <h3 className="text-lg text-white font-medium mb-4">Create Workspace</h3>
            <input
              type="text"
              value={newWorkspaceName}
              onChange={(e) => setNewWorkspaceName(e.target.value)}
              placeholder="Workspace name"
              className="w-full px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white mb-4"
              autoFocus
            />
            <div className="flex gap-2">
              <button
                onClick={() => setShowCreateModal(false)}
                className="flex-1 py-2 rounded-lg bg-[#2a2a3a] text-white"
              >
                Cancel
              </button>
              <button
                onClick={handleCreateWorkspace}
                className="flex-1 py-2 rounded-lg bg-[#a78bfa] text-white"
              >
                Create
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Invite Modal */}
      {showInviteModal && (
        <div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4" onClick={() => setShowInviteModal(false)}>
          <div className="bg-[#12121a] rounded-xl p-6 max-w-md w-full border border-[#2a2a3a]" onClick={(e) => e.stopPropagation()}>
            <h3 className="text-lg text-white font-medium mb-4">Invite Team Member</h3>
            <input
              type="email"
              value={inviteEmail}
              onChange={(e) => setInviteEmail(e.target.value)}
              placeholder="Email address"
              className="w-full px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white mb-3"
              autoFocus
            />
            <select
              value={inviteRole}
              onChange={(e) => setInviteRole(e.target.value as TeamMember["role"])}
              className="w-full px-4 py-2 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-white mb-4"
            >
              <option value="viewer">Viewer - Can view documents</option>
              <option value="editor">Editor - Can edit documents</option>
              <option value="admin">Admin - Full access</option>
            </select>
            <div className="flex gap-2">
              <button
                onClick={() => setShowInviteModal(false)}
                className="flex-1 py-2 rounded-lg bg-[#2a2a3a] text-white"
              >
                Cancel
              </button>
              <button
                onClick={handleInvite}
                className="flex-1 py-2 rounded-lg bg-[#4ecdc4] text-[#0a0a12]"
              >
                Send Invite
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/TemplateAnalytics.tsx">
"use client";

import { useState, useEffect } from "react";

interface TemplateUsage {
  templateId: string;
  templateName: string;
  count: number;
  lastUsed: string;
}

interface AnalyticsData {
  templateUsage: TemplateUsage[];
  totalDocuments: number;
  totalTimeMinutes: number;
  averageTimeMinutes: number;
  documentsThisWeek: number;
  documentsThisMonth: number;
}

const STORAGE_KEY = "templateAnalytics";

export function useTemplateAnalytics() {
  const [analytics, setAnalytics] = useState<AnalyticsData>({
    templateUsage: [],
    totalDocuments: 0,
    totalTimeMinutes: 0,
    averageTimeMinutes: 0,
    documentsThisWeek: 0,
    documentsThisMonth: 0,
  });
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    loadAnalytics();
  }, []);

  const loadAnalytics = () => {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      try {
        setAnalytics(JSON.parse(saved));
      } catch (e) {
        console.error("Error loading analytics:", e);
      }
    }
  };

  const recordTemplateUse = (templateId: string, templateName: string, timeSpentMinutes: number) => {
    const updated = { ...analytics };
    
    // Update template usage
    const existingIndex = updated.templateUsage.findIndex(t => t.templateId === templateId);
    if (existingIndex >= 0) {
      updated.templateUsage[existingIndex].count += 1;
      updated.templateUsage[existingIndex].lastUsed = new Date().toISOString();
    } else {
      updated.templateUsage.push({
        templateId,
        templateName,
        count: 1,
        lastUsed: new Date().toISOString(),
      });
    }
    
    // Sort by count descending
    updated.templateUsage.sort((a, b) => b.count - a.count);
    
    // Update totals
    updated.totalDocuments += 1;
    updated.totalTimeMinutes += timeSpentMinutes;
    updated.averageTimeMinutes = Math.round(updated.totalTimeMinutes / updated.totalDocuments);
    
    // Update weekly/monthly counts
    const now = new Date();
    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
    const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
    
    // Recalculate from history
    const history = JSON.parse(localStorage.getItem("documentHistory") || "[]");
    updated.documentsThisWeek = history.filter((h: any) => new Date(h.createdAt) > weekAgo).length + 1;
    updated.documentsThisMonth = history.filter((h: any) => new Date(h.createdAt) > monthAgo).length + 1;
    
    setAnalytics(updated);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));
  };

  const clearAnalytics = () => {
    const empty: AnalyticsData = {
      templateUsage: [],
      totalDocuments: 0,
      totalTimeMinutes: 0,
      averageTimeMinutes: 0,
      documentsThisWeek: 0,
      documentsThisMonth: 0,
    };
    setAnalytics(empty);
    localStorage.removeItem(STORAGE_KEY);
  };

  return { analytics, recordTemplateUse, clearAnalytics, mounted };
}

interface TemplateAnalyticsProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function TemplateAnalytics({ isOpen, onClose }: TemplateAnalyticsProps) {
  const { analytics, clearAnalytics } = useTemplateAnalytics();

  if (!isOpen) return null;

  const maxCount = Math.max(...analytics.templateUsage.map(t => t.count), 1);
  const totalUsage = analytics.templateUsage.reduce((sum, t) => sum + t.count, 0);

  const colors = [
    "#a78bfa", "#4ecdc4", "#f472b6", "#f0b866", "#60a5fa", 
    "#4ade80", "#f87171", "#fb923c", "#c084fc", "#22d3ee"
  ];

  const formatTime = (minutes: number) => {
    if (minutes < 60) return `${minutes}m`;
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return `${hours}h ${mins}m`;
  };

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-3xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl shadow-[#a78bfa]/10">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üìä Template Analytics</h2>
          <div className="flex items-center gap-2">
            <button
              onClick={clearAnalytics}
              className="px-3 py-1.5 rounded-lg text-sm text-[#f87171] hover:bg-[#f87171]/10 transition-colors"
            >
              Reset
            </button>
            <button onClick={onClose} className="text-[#666680] hover:text-white transition-colors text-2xl">√ó</button>
          </div>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {/* Stats Overview */}
          <div className="grid grid-cols-4 gap-4 mb-8">
            <div className="p-4 rounded-xl bg-gradient-to-br from-[#a78bfa]/20 to-[#a78bfa]/5 border border-[#a78bfa]/30">
              <div className="text-3xl font-bold text-[#a78bfa]">{analytics.totalDocuments}</div>
              <div className="text-sm text-[#a0a0a0]">Total Documents</div>
            </div>
            <div className="p-4 rounded-xl bg-gradient-to-br from-[#4ecdc4]/20 to-[#4ecdc4]/5 border border-[#4ecdc4]/30">
              <div className="text-3xl font-bold text-[#4ecdc4]">{analytics.documentsThisWeek}</div>
              <div className="text-sm text-[#a0a0a0]">This Week</div>
            </div>
            <div className="p-4 rounded-xl bg-gradient-to-br from-[#f472b6]/20 to-[#f472b6]/5 border border-[#f472b6]/30">
              <div className="text-3xl font-bold text-[#f472b6]">{formatTime(analytics.totalTimeMinutes)}</div>
              <div className="text-sm text-[#a0a0a0]">Total Time</div>
            </div>
            <div className="p-4 rounded-xl bg-gradient-to-br from-[#f0b866]/20 to-[#f0b866]/5 border border-[#f0b866]/30">
              <div className="text-3xl font-bold text-[#f0b866]">{formatTime(analytics.averageTimeMinutes)}</div>
              <div className="text-sm text-[#a0a0a0]">Avg per Doc</div>
            </div>
          </div>

          {/* Most Used Templates */}
          <div className="mb-8">
            <h3 className="text-lg text-white mb-4">Most Used Templates</h3>
            {analytics.templateUsage.length === 0 ? (
              <div className="text-center py-8 text-[#666680]">
                <p>No template usage data yet.</p>
                <p className="text-sm mt-2">Start creating documents to see analytics!</p>
              </div>
            ) : (
              <div className="space-y-3">
                {analytics.templateUsage.slice(0, 10).map((template, index) => {
                  const percentage = Math.round((template.count / totalUsage) * 100);
                  const barWidth = (template.count / maxCount) * 100;
                  const color = colors[index % colors.length];
                  
                  return (
                    <div key={template.templateId} className="group">
                      <div className="flex items-center justify-between mb-1">
                        <span className="text-white text-sm truncate flex-1">{template.templateName}</span>
                        <span className="text-[#a0a0a0] text-sm ml-2">{template.count} ({percentage}%)</span>
                      </div>
                      <div className="h-8 rounded-lg bg-[#1a1a24] overflow-hidden relative">
                        <div 
                          className="h-full rounded-lg transition-all duration-500 flex items-center px-3"
                          style={{ 
                            width: `${barWidth}%`, 
                            backgroundColor: color,
                            minWidth: '40px'
                          }}
                        >
                          <span className="text-xs text-white font-medium opacity-0 group-hover:opacity-100 transition-opacity">
                            {template.count} uses
                          </span>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>

          {/* Pie Chart */}
          {analytics.templateUsage.length > 0 && (
            <div className="mb-8">
              <h3 className="text-lg text-white mb-4">Distribution</h3>
              <div className="flex items-center gap-8">
                {/* Simple CSS Pie Chart */}
                <div className="relative w-48 h-48">
                  <svg viewBox="0 0 100 100" className="w-full h-full transform -rotate-90">
                    {analytics.templateUsage.slice(0, 8).reduce((acc, template, index) => {
                      const percentage = (template.count / totalUsage) * 100;
                      const previousOffset = acc.offset;
                      acc.offset += percentage;
                      acc.elements.push(
                        <circle
                          key={template.templateId}
                          cx="50"
                          cy="50"
                          r="40"
                          fill="none"
                          stroke={colors[index % colors.length]}
                          strokeWidth="20"
                          strokeDasharray={`${percentage * 2.51} ${251 - percentage * 2.51}`}
                          strokeDashoffset={-previousOffset * 2.51}
                          className="transition-all duration-500"
                        />
                      );
                      return acc;
                    }, { elements: [] as JSX.Element[], offset: 0 }).elements}
                  </svg>
                  <div className="absolute inset-0 flex items-center justify-center">
                    <div className="text-center">
                      <div className="text-2xl font-bold text-white">{analytics.templateUsage.length}</div>
                      <div className="text-xs text-[#666680]">templates</div>
                    </div>
                  </div>
                </div>

                {/* Legend */}
                <div className="flex-1 grid grid-cols-2 gap-2">
                  {analytics.templateUsage.slice(0, 8).map((template, index) => (
                    <div key={template.templateId} className="flex items-center gap-2">
                      <div 
                        className="w-3 h-3 rounded-full"
                        style={{ backgroundColor: colors[index % colors.length] }}
                      />
                      <span className="text-sm text-[#a0a0a0] truncate">{template.templateName}</span>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* Recent Activity */}
          {analytics.templateUsage.length > 0 && (
            <div>
              <h3 className="text-lg text-white mb-4">Recent Activity</h3>
              <div className="space-y-2">
                {analytics.templateUsage
                  .sort((a, b) => new Date(b.lastUsed).getTime() - new Date(a.lastUsed).getTime())
                  .slice(0, 5)
                  .map((template) => {
                    const lastUsed = new Date(template.lastUsed);
                    const now = new Date();
                    const diff = now.getTime() - lastUsed.getTime();
                    let timeAgo = "";
                    if (diff < 60000) timeAgo = "Just now";
                    else if (diff < 3600000) timeAgo = `${Math.floor(diff / 60000)}m ago`;
                    else if (diff < 86400000) timeAgo = `${Math.floor(diff / 3600000)}h ago`;
                    else timeAgo = `${Math.floor(diff / 86400000)}d ago`;
                    
                    return (
                      <div key={template.templateId} className="flex items-center justify-between p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                        <span className="text-white">{template.templateName}</span>
                        <span className="text-sm text-[#666680]">{timeAgo}</span>
                      </div>
                    );
                  })}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/TemplateCategories.tsx">
"use client";

import { useState, useMemo } from "react";
import {
  Search,
  X,
  FileText,
  Briefcase,
  Scale,
  Heart,
  GraduationCap,
  Building2,
  Users,
  Star,
  Clock,
  Filter,
  Grid3X3,
  List,
} from "lucide-react";
import { DocumentTemplate, documentTemplates } from "@/data/templates";

// Template categories
export const templateCategories = [
  { id: "all", name: "All Templates", icon: <Grid3X3 className="w-4 h-4" />, color: "#7a756d" },
  { id: "hr", name: "HR & Employment", icon: <Briefcase className="w-4 h-4" />, color: "#e07a5f" },
  { id: "legal", name: "Legal", icon: <Scale className="w-4 h-4" />, color: "#3d405b" },
  { id: "business", name: "Business", icon: <Building2 className="w-4 h-4" />, color: "#81b29a" },
  { id: "personal", name: "Personal", icon: <Heart className="w-4 h-4" />, color: "#f2cc8f" },
  { id: "academic", name: "Academic", icon: <GraduationCap className="w-4 h-4" />, color: "#6b7fd7" },
  { id: "reference", name: "References", icon: <Users className="w-4 h-4" />, color: "#e07a5f" },
];

// Map document types to categories
const categoryMapping: Record<string, string[]> = {
  hr: ["Letter of Employment", "Letter of Termination", "Letter of Resignation"],
  legal: ["Letter of Agreement", "Letter of Authorization", "Letter of Confirmation"],
  business: ["Letter of Introduction", "Letter of Inquiry", "Letter of Request", "Letter of Complaint"],
  personal: ["Letter of Apology", "Letter of Acceptance", "Letter of Rejection"],
  academic: ["Letter of Recommendation"],
  reference: ["Letter of Recommendation", "Letter of Reference"],
};

interface TemplateCategoriesProps {
  isOpen: boolean;
  onClose: () => void;
  onSelectTemplate: (template: DocumentTemplate) => void;
  userTemplates?: DocumentTemplate[];
}

export default function TemplateCategories({
  isOpen,
  onClose,
  onSelectTemplate,
  userTemplates = [],
}: TemplateCategoriesProps) {
  const [searchQuery, setSearchQuery] = useState("");
  const [selectedCategory, setSelectedCategory] = useState("all");
  const [viewMode, setViewMode] = useState<"grid" | "list">("grid");
  const [sortBy, setSortBy] = useState<"name" | "recent" | "popular">("name");

  // Combine built-in and user templates
  const allTemplates = useMemo(() => {
    const combined = [...documentTemplates];
    userTemplates.forEach((ut) => {
      if (!combined.find((t) => t.id === ut.id)) {
        combined.push(ut);
      }
    });
    return combined;
  }, [userTemplates]);

  // Filter templates
  const filteredTemplates = useMemo(() => {
    let filtered = allTemplates;

    // Filter by category
    if (selectedCategory !== "all") {
      const categoryTypes = categoryMapping[selectedCategory] || [];
      filtered = filtered.filter((t) => categoryTypes.includes(t.documentType));
    }

    // Filter by search
    if (searchQuery) {
      const query = searchQuery.toLowerCase();
      filtered = filtered.filter(
        (t) =>
          t.name.toLowerCase().includes(query) ||
          t.documentType.toLowerCase().includes(query) ||
          t.bodyText.toLowerCase().includes(query)
      );
    }

    // Sort
    if (sortBy === "name") {
      filtered.sort((a, b) => a.name.localeCompare(b.name));
    }

    return filtered;
  }, [allTemplates, selectedCategory, searchQuery, sortBy]);

  // Get category for a template
  const getTemplateCategory = (template: DocumentTemplate) => {
    for (const [catId, types] of Object.entries(categoryMapping)) {
      if (types.includes(template.documentType)) {
        return templateCategories.find((c) => c.id === catId);
      }
    }
    return templateCategories[0];
  };

  if (!isOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="w-full max-w-5xl max-h-[85vh] bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter flex flex-col"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h2 className="text-2xl font-bold">Template Gallery</h2>
              <p className="text-sm text-[--text-muted]">
                {filteredTemplates.length} templates available
              </p>
            </div>
            <button
              onClick={onClose}
              className="p-2 rounded-xl hover:bg-[--bg-elevated] text-[--text-muted] hover:text-[--text-primary] transition-colors"
            >
              <X className="w-6 h-6" />
            </button>
          </div>

          {/* Search & Filters */}
          <div className="flex flex-wrap gap-3">
            <div className="relative flex-1 min-w-[200px]">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[--text-muted]" />
              <input
                type="text"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                placeholder="Search templates..."
                className="w-full pl-10 pr-4 py-2.5 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary]"
              />
              {searchQuery && (
                <button
                  onClick={() => setSearchQuery("")}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-[--text-muted] hover:text-[--text-primary]"
                >
                  <X className="w-4 h-4" />
                </button>
              )}
            </div>

            <select
              value={sortBy}
              onChange={(e) => setSortBy(e.target.value as any)}
              className="px-4 py-2.5 rounded-xl bg-[--bg-elevated] border border-[--border-default] text-sm"
            >
              <option value="name">Sort by Name</option>
              <option value="recent">Recently Used</option>
              <option value="popular">Most Popular</option>
            </select>

            <div className="flex rounded-xl border border-[--border-default] overflow-hidden">
              <button
                onClick={() => setViewMode("grid")}
                className={`p-2.5 ${viewMode === "grid" ? "bg-[--color-primary] text-white" : "bg-[--bg-elevated] text-[--text-muted]"}`}
              >
                <Grid3X3 className="w-5 h-5" />
              </button>
              <button
                onClick={() => setViewMode("list")}
                className={`p-2.5 ${viewMode === "list" ? "bg-[--color-primary] text-white" : "bg-[--bg-elevated] text-[--text-muted]"}`}
              >
                <List className="w-5 h-5" />
              </button>
            </div>
          </div>
        </div>

        <div className="flex flex-1 overflow-hidden">
          {/* Sidebar - Categories */}
          <div className="w-56 border-r border-[--border-default] p-4 overflow-y-auto hidden md:block">
            <h3 className="text-xs font-semibold uppercase tracking-wider text-[--text-muted] mb-3">
              Categories
            </h3>
            <div className="space-y-1">
              {templateCategories.map((category) => {
                const count =
                  category.id === "all"
                    ? allTemplates.length
                    : allTemplates.filter((t) =>
                        (categoryMapping[category.id] || []).includes(t.documentType)
                      ).length;

                return (
                  <button
                    key={category.id}
                    onClick={() => setSelectedCategory(category.id)}
                    className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all ${
                      selectedCategory === category.id
                        ? "bg-[--color-primary]/10 text-[--color-primary]"
                        : "text-[--text-secondary] hover:bg-[--bg-elevated]"
                    }`}
                  >
                    <span style={{ color: category.color }}>{category.icon}</span>
                    <span className="flex-1 text-left text-sm">{category.name}</span>
                    <span className="text-xs text-[--text-muted]">{count}</span>
                  </button>
                );
              })}
            </div>

            {userTemplates.length > 0 && (
              <>
                <div className="my-4 border-t border-[--border-default]" />
                <h3 className="text-xs font-semibold uppercase tracking-wider text-[--text-muted] mb-3">
                  My Templates
                </h3>
                <div className="space-y-1">
                  <button
                    onClick={() => setSelectedCategory("custom")}
                    className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all ${
                      selectedCategory === "custom"
                        ? "bg-[--color-primary]/10 text-[--color-primary]"
                        : "text-[--text-secondary] hover:bg-[--bg-elevated]"
                    }`}
                  >
                    <Star className="w-4 h-4 text-[--color-warning]" />
                    <span className="flex-1 text-left text-sm">Custom</span>
                    <span className="text-xs text-[--text-muted]">{userTemplates.length}</span>
                  </button>
                </div>
              </>
            )}
          </div>

          {/* Template Grid */}
          <div className="flex-1 p-6 overflow-y-auto">
            {filteredTemplates.length === 0 ? (
              <div className="flex flex-col items-center justify-center h-full text-center">
                <Search className="w-16 h-16 text-[--text-muted] opacity-30 mb-4" />
                <h3 className="text-lg font-semibold mb-2">No templates found</h3>
                <p className="text-[--text-muted]">
                  Try a different search term or category
                </p>
              </div>
            ) : viewMode === "grid" ? (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {filteredTemplates.map((template) => {
                  const category = getTemplateCategory(template);
                  return (
                    <button
                      key={template.id}
                      onClick={() => {
                        onSelectTemplate(template);
                        onClose();
                      }}
                      className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary] transition-all text-left group hover:shadow-lg"
                    >
                      {/* Preview */}
                      <div className="aspect-[4/3] rounded-lg bg-white mb-3 overflow-hidden relative">
                        <div className="absolute inset-0 p-3 text-[6px] text-gray-400 leading-tight overflow-hidden">
                          <div className="font-bold text-gray-600 mb-1">{template.documentType}</div>
                          {template.bodyText.slice(0, 200)}...
                        </div>
                        <div className="absolute inset-0 bg-gradient-to-t from-white via-transparent to-transparent" />
                      </div>

                      {/* Info */}
                      <div className="flex items-start gap-2">
                        <div
                          className="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0"
                          style={{ backgroundColor: `${category?.color}20`, color: category?.color }}
                        >
                          {category?.icon || <FileText className="w-4 h-4" />}
                        </div>
                        <div className="flex-1 min-w-0">
                          <h4 className="font-semibold text-sm truncate group-hover:text-[--color-primary] transition-colors">
                            {template.name}
                          </h4>
                          <p className="text-xs text-[--text-muted] truncate">
                            {template.documentType}
                          </p>
                        </div>
                      </div>
                    </button>
                  );
                })}
              </div>
            ) : (
              <div className="space-y-2">
                {filteredTemplates.map((template) => {
                  const category = getTemplateCategory(template);
                  return (
                    <button
                      key={template.id}
                      onClick={() => {
                        onSelectTemplate(template);
                        onClose();
                      }}
                      className="w-full p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary] transition-all text-left flex items-center gap-4 group"
                    >
                      <div
                        className="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0"
                        style={{ backgroundColor: `${category?.color}20`, color: category?.color }}
                      >
                        {category?.icon || <FileText className="w-5 h-5" />}
                      </div>
                      <div className="flex-1 min-w-0">
                        <h4 className="font-semibold group-hover:text-[--color-primary] transition-colors">
                          {template.name}
                        </h4>
                        <p className="text-sm text-[--text-muted] truncate">
                          {template.bodyText.slice(0, 100)}...
                        </p>
                      </div>
                      <span className="text-xs text-[--text-muted] px-2 py-1 rounded-lg bg-[--bg-overlay]">
                        {template.documentType.replace("Letter of ", "")}
                      </span>
                    </button>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/TemplateExplorer.tsx">
"use client";

import { useState, useMemo, useEffect } from "react";
import {
  Search,
  X,
  FileText,
  Briefcase,
  Scale,
  Heart,
  GraduationCap,
  Building2,
  Star,
  Clock,
  Filter,
  Grid,
  List,
  Eye,
  Plus,
  Bookmark,
  BookmarkCheck,
} from "lucide-react";
import { DocumentTemplate, documentTemplates } from "@/data/templates";

interface TemplateCategory {
  id: string;
  name: string;
  icon: React.ReactNode;
  color: string;
  description: string;
}

const CATEGORIES: TemplateCategory[] = [
  { id: "all", name: "All Templates", icon: <Grid className="w-4 h-4" />, color: "#7a756d", description: "Browse all templates" },
  { id: "hr", name: "HR & Employment", icon: <Briefcase className="w-4 h-4" />, color: "#e07a5f", description: "Hiring, termination, references" },
  { id: "legal", name: "Legal", icon: <Scale className="w-4 h-4" />, color: "#81b29a", description: "Agreements, authorizations" },
  { id: "business", name: "Business", icon: <Building2 className="w-4 h-4" />, color: "#f2cc8f", description: "Proposals, confirmations" },
  { id: "personal", name: "Personal", icon: <Heart className="w-4 h-4" />, color: "#e07a5f", description: "Apologies, complaints" },
  { id: "academic", name: "Academic", icon: <GraduationCap className="w-4 h-4" />, color: "#3d405b", description: "Recommendations, acceptances" },
];

// Map document types to categories
const CATEGORY_MAPPING: Record<string, string> = {
  "Letter of Recommendation": "academic",
  "Letter of Termination": "hr",
  "Letter of Employment": "hr",
  "Letter of Reference": "hr",
  "Letter of Introduction": "business",
  "Letter of Resignation": "hr",
  "Letter of Acceptance": "academic",
  "Letter of Rejection": "hr",
  "Letter of Apology": "personal",
  "Letter of Complaint": "personal",
  "Letter of Inquiry": "business",
  "Letter of Request": "business",
  "Letter of Confirmation": "business",
  "Letter of Agreement": "legal",
  "Letter of Authorization": "legal",
  "Custom Document": "all",
};

interface TemplateExplorerProps {
  isOpen: boolean;
  onClose: () => void;
  onSelectTemplate: (template: DocumentTemplate) => void;
  onSaveAsTemplate?: () => void;
}

export default function TemplateExplorer({
  isOpen,
  onClose,
  onSelectTemplate,
  onSaveAsTemplate,
}: TemplateExplorerProps) {
  const [searchQuery, setSearchQuery] = useState("");
  const [selectedCategory, setSelectedCategory] = useState("all");
  const [viewMode, setViewMode] = useState<"grid" | "list">("grid");
  const [favorites, setFavorites] = useState<string[]>([]);
  const [recentlyUsed, setRecentlyUsed] = useState<string[]>([]);
  const [previewTemplate, setPreviewTemplate] = useState<DocumentTemplate | null>(null);

  // Load favorites and recently used from localStorage
  useEffect(() => {
    if (typeof window !== "undefined") {
      const savedFavorites = localStorage.getItem("templateFavorites");
      const savedRecent = localStorage.getItem("recentTemplates");
      if (savedFavorites) setFavorites(JSON.parse(savedFavorites));
      if (savedRecent) setRecentlyUsed(JSON.parse(savedRecent));
    }
  }, []);

  // Filter templates based on search and category
  const filteredTemplates = useMemo(() => {
    return documentTemplates.filter((template) => {
      const matchesSearch = searchQuery
        ? template.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
          template.documentType.toLowerCase().includes(searchQuery.toLowerCase()) ||
          template.bodyText.toLowerCase().includes(searchQuery.toLowerCase())
        : true;

      const templateCategory = CATEGORY_MAPPING[template.documentType] || "all";
      const matchesCategory = selectedCategory === "all" || templateCategory === selectedCategory;

      return matchesSearch && matchesCategory;
    });
  }, [searchQuery, selectedCategory]);

  // Recently used templates
  const recentTemplates = useMemo(() => {
    return recentlyUsed
      .map((id) => documentTemplates.find((t) => t.id === id))
      .filter(Boolean) as DocumentTemplate[];
  }, [recentlyUsed]);

  // Favorite templates
  const favoriteTemplates = useMemo(() => {
    return favorites
      .map((id) => documentTemplates.find((t) => t.id === id))
      .filter(Boolean) as DocumentTemplate[];
  }, [favorites]);

  const toggleFavorite = (templateId: string) => {
    const updated = favorites.includes(templateId)
      ? favorites.filter((id) => id !== templateId)
      : [...favorites, templateId];
    setFavorites(updated);
    localStorage.setItem("templateFavorites", JSON.stringify(updated));
  };

  const handleSelectTemplate = (template: DocumentTemplate) => {
    // Update recently used
    const updated = [template.id, ...recentlyUsed.filter((id) => id !== template.id)].slice(0, 5);
    setRecentlyUsed(updated);
    localStorage.setItem("recentTemplates", JSON.stringify(updated));
    
    onSelectTemplate(template);
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="w-full max-w-5xl max-h-[90vh] bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter flex flex-col">
        {/* Header */}
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h2 className="text-2xl font-bold">Template Explorer</h2>
              <p className="text-sm text-[--text-muted]">
                {filteredTemplates.length} templates available
              </p>
            </div>
            <div className="flex items-center gap-2">
              {onSaveAsTemplate && (
                <button
                  onClick={onSaveAsTemplate}
                  className="px-4 py-2 rounded-xl bg-[--color-primary] text-white font-medium hover:bg-[--color-primary-hover] transition-all flex items-center gap-2"
                >
                  <Plus className="w-4 h-4" />
                  Save Current as Template
                </button>
              )}
              <button
                onClick={onClose}
                className="p-2 rounded-xl hover:bg-[--bg-elevated] transition-colors"
              >
                <X className="w-5 h-5" />
              </button>
            </div>
          </div>

          {/* Search and filters */}
          <div className="flex gap-4">
            <div className="flex-1 relative">
              <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-[--text-muted]" />
              <input
                type="text"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                placeholder="Search templates..."
                className="w-full pl-12 pr-4 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] focus:border-[--color-primary]"
              />
            </div>
            <div className="flex items-center gap-2 p-1 rounded-xl bg-[--bg-elevated] border border-[--border-default]">
              <button
                onClick={() => setViewMode("grid")}
                className={`p-2 rounded-lg transition-colors ${
                  viewMode === "grid" ? "bg-[--color-primary] text-white" : "hover:bg-[--bg-overlay]"
                }`}
              >
                <Grid className="w-4 h-4" />
              </button>
              <button
                onClick={() => setViewMode("list")}
                className={`p-2 rounded-lg transition-colors ${
                  viewMode === "list" ? "bg-[--color-primary] text-white" : "hover:bg-[--bg-overlay]"
                }`}
              >
                <List className="w-4 h-4" />
              </button>
            </div>
          </div>
        </div>

        <div className="flex-1 flex overflow-hidden">
          {/* Categories Sidebar */}
          <div className="w-56 border-r border-[--border-default] p-4 overflow-y-auto">
            <h3 className="text-xs font-semibold uppercase tracking-wider text-[--text-muted] mb-3">
              Categories
            </h3>
            <div className="space-y-1">
              {CATEGORIES.map((category) => (
                <button
                  key={category.id}
                  onClick={() => setSelectedCategory(category.id)}
                  className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all text-left ${
                    selectedCategory === category.id
                      ? "bg-[--color-primary]/15 text-[--color-primary]"
                      : "hover:bg-[--bg-elevated] text-[--text-secondary]"
                  }`}
                >
                  <span style={{ color: category.color }}>{category.icon}</span>
                  <span className="text-sm font-medium">{category.name}</span>
                </button>
              ))}
            </div>

            {/* Favorites Section */}
            {favoriteTemplates.length > 0 && (
              <div className="mt-6">
                <h3 className="text-xs font-semibold uppercase tracking-wider text-[--text-muted] mb-3 flex items-center gap-2">
                  <Star className="w-3 h-3" />
                  Favorites
                </h3>
                <div className="space-y-1">
                  {favoriteTemplates.slice(0, 3).map((template) => (
                    <button
                      key={template.id}
                      onClick={() => handleSelectTemplate(template)}
                      className="w-full text-left px-3 py-2 rounded-lg hover:bg-[--bg-elevated] text-sm text-[--text-secondary] truncate"
                    >
                      {template.name}
                    </button>
                  ))}
                </div>
              </div>
            )}

            {/* Recently Used */}
            {recentTemplates.length > 0 && (
              <div className="mt-6">
                <h3 className="text-xs font-semibold uppercase tracking-wider text-[--text-muted] mb-3 flex items-center gap-2">
                  <Clock className="w-3 h-3" />
                  Recent
                </h3>
                <div className="space-y-1">
                  {recentTemplates.slice(0, 3).map((template) => (
                    <button
                      key={template.id}
                      onClick={() => handleSelectTemplate(template)}
                      className="w-full text-left px-3 py-2 rounded-lg hover:bg-[--bg-elevated] text-sm text-[--text-secondary] truncate"
                    >
                      {template.name}
                    </button>
                  ))}
                </div>
              </div>
            )}
          </div>

          {/* Templates Grid/List */}
          <div className="flex-1 p-6 overflow-y-auto">
            {filteredTemplates.length === 0 ? (
              <div className="flex flex-col items-center justify-center h-full text-center">
                <FileText className="w-16 h-16 text-[--text-muted] opacity-30 mb-4" />
                <h3 className="font-semibold mb-2">No templates found</h3>
                <p className="text-sm text-[--text-muted]">
                  Try adjusting your search or category filter
                </p>
              </div>
            ) : viewMode === "grid" ? (
              <div className="grid grid-cols-2 lg:grid-cols-3 gap-4">
                {filteredTemplates.map((template) => (
                  <TemplateCard
                    key={template.id}
                    template={template}
                    isFavorite={favorites.includes(template.id)}
                    onSelect={() => handleSelectTemplate(template)}
                    onToggleFavorite={() => toggleFavorite(template.id)}
                    onPreview={() => setPreviewTemplate(template)}
                  />
                ))}
              </div>
            ) : (
              <div className="space-y-2">
                {filteredTemplates.map((template) => (
                  <TemplateListItem
                    key={template.id}
                    template={template}
                    isFavorite={favorites.includes(template.id)}
                    onSelect={() => handleSelectTemplate(template)}
                    onToggleFavorite={() => toggleFavorite(template.id)}
                    onPreview={() => setPreviewTemplate(template)}
                  />
                ))}
              </div>
            )}
          </div>
        </div>

        {/* Preview Modal */}
        {previewTemplate && (
          <TemplatePreviewModal
            template={previewTemplate}
            onClose={() => setPreviewTemplate(null)}
            onSelect={() => {
              handleSelectTemplate(previewTemplate);
              setPreviewTemplate(null);
            }}
          />
        )}
      </div>
    </div>
  );
}

// Template Card Component
interface TemplateCardProps {
  template: DocumentTemplate;
  isFavorite: boolean;
  onSelect: () => void;
  onToggleFavorite: () => void;
  onPreview: () => void;
}

function TemplateCard({ template, isFavorite, onSelect, onToggleFavorite, onPreview }: TemplateCardProps) {
  const category = CATEGORY_MAPPING[template.documentType] || "all";
  const categoryInfo = CATEGORIES.find((c) => c.id === category);

  return (
    <div className="group relative p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary]/50 hover:shadow-lg transition-all cursor-pointer">
      {/* Favorite button */}
      <button
        onClick={(e) => {
          e.stopPropagation();
          onToggleFavorite();
        }}
        className="absolute top-3 right-3 p-1.5 rounded-lg bg-[--bg-surface] opacity-0 group-hover:opacity-100 transition-opacity hover:bg-[--bg-overlay]"
      >
        {isFavorite ? (
          <BookmarkCheck className="w-4 h-4 text-[--color-primary]" />
        ) : (
          <Bookmark className="w-4 h-4 text-[--text-muted]" />
        )}
      </button>

      <div onClick={onSelect}>
        {/* Category badge */}
        <div
          className="inline-flex items-center gap-1.5 px-2 py-1 rounded-lg text-xs font-medium mb-3"
          style={{ backgroundColor: `${categoryInfo?.color}20`, color: categoryInfo?.color }}
        >
          {categoryInfo?.icon}
          {categoryInfo?.name}
        </div>

        {/* Template name */}
        <h3 className="font-semibold mb-2 group-hover:text-[--color-primary] transition-colors">
          {template.name}
        </h3>

        {/* Preview text */}
        <p className="text-sm text-[--text-muted] line-clamp-3 mb-4">
          {template.bodyText.substring(0, 120)}...
        </p>
      </div>

      {/* Actions */}
      <div className="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
        <button
          onClick={onPreview}
          className="flex-1 py-2 rounded-lg bg-[--bg-surface] border border-[--border-default] text-sm font-medium hover:bg-[--bg-overlay] transition-colors flex items-center justify-center gap-1.5"
        >
          <Eye className="w-3.5 h-3.5" />
          Preview
        </button>
        <button
          onClick={onSelect}
          className="flex-1 py-2 rounded-lg bg-[--color-primary] text-white text-sm font-medium hover:bg-[--color-primary-hover] transition-colors"
        >
          Use Template
        </button>
      </div>
    </div>
  );
}

// Template List Item Component
function TemplateListItem({ template, isFavorite, onSelect, onToggleFavorite, onPreview }: TemplateCardProps) {
  const category = CATEGORY_MAPPING[template.documentType] || "all";
  const categoryInfo = CATEGORIES.find((c) => c.id === category);

  return (
    <div className="group flex items-center gap-4 p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary]/50 transition-all">
      <div
        className="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0"
        style={{ backgroundColor: `${categoryInfo?.color}20`, color: categoryInfo?.color }}
      >
        <FileText className="w-5 h-5" />
      </div>

      <div className="flex-1 min-w-0 cursor-pointer" onClick={onSelect}>
        <h3 className="font-semibold truncate group-hover:text-[--color-primary] transition-colors">
          {template.name}
        </h3>
        <p className="text-sm text-[--text-muted] truncate">{template.documentType}</p>
      </div>

      <div className="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
        <button
          onClick={onToggleFavorite}
          className="p-2 rounded-lg hover:bg-[--bg-overlay] transition-colors"
        >
          {isFavorite ? (
            <BookmarkCheck className="w-4 h-4 text-[--color-primary]" />
          ) : (
            <Bookmark className="w-4 h-4 text-[--text-muted]" />
          )}
        </button>
        <button
          onClick={onPreview}
          className="p-2 rounded-lg hover:bg-[--bg-overlay] transition-colors"
        >
          <Eye className="w-4 h-4 text-[--text-muted]" />
        </button>
        <button
          onClick={onSelect}
          className="px-4 py-2 rounded-lg bg-[--color-primary] text-white text-sm font-medium hover:bg-[--color-primary-hover] transition-colors"
        >
          Use
        </button>
      </div>
    </div>
  );
}

// Template Preview Modal
interface TemplatePreviewModalProps {
  template: DocumentTemplate;
  onClose: () => void;
  onSelect: () => void;
}

function TemplatePreviewModal({ template, onClose, onSelect }: TemplatePreviewModalProps) {
  return (
    <div
      className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4"
      onClick={onClose}
    >
      <div
        className="w-full max-w-2xl max-h-[80vh] bg-[--bg-surface] rounded-2xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="p-6 border-b border-[--border-default]">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-xl font-bold">{template.name}</h3>
              <p className="text-sm text-[--text-muted]">{template.documentType}</p>
            </div>
            <button onClick={onClose} className="p-2 rounded-xl hover:bg-[--bg-elevated]">
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>
        
        <div className="p-6 max-h-[50vh] overflow-y-auto">
          <div className="p-6 rounded-xl bg-[--bg-elevated] border border-[--border-default] font-mono text-sm whitespace-pre-wrap">
            {template.bodyText}
          </div>
        </div>

        <div className="p-6 border-t border-[--border-default] flex gap-3">
          <button
            onClick={onClose}
            className="flex-1 py-3 rounded-xl bg-[--bg-elevated] border border-[--border-default] font-medium hover:bg-[--bg-overlay] transition-colors"
          >
            Cancel
          </button>
          <button
            onClick={onSelect}
            className="flex-1 py-3 rounded-xl bg-[--color-primary] text-white font-semibold hover:bg-[--color-primary-hover] transition-colors"
          >
            Use This Template
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/TemplateVariables.tsx">
"use client";

import { useState, useEffect, useMemo } from "react";

interface TemplateVariablesProps {
  bodyText: string;
  onApply: (filledText: string) => void;
  isOpen: boolean;
  onClose: () => void;
}

interface Variable {
  name: string;
  placeholder: string;
  value: string;
  type: "text" | "date" | "number" | "email";
}

// Detect variable type from name
function detectVariableType(name: string): "text" | "date" | "number" | "email" {
  const lowerName = name.toLowerCase();
  if (lowerName.includes("date") || lowerName.includes("day")) return "date";
  if (lowerName.includes("amount") || lowerName.includes("price") || lowerName.includes("number") || lowerName.includes("qty") || lowerName.includes("quantity")) return "number";
  if (lowerName.includes("email")) return "email";
  return "text";
}

export default function TemplateVariables({ bodyText, onApply, isOpen, onClose }: TemplateVariablesProps) {
  const [variables, setVariables] = useState<Variable[]>([]);

  // Extract variables from body text
  const extractedVariables = useMemo(() => {
    const regex = /\[([^\]]+)\]/g;
    const matches = bodyText.matchAll(regex);
    const vars: Variable[] = [];
    const seen = new Set<string>();
    
    for (const match of Array.from(matches)) {
      const placeholder = match[0];
      const name = match[1];
      if (!seen.has(name)) {
        seen.add(name);
        vars.push({
          name,
          placeholder,
          value: "",
          type: detectVariableType(name),
        });
      }
    }
    return vars;
  }, [bodyText]);

  useEffect(() => {
    if (isOpen) {
      setVariables(extractedVariables.map(v => ({ ...v, value: "" })));
    }
  }, [isOpen, extractedVariables]);

  const handleValueChange = (index: number, value: string) => {
    setVariables(prev => {
      const updated = [...prev];
      updated[index] = { ...updated[index], value };
      return updated;
    });
  };

  const handleApply = () => {
    let result = bodyText;
    variables.forEach(v => {
      if (v.value) {
        result = result.split(v.placeholder).join(v.value);
      }
    });
    onApply(result);
    onClose();
  };

  const filledCount = variables.filter(v => v.value.trim()).length;
  const progress = variables.length > 0 ? (filledCount / variables.length) * 100 : 0;

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
      <div className="bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col">
        {/* Header */}
        <div className="p-5 border-b border-[--border-default]">
          <div className="flex items-center justify-between mb-3">
            <h2 className="text-lg font-semibold text-[--text-primary]">Fill Template Variables</h2>
            <button onClick={onClose} className="text-[--text-muted] hover:text-[--text-primary]">‚úï</button>
          </div>
          
          {/* Progress bar */}
          <div className="flex items-center gap-3">
            <div className="flex-1 h-2 bg-[--bg-elevated] rounded-full overflow-hidden">
              <div 
                className="h-full bg-[--color-primary] transition-all duration-300"
                style={{ width: `${progress}%` }}
              />
            </div>
            <span className="text-sm text-[--text-muted]">{filledCount}/{variables.length}</span>
          </div>
        </div>

        {/* Variables List */}
        <div className="flex-1 overflow-y-auto p-5">
          {variables.length === 0 ? (
            <div className="text-center py-8 text-[--text-muted]">
              <p>No variables found in your document.</p>
              <p className="text-sm mt-2">Use [brackets] to create placeholders, e.g., [Name], [Date]</p>
            </div>
          ) : (
            <div className="space-y-4">
              {variables.map((variable, index) => (
                <div key={variable.name}>
                  <label className="block text-sm font-medium text-[--text-secondary] mb-1.5">
                    {variable.name}
                    <span className="ml-2 text-xs text-[--text-muted] font-normal">
                      {variable.placeholder}
                    </span>
                  </label>
                  <input
                    type={variable.type === "date" ? "date" : variable.type === "number" ? "number" : variable.type === "email" ? "email" : "text"}
                    value={variable.value}
                    onChange={(e) => handleValueChange(index, e.target.value)}
                    placeholder={`Enter ${variable.name.toLowerCase()}`}
                    className="w-full px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] placeholder:text-[--text-muted] focus:border-[--color-primary] focus:outline-none"
                  />
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Footer */}
        <div className="p-5 border-t border-[--border-default] flex gap-3">
          <button
            onClick={onClose}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--bg-elevated] border border-[--border-default] text-[--text-primary] hover:bg-[--bg-overlay]"
          >
            Cancel
          </button>
          <button
            onClick={handleApply}
            disabled={filledCount === 0}
            className="flex-1 px-4 py-2.5 rounded-lg bg-[--color-primary] text-white hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Apply Variables
          </button>
        </div>
      </div>
    </div>
  );
}

// Hook to detect if template has variables
export function useTemplateVariables(bodyText: string) {
  const hasVariables = useMemo(() => {
    return /\[([^\]]+)\]/.test(bodyText);
  }, [bodyText]);

  const variableCount = useMemo(() => {
    const regex = /\[([^\]]+)\]/g;
    const matches = bodyText.matchAll(regex);
    const seen = new Set<string>();
    for (const match of Array.from(matches)) {
      seen.add(match[1]);
    }
    return seen.size;
  }, [bodyText]);

  return { hasVariables, variableCount };
}
</file>

<file path="src/components/TimeTracker.tsx">
"use client";

import { useState, useEffect, useRef, useCallback } from "react";

interface SessionData {
  startTime: string;
  documentType: string;
  duration: number; // in seconds
}

interface TimeStats {
  todayMinutes: number;
  weekMinutes: number;
  monthMinutes: number;
  sessions: SessionData[];
}

const STORAGE_KEY = "timeTrackerData";

export function useTimeTracker() {
  const [isTracking, setIsTracking] = useState(false);
  const [currentSessionSeconds, setCurrentSessionSeconds] = useState(0);
  const [timeStats, setTimeStats] = useState<TimeStats>({
    todayMinutes: 0,
    weekMinutes: 0,
    monthMinutes: 0,
    sessions: [],
  });
  const [mounted, setMounted] = useState(false);
  const intervalRef = useRef<NodeJS.Timeout | null>(null);
  const sessionStartRef = useRef<Date | null>(null);

  // Load stats on mount
  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      try {
        const data = JSON.parse(saved);
        recalculateStats(data.sessions || []);
      } catch (e) {
        console.error("Error loading time stats:", e);
      }
    }
  }, []);

  const recalculateStats = (sessions: SessionData[]) => {
    const now = new Date();
    const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const weekStart = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
    const monthStart = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);

    let todaySeconds = 0;
    let weekSeconds = 0;
    let monthSeconds = 0;

    sessions.forEach((session) => {
      const sessionDate = new Date(session.startTime);
      if (sessionDate >= todayStart) {
        todaySeconds += session.duration;
      }
      if (sessionDate >= weekStart) {
        weekSeconds += session.duration;
      }
      if (sessionDate >= monthStart) {
        monthSeconds += session.duration;
      }
    });

    setTimeStats({
      todayMinutes: Math.round(todaySeconds / 60),
      weekMinutes: Math.round(weekSeconds / 60),
      monthMinutes: Math.round(monthSeconds / 60),
      sessions,
    });
  };

  const startTracking = useCallback(() => {
    if (isTracking) return;
    
    setIsTracking(true);
    sessionStartRef.current = new Date();
    setCurrentSessionSeconds(0);
    
    intervalRef.current = setInterval(() => {
      setCurrentSessionSeconds((prev) => prev + 1);
    }, 1000);
  }, [isTracking]);

  const stopTracking = useCallback((documentType: string) => {
    if (!isTracking || !sessionStartRef.current) return 0;
    
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
      intervalRef.current = null;
    }
    
    const duration = currentSessionSeconds;
    const session: SessionData = {
      startTime: sessionStartRef.current.toISOString(),
      documentType,
      duration,
    };
    
    const newSessions = [...timeStats.sessions, session].slice(-100); // Keep last 100 sessions
    
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ sessions: newSessions }));
    recalculateStats(newSessions);
    
    setIsTracking(false);
    setCurrentSessionSeconds(0);
    sessionStartRef.current = null;
    
    return Math.round(duration / 60); // Return minutes
  }, [isTracking, currentSessionSeconds, timeStats.sessions]);

  const pauseTracking = useCallback(() => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
      intervalRef.current = null;
    }
  }, []);

  const resumeTracking = useCallback(() => {
    if (!isTracking || intervalRef.current) return;
    
    intervalRef.current = setInterval(() => {
      setCurrentSessionSeconds((prev) => prev + 1);
    }, 1000);
  }, [isTracking]);

  const formatTime = (seconds: number) => {
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    
    if (hrs > 0) {
      return `${hrs}:${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
    }
    return `${mins}:${secs.toString().padStart(2, "0")}`;
  };

  const formatMinutes = (minutes: number) => {
    if (minutes < 60) return `${minutes}m`;
    const hrs = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return `${hrs}h ${mins}m`;
  };

  // Cleanup on unmount
  useEffect(() => {
    return () => {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
      }
    };
  }, []);

  return {
    isTracking,
    currentSessionSeconds,
    timeStats,
    startTracking,
    stopTracking,
    pauseTracking,
    resumeTracking,
    formatTime,
    formatMinutes,
    mounted,
  };
}

interface TimeTrackerDisplayProps {
  currentSessionSeconds: number;
  isTracking: boolean;
  formatTime: (seconds: number) => string;
  compact?: boolean;
}

export function TimeTrackerDisplay({ currentSessionSeconds, isTracking, formatTime, compact = false }: TimeTrackerDisplayProps) {
  if (!isTracking) return null;

  if (compact) {
    return (
      <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-[#4ecdc4]/20 border border-[#4ecdc4]/30">
        <span className="w-2 h-2 rounded-full bg-[#4ecdc4] animate-pulse" />
        <span className="text-[#4ecdc4] font-mono text-sm">{formatTime(currentSessionSeconds)}</span>
      </div>
    );
  }

  return (
    <div className="fixed bottom-4 left-1/2 -translate-x-1/2 z-40">
      <div className="px-6 py-3 rounded-xl bg-[#12121a]/90 backdrop-blur-md border border-[#4ecdc4]/30 shadow-lg shadow-[#4ecdc4]/10 flex items-center gap-4">
        <span className="w-2 h-2 rounded-full bg-[#4ecdc4] animate-pulse" />
        <span className="text-white">Session Time:</span>
        <span className="text-2xl font-mono text-[#4ecdc4]">{formatTime(currentSessionSeconds)}</span>
      </div>
    </div>
  );
}

interface TimeStatsModalProps {
  isOpen: boolean;
  onClose: () => void;
  timeStats: TimeStats;
  formatMinutes: (minutes: number) => string;
}

export function TimeStatsModal({ isOpen, onClose, timeStats, formatMinutes }: TimeStatsModalProps) {
  if (!isOpen) return null;

  // Calculate daily breakdown for the week
  const dailyData: { day: string; minutes: number }[] = [];
  const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
  
  for (let i = 6; i >= 0; i--) {
    const date = new Date();
    date.setDate(date.getDate() - i);
    const dayStart = new Date(date.getFullYear(), date.getMonth(), date.getDate());
    const dayEnd = new Date(dayStart.getTime() + 24 * 60 * 60 * 1000);
    
    const dayMinutes = timeStats.sessions
      .filter((s) => {
        const sessionDate = new Date(s.startTime);
        return sessionDate >= dayStart && sessionDate < dayEnd;
      })
      .reduce((sum, s) => sum + Math.round(s.duration / 60), 0);
    
    dailyData.push({
      day: i === 0 ? "Today" : i === 1 ? "Yest" : days[date.getDay()],
      minutes: dayMinutes,
    });
  }

  const maxDailyMinutes = Math.max(...dailyData.map(d => d.minutes), 1);

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-lg w-full border border-[#2a2a3a] shadow-2xl shadow-[#4ecdc4]/10">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">‚è±Ô∏è Time Tracking</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white transition-colors text-2xl">√ó</button>
        </div>

        {/* Content */}
        <div className="p-6">
          {/* Stats Cards */}
          <div className="grid grid-cols-3 gap-4 mb-6">
            <div className="p-4 rounded-xl bg-gradient-to-br from-[#4ecdc4]/20 to-[#4ecdc4]/5 border border-[#4ecdc4]/30 text-center">
              <div className="text-2xl font-bold text-[#4ecdc4]">{formatMinutes(timeStats.todayMinutes)}</div>
              <div className="text-sm text-[#a0a0a0]">Today</div>
            </div>
            <div className="p-4 rounded-xl bg-gradient-to-br from-[#a78bfa]/20 to-[#a78bfa]/5 border border-[#a78bfa]/30 text-center">
              <div className="text-2xl font-bold text-[#a78bfa]">{formatMinutes(timeStats.weekMinutes)}</div>
              <div className="text-sm text-[#a0a0a0]">This Week</div>
            </div>
            <div className="p-4 rounded-xl bg-gradient-to-br from-[#f472b6]/20 to-[#f472b6]/5 border border-[#f472b6]/30 text-center">
              <div className="text-2xl font-bold text-[#f472b6]">{formatMinutes(timeStats.monthMinutes)}</div>
              <div className="text-sm text-[#a0a0a0]">This Month</div>
            </div>
          </div>

          {/* Weekly Chart */}
          <div>
            <h3 className="text-sm font-medium text-[#a0a0a0] mb-3">Last 7 Days</h3>
            <div className="flex items-end justify-between gap-2 h-32">
              {dailyData.map((day, index) => (
                <div key={index} className="flex-1 flex flex-col items-center gap-1">
                  <div className="w-full flex-1 flex items-end">
                    <div 
                      className="w-full rounded-t-lg bg-gradient-to-t from-[#4ecdc4] to-[#a78bfa] transition-all duration-500"
                      style={{ 
                        height: `${Math.max(4, (day.minutes / maxDailyMinutes) * 100)}%`,
                      }}
                    />
                  </div>
                  <span className="text-xs text-[#666680]">{day.day}</span>
                  {day.minutes > 0 && (
                    <span className="text-xs text-[#a0a0a0]">{day.minutes}m</span>
                  )}
                </div>
              ))}
            </div>
          </div>

          {/* Recent Sessions */}
          {timeStats.sessions.length > 0 && (
            <div className="mt-6">
              <h3 className="text-sm font-medium text-[#a0a0a0] mb-3">Recent Sessions</h3>
              <div className="space-y-2 max-h-32 overflow-auto">
                {timeStats.sessions
                  .slice(-5)
                  .reverse()
                  .map((session, index) => (
                    <div key={index} className="flex items-center justify-between p-2 rounded-lg bg-[#1a1a24]">
                      <span className="text-sm text-white truncate">{session.documentType}</span>
                      <span className="text-sm text-[#4ecdc4]">{formatMinutes(Math.round(session.duration / 60))}</span>
                    </div>
                  ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Tooltip.tsx">
"use client";

import { useState } from "react";

interface TooltipProps {
  content: string;
  children: React.ReactNode;
}

export default function Tooltip({ content, children }: TooltipProps) {
  const [isVisible, setIsVisible] = useState(false);

  return (
    <div className="relative inline-block">
      <div
        onMouseEnter={() => setIsVisible(true)}
        onMouseLeave={() => setIsVisible(false)}
        onFocus={() => setIsVisible(true)}
        onBlur={() => setIsVisible(false)}
      >
        {children}
      </div>
      {isVisible && (
        <div className="absolute z-50 px-3 py-2 text-sm font-medium text-white bg-gray-900 dark:bg-gray-700 rounded-lg shadow-lg bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 pointer-events-none">
          {content}
          <div className="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
            <div className="border-8 border-transparent border-t-gray-900 dark:border-t-gray-700"></div>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/UserMenu.tsx">
"use client";

import { useState, useRef, useEffect } from "react";
import { useSession, signOut } from "next-auth/react";
import {
  User,
  LogOut,
  Settings,
  FileText,
  ChevronDown,
  Crown,
  Folder,
} from "lucide-react";

interface UserMenuProps {
  onShowAuth: () => void;
  onShowMyTemplates: () => void;
  onShowSettings?: () => void;
}

export default function UserMenu({
  onShowAuth,
  onShowMyTemplates,
  onShowSettings,
}: UserMenuProps) {
  const { data: session, status } = useSession();
  const [isOpen, setIsOpen] = useState(false);
  const menuRef = useRef<HTMLDivElement>(null);

  // Close menu when clicking outside
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    }
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const handleSignOut = async () => {
    setIsOpen(false);
    await signOut({ redirect: false });
  };

  // Loading state
  if (status === "loading") {
    return (
      <div className="w-10 h-10 rounded-xl bg-[--bg-elevated] animate-pulse" />
    );
  }

  // Not logged in
  if (!session?.user) {
    return (
      <button
        onClick={onShowAuth}
        className="flex items-center gap-2 px-4 py-2 rounded-xl bg-[--color-primary] text-white hover:bg-[--color-primary-hover] transition-all font-medium text-sm"
      >
        <User className="w-4 h-4" />
        Sign In
      </button>
    );
  }

  // Logged in
  const initials = session.user.name
    ?.split(" ")
    .map((n) => n[0])
    .join("")
    .toUpperCase()
    .slice(0, 2) || "U";

  return (
    <div className="relative" ref={menuRef}>
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 px-3 py-2 rounded-xl bg-[--bg-elevated] hover:bg-[--bg-overlay] border border-[--border-default] transition-all"
      >
        {/* Avatar */}
        <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-[--color-primary] to-[--color-accent] flex items-center justify-center text-white font-semibold text-sm">
          {initials}
        </div>
        
        {/* Name (hidden on mobile) */}
        <span className="hidden sm:block text-sm font-medium max-w-[120px] truncate">
          {session.user.name}
        </span>
        
        <ChevronDown
          className={`w-4 h-4 text-[--text-muted] transition-transform ${
            isOpen ? "rotate-180" : ""
          }`}
        />
      </button>

      {/* Dropdown Menu */}
      {isOpen && (
        <div className="absolute right-0 top-full mt-2 w-64 bg-[--bg-surface] rounded-xl border border-[--border-default] shadow-xl z-50 overflow-hidden modal-enter">
          {/* User Info */}
          <div className="p-4 border-b border-[--border-default]">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-[--color-primary] to-[--color-accent] flex items-center justify-center text-white font-bold text-lg">
                {initials}
              </div>
              <div className="flex-1 min-w-0">
                <p className="font-semibold truncate">{session.user.name}</p>
                <p className="text-sm text-[--text-muted] truncate">
                  {session.user.email}
                </p>
              </div>
            </div>
          </div>

          {/* Menu Items */}
          <div className="p-2">
            <button
              onClick={() => {
                setIsOpen(false);
                onShowMyTemplates();
              }}
              className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-[--bg-elevated] transition-colors text-left"
            >
              <Folder className="w-5 h-5 text-[--color-primary]" />
              <span>My Templates</span>
            </button>
            
            {onShowSettings && (
              <button
                onClick={() => {
                  setIsOpen(false);
                  onShowSettings();
                }}
                className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-[--bg-elevated] transition-colors text-left"
              >
                <Settings className="w-5 h-5 text-[--text-muted]" />
                <span>Settings</span>
              </button>
            )}
            
            <div className="my-2 border-t border-[--border-default]" />
            
            <button
              onClick={handleSignOut}
              className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-red-500/10 text-red-400 transition-colors text-left"
            >
              <LogOut className="w-5 h-5" />
              <span>Sign Out</span>
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/VersionHistory.tsx">
"use client";

import { useState, useEffect } from "react";

interface DocumentVersion {
  id: string;
  timestamp: string;
  documentType: string;
  bodyText: string;
  wordCount: number;
}

interface VersionHistoryProps {
  isOpen: boolean;
  onClose: () => void;
  onRestore: (bodyText: string) => void;
  currentBodyText: string;
  documentType: string;
}

const MAX_VERSIONS = 20;

export function useVersionHistory() {
  const [versions, setVersions] = useState<DocumentVersion[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem("versionHistory");
    if (saved) {
      try {
        setVersions(JSON.parse(saved));
      } catch (e) {
        console.error("Error loading version history:", e);
      }
    }
  }, []);

  const saveVersion = (documentType: string, bodyText: string) => {
    if (!bodyText.trim()) return;

    const wordCount = bodyText.trim().split(/\s+/).length;
    const newVersion: DocumentVersion = {
      id: `v-${Date.now()}`,
      timestamp: new Date().toISOString(),
      documentType,
      bodyText,
      wordCount,
    };

    // Don't save if identical to most recent
    if (versions.length > 0 && versions[0].bodyText === bodyText) {
      return;
    }

    const updated = [newVersion, ...versions].slice(0, MAX_VERSIONS);
    setVersions(updated);
    localStorage.setItem("versionHistory", JSON.stringify(updated));
  };

  const clearHistory = () => {
    setVersions([]);
    localStorage.removeItem("versionHistory");
  };

  return { versions, saveVersion, clearHistory, mounted };
}

export default function VersionHistory({ isOpen, onClose, onRestore, currentBodyText, documentType }: VersionHistoryProps) {
  const { versions, clearHistory } = useVersionHistory();
  const [selectedVersion, setSelectedVersion] = useState<DocumentVersion | null>(null);
  const [showDiff, setShowDiff] = useState(false);

  if (!isOpen) return null;

  const formatDate = (timestamp: string) => {
    const date = new Date(timestamp);
    const now = new Date();
    const diff = now.getTime() - date.getTime();
    
    if (diff < 60000) return "Just now";
    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
    if (diff < 604800000) return `${Math.floor(diff / 86400000)}d ago`;
    
    return date.toLocaleDateString();
  };

  const getPreview = (text: string) => {
    return text.slice(0, 150) + (text.length > 150 ? "..." : "");
  };

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-4xl w-full max-h-[85vh] flex flex-col border border-[#2a2a3a] shadow-2xl shadow-[#a78bfa]/10">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üìú Version History</h2>
          <div className="flex items-center gap-2">
            {versions.length > 0 && (
              <button
                onClick={clearHistory}
                className="px-3 py-1.5 rounded-lg text-sm text-[#f87171] hover:bg-[#f87171]/10 transition-colors"
              >
                Clear All
              </button>
            )}
            <button onClick={onClose} className="text-[#666680] hover:text-white transition-colors text-2xl">√ó</button>
          </div>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-hidden flex">
          {/* Version List */}
          <div className="w-1/3 border-r border-[#2a2a3a] overflow-auto">
            {versions.length === 0 ? (
              <div className="p-8 text-center text-[#666680]">
                <p>No versions saved yet.</p>
                <p className="text-sm mt-2">Versions are saved automatically when you generate documents.</p>
              </div>
            ) : (
              <div className="p-2 space-y-1">
                {versions.map((version) => (
                  <button
                    key={version.id}
                    onClick={() => setSelectedVersion(version)}
                    className={`w-full p-3 rounded-lg text-left transition-all ${
                      selectedVersion?.id === version.id
                        ? "bg-[#a78bfa]/20 border border-[#a78bfa]/30"
                        : "hover:bg-[#1a1a24]"
                    }`}
                  >
                    <div className="flex items-center justify-between mb-1">
                      <span className="text-sm text-white">{version.documentType}</span>
                      <span className="text-xs text-[#666680]">{formatDate(version.timestamp)}</span>
                    </div>
                    <div className="text-xs text-[#666680]">{version.wordCount} words</div>
                  </button>
                ))}
              </div>
            )}
          </div>

          {/* Preview */}
          <div className="flex-1 overflow-auto p-4">
            {selectedVersion ? (
              <div>
                <div className="flex items-center justify-between mb-4">
                  <div>
                    <h3 className="text-white font-medium">{selectedVersion.documentType}</h3>
                    <p className="text-sm text-[#666680]">
                      {new Date(selectedVersion.timestamp).toLocaleString()} ¬∑ {selectedVersion.wordCount} words
                    </p>
                  </div>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setShowDiff(!showDiff)}
                      className={`px-3 py-1.5 rounded-lg text-sm transition-colors ${
                        showDiff
                          ? "bg-[#4ecdc4] text-[#0a0a12]"
                          : "bg-[#2a2a3a] text-[#a0a0a0] hover:bg-[#3a3a4a]"
                      }`}
                    >
                      Compare
                    </button>
                    <button
                      onClick={() => {
                        onRestore(selectedVersion.bodyText);
                        onClose();
                      }}
                      className="px-3 py-1.5 rounded-lg text-sm bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white"
                    >
                      Restore
                    </button>
                  </div>
                </div>

                {showDiff ? (
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <div className="text-xs text-[#f87171] mb-2">Current Version</div>
                      <div className="p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-sm text-[#a0a0a0] whitespace-pre-wrap max-h-[400px] overflow-auto">
                        {currentBodyText || "(empty)"}
                      </div>
                    </div>
                    <div>
                      <div className="text-xs text-[#4ade80] mb-2">Selected Version</div>
                      <div className="p-3 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-sm text-[#a0a0a0] whitespace-pre-wrap max-h-[400px] overflow-auto">
                        {selectedVersion.bodyText}
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a] text-sm text-[#a0a0a0] whitespace-pre-wrap max-h-[500px] overflow-auto">
                    {selectedVersion.bodyText}
                  </div>
                )}
              </div>
            ) : (
              <div className="h-full flex items-center justify-center text-[#666680]">
                Select a version to preview
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/WebhookIntegration.tsx">
"use client";

import { useState, useEffect } from "react";

interface Webhook {
  id: string;
  name: string;
  url: string;
  events: string[];
  enabled: boolean;
  lastTriggered?: string;
}

const AVAILABLE_EVENTS = [
  { id: "document.created", label: "Document Created" },
  { id: "document.downloaded", label: "Document Downloaded" },
  { id: "template.created", label: "Template Created" },
  { id: "template.deleted", label: "Template Deleted" },
];

interface WebhookIntegrationProps {
  isOpen: boolean;
  onClose: () => void;
}

export function useWebhooks() {
  const [webhooks, setWebhooks] = useState<Webhook[]>([]);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const saved = localStorage.getItem("webhooks");
    if (saved) {
      try {
        setWebhooks(JSON.parse(saved));
      } catch (e) {
        console.error("Error loading webhooks:", e);
      }
    }
  }, []);

  const saveWebhooks = (updated: Webhook[]) => {
    setWebhooks(updated);
    localStorage.setItem("webhooks", JSON.stringify(updated));
  };

  const addWebhook = (webhook: Omit<Webhook, "id">) => {
    const newWebhook = { ...webhook, id: `webhook-${Date.now()}` };
    saveWebhooks([...webhooks, newWebhook]);
  };

  const updateWebhook = (id: string, updates: Partial<Webhook>) => {
    saveWebhooks(webhooks.map(w => w.id === id ? { ...w, ...updates } : w));
  };

  const deleteWebhook = (id: string) => {
    saveWebhooks(webhooks.filter(w => w.id !== id));
  };

  const triggerWebhook = async (eventType: string, data: Record<string, unknown>) => {
    const matchingWebhooks = webhooks.filter(w => w.enabled && w.events.includes(eventType));
    
    for (const webhook of matchingWebhooks) {
      try {
        // In a real app, this would make actual HTTP requests
        console.log(`[Webhook] Triggering ${webhook.name} for ${eventType}`, data);
        updateWebhook(webhook.id, { lastTriggered: new Date().toISOString() });
      } catch (error) {
        console.error(`[Webhook] Error triggering ${webhook.name}:`, error);
      }
    }
  };

  return { webhooks, addWebhook, updateWebhook, deleteWebhook, triggerWebhook, mounted };
}

export default function WebhookIntegration({ isOpen, onClose }: WebhookIntegrationProps) {
  const { webhooks, addWebhook, updateWebhook, deleteWebhook } = useWebhooks();
  const [showCreate, setShowCreate] = useState(false);
  const [formName, setFormName] = useState("");
  const [formUrl, setFormUrl] = useState("");
  const [formEvents, setFormEvents] = useState<string[]>([]);
  const [testResult, setTestResult] = useState<{ success: boolean; message: string } | null>(null);

  const handleCreate = () => {
    if (!formName || !formUrl) return;
    
    addWebhook({
      name: formName,
      url: formUrl,
      events: formEvents,
      enabled: true,
    });
    
    setFormName("");
    setFormUrl("");
    setFormEvents([]);
    setShowCreate(false);
  };

  const handleTest = async (webhook: Webhook) => {
    setTestResult(null);
    
    // Simulate webhook test
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // In real app, this would actually ping the webhook URL
    setTestResult({
      success: true,
      message: `Test payload sent to ${webhook.url}`,
    });
    
    setTimeout(() => setTestResult(null), 3000);
  };

  const toggleEvent = (eventId: string) => {
    setFormEvents(prev => 
      prev.includes(eventId) 
        ? prev.filter(e => e !== eventId)
        : [...prev, eventId]
    );
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-3xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">üîó Webhook Integration</h2>
          <button onClick={onClose} className="text-[#666680] hover:text-white text-2xl">√ó</button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-6">
          {/* Info Banner */}
          <div className="mb-6 p-4 rounded-lg bg-[#4ecdc4]/10 border border-[#4ecdc4]/30">
            <p className="text-sm text-[#a0a0a0]">
              <strong className="text-[#4ecdc4]">Webhooks</strong> allow you to send real-time notifications to external services when events occur. 
              Connect to Zapier, Make, or your own endpoints.
            </p>
          </div>

          {/* Create Webhook Form */}
          {showCreate ? (
            <div className="mb-6 p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
              <h3 className="text-white font-medium mb-4">New Webhook</h3>
              
              <div className="space-y-4">
                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-1">Name</label>
                  <input
                    type="text"
                    value={formName}
                    onChange={(e) => setFormName(e.target.value)}
                    placeholder="e.g., Zapier Integration"
                    className="w-full px-4 py-2 rounded-lg bg-[#12121a] border border-[#2a2a3a] text-white"
                  />
                </div>

                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-1">Endpoint URL</label>
                  <input
                    type="url"
                    value={formUrl}
                    onChange={(e) => setFormUrl(e.target.value)}
                    placeholder="https://hooks.zapier.com/..."
                    className="w-full px-4 py-2 rounded-lg bg-[#12121a] border border-[#2a2a3a] text-white"
                  />
                </div>

                <div>
                  <label className="block text-sm text-[#a0a0a0] mb-2">Events</label>
                  <div className="grid grid-cols-2 gap-2">
                    {AVAILABLE_EVENTS.map(event => (
                      <button
                        key={event.id}
                        onClick={() => toggleEvent(event.id)}
                        className={`p-2 rounded-lg text-sm text-left transition-colors ${
                          formEvents.includes(event.id)
                            ? "bg-[#a78bfa]/20 border border-[#a78bfa] text-white"
                            : "bg-[#12121a] border border-[#2a2a3a] text-[#a0a0a0]"
                        }`}
                      >
                        {event.label}
                      </button>
                    ))}
                  </div>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => setShowCreate(false)}
                    className="flex-1 py-2 rounded-lg bg-[#2a2a3a] text-white"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={handleCreate}
                    disabled={!formName || !formUrl}
                    className="flex-1 py-2 rounded-lg bg-[#a78bfa] text-white disabled:opacity-50"
                  >
                    Create Webhook
                  </button>
                </div>
              </div>
            </div>
          ) : (
            <button
              onClick={() => setShowCreate(true)}
              className="w-full mb-6 p-4 rounded-lg border-2 border-dashed border-[#2a2a3a] text-[#a78bfa] hover:border-[#a78bfa] transition-colors"
            >
              + Add New Webhook
            </button>
          )}

          {/* Test Result */}
          {testResult && (
            <div className={`mb-4 p-3 rounded-lg ${testResult.success ? "bg-[#4ade80]/10 border border-[#4ade80]/30 text-[#4ade80]" : "bg-[#f87171]/10 border border-[#f87171]/30 text-[#f87171]"}`}>
              {testResult.message}
            </div>
          )}

          {/* Webhooks List */}
          <div className="space-y-3">
            {webhooks.length === 0 ? (
              <div className="text-center py-8 text-[#666680]">
                <p>No webhooks configured yet.</p>
                <p className="text-sm mt-1">Create one to start receiving notifications.</p>
              </div>
            ) : (
              webhooks.map(webhook => (
                <div key={webhook.id} className="p-4 rounded-lg bg-[#1a1a24] border border-[#2a2a3a]">
                  <div className="flex items-start justify-between">
                    <div>
                      <div className="flex items-center gap-2">
                        <span className="text-white font-medium">{webhook.name}</span>
                        <span className={`px-2 py-0.5 rounded-full text-xs ${webhook.enabled ? "bg-[#4ade80]/20 text-[#4ade80]" : "bg-[#666680]/20 text-[#666680]"}`}>
                          {webhook.enabled ? "Active" : "Disabled"}
                        </span>
                      </div>
                      <p className="text-sm text-[#666680] mt-1 font-mono">{webhook.url}</p>
                      <div className="flex gap-1 mt-2">
                        {webhook.events.map(event => (
                          <span key={event} className="px-2 py-0.5 rounded text-xs bg-[#2a2a3a] text-[#a0a0a0]">
                            {event}
                          </span>
                        ))}
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      <button
                        onClick={() => handleTest(webhook)}
                        className="px-3 py-1 rounded text-sm text-[#4ecdc4] hover:bg-[#4ecdc4]/10"
                      >
                        Test
                      </button>
                      <button
                        onClick={() => updateWebhook(webhook.id, { enabled: !webhook.enabled })}
                        className="px-3 py-1 rounded text-sm text-[#a0a0a0] hover:bg-[#2a2a3a]"
                      >
                        {webhook.enabled ? "Disable" : "Enable"}
                      </button>
                      <button
                        onClick={() => deleteWebhook(webhook.id)}
                        className="px-3 py-1 rounded text-sm text-[#f87171] hover:bg-[#f87171]/10"
                      >
                        Delete
                      </button>
                    </div>
                  </div>
                  {webhook.lastTriggered && (
                    <p className="text-xs text-[#4a4a5a] mt-2">
                      Last triggered: {new Date(webhook.lastTriggered).toLocaleString()}
                    </p>
                  )}
                </div>
              ))
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/WelcomeModal.tsx">
"use client";

import { useState, useEffect } from "react";
import {
  FileText,
  Sparkles,
  Zap,
  Star,
  ArrowRight,
  Check,
  Command,
  Download,
  Clock,
  Palette,
} from "lucide-react";

interface WelcomeModalProps {
  onComplete: () => void;
}

const features = [
  {
    icon: <FileText className="w-6 h-6" />,
    title: "Professional Templates",
    description: "Choose from 16+ document types with pre-written content",
    color: "#e07a5f",
  },
  {
    icon: <Sparkles className="w-6 h-6" />,
    title: "AI Writing Assistant",
    description: "Get help writing with our built-in AI assistant",
    color: "#81b29a",
  },
  {
    icon: <Zap className="w-6 h-6" />,
    title: "Instant PDF Generation",
    description: "Download professional PDFs with one click",
    color: "#f2cc8f",
  },
  {
    icon: <Command className="w-6 h-6" />,
    title: "Power User Shortcuts",
    description: "Press ‚åòK anytime for quick commands",
    color: "#3d405b",
  },
];

const tips = [
  { icon: <Download className="w-4 h-4" />, text: "Use Ctrl+S to save your draft" },
  { icon: <Command className="w-4 h-4" />, text: "Press ‚åòK for command palette" },
  { icon: <Star className="w-4 h-4" />, text: "Save favorites for quick access" },
  { icon: <Clock className="w-4 h-4" />, text: "Auto-save keeps your work safe" },
  { icon: <Palette className="w-4 h-4" />, text: "Customize PDF themes & branding" },
];

export default function WelcomeModal({ onComplete }: WelcomeModalProps) {
  const [step, setStep] = useState(0);
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    // Check if user has seen the welcome modal
    const hasSeenWelcome = localStorage.getItem("hasSeenWelcome");
    if (!hasSeenWelcome) {
      setIsVisible(true);
    }
  }, []);

  const handleComplete = () => {
    localStorage.setItem("hasSeenWelcome", "true");
    setIsVisible(false);
    onComplete();
  };

  const handleSkip = () => {
    localStorage.setItem("hasSeenWelcome", "true");
    setIsVisible(false);
  };

  if (!isVisible) return null;

  return (
    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
      <div className="w-full max-w-2xl bg-[--bg-surface] rounded-3xl shadow-2xl border border-[--border-default] overflow-hidden modal-enter">
        {/* Progress indicator */}
        <div className="flex gap-1 p-4 justify-center">
          {[0, 1, 2].map((i) => (
            <div
              key={i}
              className={`h-1.5 rounded-full transition-all duration-300 ${
                i === step ? "w-8 bg-[--color-primary]" : "w-2 bg-[--border-default]"
              }`}
            />
          ))}
        </div>

        {/* Step 0: Welcome */}
        {step === 0 && (
          <div className="px-8 pb-8 text-center animate-fade-in">
            <div className="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-[--color-primary] to-[--color-accent] flex items-center justify-center shadow-lg animate-float">
              <FileText className="w-10 h-10 text-white" />
            </div>
            <h1 className="text-3xl font-bold mb-3">
              Welcome to <span className="text-gradient">DocGen</span>
            </h1>
            <p className="text-[--text-secondary] mb-8 max-w-md mx-auto">
              Create professional documents in minutes. Let&apos;s take a quick tour of the key features.
            </p>
            <div className="flex gap-3 justify-center">
              <button
                onClick={handleSkip}
                className="px-6 py-3 rounded-xl text-[--text-muted] hover:text-[--text-primary] transition-colors"
              >
                Skip tour
              </button>
              <button
                onClick={() => setStep(1)}
                className="px-8 py-3 rounded-xl bg-[--color-primary] text-white font-semibold hover:bg-[--color-primary-hover] transition-all flex items-center gap-2 shadow-lg shadow-[--color-primary]/20"
              >
                Get Started
                <ArrowRight className="w-4 h-4" />
              </button>
            </div>
          </div>
        )}

        {/* Step 1: Features */}
        {step === 1 && (
          <div className="px-8 pb-8 animate-fade-in">
            <h2 className="text-2xl font-bold text-center mb-2">Key Features</h2>
            <p className="text-[--text-muted] text-center mb-6">
              Everything you need for professional documents
            </p>
            <div className="grid grid-cols-2 gap-4 mb-8">
              {features.map((feature, index) => (
                <div
                  key={index}
                  className="p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:border-[--border-hover] transition-all group"
                  style={{ animationDelay: `${index * 0.1}s` }}
                >
                  <div
                    className="w-12 h-12 rounded-xl flex items-center justify-center mb-3 transition-transform group-hover:scale-110"
                    style={{ backgroundColor: `${feature.color}20`, color: feature.color }}
                  >
                    {feature.icon}
                  </div>
                  <h3 className="font-semibold mb-1">{feature.title}</h3>
                  <p className="text-sm text-[--text-muted]">{feature.description}</p>
                </div>
              ))}
            </div>
            <div className="flex gap-3 justify-center">
              <button
                onClick={() => setStep(0)}
                className="px-6 py-3 rounded-xl text-[--text-muted] hover:text-[--text-primary] transition-colors"
              >
                Back
              </button>
              <button
                onClick={() => setStep(2)}
                className="px-8 py-3 rounded-xl bg-[--color-primary] text-white font-semibold hover:bg-[--color-primary-hover] transition-all flex items-center gap-2"
              >
                Next
                <ArrowRight className="w-4 h-4" />
              </button>
            </div>
          </div>
        )}

        {/* Step 2: Tips & Get Started */}
        {step === 2 && (
          <div className="px-8 pb-8 animate-fade-in">
            <h2 className="text-2xl font-bold text-center mb-2">Pro Tips</h2>
            <p className="text-[--text-muted] text-center mb-6">
              Quick shortcuts to boost your productivity
            </p>
            <div className="space-y-3 mb-8">
              {tips.map((tip, index) => (
                <div
                  key={index}
                  className="flex items-center gap-4 p-4 rounded-xl bg-[--bg-elevated] border border-[--border-default]"
                  style={{ animationDelay: `${index * 0.1}s` }}
                >
                  <div className="w-10 h-10 rounded-lg bg-[--color-primary]/10 text-[--color-primary] flex items-center justify-center">
                    {tip.icon}
                  </div>
                  <span className="text-[--text-secondary]">{tip.text}</span>
                  <Check className="w-5 h-5 text-[--color-success] ml-auto" />
                </div>
              ))}
            </div>
            <div className="flex gap-3 justify-center">
              <button
                onClick={() => setStep(1)}
                className="px-6 py-3 rounded-xl text-[--text-muted] hover:text-[--text-primary] transition-colors"
              >
                Back
              </button>
              <button
                onClick={handleComplete}
                className="px-8 py-3 rounded-xl bg-gradient-to-r from-[--color-primary] to-[--color-accent] text-white font-semibold hover:opacity-90 transition-all flex items-center gap-2 shadow-lg"
              >
                Start Creating
                <Sparkles className="w-4 h-4" />
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// Hook to check if user is new
export function useIsNewUser() {
  const [isNewUser, setIsNewUser] = useState(false);

  useEffect(() => {
    const hasSeenWelcome = localStorage.getItem("hasSeenWelcome");
    setIsNewUser(!hasSeenWelcome);
  }, []);

  const resetWelcome = () => {
    localStorage.removeItem("hasSeenWelcome");
    setIsNewUser(true);
  };

  return { isNewUser, resetWelcome };
}
</file>

<file path="src/hooks/useSoundEffects.ts">
"use client";

import { useCallback } from "react";

type SoundType = "click" | "success" | "error" | "typing" | "save" | "complete" | "notification";

export function useSoundEffects(enabled: boolean) {
  const playSound = useCallback((type: SoundType) => {
    if (!enabled) return;

    try {
      const AudioContext = window.AudioContext || (window as any).webkitAudioContext;
      const audioContext = new AudioContext();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      gainNode.gain.value = 0.15;
      
      switch (type) {
        case "click":
          oscillator.frequency.value = 800;
          oscillator.type = "sine";
          oscillator.start();
          setTimeout(() => {
            oscillator.stop();
            audioContext.close();
          }, 50);
          break;
          
        case "typing":
          oscillator.frequency.value = 400 + Math.random() * 200;
          oscillator.type = "square";
          gainNode.gain.value = 0.05;
          oscillator.start();
          setTimeout(() => {
            oscillator.stop();
            audioContext.close();
          }, 30);
          break;
          
        case "success":
          oscillator.frequency.value = 523.25; // C5
          oscillator.type = "sine";
          oscillator.start();
          setTimeout(() => {
            oscillator.frequency.value = 659.25; // E5
          }, 100);
          setTimeout(() => {
            oscillator.frequency.value = 783.99; // G5
          }, 200);
          setTimeout(() => {
            oscillator.stop();
            audioContext.close();
          }, 350);
          break;
          
        case "error":
          oscillator.frequency.value = 200;
          oscillator.type = "sawtooth";
          gainNode.gain.value = 0.1;
          oscillator.start();
          setTimeout(() => {
            oscillator.frequency.value = 150;
          }, 100);
          setTimeout(() => {
            oscillator.stop();
            audioContext.close();
          }, 250);
          break;
          
        case "save":
          oscillator.frequency.value = 440;
          oscillator.type = "sine";
          oscillator.start();
          setTimeout(() => {
            oscillator.frequency.value = 550;
          }, 80);
          setTimeout(() => {
            oscillator.stop();
            audioContext.close();
          }, 150);
          break;
          
        case "complete":
          oscillator.frequency.value = 392; // G4
          oscillator.type = "sine";
          oscillator.start();
          setTimeout(() => oscillator.frequency.value = 523.25, 100); // C5
          setTimeout(() => oscillator.frequency.value = 659.25, 200); // E5
          setTimeout(() => oscillator.frequency.value = 783.99, 300); // G5
          setTimeout(() => oscillator.frequency.value = 1046.5, 400); // C6
          setTimeout(() => {
            oscillator.stop();
            audioContext.close();
          }, 550);
          break;
          
        case "notification":
          oscillator.frequency.value = 880;
          oscillator.type = "sine";
          oscillator.start();
          setTimeout(() => {
            oscillator.frequency.value = 1174.66;
          }, 100);
          setTimeout(() => {
            oscillator.stop();
            audioContext.close();
          }, 200);
          break;
      }
    } catch (e) {
      console.error("Error playing sound:", e);
    }
  }, [enabled]);

  return { playSound };
}
</file>

<file path="src/lib/auth.ts">
import { NextAuthOptions } from "next-auth";
import CredentialsProvider from "next-auth/providers/credentials";
import bcrypt from "bcryptjs";
import { v4 as uuidv4 } from "uuid";

// In-memory user store for demo (in production, use a real database)
// This simulates a database - in production, replace with Prisma, MongoDB, etc.
interface User {
  id: string;
  email: string;
  name: string;
  password: string;
  createdAt: string;
  avatar?: string;
}

// Simple file-based storage simulation
// In production, replace this with actual database calls
const USERS_STORAGE_KEY = "docgen_users";

function getUsers(): User[] {
  if (typeof window !== "undefined") {
    const stored = localStorage.getItem(USERS_STORAGE_KEY);
    return stored ? JSON.parse(stored) : [];
  }
  return [];
}

function saveUsers(users: User[]) {
  if (typeof window !== "undefined") {
    localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));
  }
}

export async function createUser(email: string, password: string, name: string): Promise<User | null> {
  const users = getUsers();
  
  // Check if user already exists
  if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
    return null;
  }
  
  const hashedPassword = await bcrypt.hash(password, 10);
  const newUser: User = {
    id: uuidv4(),
    email: email.toLowerCase(),
    name,
    password: hashedPassword,
    createdAt: new Date().toISOString(),
  };
  
  users.push(newUser);
  saveUsers(users);
  
  return newUser;
}

export async function validateUser(email: string, password: string): Promise<User | null> {
  const users = getUsers();
  const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());
  
  if (!user) return null;
  
  const isValid = await bcrypt.compare(password, user.password);
  return isValid ? user : null;
}

export async function getUserById(id: string): Promise<User | null> {
  const users = getUsers();
  return users.find(u => u.id === id) || null;
}

export async function updateUser(id: string, updates: Partial<User>): Promise<User | null> {
  const users = getUsers();
  const index = users.findIndex(u => u.id === id);
  
  if (index === -1) return null;
  
  users[index] = { ...users[index], ...updates };
  saveUsers(users);
  
  return users[index];
}

export const authOptions: NextAuthOptions = {
  providers: [
    CredentialsProvider({
      name: "credentials",
      credentials: {
        email: { label: "Email", type: "email" },
        password: { label: "Password", type: "password" },
        name: { label: "Name", type: "text" },
        action: { label: "Action", type: "text" }, // "login" or "signup"
      },
      async authorize(credentials) {
        if (!credentials?.email || !credentials?.password) {
          throw new Error("Email and password required");
        }

        const action = credentials.action || "login";

        if (action === "signup") {
          if (!credentials.name) {
            throw new Error("Name required for signup");
          }
          
          const existingUser = await validateUser(credentials.email, credentials.password);
          if (existingUser) {
            throw new Error("User already exists");
          }
          
          const newUser = await createUser(
            credentials.email,
            credentials.password,
            credentials.name
          );
          
          if (!newUser) {
            throw new Error("Email already registered");
          }
          
          return {
            id: newUser.id,
            email: newUser.email,
            name: newUser.name,
          };
        } else {
          // Login
          const user = await validateUser(credentials.email, credentials.password);
          
          if (!user) {
            throw new Error("Invalid email or password");
          }
          
          return {
            id: user.id,
            email: user.email,
            name: user.name,
          };
        }
      },
    }),
  ],
  session: {
    strategy: "jwt",
    maxAge: 30 * 24 * 60 * 60, // 30 days
  },
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.id = user.id;
      }
      return token;
    },
    async session({ session, token }) {
      if (session.user) {
        (session.user as any).id = token.id;
      }
      return session;
    },
  },
  pages: {
    signIn: "/", // We'll handle sign in with a modal
  },
  secret: process.env.NEXTAUTH_SECRET || "docgen-secret-key-change-in-production",
};
</file>

<file path="src/lib/userTemplates.ts">
import { v4 as uuidv4 } from "uuid";

export interface UserTemplate {
  id: string;
  userId: string;
  name: string;
  description: string;
  documentType: string;
  bodyText: string;
  category: string;
  tags: string[];
  isPublic: boolean;
  createdAt: string;
  updatedAt: string;
  useCount: number;
}

const TEMPLATES_STORAGE_KEY = "docgen_user_templates";

function getStoredTemplates(): UserTemplate[] {
  if (typeof window !== "undefined") {
    const stored = localStorage.getItem(TEMPLATES_STORAGE_KEY);
    return stored ? JSON.parse(stored) : [];
  }
  return [];
}

function saveStoredTemplates(templates: UserTemplate[]) {
  if (typeof window !== "undefined") {
    localStorage.setItem(TEMPLATES_STORAGE_KEY, JSON.stringify(templates));
  }
}

// Get templates for a specific user
export function getUserTemplates(userId: string): UserTemplate[] {
  const templates = getStoredTemplates();
  return templates.filter(t => t.userId === userId);
}

// Get all public templates
export function getPublicTemplates(): UserTemplate[] {
  const templates = getStoredTemplates();
  return templates.filter(t => t.isPublic);
}

// Create a new template
export function createTemplate(
  userId: string,
  data: {
    name: string;
    description: string;
    documentType: string;
    bodyText: string;
    category: string;
    tags?: string[];
    isPublic?: boolean;
  }
): UserTemplate {
  const templates = getStoredTemplates();
  
  const newTemplate: UserTemplate = {
    id: uuidv4(),
    userId,
    name: data.name,
    description: data.description,
    documentType: data.documentType,
    bodyText: data.bodyText,
    category: data.category,
    tags: data.tags || [],
    isPublic: data.isPublic || false,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
    useCount: 0,
  };
  
  templates.push(newTemplate);
  saveStoredTemplates(templates);
  
  return newTemplate;
}

// Update a template
export function updateTemplate(
  templateId: string,
  userId: string,
  updates: Partial<Omit<UserTemplate, "id" | "userId" | "createdAt">>
): UserTemplate | null {
  const templates = getStoredTemplates();
  const index = templates.findIndex(t => t.id === templateId && t.userId === userId);
  
  if (index === -1) return null;
  
  templates[index] = {
    ...templates[index],
    ...updates,
    updatedAt: new Date().toISOString(),
  };
  
  saveStoredTemplates(templates);
  return templates[index];
}

// Delete a template
export function deleteTemplate(templateId: string, userId: string): boolean {
  const templates = getStoredTemplates();
  const index = templates.findIndex(t => t.id === templateId && t.userId === userId);
  
  if (index === -1) return false;
  
  templates.splice(index, 1);
  saveStoredTemplates(templates);
  return true;
}

// Get a single template by ID
export function getTemplateById(templateId: string): UserTemplate | null {
  const templates = getStoredTemplates();
  return templates.find(t => t.id === templateId) || null;
}

// Increment use count
export function incrementTemplateUseCount(templateId: string): void {
  const templates = getStoredTemplates();
  const index = templates.findIndex(t => t.id === templateId);
  
  if (index !== -1) {
    templates[index].useCount++;
    saveStoredTemplates(templates);
  }
}

// Duplicate a template for a user
export function duplicateTemplate(templateId: string, newUserId: string): UserTemplate | null {
  const original = getTemplateById(templateId);
  if (!original) return null;
  
  return createTemplate(newUserId, {
    name: `${original.name} (Copy)`,
    description: original.description,
    documentType: original.documentType,
    bodyText: original.bodyText,
    category: original.category,
    tags: original.tags,
    isPublic: false,
  });
}
</file>

<file path="src/store/documentStore.ts">
"use client";

import { create } from "zustand";
import { persist } from "zustand/middleware";
import { signatories } from "@/data/signatories";

// Types
export interface RecipientInfo {
  name: string;
  title: string;
  address: string;
}

export interface SignatoryInfo {
  id: string;
  name: string;
  title: string;
  company?: string;
  phone?: string;
  email?: string;
}

export interface SavedRecipient extends RecipientInfo {
  id: string;
}

export interface FormattingOptions {
  fontSize: number;
  lineSpacing: number;
}

export interface DocumentState {
  // Document content
  documentType: string;
  bodyText: string;
  subject: string;

  // Recipient
  recipient: RecipientInfo;
  savedRecipients: SavedRecipient[];

  // Signatory
  selectedSignatoryId: string;
  useCustomSignatory: boolean;
  customSignatory: SignatoryInfo;

  // Formatting
  formatting: FormattingOptions;

  // Tags
  documentTags: string[];

  // UI State
  hasUnsavedChanges: boolean;
  lastSaved: Date | null;

  // Undo
  undoStack: string[];

  // Actions
  setDocumentType: (type: string) => void;
  setBodyText: (text: string) => void;
  setSubject: (subject: string) => void;
  setRecipient: (recipient: Partial<RecipientInfo>) => void;
  addSavedRecipient: (recipient: SavedRecipient) => void;
  removeSavedRecipient: (id: string) => void;
  setSelectedSignatory: (id: string) => void;
  setUseCustomSignatory: (use: boolean) => void;
  setCustomSignatory: (signatory: Partial<SignatoryInfo>) => void;
  setFormatting: (options: Partial<FormattingOptions>) => void;
  setDocumentTags: (tags: string[]) => void;
  markSaved: () => void;
  pushToUndoStack: (text: string) => void;
  undo: () => string | null;
  clearDocument: () => void;
  loadDraft: (draft: Partial<DocumentState>) => void;
  getSignatory: () => SignatoryInfo;
}

const DEFAULT_RECIPIENT: RecipientInfo = {
  name: "",
  title: "",
  address: "",
};

const DEFAULT_CUSTOM_SIGNATORY: SignatoryInfo = {
  id: "custom",
  name: "",
  title: "",
  company: undefined,
  phone: undefined,
  email: undefined,
};

const DEFAULT_FORMATTING: FormattingOptions = {
  fontSize: 11,
  lineSpacing: 1.5,
};

export const useDocumentStore = create<DocumentState>()(
  persist(
    (set, get) => ({
      // Initial state
      documentType: "Letter of Recommendation",
      bodyText: "",
      subject: "",
      recipient: DEFAULT_RECIPIENT,
      savedRecipients: [],
      selectedSignatoryId: signatories[0]?.id || "",
      useCustomSignatory: false,
      customSignatory: DEFAULT_CUSTOM_SIGNATORY,
      formatting: DEFAULT_FORMATTING,
      documentTags: [],
      hasUnsavedChanges: false,
      lastSaved: null,
      undoStack: [],

      // Actions
      setDocumentType: (type) =>
        set({ documentType: type, hasUnsavedChanges: true }),

      setBodyText: (text) => {
        const current = get().bodyText;
        // Add to undo stack if significant change
        if (text.length - current.length > 20 || current.length - text.length > 20) {
          set((state) => ({
            undoStack: [...state.undoStack.slice(-19), current],
          }));
        }
        set({ bodyText: text, hasUnsavedChanges: true });
      },

      setSubject: (subject) => set({ subject, hasUnsavedChanges: true }),

      setRecipient: (recipient) =>
        set((state) => ({
          recipient: { ...state.recipient, ...recipient },
          hasUnsavedChanges: true,
        })),

      addSavedRecipient: (recipient) =>
        set((state) => ({
          savedRecipients: [...state.savedRecipients, recipient],
        })),

      removeSavedRecipient: (id) =>
        set((state) => ({
          savedRecipients: state.savedRecipients.filter((r) => r.id !== id),
        })),

      setSelectedSignatory: (id) =>
        set({ selectedSignatoryId: id, useCustomSignatory: false, hasUnsavedChanges: true }),

      setUseCustomSignatory: (use) =>
        set({ useCustomSignatory: use, hasUnsavedChanges: true }),

      setCustomSignatory: (signatory) =>
        set((state) => ({
          customSignatory: { ...state.customSignatory, ...signatory },
          useCustomSignatory: true,
          hasUnsavedChanges: true,
        })),

      setFormatting: (options) =>
        set((state) => ({
          formatting: { ...state.formatting, ...options },
          hasUnsavedChanges: true,
        })),

      setDocumentTags: (tags) => set({ documentTags: tags }),

      markSaved: () =>
        set({ hasUnsavedChanges: false, lastSaved: new Date() }),

      pushToUndoStack: (text) =>
        set((state) => ({
          undoStack: [...state.undoStack.slice(-19), text],
        })),

      undo: () => {
        const { undoStack } = get();
        if (undoStack.length === 0) return null;
        const previous = undoStack[undoStack.length - 1];
        set({
          undoStack: undoStack.slice(0, -1),
          bodyText: previous,
          hasUnsavedChanges: true,
        });
        return previous;
      },

      clearDocument: () =>
        set({
          documentType: "Letter of Recommendation",
          bodyText: "",
          subject: "",
          recipient: DEFAULT_RECIPIENT,
          selectedSignatoryId: signatories[0]?.id || "",
          useCustomSignatory: false,
          customSignatory: DEFAULT_CUSTOM_SIGNATORY,
          formatting: DEFAULT_FORMATTING,
          documentTags: [],
          undoStack: [],
          hasUnsavedChanges: false,
        }),

      loadDraft: (draft) => set({ ...draft, hasUnsavedChanges: false }),

      getSignatory: () => {
        const state = get();
        if (state.useCustomSignatory) {
          return state.customSignatory;
        }
        const found = signatories.find((s) => s.id === state.selectedSignatoryId);
        return found || signatories[0];
      },
    }),
    {
      name: "document-store",
      partialize: (state) => ({
        documentType: state.documentType,
        bodyText: state.bodyText,
        subject: state.subject,
        recipient: state.recipient,
        savedRecipients: state.savedRecipients,
        selectedSignatoryId: state.selectedSignatoryId,
        useCustomSignatory: state.useCustomSignatory,
        customSignatory: state.customSignatory,
        formatting: state.formatting,
        documentTags: state.documentTags,
      }),
    }
  )
);

// UI Store for modals and panels
export interface UIState {
  // Theme
  theme: "dark" | "light";
  sidebarOpen: boolean;

  // Modals
  activeModal: string | null;
  commandPaletteOpen: boolean;

  // Settings
  focusMode: boolean;
  compactMode: boolean;
  soundEffects: boolean;
  confettiEnabled: boolean;

  // Actions
  setTheme: (theme: "dark" | "light") => void;
  toggleSidebar: () => void;
  openModal: (modal: string) => void;
  closeModal: () => void;
  toggleCommandPalette: () => void;
  setFocusMode: (enabled: boolean) => void;
  setCompactMode: (enabled: boolean) => void;
  setSoundEffects: (enabled: boolean) => void;
  setConfettiEnabled: (enabled: boolean) => void;
}

export const useUIStore = create<UIState>()(
  persist(
    (set) => ({
      theme: "dark",
      sidebarOpen: true,
      activeModal: null,
      commandPaletteOpen: false,
      focusMode: false,
      compactMode: false,
      soundEffects: true,
      confettiEnabled: true,

      setTheme: (theme) => {
        if (typeof document !== "undefined") {
          document.documentElement.classList.toggle("light", theme === "light");
        }
        set({ theme });
      },

      toggleSidebar: () => set((state) => ({ sidebarOpen: !state.sidebarOpen })),

      openModal: (modal) => set({ activeModal: modal }),

      closeModal: () => set({ activeModal: null }),

      toggleCommandPalette: () =>
        set((state) => ({ commandPaletteOpen: !state.commandPaletteOpen })),

      setFocusMode: (enabled) => set({ focusMode: enabled }),

      setCompactMode: (enabled) => set({ compactMode: enabled }),

      setSoundEffects: (enabled) => set({ soundEffects: enabled }),

      setConfettiEnabled: (enabled) => set({ confettiEnabled: enabled }),
    }),
    {
      name: "ui-store",
      partialize: (state) => ({
        theme: state.theme,
        sidebarOpen: state.sidebarOpen,
        focusMode: state.focusMode,
        compactMode: state.compactMode,
        soundEffects: state.soundEffects,
        confettiEnabled: state.confettiEnabled,
      }),
    }
  )
);
</file>

<file path="src/utils/favorites.ts">
export interface FavoriteSettings {
  id: string;
  name: string;
  documentType: string;
  selectedSignatory: string;
  useCustomSignatory: boolean;
  customSignatoryName?: string;
  customSignatoryTitle?: string;
  customSignatoryCompany?: string;
  customSignatoryPhone?: string;
  customSignatoryEmail?: string;
  recipientName?: string;
  recipientTitle?: string;
  recipientAddress?: string;
  subject?: string;
  fontSize: number;
  lineSpacing: number;
  createdAt: string;
}

export interface LastUsedSettings {
  documentType: string;
  selectedSignatory: string;
  useCustomSignatory: boolean;
  customSignatoryName?: string;
  customSignatoryTitle?: string;
  customSignatoryCompany?: string;
  customSignatoryPhone?: string;
  customSignatoryEmail?: string;
  fontSize: number;
  lineSpacing: number;
  lastUsedAt: string;
}

export const saveLastUsedSettings = (settings: Omit<LastUsedSettings, 'lastUsedAt'>): void => {
  const lastUsed: LastUsedSettings = {
    ...settings,
    lastUsedAt: new Date().toISOString(),
  };
  localStorage.setItem('lastUsedSettings', JSON.stringify(lastUsed));
};

export const getLastUsedSettings = (): LastUsedSettings | null => {
  const saved = localStorage.getItem('lastUsedSettings');
  if (saved) {
    try {
      return JSON.parse(saved);
    } catch {
      return null;
    }
  }
  return null;
};

export const saveFavorite = (favorite: Omit<FavoriteSettings, 'id' | 'createdAt'>): FavoriteSettings => {
  const favorites = getFavorites();
  const newFavorite: FavoriteSettings = {
    ...favorite,
    id: `fav-${Date.now()}`,
    createdAt: new Date().toISOString(),
  };
  favorites.push(newFavorite);
  localStorage.setItem('favoriteSettings', JSON.stringify(favorites));
  return newFavorite;
};

export const getFavorites = (): FavoriteSettings[] => {
  const saved = localStorage.getItem('favoriteSettings');
  if (saved) {
    try {
      return JSON.parse(saved);
    } catch {
      return [];
    }
  }
  return [];
};

export const deleteFavorite = (id: string): void => {
  const favorites = getFavorites();
  const filtered = favorites.filter(f => f.id !== id);
  localStorage.setItem('favoriteSettings', JSON.stringify(filtered));
};

export const updateFavorite = (id: string, updates: Partial<FavoriteSettings>): void => {
  const favorites = getFavorites();
  const index = favorites.findIndex(f => f.id === id);
  if (index !== -1) {
    favorites[index] = { ...favorites[index], ...updates };
    localStorage.setItem('favoriteSettings', JSON.stringify(favorites));
  }
};
</file>

<file path="src/utils/smartDate.ts">
// Smart Date Parsing - converts natural language to dates

export function parseSmartDate(input: string): Date | null {
  const today = new Date();
  const lowerInput = input.toLowerCase().trim();
  
  // Today, tomorrow, yesterday
  if (lowerInput === "today") return today;
  if (lowerInput === "tomorrow") {
    const d = new Date(today);
    d.setDate(d.getDate() + 1);
    return d;
  }
  if (lowerInput === "yesterday") {
    const d = new Date(today);
    d.setDate(d.getDate() - 1);
    return d;
  }
  
  // Next/last weekday
  const weekdays = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
  const nextMatch = lowerInput.match(/^next\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/);
  if (nextMatch) {
    const targetDay = weekdays.indexOf(nextMatch[1]);
    const d = new Date(today);
    const currentDay = d.getDay();
    let daysToAdd = targetDay - currentDay;
    if (daysToAdd <= 0) daysToAdd += 7;
    d.setDate(d.getDate() + daysToAdd);
    return d;
  }
  
  const lastMatch = lowerInput.match(/^last\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/);
  if (lastMatch) {
    const targetDay = weekdays.indexOf(lastMatch[1]);
    const d = new Date(today);
    const currentDay = d.getDay();
    let daysToSubtract = currentDay - targetDay;
    if (daysToSubtract <= 0) daysToSubtract += 7;
    d.setDate(d.getDate() - daysToSubtract);
    return d;
  }
  
  // In X days/weeks/months
  const inMatch = lowerInput.match(/^in\s+(\d+)\s+(day|days|week|weeks|month|months)$/);
  if (inMatch) {
    const amount = parseInt(inMatch[1]);
    const unit = inMatch[2];
    const d = new Date(today);
    if (unit.startsWith("day")) d.setDate(d.getDate() + amount);
    else if (unit.startsWith("week")) d.setDate(d.getDate() + amount * 7);
    else if (unit.startsWith("month")) d.setMonth(d.getMonth() + amount);
    return d;
  }
  
  // X days/weeks/months ago
  const agoMatch = lowerInput.match(/^(\d+)\s+(day|days|week|weeks|month|months)\s+ago$/);
  if (agoMatch) {
    const amount = parseInt(agoMatch[1]);
    const unit = agoMatch[2];
    const d = new Date(today);
    if (unit.startsWith("day")) d.setDate(d.getDate() - amount);
    else if (unit.startsWith("week")) d.setDate(d.getDate() - amount * 7);
    else if (unit.startsWith("month")) d.setMonth(d.getMonth() - amount);
    return d;
  }
  
  // End of month/week
  if (lowerInput === "end of month" || lowerInput === "eom") {
    const d = new Date(today.getFullYear(), today.getMonth() + 1, 0);
    return d;
  }
  if (lowerInput === "end of week" || lowerInput === "eow") {
    const d = new Date(today);
    const daysToFriday = 5 - d.getDay();
    d.setDate(d.getDate() + (daysToFriday < 0 ? daysToFriday + 7 : daysToFriday));
    return d;
  }
  
  // Beginning of month/next month
  if (lowerInput === "first of month" || lowerInput === "beginning of month") {
    return new Date(today.getFullYear(), today.getMonth(), 1);
  }
  if (lowerInput === "first of next month") {
    return new Date(today.getFullYear(), today.getMonth() + 1, 1);
  }
  
  // Try standard date parsing as fallback
  const parsed = new Date(input);
  if (!isNaN(parsed.getTime())) return parsed;
  
  return null;
}

export function formatDate(date: Date, format: "short" | "long" | "iso" = "long"): string {
  if (format === "iso") {
    return date.toISOString().split("T")[0];
  }
  if (format === "short") {
    return date.toLocaleDateString("en-US", { month: "numeric", day: "numeric", year: "2-digit" });
  }
  return date.toLocaleDateString("en-US", { month: "long", day: "numeric", year: "numeric" });
}

export function getSmartDateSuggestions(): string[] {
  return [
    "today",
    "tomorrow", 
    "next monday",
    "next friday",
    "in 7 days",
    "in 2 weeks",
    "in 1 month",
    "end of month",
    "end of week",
    "first of next month",
  ];
}
</file>

<file path="src/utils/validation.ts">
export interface ValidationResult {
  isValid: boolean;
  error?: string;
  warning?: string;
  suggestion?: string;
}

export const validateEmail = (email: string): ValidationResult => {
  if (!email) return { isValid: true };
  
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    return {
      isValid: false,
      error: "Please enter a valid email address",
    };
  }
  return { isValid: true };
};

export const validatePhone = (phone: string): ValidationResult => {
  if (!phone) return { isValid: true };
  
  // Remove formatting characters
  const cleanPhone = phone.replace(/[\s\-\(\)]/g, "");
  
  if (!/^\d{10,15}$/.test(cleanPhone)) {
    return {
      isValid: false,
      error: "Phone number should be 10-15 digits",
      suggestion: "Example: (555) 123-4567",
    };
  }
  return { isValid: true };
};

export const validateBodyText = (text: string): ValidationResult => {
  if (!text.trim()) {
    return {
      isValid: false,
      error: "Document body cannot be empty",
    };
  }
  
  const wordCount = text.trim().split(/\s+/).length;
  
  if (wordCount < 50) {
    return {
      isValid: true,
      warning: "Document seems short. Consider adding more detail.",
      suggestion: `Current: ${wordCount} words. Recommended: 50+ words`,
    };
  }
  
  if (wordCount > 1000) {
    return {
      isValid: true,
      warning: "Document is quite long. Consider breaking it into sections.",
      suggestion: `Current: ${wordCount} words. Consider condensing.`,
    };
  }
  
  return { isValid: true };
};

export const validateRequired = (value: string, fieldName: string): ValidationResult => {
  if (!value.trim()) {
    return {
      isValid: false,
      error: `${fieldName} is required`,
    };
  }
  return { isValid: true };
};

export const validateName = (name: string): ValidationResult => {
  if (!name.trim()) {
    return {
      isValid: false,
      error: "Name is required",
    };
  }
  
  if (name.length < 2) {
    return {
      isValid: false,
      error: "Name must be at least 2 characters",
    };
  }
  
  if (!/^[a-zA-Z\s\-\.]+$/.test(name)) {
    return {
      isValid: false,
      error: "Name should only contain letters, spaces, hyphens, and periods",
    };
  }
  
  return { isValid: true };
};

export const getCharacterCount = (text: string): {
  characters: number;
  charactersNoSpaces: number;
  words: number;
  sentences: number;
  readingTimeMinutes: number;
} => {
  const characters = text.length;
  const charactersNoSpaces = text.replace(/\s/g, "").length;
  const words = text.trim() ? text.trim().split(/\s+/).length : 0;
  const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
  const readingTimeMinutes = Math.ceil(words / 200); // Average reading speed: 200 words/min
  
  return {
    characters,
    charactersNoSpaces,
    words,
    sentences,
    readingTimeMinutes,
  };
};
</file>

<file path="src/app/api/templates/route.ts">
import { NextRequest, NextResponse } from "next/server";

// Simple JSON storage - just need one env var!
// Using JSONBin.io free tier
const JSONBIN_API_KEY = process.env.JSONBIN_API_KEY; // Get free at jsonbin.io
const JSONBIN_BIN_ID = process.env.JSONBIN_BIN_ID || ""; // Will be created on first write
const JSONBIN_BASE_URL = "https://api.jsonbin.io/v3/b";

export interface UserTemplate {
  id: string;
  name: string;
  documentType: string;
  bodyText: string;
  description: string;
  category: string;
  createdAt?: string;
  createdBy?: string;
}

// GET - Fetch all shared templates
export async function GET() {
  try {
    // Check if JSONBin is configured
    if (!JSONBIN_BIN_ID) {
      console.log("JSONBin not configured, returning empty templates");
      return NextResponse.json({ templates: [], source: "fallback" });
    }

    const response = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_BIN_ID}/latest`, {
      headers: {
        "X-Master-Key": JSONBIN_API_KEY || "",
      },
      // Cache for 30 seconds to reduce API calls
      next: { revalidate: 30 },
    });

    if (!response.ok) {
      throw new Error(`JSONBin fetch failed: ${response.status}`);
    }

    const data = await response.json();
    const templates = data.record?.templates || [];

    return NextResponse.json({ 
      templates, 
      source: "jsonbin" 
    });
  } catch (error) {
    console.error("Error fetching templates:", error);
    return NextResponse.json(
      { error: "Failed to fetch templates", templates: [] },
      { status: 500 }
    );
  }
}

// Helper to create a new bin if needed
async function createBin(apiKey: string, templates: UserTemplate[]): Promise<string | null> {
  try {
    const response = await fetch(JSONBIN_BASE_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-Master-Key": apiKey,
        "X-Bin-Private": "false",
        "X-Bin-Name": "docusign-templates",
      },
      body: JSON.stringify({ templates }),
    });

    if (response.ok) {
      const data = await response.json();
      console.log("Created new bin:", data.metadata.id);
      return data.metadata.id;
    }
    return null;
  } catch {
    return null;
  }
}

// POST - Add a new template
export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { template } = body as { template: Omit<UserTemplate, "id" | "createdAt"> };

    if (!template || !template.name || !template.bodyText) {
      return NextResponse.json(
        { error: "Template name and content are required" },
        { status: 400 }
      );
    }

    // Check if API key is configured
    if (!JSONBIN_API_KEY) {
      return NextResponse.json(
        { error: "Storage not configured. Templates will only be saved locally." },
        { status: 503 }
      );
    }

    // Create new template with ID and timestamp
    const newTemplate: UserTemplate = {
      ...template,
      id: `shared-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
      createdAt: new Date().toISOString(),
    };

    let existingTemplates: UserTemplate[] = [];
    let binId: string | null = JSONBIN_BIN_ID || null;

    // If no bin exists, create one
    if (!binId) {
      const newBinId = await createBin(JSONBIN_API_KEY, [newTemplate]);
      if (newBinId) {
        return NextResponse.json({ 
          success: true, 
          template: newTemplate,
          totalTemplates: 1,
          newBinId: newBinId, // Return this so user can add it to env vars
          message: `Template saved! Add JSONBIN_BIN_ID=${newBinId} to your environment variables.`
        });
      }
      throw new Error("Could not create storage bin");
    }

    // Get existing templates
    const fetchResponse = await fetch(`${JSONBIN_BASE_URL}/${binId}/latest`, {
      headers: {
        "X-Master-Key": JSONBIN_API_KEY,
      },
    });

    if (fetchResponse.ok) {
      const data = await fetchResponse.json();
      existingTemplates = data.record?.templates || [];
    }

    // Add to list
    const updatedTemplates = [...existingTemplates, newTemplate];

    // Save to JSONBin
    const updateResponse = await fetch(`${JSONBIN_BASE_URL}/${binId}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "X-Master-Key": JSONBIN_API_KEY,
      },
      body: JSON.stringify({ templates: updatedTemplates }),
    });

    if (!updateResponse.ok) {
      throw new Error(`JSONBin update failed: ${updateResponse.status}`);
    }

    return NextResponse.json({ 
      success: true, 
      template: newTemplate,
      totalTemplates: updatedTemplates.length 
    });
  } catch (error) {
    console.error("Error saving template:", error);
    return NextResponse.json(
      { error: "Failed to save template" },
      { status: 500 }
    );
  }
}

// DELETE - Remove a template
export async function DELETE(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const templateId = searchParams.get("id");

    if (!templateId) {
      return NextResponse.json(
        { error: "Template ID is required" },
        { status: 400 }
      );
    }

    // Check if JSONBin is configured
    if (!JSONBIN_BIN_ID || !JSONBIN_API_KEY) {
      return NextResponse.json(
        { error: "Storage not configured" },
        { status: 503 }
      );
    }

    // Get existing templates
    const fetchResponse = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_BIN_ID}/latest`, {
      headers: {
        "X-Master-Key": JSONBIN_API_KEY,
      },
    });

    if (!fetchResponse.ok) {
      throw new Error("Failed to fetch existing templates");
    }

    const data = await fetchResponse.json();
    const existingTemplates: UserTemplate[] = data.record?.templates || [];

    // Filter out the template to delete
    const updatedTemplates = existingTemplates.filter((t) => t.id !== templateId);

    if (updatedTemplates.length === existingTemplates.length) {
      return NextResponse.json(
        { error: "Template not found" },
        { status: 404 }
      );
    }

    // Save updated list
    const updateResponse = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_BIN_ID}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "X-Master-Key": JSONBIN_API_KEY,
      },
      body: JSON.stringify({ templates: updatedTemplates }),
    });

    if (!updateResponse.ok) {
      throw new Error(`JSONBin update failed: ${updateResponse.status}`);
    }

    return NextResponse.json({ 
      success: true,
      totalTemplates: updatedTemplates.length 
    });
  } catch (error) {
    console.error("Error deleting template:", error);
    return NextResponse.json(
      { error: "Failed to delete template" },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/suggestions/page.tsx">
"use client";

import { useState } from "react";
import { Toaster, toast } from "react-hot-toast";
import Link from "next/link";

export default function SuggestionsPage() {
  const [name, setName] = useState<string>("");
  const [email, setEmail] = useState<string>("");
  const [suggestion, setSuggestion] = useState<string>("");
  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!name.trim() || !email.trim() || !suggestion.trim()) {
      toast.error("Please fill in all fields");
      return;
    }

    if (!email.includes("@")) {
      toast.error("Please enter a valid email address");
      return;
    }

    setIsSubmitting(true);
    try {
      const response = await fetch("/api/suggestions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          name,
          email,
          suggestion,
        }),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || "Failed to submit suggestion");
      }

      toast.success("Thank you! Your suggestion has been submitted successfully.");
      setName("");
      setEmail("");
      setSuggestion("");
    } catch (error: any) {
      console.error("Error submitting suggestion:", error);
      toast.error(error.message || "Error submitting suggestion. Please try again.");
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <>
      <Toaster position="top-right" />
      <div className="min-h-screen py-6 sm:py-12 px-4 sm:px-6 lg:px-8">
        <div className="max-w-2xl mx-auto">
          <div className="bg-white shadow-2xl rounded-2xl p-6 sm:p-8 backdrop-blur-sm border border-white/20">
            <div className="mb-6">
              <Link
                href="/"
                className="inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4"
              >
                ‚Üê Back to Document Generator
              </Link>
              <h1 className="text-3xl sm:text-4xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">
                Suggestions & Feedback
              </h1>
              <p className="text-sm text-gray-600 font-medium">
                We&apos;d love to hear your thoughts! Share your suggestions, report issues, or request new features.
              </p>
            </div>

            <form onSubmit={handleSubmit} className="space-y-6">
              <div className="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-100">
                <label
                  htmlFor="name"
                  className="block text-sm font-semibold text-gray-800 mb-2"
                >
                  Your Name
                </label>
                <input
                  type="text"
                  id="name"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  required
                  className="w-full px-4 py-3 border-2 border-blue-200 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white font-medium text-gray-800 hover:border-blue-300"
                  placeholder="Enter your name"
                />
              </div>

              <div className="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-xl border border-green-100">
                <label
                  htmlFor="email"
                  className="block text-sm font-semibold text-gray-800 mb-2"
                >
                  Your Email
                </label>
                <input
                  type="email"
                  id="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  required
                  className="w-full px-4 py-3 border-2 border-green-200 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white font-medium text-gray-800 hover:border-green-300"
                  placeholder="your.email@example.com"
                />
              </div>

              <div className="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-100">
                <label
                  htmlFor="suggestion"
                  className="block text-sm font-semibold text-gray-800 mb-2"
                >
                  Your Suggestion or Feedback
                </label>
                <textarea
                  id="suggestion"
                  value={suggestion}
                  onChange={(e) => setSuggestion(e.target.value)}
                  required
                  rows={8}
                  className="w-full px-4 py-3 border-2 border-purple-200 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white font-medium text-gray-800 hover:border-purple-300 resize-y"
                  placeholder="Tell us what you think! Share your suggestions, report bugs, or request new features..."
                />
                <div className="mt-2 text-xs text-gray-600">
                  {suggestion.length} characters
                </div>
              </div>

              <div className="flex gap-4">
                <Link
                  href="/"
                  className="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-xl font-semibold hover:bg-gray-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all text-center"
                >
                  Cancel
                </Link>
                <button
                  type="submit"
                  disabled={isSubmitting}
                  className="flex-1 bg-gradient-to-r from-purple-600 via-blue-600 to-pink-600 text-white py-3 px-6 rounded-xl font-semibold hover:from-purple-700 hover:via-blue-700 hover:to-pink-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all"
                >
                  {isSubmitting ? "Submitting..." : "Submit Suggestion"}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </>
  );
}
</file>

<file path="src/components/OnboardingTour.tsx">
"use client";

import { useState, useEffect } from "react";

interface TourStep {
  target: string;
  title: string;
  content: string;
  position: "top" | "bottom" | "left" | "right";
}

const TOUR_STEPS: TourStep[] = [
  {
    target: "templates-btn",
    title: "üìÑ Templates",
    content: "Start with a pre-built template or create your own. Templates include placeholders like [Name] that you can fill in.",
    position: "bottom",
  },
  {
    target: "document-type",
    title: "üìã Document Type",
    content: "Select the type of document you're creating. This helps organize your documents.",
    position: "bottom",
  },
  {
    target: "document-body",
    title: "‚úçÔ∏è Document Body",
    content: "Write your document content here. Use [brackets] for placeholders. The toolbar above has quick insert options.",
    position: "top",
  },
  {
    target: "signatory-section",
    title: "üñäÔ∏è Signatory",
    content: "Choose who will sign the document. You can select a preset signatory or enter custom details.",
    position: "top",
  },
  {
    target: "download-btn",
    title: "üì• Generate PDF",
    content: "When you're ready, click here to download your professional PDF document!",
    position: "top",
  },
  {
    target: "settings-btn",
    title: "‚öôÔ∏è Settings",
    content: "Customize colors, fonts, sounds, and many more options in Settings.",
    position: "left",
  },
];

interface OnboardingTourProps {
  onComplete: () => void;
}

export default function OnboardingTour({ onComplete }: OnboardingTourProps) {
  const [currentStep, setCurrentStep] = useState(0);
  const [isVisible, setIsVisible] = useState(true);

  const handleNext = () => {
    if (currentStep < TOUR_STEPS.length - 1) {
      setCurrentStep(currentStep + 1);
    } else {
      handleComplete();
    }
  };

  const handlePrev = () => {
    if (currentStep > 0) {
      setCurrentStep(currentStep - 1);
    }
  };

  const handleComplete = () => {
    setIsVisible(false);
    localStorage.setItem("onboardingComplete", "true");
    onComplete();
  };

  const handleSkip = () => {
    handleComplete();
  };

  if (!isVisible) return null;

  const step = TOUR_STEPS[currentStep];
  const progress = ((currentStep + 1) / TOUR_STEPS.length) * 100;

  return (
    <>
      {/* Overlay */}
      <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60]" />

      {/* Tour Card */}
      <div className="fixed inset-0 z-[61] flex items-center justify-center p-4">
        <div className="bg-[#12121a] rounded-2xl border border-[#2a2a3a] shadow-2xl max-w-md w-full overflow-hidden">
          {/* Progress bar */}
          <div className="h-1 bg-[#2a2a3a]">
            <div 
              className="h-full bg-gradient-to-r from-[#a78bfa] to-[#4ecdc4] transition-all duration-300"
              style={{ width: `${progress}%` }}
            />
          </div>

          {/* Content */}
          <div className="p-6">
            <div className="flex items-center justify-between mb-4">
              <span className="text-xs text-[#666680]">Step {currentStep + 1} of {TOUR_STEPS.length}</span>
              <button onClick={handleSkip} className="text-xs text-[#666680] hover:text-white">
                Skip tour
              </button>
            </div>

            <h3 className="text-xl text-white font-semibold mb-3">{step.title}</h3>
            <p className="text-[#a0a0a0] mb-6">{step.content}</p>

            {/* Navigation */}
            <div className="flex items-center justify-between">
              <button
                onClick={handlePrev}
                disabled={currentStep === 0}
                className="px-4 py-2 rounded-lg text-sm text-[#a0a0a0] hover:text-white disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
              >
                ‚Üê Previous
              </button>

              <div className="flex gap-1">
                {TOUR_STEPS.map((_, i) => (
                  <div
                    key={i}
                    className={`w-2 h-2 rounded-full transition-colors ${
                      i === currentStep ? "bg-[#a78bfa]" : i < currentStep ? "bg-[#4ecdc4]" : "bg-[#2a2a3a]"
                    }`}
                  />
                ))}
              </div>

              <button
                onClick={handleNext}
                className="px-4 py-2 rounded-lg text-sm bg-gradient-to-r from-[#a78bfa] to-[#4ecdc4] text-white hover:opacity-90 transition-opacity"
              >
                {currentStep === TOUR_STEPS.length - 1 ? "Get Started" : "Next ‚Üí"}
              </button>
            </div>
          </div>
        </div>
      </div>
    </>
  );
}

export function useOnboarding() {
  const [showTour, setShowTour] = useState(false);
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const hasVisited = localStorage.getItem("hasVisitedBefore");
    
    // Only show tour on very first visit ever
    if (!hasVisited) {
      // Mark as visited immediately so tour won't show on refresh
      localStorage.setItem("hasVisitedBefore", "true");
      // Show tour once
      setTimeout(() => setShowTour(true), 1000);
    }
  }, []);

  const resetTour = () => {
    localStorage.removeItem("hasVisitedBefore");
    localStorage.removeItem("onboardingComplete");
    setShowTour(true);
  };

  return { showTour, setShowTour, resetTour, mounted };
}
</file>

<file path="src/components/PageHeader.tsx">
"use client";

import { useUIStore, useDocumentStore } from "@/store/documentStore";
import { Sun, Moon, Settings, Command, Save, Trash2, Eye, Flame, Timer } from "lucide-react";
import AutoSaveIndicator from "./AutoSaveIndicator";
import LanguageSelector from "./LanguageSelector";
import { IconButton, ButtonGroup } from "./Button";
import UserMenu from "./UserMenu";

interface PageHeaderProps {
  isTracking?: boolean;
  currentSessionSeconds?: number;
  formatTime?: (seconds: number) => string;
  onSave: () => void;
  onClear: () => void;
  onTogglePreview: () => void;
  showPreview?: boolean;
  onShowStreaks: () => void;
  onShowSettings: () => void;
  isSaving?: boolean;
  onShowAuth?: () => void;
  onShowMyTemplates?: () => void;
}

export default function PageHeader({
  isTracking = false,
  currentSessionSeconds = 0,
  formatTime = (s) => `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, "0")}`,
  onSave,
  onClear,
  onTogglePreview,
  showPreview = false,
  onShowStreaks,
  onShowSettings,
  isSaving = false,
  onShowAuth,
  onShowMyTemplates,
}: PageHeaderProps) {
  const { theme, setTheme, toggleCommandPalette } = useUIStore();
  const { hasUnsavedChanges, lastSaved } = useDocumentStore();

  return (
    <header className="mb-8 animate-fade-in">
      <div className="flex items-center justify-between mb-6">
        <div>
          <h1 className="text-3xl sm:text-4xl font-bold mb-1">
            <span className="text-gradient">Document Generator</span>
          </h1>
          <p className="text-sm text-[--text-muted]">
            Professional documents, ready for signature
          </p>
        </div>

        <div className="flex items-center gap-2">
          <AutoSaveIndicator
            lastSaved={lastSaved}
            isSaving={isSaving}
            hasChanges={hasUnsavedChanges}
          />
          <LanguageSelector compact />
          <IconButton
            icon={theme === "dark" ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
            onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
            variant="secondary"
            tooltip={theme === "dark" ? "Light mode" : "Dark mode"}
          />
          <IconButton
            icon={<Settings className="w-5 h-5" />}
            onClick={onShowSettings}
            variant="ghost"
            tooltip="Settings"
          />
          {/* User Menu */}
          <UserMenu
            onShowAuth={onShowAuth || (() => {})}
            onShowMyTemplates={onShowMyTemplates || (() => {})}
            onShowSettings={onShowSettings}
          />
        </div>
      </div>

      {/* Quick Action Bar */}
      <div className="flex flex-wrap items-center gap-3 pb-4 border-b border-[--border-default]">
        {/* Command Palette Trigger */}
        <button
          onClick={toggleCommandPalette}
          className="flex items-center gap-2 px-3 py-2 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:border-[--color-primary]/50 transition-all text-[--text-muted] hover:text-[--text-primary]"
        >
          <Command className="w-4 h-4" />
          <span className="text-sm hidden sm:inline">Search commands...</span>
          <kbd className="kbd text-xs ml-2">‚åòK</kbd>
        </button>

        {/* Time Tracker */}
        {isTracking && (
          <div className="flex items-center gap-2 px-3 py-2 rounded-xl bg-[--color-primary]/10 border border-[--color-primary]/30">
            <Timer className="w-4 h-4 text-[--color-primary]" />
            <span className="text-sm font-mono text-[--color-primary]">
              {formatTime(currentSessionSeconds)}
            </span>
          </div>
        )}

        <div className="flex-1" />

        <ButtonGroup>
          <IconButton
            icon={<Flame className="w-5 h-5" />}
            onClick={onShowStreaks}
            variant="ghost"
            tooltip="View streak"
          />
          <IconButton
            icon={<Eye className="w-5 h-5" />}
            onClick={onTogglePreview}
            variant={showPreview ? "primary" : "ghost"}
            tooltip={showPreview ? "Hide preview" : "Live preview"}
          />
        </ButtonGroup>

        <div className="h-6 w-px bg-[--border-default]" />

        <ButtonGroup>
          <IconButton
            icon={<Save className="w-4 h-4" />}
            onClick={onSave}
            variant="ghost"
            tooltip="Save draft (‚åòS)"
          />
          <IconButton
            icon={<Trash2 className="w-4 h-4" />}
            onClick={onClear}
            variant="ghost"
            tooltip="Clear document"
          />
        </ButtonGroup>
      </div>
    </header>
  );
}
</file>

<file path="src/components/PrivacySettings.tsx">
"use client";

import { useState } from "react";
import { toast } from "react-hot-toast";

interface PrivacySettingsProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function PrivacySettings({ isOpen, onClose }: PrivacySettingsProps) {
  const [isPrivateMode, setIsPrivateMode] = useState<boolean>(() => {
    if (typeof window !== "undefined") {
      return localStorage.getItem("privateMode") === "true";
    }
    return false;
  });

  const handleTogglePrivateMode = () => {
    const newMode = !isPrivateMode;
    setIsPrivateMode(newMode);
    localStorage.setItem("privateMode", newMode.toString());
    toast.success(newMode ? "Private mode enabled üîí" : "Private mode disabled");
  };

  const handleClearAllData = () => {
    const confirmed = window.confirm(
      "‚ö†Ô∏è Are you sure you want to clear ALL data? This will delete:\n\n" +
      "‚Ä¢ Document drafts\n" +
      "‚Ä¢ Document history\n" +
      "‚Ä¢ Statistics\n" +
      "‚Ä¢ Favorites\n" +
      "‚Ä¢ Last used settings\n" +
      "‚Ä¢ Theme preferences\n\n" +
      "This action cannot be undone!"
    );

    if (confirmed) {
      const itemsToKeep = ["theme"]; // Keep theme preference
      const allKeys = Object.keys(localStorage);
      
      allKeys.forEach(key => {
        if (!itemsToKeep.includes(key)) {
          localStorage.removeItem(key);
        }
      });

      toast.success("All data cleared successfully!");
      onClose();
      window.location.reload(); // Reload to reflect changes
    }
  };

  const handleClearHistory = () => {
    localStorage.removeItem("documentHistory");
    toast.success("Document history cleared!");
  };

  const handleClearStatistics = () => {
    localStorage.removeItem("documentStats");
    toast.success("Statistics cleared!");
  };

  const handleClearFavorites = () => {
    localStorage.removeItem("favoriteSettings");
    toast.success("Favorites cleared!");
  };

  const handleExportData = () => {
    const data = {
      documentDraft: localStorage.getItem("documentDraft"),
      documentHistory: localStorage.getItem("documentHistory"),
      documentStats: localStorage.getItem("documentStats"),
      favoriteSettings: localStorage.getItem("favoriteSettings"),
      lastUsedSettings: localStorage.getItem("lastUsedSettings"),
      lastSaved: localStorage.getItem("lastSaved"),
      theme: localStorage.getItem("theme"),
      exportedAt: new Date().toISOString(),
    };

    const jsonString = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonString], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = `document-generator-data-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    toast.success("Data exported successfully!");
  };

  const getStorageSize = (): string => {
    let totalSize = 0;
    for (const key in localStorage) {
      if (localStorage.hasOwnProperty(key)) {
        totalSize += localStorage[key].length + key.length;
      }
    }
    const sizeInKB = (totalSize / 1024).toFixed(2);
    return sizeInKB;
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div className="bg-white dark:bg-gray-800 rounded-2xl max-w-2xl w-full max-h-[80vh] flex flex-col shadow-2xl">
        <div className="flex items-center justify-between p-6 border-b dark:border-gray-700">
          <div>
            <h2 className="text-2xl font-bold bg-gradient-to-r from-red-600 to-orange-600 bg-clip-text text-transparent">
              üîí Privacy & Data Management
            </h2>
            <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
              Control your data and privacy settings
            </p>
          </div>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700"
          >
            ‚úï
          </button>
        </div>
        
        <div className="flex-1 overflow-auto p-6 space-y-6">
          {/* Privacy Notice */}
          <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 dark:border-blue-700">
            <h3 className="font-semibold text-blue-900 dark:text-blue-300 flex items-center gap-2 mb-2">
              <span>‚ÑπÔ∏è</span> Data Storage Notice
            </h3>
            <p className="text-sm text-blue-800 dark:text-blue-200">
              All your data is stored locally in your browser (localStorage). We do not collect, store, or transmit any personal information to external servers. Your documents, drafts, and settings stay on your device only.
            </p>
          </div>

          {/* Storage Info */}
          <div className="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
            <h3 className="font-semibold text-gray-900 dark:text-white mb-2">
              Storage Usage
            </h3>
            <p className="text-sm text-gray-600 dark:text-gray-300">
              Current storage: <span className="font-bold">{getStorageSize()} KB</span> of local data
            </p>
          </div>

          {/* Private Mode */}
          <div className="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-xl border border-purple-200 dark:border-purple-700">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="font-semibold text-purple-900 dark:text-purple-300 flex items-center gap-2">
                  <span>üïµÔ∏è</span> Private Mode
                </h3>
                <p className="text-sm text-purple-800 dark:text-purple-200 mt-1">
                  When enabled, history and statistics won&apos;t be saved
                </p>
              </div>
              <label className="relative inline-flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  checked={isPrivateMode}
                  onChange={handleTogglePrivateMode}
                  className="sr-only peer"
                />
                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
              </label>
            </div>
          </div>

          {/* Clear Data Options */}
          <div className="space-y-3">
            <h3 className="font-semibold text-gray-900 dark:text-white">
              Clear Data
            </h3>
            
            <button
              onClick={handleClearHistory}
              className="w-full bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 py-3 px-4 rounded-xl font-semibold hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition-all text-left flex items-center justify-between"
            >
              <span>Clear Document History</span>
              <span>üóëÔ∏è</span>
            </button>

            <button
              onClick={handleClearStatistics}
              className="w-full bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300 py-3 px-4 rounded-xl font-semibold hover:bg-orange-200 dark:hover:bg-orange-900/50 transition-all text-left flex items-center justify-between"
            >
              <span>Clear Statistics</span>
              <span>üóëÔ∏è</span>
            </button>

            <button
              onClick={handleClearFavorites}
              className="w-full bg-pink-100 dark:bg-pink-900/30 text-pink-800 dark:text-pink-300 py-3 px-4 rounded-xl font-semibold hover:bg-pink-200 dark:hover:bg-pink-900/50 transition-all text-left flex items-center justify-between"
            >
              <span>Clear Favorites</span>
              <span>üóëÔ∏è</span>
            </button>

            <button
              onClick={handleClearAllData}
              className="w-full bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 py-3 px-4 rounded-xl font-semibold hover:bg-red-200 dark:hover:bg-red-900/50 transition-all text-left flex items-center justify-between"
            >
              <span>‚ö†Ô∏è Clear ALL Data</span>
              <span>üóëÔ∏è</span>
            </button>
          </div>

          {/* Export Data */}
          <div>
            <button
              onClick={handleExportData}
              className="w-full bg-gradient-to-r from-green-500 to-emerald-500 text-white py-3 px-4 rounded-xl font-semibold hover:from-green-600 hover:to-emerald-600 transition-all shadow-md hover:shadow-lg flex items-center justify-between"
            >
              <span>üì¶ Export All Data (JSON)</span>
              <span>‚¨áÔ∏è</span>
            </button>
            <p className="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">
              Download a backup of all your data
            </p>
          </div>
        </div>
        
        <div className="p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900 rounded-b-2xl">
          <button
            onClick={onClose}
            className="w-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/UserGuide.tsx">
"use client";

interface UserGuideProps {
  onClose: () => void;
}

export default function UserGuide({ onClose }: UserGuideProps) {
  return (
    <div className="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 overflow-y-auto">
      <div className="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl border border-blue-200">
        <div className="sticky top-0 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-2xl z-10">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <span className="text-3xl">üìñ</span>
              <h2 className="text-2xl font-bold">User Guide</h2>
            </div>
            <button
              onClick={onClose}
              className="text-white hover:text-gray-200 text-3xl leading-none transition-colors"
              aria-label="Close guide"
            >
              √ó
            </button>
          </div>
          <p className="text-blue-100 mt-2">Everything you need to know about using the Document Template Generator</p>
        </div>

        <div className="p-8 space-y-8">
          {/* Introduction */}
          <section>
            <h3 className="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
              <span className="text-2xl">üéØ</span>
              What is this tool?
            </h3>
            <p className="text-gray-700 leading-relaxed">
              The Document Template Generator creates professional PDF documents ready to upload to DocuSign. 
              Generate letters of recommendation, employment letters, termination notices, and more with custom 
              signatories and beautiful formatting.
            </p>
          </section>

          {/* Step by Step */}
          <section className="bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-xl border border-purple-100">
            <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <span className="text-2xl">üìã</span>
              Step-by-Step Instructions
            </h3>
            
            <div className="space-y-4">
              <div className="flex gap-4">
                <div className="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold">
                  1
                </div>
                <div>
                  <h4 className="font-semibold text-gray-900 mb-1">Select Document Type</h4>
                  <p className="text-gray-700">Choose from 16+ document types including letters of recommendation, employment, termination, and more.</p>
                </div>
              </div>

              <div className="flex gap-4">
                <div className="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold">
                  2
                </div>
                <div>
                  <h4 className="font-semibold text-gray-900 mb-1">Add Recipient Information (Optional)</h4>
                  <p className="text-gray-700">Enter the recipient&apos;s name, title, address, and subject line if needed.</p>
                </div>
              </div>

              <div className="flex gap-4">
                <div className="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold">
                  3
                </div>
                <div>
                  <h4 className="font-semibold text-gray-900 mb-1">Choose or Create a Signatory</h4>
                  <p className="text-gray-700">Select a predefined signatory or create a custom one with name, title, company, phone, and email.</p>
                </div>
              </div>

              <div className="flex gap-4">
                <div className="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold">
                  4
                </div>
                <div>
                  <h4 className="font-semibold text-gray-900 mb-1">Customize Formatting</h4>
                  <p className="text-gray-700">Adjust font size (9-14pt) and line spacing (1.0-2.5) to your preference.</p>
                </div>
              </div>

              <div className="flex gap-4">
                <div className="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold">
                  5
                </div>
                <div>
                  <h4 className="font-semibold text-gray-900 mb-1">Write or Load Document Body</h4>
                  <p className="text-gray-700">Type your document content or load a template from the gallery. Watch the word and character count as you type.</p>
                </div>
              </div>

              <div className="flex gap-4">
                <div className="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold">
                  6
                </div>
                <div>
                  <h4 className="font-semibold text-gray-900 mb-1">Preview & Download</h4>
                  <p className="text-gray-700">Click &quot;Preview PDF&quot; to review your document, then &quot;Generate & Download PDF&quot; to save it.</p>
                </div>
              </div>
            </div>
          </section>

          {/* Features */}
          <section>
            <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <span className="text-2xl">‚ú®</span>
              Key Features
            </h3>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                <h4 className="font-semibold text-gray-900 mb-2">üìö Template Gallery</h4>
                <p className="text-gray-700 text-sm">Browse pre-written templates for common document types.</p>
              </div>

              <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                <h4 className="font-semibold text-gray-900 mb-2">üíæ Auto-Save Drafts</h4>
                <p className="text-gray-700 text-sm">Your work is automatically saved as you type. Never lose progress!</p>
              </div>

              <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                <h4 className="font-semibold text-gray-900 mb-2">üëÅÔ∏è PDF Preview</h4>
                <p className="text-gray-700 text-sm">Preview your document before downloading to ensure it&apos;s perfect.</p>
              </div>

              <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                <h4 className="font-semibold text-gray-900 mb-2">üìä Statistics & Achievements</h4>
                <p className="text-gray-700 text-sm">Track your document generation stats and unlock achievements.</p>
              </div>

              <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                <h4 className="font-semibold text-gray-900 mb-2">üìú Document History</h4>
                <p className="text-gray-700 text-sm">View and reload recently generated documents.</p>
              </div>

              <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                <h4 className="font-semibold text-gray-900 mb-2">‚å®Ô∏è Keyboard Shortcuts</h4>
                <p className="text-gray-700 text-sm">Press &quot;?&quot; to see available shortcuts for faster workflow.</p>
              </div>
            </div>
          </section>

          {/* Keyboard Shortcuts */}
          <section className="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-100">
            <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <span className="text-2xl">‚å®Ô∏è</span>
              Keyboard Shortcuts
            </h3>
            
            <div className="space-y-2">
              <div className="flex justify-between items-center py-2 border-b border-green-200">
                <span className="text-gray-700">Save Draft</span>
                <kbd className="px-3 py-1 bg-gray-200 text-gray-800 rounded font-mono text-sm">Ctrl + S</kbd>
              </div>
              <div className="flex justify-between items-center py-2 border-b border-green-200">
                <span className="text-gray-700">Preview PDF</span>
                <kbd className="px-3 py-1 bg-gray-200 text-gray-800 rounded font-mono text-sm">Ctrl + P</kbd>
              </div>
              <div className="flex justify-between items-center py-2 border-b border-green-200">
                <span className="text-gray-700">Generate & Download PDF</span>
                <kbd className="px-3 py-1 bg-gray-200 text-gray-800 rounded font-mono text-sm">Ctrl + G</kbd>
              </div>
              <div className="flex justify-between items-center py-2">
                <span className="text-gray-700">Show Shortcuts Help</span>
                <kbd className="px-3 py-1 bg-gray-200 text-gray-800 rounded font-mono text-sm">?</kbd>
              </div>
            </div>
          </section>

          {/* Tips & Best Practices */}
          <section>
            <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <span className="text-2xl">üí°</span>
              Tips & Best Practices
            </h3>
            
            <ul className="space-y-3">
              <li className="flex gap-3">
                <span className="text-green-600 text-xl">‚úì</span>
                <p className="text-gray-700"><strong>Use templates:</strong> Start with a template from the gallery to save time.</p>
              </li>
              <li className="flex gap-3">
                <span className="text-green-600 text-xl">‚úì</span>
                <p className="text-gray-700"><strong>Preview first:</strong> Always preview your document before downloading to catch any errors.</p>
              </li>
              <li className="flex gap-3">
                <span className="text-green-600 text-xl">‚úì</span>
                <p className="text-gray-700"><strong>Adjust formatting:</strong> Experiment with font size and line spacing for optimal readability.</p>
              </li>
              <li className="flex gap-3">
                <span className="text-green-600 text-xl">‚úì</span>
                <p className="text-gray-700"><strong>Add recipient info:</strong> Including recipient details makes your document more professional.</p>
              </li>
              <li className="flex gap-3">
                <span className="text-green-600 text-xl">‚úì</span>
                <p className="text-gray-700"><strong>Custom signatories:</strong> Create custom signatories with complete contact information for personalized documents.</p>
              </li>
              <li className="flex gap-3">
                <span className="text-green-600 text-xl">‚úì</span>
                <p className="text-gray-700"><strong>DocuSign ready:</strong> Generated PDFs include a dotted signature line perfect for DocuSign fields.</p>
              </li>
            </ul>
          </section>

          {/* Troubleshooting */}
          <section className="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-xl border border-yellow-100">
            <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <span className="text-2xl">üîß</span>
              Troubleshooting
            </h3>
            
            <div className="space-y-4">
              <div>
                <h4 className="font-semibold text-gray-900 mb-1">PDF not generating?</h4>
                <p className="text-gray-700 text-sm">Make sure you&apos;ve entered document body text and selected a signatory.</p>
              </div>
              <div>
                <h4 className="font-semibold text-gray-900 mb-1">Draft not loading?</h4>
                <p className="text-gray-700 text-sm">Check that you have a saved draft. Drafts are stored in your browser&apos;s local storage.</p>
              </div>
              <div>
                <h4 className="font-semibold text-gray-900 mb-1">Footer cut off in PDF?</h4>
                <p className="text-gray-700 text-sm">This should be fixed in the latest version. Try refreshing the page and regenerating.</p>
              </div>
              <div>
                <h4 className="font-semibold text-gray-900 mb-1">Lost your work?</h4>
                <p className="text-gray-700 text-sm">Use the &quot;Load Draft&quot; button - your work is automatically saved as you type!</p>
              </div>
            </div>
          </section>

          {/* Contact/Feedback */}
          <section className="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl border border-indigo-100">
            <h3 className="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
              <span className="text-2xl">üí¨</span>
              Need More Help?
            </h3>
            <p className="text-gray-700 mb-3">
              Have questions or suggestions? We&apos;d love to hear from you!
            </p>
            <button
              onClick={() => {
                onClose();
                window.location.href = '/suggestions';
              }}
              className="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-lg hover:from-indigo-600 hover:to-purple-600 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 font-semibold transition-all"
            >
              üìù Send Feedback or Suggestion
            </button>
          </section>
        </div>

        {/* Close Button at Bottom */}
        <div className="sticky bottom-0 bg-white border-t border-gray-200 p-4 rounded-b-2xl">
          <button
            onClick={onClose}
            className="w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 shadow-md hover:shadow-lg font-semibold transition-all"
          >
            Got it! Close Guide
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/data/signatories.ts">
export interface Signatory {
  id: string;
  name: string;
  title: string;
  company?: string;
  phone?: string;
  email?: string;
}

export const signatories: Signatory[] = [
  {
    id: "doron-stember",
    name: "Doron Stember",
    title: "Chief Medical Officer",
    company: "Fountain Vitality",
  },
  {
    id: "lindsay-burden",
    name: "Lindsay Burden",
    title: "Chief Clinical Operations Officer",
    company: "Fountain Vitality",
    phone: "213-237-1454",
    email: "Support@fountain.net",
  },
];
</file>

<file path=".eslintrc.json">
{
  "extends": "next/core-web-vitals"
}
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# local env files
.env*.local

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="postcss.config.js">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="src/app/api/generate-text/route.ts">
import { NextRequest, NextResponse } from "next/server";

export async function POST(request: NextRequest) {
  try {
    const { prompt, documentType } = await request.json();

    if (!prompt || !documentType) {
      return NextResponse.json(
        { error: "Prompt and document type are required" },
        { status: 400 }
      );
    }

    // Check if OpenAI API key is configured
    const apiKey = process.env.OPENAI_API_KEY;
    
    if (!apiKey) {
      return NextResponse.json(
        { 
          error: "OpenAI API key not configured",
          message: "Please add OPENAI_API_KEY to your environment variables"
        },
        { status: 500 }
      );
    }

    // Call OpenAI API
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${apiKey}`,
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [
          {
            role: "system",
            content: `You are a professional document writer. Generate a well-formatted ${documentType} based on the user's prompt. The document should be professional, clear, and appropriate for the document type. Return only the body text of the document, without headers or signatures.`,
          },
          {
            role: "user",
            content: prompt,
          },
        ],
        temperature: 0.7,
        max_tokens: 1000,
      }),
    });

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      return NextResponse.json(
        { 
          error: "Failed to generate text",
          details: errorData.error?.message || "Unknown error"
        },
        { status: response.status }
      );
    }

    const data = await response.json();
    const generatedText = data.choices[0]?.message?.content || "";

    if (!generatedText) {
      return NextResponse.json(
        { error: "No text generated" },
        { status: 500 }
      );
    }

    return NextResponse.json({
      success: true,
      text: generatedText,
    });
  } catch (error) {
    console.error("Error in generate-text route:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/sign/route.ts">
import { NextRequest, NextResponse } from "next/server";

export async function POST(request: NextRequest) {
  try {
    const formData = await request.formData();
    const pdf = formData.get("pdf") as File;
    const documentType = formData.get("documentType") as string;
    const signatoryId = formData.get("signatoryId") as string;

    if (!pdf || !documentType || !signatoryId) {
      return NextResponse.json(
        { error: "Missing required fields" },
        { status: 400 }
      );
    }

    // TODO: Implement DocuSign envelope creation logic
    // This is a placeholder implementation
    // You would use @docusign/esign-node here to:
    // 1. Create an envelope
    // 2. Add the PDF document
    // 3. Add signer(s)
    // 4. Send the envelope

    // Placeholder response
    const envelopeId = `envelope_${Date.now()}`;

    return NextResponse.json({
      success: true,
      envelopeId,
      message: "Document sent to DocuSign (placeholder)",
    });
  } catch (error) {
    console.error("Error in sign route:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/suggestions/route.ts">
import { NextRequest, NextResponse } from "next/server";

export async function POST(request: NextRequest) {
  try {
    const { name, email, suggestion } = await request.json();

    // Validation
    if (!name || !email || !suggestion) {
      return NextResponse.json(
        { error: "All fields are required" },
        { status: 400 }
      );
    }

    if (!email.includes("@") || !email.includes(".")) {
      return NextResponse.json(
        { error: "Invalid email address" },
        { status: 400 }
      );
    }

    if (suggestion.trim().length < 10) {
      return NextResponse.json(
        { error: "Suggestion must be at least 10 characters long" },
        { status: 400 }
      );
    }

    // Log the suggestion (in production, you might want to save to a database or send an email)
    console.log("New suggestion received:", {
      name,
      email,
      suggestion,
      timestamp: new Date().toISOString(),
    });

    // TODO: In production, you could:
    // 1. Save to a database (e.g., MongoDB, PostgreSQL)
    // 2. Send an email notification (e.g., using SendGrid, Resend, or Nodemailer)
    // 3. Store in a file or external service
    // 4. Send to a webhook or API endpoint

    // For now, we'll just return success
    // You can extend this to actually store the data
    return NextResponse.json({
      success: true,
      message: "Suggestion submitted successfully",
    });
  } catch (error) {
    console.error("Error in suggestions route:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}
</file>

<file path="src/components/DocumentHistory.tsx">
"use client";

import { getHistory, removeFromHistory, DocumentHistoryItem } from "@/utils/documentHistory";
import { useState, useEffect } from "react";
import { format } from "date-fns";

interface DocumentHistoryProps {
  isOpen: boolean;
  onClose: () => void;
  onLoadDocument: (item: DocumentHistoryItem) => void;
}

export default function DocumentHistory({ isOpen, onClose, onLoadDocument }: DocumentHistoryProps) {
  const [history, setHistory] = useState<DocumentHistoryItem[]>([]);

  useEffect(() => {
    if (isOpen) {
      setHistory(getHistory());
    }
  }, [isOpen]);

  const handleRemove = (id: string) => {
    removeFromHistory(id);
    setHistory(getHistory());
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div className="bg-white dark:bg-gray-800 rounded-lg max-w-3xl w-full max-h-[90vh] flex flex-col shadow-2xl">
        <div className="flex items-center justify-between p-6 border-b dark:border-gray-700">
          <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
            üìú Document History
          </h2>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl"
          >
            ‚úï
          </button>
        </div>
        <div className="flex-1 overflow-auto p-6">
          {history.length === 0 ? (
            <div className="text-center py-12 text-gray-500 dark:text-gray-400">
              No document history yet. Generate your first document to see it here!
            </div>
          ) : (
            <div className="space-y-3">
              {history.map((item) => (
                <div
                  key={item.id}
                  className="p-4 border-2 border-gray-200 dark:border-gray-700 rounded-xl hover:border-purple-400 dark:hover:border-purple-500 hover:shadow-lg transition-all bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900"
                >
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <h3 className="font-semibold text-lg text-gray-900 dark:text-white">
                        {item.documentType}
                      </h3>
                      <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                        Signed by: {item.signatoryName}
                      </p>
                      <p className="text-xs text-gray-500 dark:text-gray-500 mt-1">
                        {format(new Date(item.createdAt), "MMM dd, yyyy 'at' h:mm a")}
                      </p>
                    </div>
                    <div className="flex gap-2 ml-4">
                      <button
                        onClick={() => {
                          onLoadDocument(item);
                          onClose();
                        }}
                        className="px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm"
                      >
                        Load
                      </button>
                      <button
                        onClick={() => handleRemove(item.id)}
                        className="px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm"
                      >
                        Remove
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/StatisticsPanel.tsx">
"use client";

import { getStats, getAchievementName, DocumentStats } from "@/utils/statistics";
import { useState, useEffect } from "react";

interface StatisticsPanelProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function StatisticsPanel({ isOpen, onClose }: StatisticsPanelProps) {
  const [stats, setStats] = useState<DocumentStats | null>(null);

  useEffect(() => {
    if (isOpen) {
      setStats(getStats());
    }
  }, [isOpen]);

  if (!isOpen || !stats) return null;

  const topDocumentType = Object.entries(stats.documentTypeCounts).sort((a, b) => b[1] - a[1])[0];
  const topSignatory = Object.entries(stats.signatoryCounts).sort((a, b) => b[1] - a[1])[0];

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div className="bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full max-h-[90vh] flex flex-col shadow-2xl">
        <div className="flex items-center justify-between p-6 border-b dark:border-gray-700">
          <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
            üìä Your Statistics
          </h2>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl"
          >
            ‚úï
          </button>
        </div>
        <div className="flex-1 overflow-auto p-6 space-y-6">
          <div className="grid grid-cols-2 gap-4">
            <div className="bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-900 dark:to-purple-800 p-4 rounded-xl">
              <div className="text-3xl font-bold text-purple-700 dark:text-purple-300">
                {stats.totalGenerated}
              </div>
              <div className="text-sm text-purple-600 dark:text-purple-400">Total Documents</div>
            </div>
            <div className="bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-900 dark:to-blue-800 p-4 rounded-xl">
              <div className="text-3xl font-bold text-blue-700 dark:text-blue-300">
                {stats.streakDays}
              </div>
              <div className="text-sm text-blue-600 dark:text-blue-400">Day Streak</div>
            </div>
          </div>

          {topDocumentType && (
            <div className="bg-gray-50 dark:bg-gray-900 p-4 rounded-xl">
              <h3 className="font-semibold mb-2 text-gray-900 dark:text-white">Most Used Document Type</h3>
              <div className="text-lg text-gray-700 dark:text-gray-300">
                {topDocumentType[0]} ({topDocumentType[1]} times)
              </div>
            </div>
          )}

          {topSignatory && (
            <div className="bg-gray-50 dark:bg-gray-900 p-4 rounded-xl">
              <h3 className="font-semibold mb-2 text-gray-900 dark:text-white">Most Used Signatory</h3>
              <div className="text-lg text-gray-700 dark:text-gray-300">
                {topSignatory[0]} ({topSignatory[1]} times)
              </div>
            </div>
          )}

          {stats.achievements.length > 0 && (
            <div className="bg-gradient-to-br from-yellow-100 to-yellow-200 dark:from-yellow-900 dark:to-yellow-800 p-4 rounded-xl">
              <h3 className="font-semibold mb-3 text-gray-900 dark:text-white">üèÜ Achievements</h3>
              <div className="grid grid-cols-2 gap-2">
                {stats.achievements.map((achievement) => (
                  <div
                    key={achievement}
                    className="bg-white dark:bg-gray-800 px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300"
                  >
                    {getAchievementName(achievement)}
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/contexts/ThemeContext.tsx">
"use client";

import { createContext, useContext, useEffect, useState, ReactNode } from "react";

type Theme = "light" | "dark";

interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export function ThemeProvider({ children }: { children: ReactNode }) {
  const [theme, setTheme] = useState<Theme>("light");
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    const savedTheme = localStorage.getItem("theme") as Theme;
    if (savedTheme) {
      setTheme(savedTheme);
    } else {
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      setTheme(prefersDark ? "dark" : "light");
    }
  }, []);

  useEffect(() => {
    if (mounted) {
      localStorage.setItem("theme", theme);
      document.documentElement.classList.toggle("dark", theme === "dark");
    }
  }, [theme, mounted]);

  const toggleTheme = () => {
    setTheme((prev) => (prev === "light" ? "dark" : "light"));
  };

  if (!mounted) {
    return <>{children}</>;
  }

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (context === undefined) {
    throw new Error("useTheme must be used within a ThemeProvider");
  }
  return context;
}
</file>

<file path="src/hooks/useKeyboardShortcuts.ts">
import { useEffect } from "react";

interface KeyboardShortcut {
  key: string;
  ctrl?: boolean;
  shift?: boolean;
  alt?: boolean;
  action: () => void;
  description: string;
}

export function useKeyboardShortcuts(shortcuts: KeyboardShortcut[]) {
  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      shortcuts.forEach((shortcut) => {
        const ctrlMatch = shortcut.ctrl ? event.ctrlKey || event.metaKey : !event.ctrlKey && !event.metaKey;
        const shiftMatch = shortcut.shift ? event.shiftKey : !event.shiftKey;
        const altMatch = shortcut.alt ? event.altKey : !event.altKey;
        const keyMatch = event.key.toLowerCase() === shortcut.key.toLowerCase();

        if (ctrlMatch && shiftMatch && altMatch && keyMatch) {
          event.preventDefault();
          shortcut.action();
        }
      });
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [shortcuts]);
}
</file>

<file path="src/utils/statistics.ts">
const STATS_KEY = "documentStats";

export interface DocumentStats {
  totalGenerated: number;
  documentTypeCounts: Record<string, number>;
  signatoryCounts: Record<string, number>;
  lastGenerated?: string;
  streakDays: number;
  achievements: string[];
}

export function getStats(): DocumentStats {
  if (typeof window === "undefined") {
    return {
      totalGenerated: 0,
      documentTypeCounts: {},
      signatoryCounts: {},
      streakDays: 0,
      achievements: [],
    };
  }

  const stored = localStorage.getItem(STATS_KEY);
  const defaultStats: DocumentStats = {
    totalGenerated: 0,
    documentTypeCounts: {},
    signatoryCounts: {},
    streakDays: 0,
    achievements: [],
  };

  if (!stored) return defaultStats;

  const stats = JSON.parse(stored);
  return { ...defaultStats, ...stats };
}

export function updateStats(documentType: string, signatoryName: string) {
  const stats = getStats();
  
  stats.totalGenerated += 1;
  stats.documentTypeCounts[documentType] = (stats.documentTypeCounts[documentType] || 0) + 1;
  stats.signatoryCounts[signatoryName] = (stats.signatoryCounts[signatoryName] || 0) + 1;
  stats.lastGenerated = new Date().toISOString();

  // Update streak
  const lastDate = stats.lastGenerated ? new Date(stats.lastGenerated) : null;
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  if (lastDate) {
    lastDate.setHours(0, 0, 0, 0);
    const diffDays = Math.floor((today.getTime() - lastDate.getTime()) / (1000 * 60 * 60 * 24));
    if (diffDays === 1) {
      stats.streakDays += 1;
    } else if (diffDays > 1) {
      stats.streakDays = 1;
    }
  } else {
    stats.streakDays = 1;
  }

  // Check achievements
  const newAchievements: string[] = [];
  if (stats.totalGenerated === 1 && !stats.achievements.includes("first-doc")) {
    newAchievements.push("first-doc");
  }
  if (stats.totalGenerated === 10 && !stats.achievements.includes("ten-docs")) {
    newAchievements.push("ten-docs");
  }
  if (stats.totalGenerated === 50 && !stats.achievements.includes("fifty-docs")) {
    newAchievements.push("fifty-docs");
  }
  if (stats.totalGenerated === 100 && !stats.achievements.includes("hundred-docs")) {
    newAchievements.push("hundred-docs");
  }
  if (stats.streakDays === 7 && !stats.achievements.includes("week-streak")) {
    newAchievements.push("week-streak");
  }

  stats.achievements = [...stats.achievements, ...newAchievements];

  localStorage.setItem(STATS_KEY, JSON.stringify(stats));
  return { stats, newAchievements };
}

export function getAchievementName(id: string): string {
  const names: Record<string, string> = {
    "first-doc": "First Document",
    "ten-docs": "Getting Started",
    "fifty-docs": "Power User",
    "hundred-docs": "Document Master",
    "week-streak": "Consistent Creator",
  };
  return names[id] || id;
}
</file>

<file path="tailwind.config.ts">
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: "class",
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      colors: {
        background: "var(--background)",
        foreground: "var(--foreground)",
      },
      animation: {
        'float': 'float 6s ease-in-out infinite',
        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        'bounce-slow': 'bounce 2s infinite',
        'spin-slow': 'spin 3s linear infinite',
      },
      keyframes: {
        float: {
          '0%, 100%': { transform: 'translateY(0px) rotate(0deg)' },
          '50%': { transform: 'translateY(-20px) rotate(180deg)' },
        },
      },
    },
  },
  plugins: [],
};
export default config;
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

<file path="vercel.json">
{
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nextjs",
  "outputDirectory": ".next"
}
</file>

<file path="README.md">
# Document Template Generator

A professional Next.js web application that simplifies the creation of PDF document templates for business correspondence. This tool enables users to quickly generate professional documents (such as letters of recommendation, termination notices, employment letters, and more) with customizable content, automatic formatting, and AI-powered text generation.

## Purpose

The Document Template Generator is designed to streamline the document creation process for organizations that frequently need to produce standardized business documents. Instead of manually creating each document from scratch, users can:

- **Generate professional PDF templates** with consistent formatting and branding
- **Customize document content** through an intuitive web interface
- **Leverage AI assistance** to draft document text based on simple prompts
- **Save time** by automating the formatting and layout process
- **Ensure consistency** across all generated documents with standardized templates
- **Prepare documents for DocuSign** with properly formatted signature areas

## What It Does

This tool provides a complete document generation workflow:

1. **Document Type Selection**: Choose from 16+ pre-configured document types (Letters of Recommendation, Termination, Employment, Reference, etc.)

2. **AI-Powered Content Generation**: Use ChatGPT-like AI to automatically generate professional document text based on your prompts, with options to regenerate or improve the content

3. **Customizable Fields**: 
   - Add recipient information (name, title, address)
   - Set document date
   - Include subject lines
   - Select or create custom signatories

4. **Professional PDF Output**: 
   - Full-width header image (your company branding)
   - Properly formatted document body
   - Signature area with signatory information
   - Consistent typography and spacing
   - Ready for DocuSign upload

5. **Draft Management**: Save, load, and clear drafts automatically using browser storage

6. **Preview Before Download**: Review the generated PDF before downloading

## Features

- **Document Type Selection**: Choose from 16+ document types (Letters of Recommendation, Termination, Employment, etc.)
- **AI-Powered Text Generation**: Use ChatGPT-like AI to generate document text based on prompts
- **Signatory Selection**: Select from pre-configured signatories (Doron Stember or Lindsay Burden)
- **Dynamic PDF Generation**: Automatically generates PDFs with header image, body text, and signatory information
- **PDF Download**: Automatically downloads generated PDF templates ready for DocuSign

## Project Structure

```
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globals.css               # Global styles with Tailwind
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Root layout
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                  # Main form page
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ signatories.ts            # Signatory configuration
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îî‚îÄ‚îÄ pdfGenerator.ts           # PDF generation utility
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ header.png                    # Header image (add your image here)
‚îî‚îÄ‚îÄ package.json
```

## Setup Instructions

### Local Development

1. **Install Dependencies**:
   ```bash
   npm install
   ```

2. **Add Header Image**:
   - Place your header image as `header.png` in the `public/` directory
   - The PDF generator will automatically include this image at the top of each document

3. **Run Development Server**:
   ```bash
   npm run dev
   ```

4. **Open in Browser**:
   - Navigate to `http://localhost:3000`

### Deployment to Vercel

The project is configured for easy deployment to Vercel:

1. **Push to GitHub** (already done):
   - Repository: https://github.com/draphael123/docusign.git

2. **Deploy to Vercel**:
   - Go to [Vercel](https://vercel.com)
   - Click "Add New Project"
   - Import the GitHub repository: `draphael123/docusign`
   - Vercel will auto-detect Next.js and configure the build settings
   - Click "Deploy"

3. **Environment Variables**:
   - **OPENAI_API_KEY** (optional): Required for AI text generation feature
     - Get your API key from [OpenAI Platform](https://platform.openai.com/api-keys)
     - Add it in Vercel's project settings under "Environment Variables"
     - If not set, users can still manually enter document text

4. **Your app will be live** at: `https://your-project-name.vercel.app`

## Usage

1. Select a **Document Type** from the dropdown
2. Choose a **Signatory** using the radio buttons
3. **Generate Document Text** (optional):
   - Click "Use AI to Generate Text"
   - Enter a prompt describing what you want in the document
   - Click "Generate Text with AI" to auto-generate the content
   - Or manually enter the **Document Body** text in the textarea
4. Click **Generate PDF** to create and download the PDF template

## Signatory Configuration

Signatories are configured in `src/data/signatories.ts`:

- **Doron Stember** - Executive Director
- **Lindsay Burden** - Operations Manager

To add more signatories, edit the `signatories` array in this file.

## PDF Generation

The PDF generator automatically:
1. Loads the header image from `/public/header.png` (if available)
2. Adds the document type as a title
3. Formats the body text with proper line breaks
4. Places the signatory name and title at the bottom
5. Downloads the PDF with a descriptive filename

## Technologies Used

- **Next.js 14** - React framework with App Router
- **TypeScript** - Type safety
- **Tailwind CSS** - Styling
- **jsPDF** - PDF generation

## Notes

- The PDF generator will automatically load the header image from `/public/header.png` if it exists. If the image is not found, it will display a placeholder.
- The generated PDFs are downloaded directly to the user's device with a filename based on the document type and timestamp.
</file>

<file path="src/components/ProgressIndicator.tsx">
"use client";

interface ProgressIndicatorProps {
  bodyText: string;
  recipientName: string;
  signatorySelected: boolean;
  documentType: string;
  compact?: boolean;
}

interface CheckItem {
  label: string;
  completed: boolean;
  weight: number;
}

export default function ProgressIndicator({ 
  bodyText, 
  recipientName, 
  signatorySelected, 
  documentType,
  compact = false 
}: ProgressIndicatorProps) {
  const wordCount = bodyText.trim() ? bodyText.trim().split(/\s+/).length : 0;
  
  const checks: CheckItem[] = [
    { label: "Document type selected", completed: !!documentType, weight: 10 },
    { label: "Content added (50+ words)", completed: wordCount >= 50, weight: 40 },
    { label: "Signatory selected", completed: signatorySelected, weight: 25 },
    { label: "Recipient info (optional)", completed: !!recipientName, weight: 15 },
    { label: "Placeholders filled", completed: !bodyText.includes("[") || bodyText.includes("[]"), weight: 10 },
  ];

  const completedWeight = checks
    .filter(c => c.completed)
    .reduce((sum, c) => sum + c.weight, 0);

  const progress = Math.min(100, completedWeight);

  const getColor = () => {
    if (progress >= 90) return "#4ade80";
    if (progress >= 60) return "#f0b866";
    if (progress >= 30) return "#fb923c";
    return "#f87171";
  };

  const getStatus = () => {
    if (progress >= 90) return "Ready to generate!";
    if (progress >= 60) return "Almost there...";
    if (progress >= 30) return "Keep going...";
    return "Just getting started";
  };

  if (compact) {
    return (
      <div className="flex items-center gap-2">
        <div className="w-24 h-2 rounded-full bg-[#2a2a3a] overflow-hidden">
          <div 
            className="h-full rounded-full transition-all duration-500"
            style={{ width: `${progress}%`, backgroundColor: getColor() }}
          />
        </div>
        <span className="text-xs" style={{ color: getColor() }}>{progress}%</span>
      </div>
    );
  }

  return (
    <div className="p-4 rounded-xl bg-[#12121a] border border-[#2a2a3a]">
      {/* Header */}
      <div className="flex items-center justify-between mb-3">
        <h3 className="text-white font-medium">Document Progress</h3>
        <span className="text-sm" style={{ color: getColor() }}>{getStatus()}</span>
      </div>

      {/* Progress bar */}
      <div className="h-3 rounded-full bg-[#2a2a3a] overflow-hidden mb-4">
        <div 
          className="h-full rounded-full transition-all duration-500"
          style={{ 
            width: `${progress}%`, 
            backgroundColor: getColor(),
            boxShadow: `0 0 10px ${getColor()}40`
          }}
        />
      </div>

      {/* Checklist */}
      <div className="space-y-2">
        {checks.map((check, index) => (
          <div key={index} className="flex items-center gap-2">
            <div className={`w-5 h-5 rounded-full flex items-center justify-center text-xs ${
              check.completed 
                ? "bg-[#4ade80] text-[#0a0a12]" 
                : "bg-[#2a2a3a] text-[#666680]"
            }`}>
              {check.completed ? "‚úì" : index + 1}
            </div>
            <span className={`text-sm ${check.completed ? "text-[#a0a0a0]" : "text-[#666680]"}`}>
              {check.label}
            </span>
          </div>
        ))}
      </div>

      {/* Ready indicator */}
      {progress >= 75 && (
        <div className="mt-4 p-3 rounded-lg bg-[#4ade80]/10 border border-[#4ade80]/30">
          <p className="text-sm text-[#4ade80]">‚ú® Your document is ready to generate!</p>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/utils/documentHistory.ts">
export interface DocumentHistoryItem {
  id: string;
  documentType: string;
  signatoryName: string;
  createdAt: string;
  preview?: string;
  bodyText?: string;
  recipientName?: string;
  recipientTitle?: string;
  recipientAddress?: string;
}

const HISTORY_KEY = "documentHistory";
const MAX_HISTORY = 50;

export function saveToHistory(item: Omit<DocumentHistoryItem, "id" | "createdAt">) {
  const history = getHistory();
  const newItem: DocumentHistoryItem = {
    ...item,
    id: Date.now().toString(),
    createdAt: new Date().toISOString(),
  };

  const updatedHistory = [newItem, ...history].slice(0, MAX_HISTORY);
  localStorage.setItem(HISTORY_KEY, JSON.stringify(updatedHistory));
  return newItem;
}

export function getHistory(): DocumentHistoryItem[] {
  if (typeof window === "undefined") return [];
  const stored = localStorage.getItem(HISTORY_KEY);
  return stored ? JSON.parse(stored) : [];
}

export function clearHistory() {
  localStorage.removeItem(HISTORY_KEY);
}

export function removeFromHistory(id: string) {
  const history = getHistory();
  const updated = history.filter((item) => item.id !== id);
  localStorage.setItem(HISTORY_KEY, JSON.stringify(updated));
}
</file>

<file path="next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  webpack: (config, { isServer }) => {
    // Handle pdfjs-dist dependencies
    config.resolve.alias.canvas = false;
    config.resolve.alias.encoding = false;
    
    // Ignore specific node modules that aren't needed in browser
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
        path: false,
        stream: false,
        crypto: false,
      };
    }
    
    return config;
  },
}

module.exports = nextConfig
</file>

<file path="src/app/layout.tsx">
import type { Metadata, Viewport } from "next";
import "./globals.css";
import Providers from "@/components/Providers";

export const metadata: Metadata = {
  title: "DocGen - Professional Document Generator",
  description: "Generate professional PDF document templates quickly and easily. Create letters of recommendation, employment letters, business documents, and more with AI-powered assistance.",
  keywords: ["document generator", "PDF generator", "letter templates", "business documents", "document templates", "professional letters", "employment letters", "recommendation letters", "AI writing assistant"],
  authors: [{ name: "DocGen" }],
  creator: "DocGen",
  publisher: "DocGen",
  applicationName: "DocGen",
  manifest: "/manifest.json",
  appleWebApp: {
    capable: true,
    statusBarStyle: "black-translucent",
    title: "DocGen",
  },
  formatDetection: {
    telephone: false,
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      "max-video-preview": -1,
      "max-image-preview": "large",
      "max-snippet": -1,
    },
  },
  openGraph: {
    type: "website",
    locale: "en_US",
    url: "https://docgen.app",
    title: "DocGen - Professional Document Generator",
    description: "Create professional business documents, letters, and templates in minutes with AI assistance.",
    siteName: "DocGen",
    images: [
      {
        url: "/og-image.png",
        width: 1200,
        height: 630,
        alt: "DocGen - Professional Document Generator",
      },
    ],
  },
  twitter: {
    card: "summary_large_image",
    title: "DocGen - Document Generator",
    description: "Generate professional PDF documents in minutes with AI",
    images: ["/og-image.png"],
  },
  category: "productivity",
  other: {
    "mobile-web-app-capable": "yes",
    "apple-mobile-web-app-capable": "yes",
    "apple-mobile-web-app-status-bar-style": "black-translucent",
  },
};

export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  maximumScale: 5,
  themeColor: [
    { media: "(prefers-color-scheme: light)", color: "#faf8f5" },
    { media: "(prefers-color-scheme: dark)", color: "#0f0f12" },
  ],
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <head>
        <link rel="icon" href="/favicon.ico" sizes="any" />
        <link rel="icon" href="/icon.svg" type="image/svg+xml" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
      </head>
      <body>
        <Providers>{children}</Providers>
        <script
          dangerouslySetInnerHTML={{
            __html: `
              if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                  navigator.serviceWorker.register('/sw.js').then(
                    function(registration) {
                      console.log('ServiceWorker registration successful');
                    },
                    function(err) {
                      console.log('ServiceWorker registration failed: ', err);
                    }
                  );
                });
              }
            `,
          }}
        />
      </body>
    </html>
  );
}
</file>

<file path="src/data/templates.ts">
export interface DocumentTemplate {
  id: string;
  name: string;
  documentType: string;
  bodyText: string;
  description: string;
  category: string;
  useAppHeader?: boolean; // If true, apply the app's header image to this template
  isPinned?: boolean; // If true, show in quick access
  tags?: string[]; // Tags for filtering and organization
  isDocuSignReady?: boolean; // If true, includes DocuSign signature placeholders
}

export const documentTemplates: DocumentTemplate[] = [
  {
    id: "recommendation-1",
    name: "Professional Recommendation",
    documentType: "Letter of Recommendation",
    bodyText: "I am writing to recommend [Name] for [Position/Role]. I have had the pleasure of working with [Name] for [Duration] and can confidently say they are one of the most [adjective] professionals I have encountered.\n\n[Name] consistently demonstrated [skill/quality] and [skill/quality] throughout their tenure. Their ability to [specific achievement] was particularly impressive and contributed significantly to [outcome].\n\nI highly recommend [Name] without reservation and believe they would be an excellent addition to your team. Please feel free to contact me if you need any additional information.",
    description: "A comprehensive professional recommendation letter template",
    category: "Professional",
  },
  {
    id: "termination-1",
    name: "Standard Termination",
    documentType: "Letter of Termination",
    bodyText: "This letter is to inform you that your employment with [Company Name] will be terminated effective [Date].\n\nThis decision has been made due to [Reason]. We want to thank you for your service and contributions during your time with us.\n\nYour final paycheck and any accrued benefits will be processed according to company policy. Please return all company property, including [items], by [Date].\n\nWe wish you the best in your future endeavors.",
    description: "Professional termination letter template",
    category: "HR",
  },
  {
    id: "employment-1",
    name: "Job Offer Letter",
    documentType: "Letter of Employment",
    bodyText: "We are pleased to offer you the position of [Position Title] at [Company Name]. We believe your skills and experience make you an excellent fit for our team.\n\nYour start date will be [Date]. Your compensation will be [Salary/Details], and you will be eligible for [Benefits].\n\nPlease confirm your acceptance of this offer by [Date]. We look forward to welcoming you to our team.\n\nIf you have any questions, please do not hesitate to contact us.",
    description: "Standard job offer letter template",
    category: "HR",
  },
  {
    id: "reference-1",
    name: "Character Reference",
    documentType: "Letter of Reference",
    bodyText: "I am writing to provide a character reference for [Name], whom I have known for [Duration] in my capacity as [Relationship].\n\n[Name] has consistently demonstrated [qualities] and has proven to be [description]. I have observed their [specific examples] and can attest to their [characteristics].\n\nI recommend [Name] highly and believe they would be an asset to [context]. Please feel free to contact me if you require any further information.",
    description: "Character reference letter template",
    category: "Personal",
  },
];
</file>

<file path="package.json">
{
  "name": "docusign-template-automation",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@types/file-saver": "^2.0.7",
    "bcryptjs": "^3.0.3",
    "date-fns": "^4.1.0",
    "docx": "^9.5.1",
    "file-saver": "^2.0.5",
    "jspdf": "^2.5.2",
    "lucide-react": "^0.562.0",
    "mammoth": "^1.11.0",
    "next": "^14.2.5",
    "next-auth": "^4.24.13",
    "openai": "^4.52.7",
    "pdfjs-dist": "^4.0.379",
    "qrcode.react": "^3.2.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-hot-toast": "^2.6.0",
    "react-quill": "^2.0.0",
    "uuid": "^13.0.0",
    "zustand": "^5.0.10"
  },
  "devDependencies": {
    "@types/bcryptjs": "^2.4.6",
    "@types/node": "^20.14.12",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@types/uuid": "^10.0.0",
    "autoprefixer": "^10.4.19",
    "eslint": "^8.57.0",
    "eslint-config-next": "^14.2.5",
    "pdf-lib": "^1.17.1",
    "postcss": "^8.4.40",
    "tailwindcss": "^3.4.7",
    "typescript": "^5.5.4"
  }
}
</file>

<file path="src/components/TemplateGallery.tsx">
"use client";

import { useState, useEffect, useRef, useCallback } from "react";
import { documentTemplates, DocumentTemplate } from "@/data/templates";

interface TemplateGalleryProps {
  onSelectTemplate: (template: DocumentTemplate) => void;
  isOpen: boolean;
  onClose: () => void;
}

const LOCAL_STORAGE_KEY = "userTemplates_local_backup";

const documentTypes = [
  "Letter of Recommendation",
  "Letter of Termination",
  "Letter of Employment",
  "Letter of Reference",
  "Letter of Introduction",
  "Letter of Resignation",
  "Letter of Acceptance",
  "Letter of Rejection",
  "Letter of Apology",
  "Letter of Complaint",
  "Letter of Inquiry",
  "Letter of Request",
  "Letter of Confirmation",
  "Letter of Agreement",
  "Letter of Authorization",
  "Custom Document",
];

const categories = ["Professional", "HR", "Personal", "Legal", "Business", "Other"];

export default function TemplateGallery({ onSelectTemplate, isOpen, onClose }: TemplateGalleryProps) {
  const [userTemplates, setUserTemplates] = useState<DocumentTemplate[]>([]);
  const [showCreateForm, setShowCreateForm] = useState(false);
  const [activeTab, setActiveTab] = useState<"all" | "builtin" | "custom">("all");
  const [deleteConfirm, setDeleteConfirm] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [storageMode, setStorageMode] = useState<"cloud" | "local">("cloud");
  
  // Search state
  const [searchQuery, setSearchQuery] = useState("");
  
  // Form state
  const [formName, setFormName] = useState("");
  const [formDocType, setFormDocType] = useState(documentTypes[0]);
  const [formCategory, setFormCategory] = useState(categories[0]);
  const [formDescription, setFormDescription] = useState("");
  const [formBody, setFormBody] = useState("");
  const [formError, setFormError] = useState("");
  
  // File upload state
  const [isProcessing, setIsProcessing] = useState(false);
  const [uploadedFileName, setUploadedFileName] = useState("");
  const fileInputRef = useRef<HTMLInputElement>(null);
  
  // Header skip options
  const [skipHeader, setSkipHeader] = useState(false);
  const [headerLinesToSkip, setHeaderLinesToSkip] = useState(3);
  
  // Footer skip options
  const [skipFooter, setSkipFooter] = useState(false);
  const [footerLinesToSkip, setFooterLinesToSkip] = useState(2);
  
  // App header option
  const [useAppHeader, setUseAppHeader] = useState(true);
  
  // Additional options
  const [autoDetectPlaceholders, setAutoDetectPlaceholders] = useState(true);
  const [isPinned, setIsPinned] = useState(false);
  const [templateTags, setTemplateTags] = useState<string[]>([]);
  const [tagInput, setTagInput] = useState("");
  const [isDocuSignReady, setIsDocuSignReady] = useState(false);

  // Fetch templates from API
  const fetchTemplates = useCallback(async () => {
    setIsLoading(true);
    try {
      const response = await fetch("/api/templates");
      const data = await response.json();
      
      if (data.templates && data.templates.length > 0) {
        setUserTemplates(data.templates);
        setStorageMode("cloud");
        // Also save to localStorage as backup
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data.templates));
      } else if (data.source === "fallback") {
        // KV not configured, use localStorage
        setStorageMode("local");
        const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
        if (stored) {
          setUserTemplates(JSON.parse(stored));
        }
      }
    } catch (error) {
      console.error("Error fetching templates:", error);
      // Fallback to localStorage
      setStorageMode("local");
      const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
      if (stored) {
        try {
          setUserTemplates(JSON.parse(stored));
        } catch (e) {
          console.error("Error loading local templates:", e);
        }
      }
    } finally {
      setIsLoading(false);
    }
  }, []);

  // Load templates on mount
  useEffect(() => {
    fetchTemplates();
  }, [fetchTemplates]);

  // Save template to API or localStorage
  const saveTemplate = async (template: Omit<DocumentTemplate, "id">): Promise<boolean> => {
    setIsSaving(true);
    try {
      const response = await fetch("/api/templates", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ template }),
      });
      
      const data = await response.json();
      
      if (data.success && data.template) {
        // Add to local state
        const newTemplates = [...userTemplates, data.template];
        setUserTemplates(newTemplates);
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newTemplates));
        setStorageMode("cloud");
        return true;
      } else if (response.status === 503) {
        // Storage not configured, save locally only
        const localTemplate: DocumentTemplate = {
          ...template,
          id: `local-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
        };
        const newTemplates = [...userTemplates, localTemplate];
        setUserTemplates(newTemplates);
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newTemplates));
        setStorageMode("local");
        return true;
      }
      
      throw new Error(data.error || "Failed to save template");
    } catch (error) {
      console.error("Error saving template:", error);
      // Fallback: save locally
      const localTemplate: DocumentTemplate = {
        ...template,
        id: `local-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
      };
      const newTemplates = [...userTemplates, localTemplate];
      setUserTemplates(newTemplates);
      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newTemplates));
      setStorageMode("local");
      return true;
    } finally {
      setIsSaving(false);
    }
  };

  // Delete template from API or localStorage
  const deleteTemplate = async (templateId: string): Promise<boolean> => {
    try {
      // Only call API for cloud-stored templates
      if (templateId.startsWith("shared-")) {
        const response = await fetch(`/api/templates?id=${templateId}`, {
          method: "DELETE",
        });
        
        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || "Failed to delete template");
        }
      }
      
      // Update local state
      const newTemplates = userTemplates.filter((t) => t.id !== templateId);
      setUserTemplates(newTemplates);
      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newTemplates));
      return true;
    } catch (error) {
      console.error("Error deleting template:", error);
      // Still remove from local state
      const newTemplates = userTemplates.filter((t) => t.id !== templateId);
      setUserTemplates(newTemplates);
      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newTemplates));
      return true;
    }
  };

  const resetForm = () => {
    setFormName("");
    setFormDocType(documentTypes[0]);
    setFormCategory(categories[0]);
    setFormDescription("");
    setFormBody("");
    setFormError("");
    setUploadedFileName("");
    setSkipHeader(false);
    setHeaderLinesToSkip(3);
    setSkipFooter(false);
    setFooterLinesToSkip(2);
    setUseAppHeader(true);
    setAutoDetectPlaceholders(true);
    setIsPinned(false);
    setTemplateTags([]);
    setTagInput("");
    setIsDocuSignReady(false);
    if (fileInputRef.current) {
      fileInputRef.current.value = "";
    }
  };

  // Extract text from Word document
  const extractTextFromWord = async (file: File): Promise<string> => {
    try {
      const mammoth = await import("mammoth");
      const arrayBuffer = await file.arrayBuffer();
      const result = await mammoth.extractRawText({ arrayBuffer });
      return result.value;
    } catch (error) {
      console.error("Mammoth error:", error);
      throw new Error("Could not read Word document. Make sure it's a valid .docx file.");
    }
  };

  // Extract text from PDF
  const extractTextFromPDF = async (file: File): Promise<string> => {
    try {
      // Use dynamic import for pdf.js v4
      const pdfjsLib = await import("pdfjs-dist");
      
      // Configure worker - using unpkg CDN (more reliable for npm packages)
      const PDFJS_VERSION = "4.0.379";
      pdfjsLib.GlobalWorkerOptions.workerSrc = `https://unpkg.com/pdfjs-dist@${PDFJS_VERSION}/build/pdf.worker.min.mjs`;
      
      console.log("PDF.js version:", PDFJS_VERSION);
      console.log("Loading PDF file:", file.name, "Size:", file.size, "bytes");
      
      const arrayBuffer = await file.arrayBuffer();
      console.log("ArrayBuffer created, size:", arrayBuffer.byteLength);
      
      // Load document
      const loadingTask = pdfjsLib.getDocument({ 
        data: arrayBuffer,
        verbosity: 0, // Reduce console noise
      });
      
      console.log("Loading task created, waiting for PDF...");
      const pdf = await loadingTask.promise;
      console.log("PDF loaded successfully. Pages:", pdf.numPages);
      
      if (pdf.numPages === 0) {
        throw new Error("PDF has no pages");
      }
      
      let fullText = "";
      let pagesWithText = 0;
      
      for (let i = 1; i <= pdf.numPages; i++) {
        try {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          
          // Extract text items with proper spacing
          const pageText = textContent.items
            .filter((item: any) => item.str && item.str.trim())
            .map((item: any) => item.str)
            .join(" ");
          
          if (pageText.trim()) {
            fullText += pageText + "\n\n";
            pagesWithText++;
          }
          
          console.log(`Page ${i}: ${pageText.length} characters extracted`);
        } catch (pageError) {
          console.warn(`Error reading page ${i}:`, pageError);
        }
      }
      
      console.log(`Total extraction: ${fullText.length} characters from ${pagesWithText}/${pdf.numPages} pages`);
      
      if (!fullText.trim()) {
        throw new Error("NO_TEXT_CONTENT");
      }
      
      return fullText.trim();
    } catch (pdfJsError: any) {
      console.error("PDF.js error details:", {
        name: pdfJsError?.name,
        message: pdfJsError?.message,
        stack: pdfJsError?.stack?.slice(0, 500),
      });
      
      // Provide specific error messages
      if (pdfJsError.message === "NO_TEXT_CONTENT") {
        throw new Error("This PDF appears to be image-based (scanned) and doesn't contain extractable text. Please use a text-based PDF or paste the content manually.");
      }
      
      if (pdfJsError.message?.includes("Invalid PDF")) {
        throw new Error("Invalid or corrupted PDF file. Please try a different file.");
      }
      
      if (pdfJsError.message?.includes("Password")) {
        throw new Error("This PDF is password protected. Please remove the password and try again.");
      }
      
      if (pdfJsError.name === "MissingPDFException") {
        throw new Error("Could not read PDF file. The file may be corrupted.");
      }
      
      throw new Error(`Could not read PDF: ${pdfJsError.message || "Unknown error"}. Try a different file or paste content manually.`);
    }
  };

  // Handle file upload
  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const fileName = file.name.toLowerCase();
    const isDocx = fileName.endsWith(".docx");
    const isDoc = fileName.endsWith(".doc");
    const isPDF = fileName.endsWith(".pdf");

    if (!isDocx && !isDoc && !isPDF) {
      setFormError("Please upload a .docx or .pdf file");
      return;
    }

    // .doc format (old Word) is not supported
    if (isDoc) {
      setFormError("Old .doc format is not supported. Please save as .docx and try again, or paste the content manually.");
      return;
    }

    setIsProcessing(true);
    setFormError("");
    setUploadedFileName(file.name);

    try {
      let extractedText = "";

      if (isDocx) {
        extractedText = await extractTextFromWord(file);
      } else if (isPDF) {
        extractedText = await extractTextFromPDF(file);
      }

      if (!extractedText.trim()) {
        setFormError("Could not extract text from the file. The file may be empty or image-based (scanned).");
        setUploadedFileName("");
        return;
      }

      // Clean up extracted text - preserve line breaks for header skipping
      extractedText = extractedText
        .replace(/[ \t]+/g, " ")  // Collapse spaces/tabs but keep newlines
        .replace(/\n{3,}/g, "\n\n")  // Max 2 consecutive newlines
        .trim();

      // Skip header lines if enabled
      if (skipHeader && headerLinesToSkip > 0) {
        const lines = extractedText.split("\n");
        if (lines.length > headerLinesToSkip) {
          extractedText = lines.slice(headerLinesToSkip).join("\n").trim();
          console.log(`Skipped ${headerLinesToSkip} header lines`);
        }
      }
      
      // Skip footer lines if enabled
      if (skipFooter && footerLinesToSkip > 0) {
        const lines = extractedText.split("\n");
        if (lines.length > footerLinesToSkip) {
          extractedText = lines.slice(0, -footerLinesToSkip).join("\n").trim();
          console.log(`Skipped ${footerLinesToSkip} footer lines`);
        }
      }
      
      // Auto-detect and highlight placeholders
      if (autoDetectPlaceholders) {
        // Find patterns like names, dates, company names and suggest as placeholders
        const patterns = [
          { regex: /\b(January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{1,2},?\s+\d{4}\b/gi, replacement: "[Date]" },
          { regex: /\b\d{1,2}\/\d{1,2}\/\d{2,4}\b/g, replacement: "[Date]" },
          { regex: /\$[\d,]+(?:\.\d{2})?/g, replacement: "[Amount]" },
          { regex: /\b[A-Z][a-z]+\s+[A-Z][a-z]+(?:\s+(?:Jr\.|Sr\.|III|IV|II))?\b/g, replacement: "[Name]" },
        ];
        
        let detectedCount = 0;
        patterns.forEach(({ regex, replacement }) => {
          const matches = extractedText.match(regex);
          if (matches) {
            detectedCount += matches.length;
          }
        });
        
        if (detectedCount > 0) {
          console.log(`Auto-detected ${detectedCount} potential placeholders`);
        }
      }

      // Set form values
      setFormBody(extractedText);
      
      // Auto-fill name from filename if empty
      if (!formName) {
        const nameWithoutExt = file.name.replace(/\.(docx?|pdf)$/i, "");
        setFormName(nameWithoutExt);
      }

    } catch (error: any) {
      console.error("Error processing file:", error);
      const errorMessage = error?.message || "Error processing file. Please try a different file or paste the content manually.";
      setFormError(errorMessage);
      setUploadedFileName("");
    } finally {
      setIsProcessing(false);
      // Reset file input
      if (fileInputRef.current) {
        fileInputRef.current.value = "";
      }
    }
  };

  const handleCreateTemplate = async () => {
    // Validation
    if (!formName.trim()) {
      setFormError("Template name is required");
      return;
    }
    if (!formBody.trim()) {
      setFormError("Template content is required");
      return;
    }
    if (formBody.trim().length < 50) {
      setFormError("Template content should be at least 50 characters");
      return;
    }

    const templateData = {
      name: formName.trim(),
      documentType: formDocType,
      bodyText: formBody.trim(),
      description: formDescription.trim() || `Custom ${formDocType.toLowerCase()} template`,
      category: formCategory,
      useAppHeader: useAppHeader,
      isPinned: isPinned,
      tags: templateTags,
      isDocuSignReady: isDocuSignReady,
    };

    const success = await saveTemplate(templateData);
    if (success) {
      resetForm();
      setShowCreateForm(false);
    } else {
      setFormError("Failed to save template. Please try again.");
    }
  };

  const handleDeleteTemplate = async (id: string) => {
    await deleteTemplate(id);
    setDeleteConfirm(null);
  };

  const getFilteredTemplates = () => {
    let templates: DocumentTemplate[];
    switch (activeTab) {
      case "builtin":
        templates = documentTemplates;
        break;
      case "custom":
        templates = userTemplates;
        break;
      default:
        templates = [...documentTemplates, ...userTemplates];
    }
    
    // Apply search filter
    if (searchQuery.trim()) {
      const query = searchQuery.toLowerCase();
      templates = templates.filter(
        (t) =>
          t.name.toLowerCase().includes(query) ||
          t.description.toLowerCase().includes(query) ||
          t.category.toLowerCase().includes(query) ||
          t.documentType.toLowerCase().includes(query)
      );
    }
    
    return templates;
  };

  const filteredTemplates = getFilteredTemplates();

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-[#12121a]/95 backdrop-blur-md rounded-xl max-w-4xl w-full max-h-[90vh] flex flex-col border border-[#2a2a3a] shadow-2xl shadow-[#a78bfa]/10">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-[#2a2a3a]">
          <h2 className="text-xl gradient-text font-semibold">Templates</h2>
          <div className="flex items-center gap-3">
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="Search templates..."
              className="px-3 py-1.5 text-sm bg-[#1a1a24] border border-[#2a2a3a] rounded-lg text-[#fafafa] placeholder-[#666680] focus:border-[#a78bfa] focus:shadow-lg focus:shadow-[#a78bfa]/20 focus:outline-none w-48 transition-all"
            />
            <button
              onClick={onClose}
              className="text-[#666666] hover:text-[#fafafa] transition-colors text-xl"
            >
              √ó
            </button>
          </div>
        </div>

        {/* Tabs and Actions */}
        <div className="flex items-center justify-between px-4 py-3 border-b border-[#2a2a2a]">
          <div className="flex items-center gap-3">
            <div className="flex gap-1">
              <button
                onClick={() => setActiveTab("all")}
                className={`px-3 py-1.5 text-sm rounded-lg transition-all ${
                  activeTab === "all"
                    ? "bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white shadow-lg shadow-[#a78bfa]/25"
                    : "text-[#666680] hover:text-[#a78bfa] hover:bg-[#a78bfa]/10"
                }`}
              >
                All ({documentTemplates.length + userTemplates.length})
              </button>
              <button
                onClick={() => setActiveTab("builtin")}
                className={`px-3 py-1.5 text-sm rounded-lg transition-all ${
                  activeTab === "builtin"
                    ? "bg-[#4ecdc4] text-[#0a0a12] shadow-lg shadow-[#4ecdc4]/25"
                    : "text-[#666680] hover:text-[#4ecdc4] hover:bg-[#4ecdc4]/10"
                }`}
              >
                Built-in ({documentTemplates.length})
              </button>
              <button
                onClick={() => setActiveTab("custom")}
                className={`px-3 py-1.5 text-sm rounded-lg transition-all ${
                  activeTab === "custom"
                    ? "bg-[#f0b866] text-[#0a0a12] shadow-lg shadow-[#f0b866]/25"
                    : "text-[#666680] hover:text-[#f0b866] hover:bg-[#f0b866]/10"
                }`}
              >
                My Templates ({userTemplates.length})
              </button>
            </div>
            {/* Storage indicator */}
            <span className={`text-xs px-2 py-1 rounded-full ${
              storageMode === "cloud" 
                ? "bg-[#4ade80]/20 text-[#4ade80]" 
                : "bg-[#fbbf24]/20 text-[#fbbf24]"
            }`}>
              {storageMode === "cloud" ? "‚òÅÔ∏è Cloud Synced" : "üíæ Local Only"}
            </span>
          </div>
          <button
            onClick={() => {
              resetForm();
              setShowCreateForm(true);
            }}
            disabled={isSaving}
            className="px-3 py-1.5 text-sm bg-[#d4a373] text-[#0f0f0f] rounded hover:bg-[#e5b888] transition-colors disabled:opacity-50"
          >
            + New Template
          </button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-4">
          {showCreateForm ? (
            /* Create Template Form */
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center justify-between mb-6">
                <h3 className="text-lg text-[#fafafa]">Create New Template</h3>
                <button
                  onClick={() => {
                    resetForm();
                    setShowCreateForm(false);
                  }}
                  className="text-sm text-[#666666] hover:text-[#a0a0a0]"
                >
                  Cancel
                </button>
              </div>

              {formError && (
                <div className="mb-4 p-3 bg-[#f87171]/10 border border-[#f87171]/20 rounded-lg text-sm text-[#f87171]">
                  {formError}
                </div>
              )}

              <div className="space-y-4">
                {/* File Upload */}
                <div>
                  <label className="block text-sm text-[#666666] mb-2">
                    Upload Document
                  </label>
                  <div 
                    className={`relative border-2 border-dashed rounded-lg p-6 text-center transition-colors ${
                      isProcessing 
                        ? "border-[#d4a373] bg-[#d4a373]/5" 
                        : "border-[#2a2a2a] hover:border-[#3a3a3a]"
                    }`}
                  >
                    <input
                      ref={fileInputRef}
                      type="file"
                      accept=".doc,.docx,.pdf"
                      onChange={handleFileUpload}
                      className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                      disabled={isProcessing}
                    />
                    {isProcessing ? (
                      <div className="text-[#d4a373]">
                        <div className="mb-2">Processing...</div>
                        <div className="text-sm text-[#666666]">{uploadedFileName}</div>
                      </div>
                    ) : uploadedFileName ? (
                      <div>
                        <div className="text-[#4ade80] mb-1">File loaded</div>
                        <div className="text-sm text-[#a0a0a0]">{uploadedFileName}</div>
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            setUploadedFileName("");
                            setFormBody("");
                            if (fileInputRef.current) {
                              fileInputRef.current.value = "";
                            }
                          }}
                          className="mt-2 text-xs text-[#666666] hover:text-[#a0a0a0]"
                        >
                          Remove
                        </button>
                      </div>
                    ) : (
                      <div>
                        <div className="text-[#a0a0a0] mb-1">
                          Drop a file here or click to upload
                        </div>
                        <div className="text-sm text-[#666666]">
                          Supports .docx and .pdf files
                        </div>
                      </div>
                    )}
                  </div>
                  
                  {/* Skip Header Option */}
                  <div className="mt-3 flex items-center gap-4">
                    <label className="flex items-center gap-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={skipHeader}
                        onChange={(e) => setSkipHeader(e.target.checked)}
                        className="w-4 h-4 rounded border-[#2a2a2a] bg-[#1a1a24] text-[#a78bfa] focus:ring-[#a78bfa] focus:ring-offset-0 cursor-pointer"
                      />
                      <span className="text-sm text-[#a0a0a0]">Skip header lines</span>
                    </label>
                    {skipHeader && (
                      <div className="flex items-center gap-2">
                        <input
                          type="number"
                          min="1"
                          max="20"
                          value={headerLinesToSkip}
                          onChange={(e) => setHeaderLinesToSkip(Math.max(1, Math.min(20, parseInt(e.target.value) || 1)))}
                          className="w-16 px-2 py-1 text-sm rounded bg-[#1a1a24] border border-[#2a2a2a] text-[#fafafa] focus:border-[#a78bfa] focus:outline-none"
                        />
                        <span className="text-xs text-[#666666]">lines to skip</span>
                      </div>
                    )}
                  </div>
                  
                  {/* Skip Footer Toggle */}
                  <div className="mt-3 flex items-center gap-4">
                    <label className="flex items-center gap-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={skipFooter}
                        onChange={(e) => setSkipFooter(e.target.checked)}
                        className="w-4 h-4 rounded border-[#2a2a2a] bg-[#1a1a24] text-[#f472b6] focus:ring-[#f472b6] focus:ring-offset-0 cursor-pointer"
                      />
                      <span className="text-sm text-[#a0a0a0]">Skip footer lines</span>
                    </label>
                    {skipFooter && (
                      <div className="flex items-center gap-2">
                        <input
                          type="number"
                          min="1"
                          max="10"
                          value={footerLinesToSkip}
                          onChange={(e) => setFooterLinesToSkip(Math.max(1, Math.min(10, parseInt(e.target.value) || 1)))}
                          className="w-16 px-2 py-1 text-sm rounded bg-[#1a1a24] border border-[#2a2a2a] text-[#fafafa] focus:border-[#f472b6] focus:outline-none"
                        />
                        <span className="text-xs text-[#666666]">lines to skip</span>
                      </div>
                    )}
                  </div>
                  
                  {/* Template Options Grid */}
                  <div className="mt-4 grid grid-cols-2 gap-3">
                    {/* Use App Header */}
                    <div className="p-3 rounded-lg bg-[#1a1a24]/50 border border-[#2a2a3a] hover:border-[#4ecdc4]/50 transition-colors">
                      <label className="flex items-start gap-3 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={useAppHeader}
                          onChange={(e) => setUseAppHeader(e.target.checked)}
                          className="w-4 h-4 mt-0.5 rounded border-[#2a2a2a] bg-[#1a1a24] text-[#4ecdc4] focus:ring-[#4ecdc4] focus:ring-offset-0 cursor-pointer"
                        />
                        <div>
                          <span className="text-sm text-[#fafafa]">üñºÔ∏è Use App Header</span>
                          <p className="text-xs text-[#666666] mt-0.5">
                            Apply company header image
                          </p>
                        </div>
                      </label>
                    </div>
                    
                    {/* DocuSign Ready */}
                    <div className="p-3 rounded-lg bg-[#1a1a24]/50 border border-[#2a2a3a] hover:border-[#a78bfa]/50 transition-colors">
                      <label className="flex items-start gap-3 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={isDocuSignReady}
                          onChange={(e) => setIsDocuSignReady(e.target.checked)}
                          className="w-4 h-4 mt-0.5 rounded border-[#2a2a2a] bg-[#1a1a24] text-[#a78bfa] focus:ring-[#a78bfa] focus:ring-offset-0 cursor-pointer"
                        />
                        <div>
                          <span className="text-sm text-[#fafafa]">‚úçÔ∏è DocuSign Ready</span>
                          <p className="text-xs text-[#666666] mt-0.5">
                            Include signature placeholders
                          </p>
                        </div>
                      </label>
                    </div>
                    
                    {/* Auto-detect Placeholders */}
                    <div className="p-3 rounded-lg bg-[#1a1a24]/50 border border-[#2a2a3a] hover:border-[#f0b866]/50 transition-colors">
                      <label className="flex items-start gap-3 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={autoDetectPlaceholders}
                          onChange={(e) => setAutoDetectPlaceholders(e.target.checked)}
                          className="w-4 h-4 mt-0.5 rounded border-[#2a2a2a] bg-[#1a1a24] text-[#f0b866] focus:ring-[#f0b866] focus:ring-offset-0 cursor-pointer"
                        />
                        <div>
                          <span className="text-sm text-[#fafafa]">üîç Auto-detect</span>
                          <p className="text-xs text-[#666666] mt-0.5">
                            Find dates, names, amounts
                          </p>
                        </div>
                      </label>
                    </div>
                    
                    {/* Pin Template */}
                    <div className="p-3 rounded-lg bg-[#1a1a24]/50 border border-[#2a2a3a] hover:border-[#f87171]/50 transition-colors">
                      <label className="flex items-start gap-3 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={isPinned}
                          onChange={(e) => setIsPinned(e.target.checked)}
                          className="w-4 h-4 mt-0.5 rounded border-[#2a2a2a] bg-[#1a1a24] text-[#f87171] focus:ring-[#f87171] focus:ring-offset-0 cursor-pointer"
                        />
                        <div>
                          <span className="text-sm text-[#fafafa]">üìå Pin Template</span>
                          <p className="text-xs text-[#666666] mt-0.5">
                            Show in quick access
                          </p>
                        </div>
                      </label>
                    </div>
                  </div>
                  
                  {/* Tags Input */}
                  <div className="mt-4">
                    <label className="block text-sm text-[#666666] mb-2">üè∑Ô∏è Tags (for organization)</label>
                    <div className="flex flex-wrap gap-2 mb-2">
                      {templateTags.map((tag, index) => (
                        <span 
                          key={index} 
                          className="inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full bg-[#a78bfa]/20 text-[#a78bfa]"
                        >
                          {tag}
                          <button
                            type="button"
                            onClick={() => setTemplateTags(templateTags.filter((_, i) => i !== index))}
                            className="hover:text-[#f87171] transition-colors"
                          >
                            √ó
                          </button>
                        </span>
                      ))}
                    </div>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        value={tagInput}
                        onChange={(e) => setTagInput(e.target.value)}
                        onKeyDown={(e) => {
                          if (e.key === "Enter" && tagInput.trim()) {
                            e.preventDefault();
                            if (!templateTags.includes(tagInput.trim().toLowerCase())) {
                              setTemplateTags([...templateTags, tagInput.trim().toLowerCase()]);
                            }
                            setTagInput("");
                          }
                        }}
                        placeholder="Add tag and press Enter"
                        className="flex-1 px-3 py-1.5 text-sm rounded bg-[#1a1a24] border border-[#2a2a2a] text-[#fafafa] placeholder-[#666666] focus:border-[#a78bfa] focus:outline-none"
                      />
                      <button
                        type="button"
                        onClick={() => {
                          if (tagInput.trim() && !templateTags.includes(tagInput.trim().toLowerCase())) {
                            setTemplateTags([...templateTags, tagInput.trim().toLowerCase()]);
                            setTagInput("");
                          }
                        }}
                        className="px-3 py-1.5 text-sm rounded bg-[#2a2a3a] text-[#a0a0a0] hover:bg-[#3a3a4a] hover:text-[#fafafa] transition-colors"
                      >
                        Add
                      </button>
                    </div>
                    <div className="mt-2 flex flex-wrap gap-1">
                      {["contract", "hr", "legal", "sales", "onboarding", "finance"].map((suggestion) => (
                        <button
                          key={suggestion}
                          type="button"
                          onClick={() => {
                            if (!templateTags.includes(suggestion)) {
                              setTemplateTags([...templateTags, suggestion]);
                            }
                          }}
                          disabled={templateTags.includes(suggestion)}
                          className="px-2 py-0.5 text-xs rounded bg-[#2a2a3a]/50 text-[#666666] hover:bg-[#2a2a3a] hover:text-[#a0a0a0] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                          + {suggestion}
                        </button>
                      ))}
                    </div>
                  </div>
                </div>

                <div className="flex items-center gap-4">
                  <div className="flex-1 h-px bg-[#2a2a2a]" />
                  <span className="text-sm text-[#666666]">or type manually</span>
                  <div className="flex-1 h-px bg-[#2a2a2a]" />
                </div>

                <div>
                  <label className="block text-sm text-[#666666] mb-1">
                    Template Name *
                  </label>
                  <input
                    type="text"
                    value={formName}
                    onChange={(e) => {
                      setFormName(e.target.value);
                      setFormError("");
                    }}
                    placeholder="e.g., Formal Business Letter"
                    className="w-full px-4 py-2.5 rounded-lg bg-[#242424] border border-[#2a2a2a] text-[#fafafa] placeholder-[#666666] focus:border-[#d4a373] focus:outline-none"
                  />
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm text-[#666666] mb-1">
                      Document Type
                    </label>
                    <select
                      value={formDocType}
                      onChange={(e) => setFormDocType(e.target.value)}
                      className="w-full px-4 py-2.5 rounded-lg bg-[#242424] border border-[#2a2a2a] text-[#fafafa] focus:border-[#d4a373] focus:outline-none cursor-pointer"
                    >
                      {documentTypes.map((type) => (
                        <option key={type} value={type}>
                          {type}
                        </option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm text-[#666666] mb-1">
                      Category
                    </label>
                    <select
                      value={formCategory}
                      onChange={(e) => setFormCategory(e.target.value)}
                      className="w-full px-4 py-2.5 rounded-lg bg-[#242424] border border-[#2a2a2a] text-[#fafafa] focus:border-[#d4a373] focus:outline-none cursor-pointer"
                    >
                      {categories.map((cat) => (
                        <option key={cat} value={cat}>
                          {cat}
                        </option>
                      ))}
                    </select>
                  </div>
                </div>

                <div>
                  <label className="block text-sm text-[#666666] mb-1">
                    Description
                  </label>
                  <input
                    type="text"
                    value={formDescription}
                    onChange={(e) => setFormDescription(e.target.value)}
                    placeholder="Brief description of this template"
                    className="w-full px-4 py-2.5 rounded-lg bg-[#242424] border border-[#2a2a2a] text-[#fafafa] placeholder-[#666666] focus:border-[#d4a373] focus:outline-none"
                  />
                </div>

                <div>
                  <div className="flex items-center justify-between mb-1">
                    <label className="text-sm text-[#666666]">
                      Template Content *
                    </label>
                    {formBody && (
                      <span className="text-xs text-[#666666]">
                        {formBody.length} characters
                      </span>
                    )}
                  </div>
                  <textarea
                    value={formBody}
                    onChange={(e) => {
                      setFormBody(e.target.value);
                      setFormError("");
                    }}
                    rows={10}
                    placeholder="Enter your template text or upload a document above. Use [brackets] for placeholder text."
                    className="w-full px-4 py-3 rounded-lg bg-[#242424] border border-[#2a2a2a] text-[#fafafa] placeholder-[#666666] focus:border-[#d4a373] focus:outline-none resize-y"
                  />
                  <p className="mt-1 text-xs text-[#666666]">
                    Tip: Use [Name], [Date], [Company], etc. as placeholders
                  </p>
                </div>

                <div className="flex gap-3 pt-2">
                  <button
                    onClick={handleCreateTemplate}
                    disabled={isProcessing || isSaving}
                    className="flex-1 px-4 py-2.5 bg-gradient-to-r from-[#a78bfa] to-[#f472b6] text-white rounded-lg hover:opacity-90 hover:shadow-lg hover:shadow-[#a78bfa]/30 transition-all font-medium disabled:opacity-50"
                  >
                    {isSaving ? (
                      <span className="flex items-center justify-center gap-2">
                        <svg className="animate-spin h-4 w-4" viewBox="0 0 24 24">
                          <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                          <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                        </svg>
                        Saving...
                      </span>
                    ) : (
                      "Create Template"
                    )}
                  </button>
                  <button
                    onClick={() => {
                      resetForm();
                      setShowCreateForm(false);
                    }}
                    disabled={isSaving}
                    className="px-4 py-2.5 bg-[#242424] text-[#fafafa] border border-[#2a2a2a] rounded-lg hover:bg-[#2a2a2a] transition-colors disabled:opacity-50"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          ) : isLoading ? (
            /* Loading State */
            <div className="flex flex-col items-center justify-center py-12 text-center">
              <svg className="animate-spin h-8 w-8 text-[#a78bfa] mb-4" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
              </svg>
              <p className="text-[#666666]">Loading templates...</p>
            </div>
          ) : filteredTemplates.length === 0 ? (
            /* Empty State */
            <div className="flex flex-col items-center justify-center py-12 text-center">
              <p className="text-[#666666] mb-4">
                {activeTab === "custom"
                  ? "No shared templates yet. Be the first to create one!"
                  : "No templates found."}
              </p>
              {activeTab === "custom" && (
                <button
                  onClick={() => {
                    resetForm();
                    setShowCreateForm(true);
                  }}
                  className="px-4 py-2 text-sm bg-[#d4a373] text-[#0f0f0f] rounded-lg hover:bg-[#e5b888] transition-colors"
                >
                  Create Your First Template
                </button>
              )}
            </div>
          ) : (
            /* Template Grid */
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              {filteredTemplates.map((template) => {
                const isSharedTemplate = template.id.startsWith("shared-");
                const isLocalTemplate = template.id.startsWith("local-") || template.id.startsWith("user-");
                const isUserTemplate = isSharedTemplate || isLocalTemplate;
                const isDeleting = deleteConfirm === template.id;

                return (
                  <div
                    key={template.id}
                    className={`p-4 rounded-xl border transition-all hover:shadow-lg ${
                      isDeleting
                        ? "bg-[#f87171]/10 border-[#f87171]/30"
                        : isUserTemplate 
                          ? "bg-[#1a1a24] border-[#f0b866]/30 hover:border-[#f0b866] hover:shadow-[#f0b866]/10"
                          : "bg-[#1a1a24] border-[#4ecdc4]/30 hover:border-[#4ecdc4] hover:shadow-[#4ecdc4]/10"
                    }`}
                  >
                    {isDeleting ? (
                      /* Delete Confirmation */
                      <div>
                        <p className="text-sm text-[#fafafa] mb-3">
                          Delete &ldquo;{template.name}&rdquo;?
                        </p>
                        <div className="flex gap-2">
                          <button
                            onClick={() => handleDeleteTemplate(template.id)}
                            className="px-3 py-1.5 text-sm bg-[#f87171] text-white rounded hover:bg-[#ef4444] transition-colors"
                          >
                            Delete
                          </button>
                          <button
                            onClick={() => setDeleteConfirm(null)}
                            className="px-3 py-1.5 text-sm text-[#a0a0a0] hover:text-[#fafafa] transition-colors"
                          >
                            Cancel
                          </button>
                        </div>
                      </div>
                    ) : (
                      /* Template Card */
                      <>
                        <div className="flex items-start justify-between mb-2">
                          <h3 className="text-[#fafafa] font-medium">
                            {template.name}
                          </h3>
                          {isUserTemplate && (
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                setDeleteConfirm(template.id);
                              }}
                              className="text-[#666666] hover:text-[#f87171] transition-colors text-sm"
                              title="Delete template"
                            >
                              √ó
                            </button>
                          )}
                        </div>
                        <p className="text-sm text-[#666666] mb-2 line-clamp-2">
                          {template.description}
                        </p>
                        {template.tags && template.tags.length > 0 && (
                          <div className="flex flex-wrap gap-1 mb-2">
                            {template.tags.slice(0, 3).map((tag, idx) => (
                              <span key={idx} className="text-[10px] px-1.5 py-0.5 rounded bg-[#2a2a3a] text-[#888]">
                                {tag}
                              </span>
                            ))}
                            {template.tags.length > 3 && (
                              <span className="text-[10px] px-1.5 py-0.5 rounded bg-[#2a2a3a] text-[#666]">
                                +{template.tags.length - 3}
                              </span>
                            )}
                          </div>
                        )}
                        <div className="flex items-center justify-between">
                          <div className="flex gap-2">
                            <span className="text-xs px-2 py-0.5 bg-[#a78bfa]/20 text-[#a78bfa] rounded-full">
                              {template.category}
                            </span>
                            {isSharedTemplate && (
                              <span className="text-xs px-2 py-0.5 bg-[#4ade80]/20 text-[#4ade80] rounded-full">
                                ‚òÅÔ∏è Shared
                              </span>
                            )}
                            {isLocalTemplate && (
                              <span className="text-xs px-2 py-0.5 bg-[#fbbf24]/20 text-[#fbbf24] rounded-full">
                                üíæ Local
                              </span>
                            )}
                            {template.useAppHeader && (
                              <span className="text-xs px-2 py-0.5 bg-[#4ecdc4]/20 text-[#4ecdc4] rounded-full">
                                üñºÔ∏è Header
                              </span>
                            )}
                            {template.isDocuSignReady && (
                              <span className="text-xs px-2 py-0.5 bg-[#a78bfa]/20 text-[#a78bfa] rounded-full">
                                ‚úçÔ∏è Sign
                              </span>
                            )}
                            {template.isPinned && (
                              <span className="text-xs px-2 py-0.5 bg-[#f87171]/20 text-[#f87171] rounded-full">
                                üìå
                              </span>
                            )}
                          </div>
                          <button
                            onClick={() => {
                              onSelectTemplate(template);
                              onClose();
                            }}
                            className="text-sm px-3 py-1 rounded-full bg-[#4ecdc4]/20 text-[#4ecdc4] hover:bg-[#4ecdc4] hover:text-[#0a0a12] transition-all"
                          >
                            Use ‚Üí
                          </button>
                        </div>
                      </>
                    )}
                  </div>
                );
              })}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/app/globals.css">
/* Import distinctive fonts - Syne for headings, Outfit for body */
@import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* Warm, earthy palette with character */
  --color-primary: #e07a5f;
  --color-primary-hover: #c86a52;
  --color-accent: #81b29a;
  --color-accent-hover: #6a9a82;
  
  /* Rich, warm dark background */
  --bg-base: #0f0f12;
  --bg-surface: #161619;
  --bg-elevated: #1e1e23;
  --bg-overlay: #28282f;
  
  /* Warm text colors */
  --text-primary: #f4f1ed;
  --text-secondary: #b8b2a7;
  --text-muted: #7a756d;
  
  /* Warm borders */
  --border-default: #2a2a32;
  --border-hover: #3d3d47;
  
  /* Semantic with warmth */
  --color-success: #81b29a;
  --color-warning: #f2cc8f;
  --color-error: #e07a5f;
  
  /* Shadows - deeper for more depth */
  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.25);
  --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.3);
  --shadow-glow: 0 0 40px rgba(224, 122, 95, 0.15);
  
  /* Radius - more rounded for friendliness */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  
  /* Legacy mappings */
  --bg-primary: var(--bg-base);
  --bg-secondary: var(--bg-surface);
  --accent-violet: var(--color-primary);
  --accent-teal: var(--color-accent);
  --accent-gold: #f2cc8f;
  --border-color: var(--border-default);
}

/* Light theme - warm cream tones */
.light {
  --bg-base: #faf8f5;
  --bg-surface: #ffffff;
  --bg-elevated: #f5f2ed;
  --bg-overlay: #ebe7e0;
  
  --text-primary: #2d2a26;
  --text-secondary: #5c5751;
  --text-muted: #8f897f;
  
  --border-default: #e5e0d8;
  --border-hover: #d4cec3;
  
  --shadow-sm: 0 2px 8px rgba(45, 42, 38, 0.06);
  --shadow-md: 0 8px 24px rgba(45, 42, 38, 0.08);
  --shadow-lg: 0 16px 48px rgba(45, 42, 38, 0.1);
  --shadow-glow: 0 0 40px rgba(224, 122, 95, 0.1);
  
  --bg-primary: var(--bg-base);
  --bg-secondary: var(--bg-surface);
  --border-color: var(--border-default);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: 'Outfit', system-ui, sans-serif;
  background-color: var(--bg-base);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
  letter-spacing: -0.01em;
  position: relative;
}

/* Atmospheric background with gradient orbs */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: 
    radial-gradient(ellipse 80% 50% at 20% 80%, rgba(224, 122, 95, 0.08) 0%, transparent 50%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(129, 178, 154, 0.06) 0%, transparent 50%),
    radial-gradient(ellipse 40% 30% at 50% 50%, rgba(242, 204, 143, 0.04) 0%, transparent 50%);
  pointer-events: none;
  z-index: -1;
}

.light body::before {
  background: 
    radial-gradient(ellipse 80% 50% at 20% 80%, rgba(224, 122, 95, 0.05) 0%, transparent 50%),
    radial-gradient(ellipse 60% 40% at 80% 20%, rgba(129, 178, 154, 0.04) 0%, transparent 50%);
}

/* Subtle noise texture overlay */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  opacity: 0.02;
  pointer-events: none;
  z-index: -1;
}

/* Headings - Syne for impact */
h1, h2, h3, h4, h5, h6 {
  font-family: 'Syne', system-ui, sans-serif;
  font-weight: 600;
  letter-spacing: -0.03em;
  line-height: 1.2;
}

h1 {
  font-weight: 700;
  letter-spacing: -0.04em;
}

/* Monospace - JetBrains Mono */
code, pre, .mono, .font-mono {
  font-family: 'JetBrains Mono', monospace;
}

/* Focus styles - warm accent */
:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
}

/* Selection */
::selection {
  background: var(--color-primary);
  color: white;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: var(--bg-surface);
}

::-webkit-scrollbar-thumb {
  background: var(--border-default);
  border-radius: 5px;
  border: 2px solid var(--bg-surface);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-primary);
}

/* Form elements */
input[type="text"],
input[type="email"],
input[type="number"],
input[type="date"],
textarea,
select {
  font-family: inherit;
  font-size: 0.9rem;
  color: var(--text-primary);
  background-color: var(--bg-elevated);
  border: 1px solid var(--border-default);
  border-radius: var(--radius-md);
  transition: all 0.2s ease;
}

input:focus,
textarea:focus,
select:focus {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(224, 122, 95, 0.15);
  outline: none;
}

input:hover:not(:focus),
textarea:hover:not(:focus),
select:hover:not(:focus) {
  border-color: var(--border-hover);
}

input::placeholder,
textarea::placeholder {
  color: var(--text-muted);
}

/* Buttons */
button {
  font-family: inherit;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

button:disabled {
  cursor: not-allowed;
  opacity: 0.5;
}

/* Primary button */
.btn-primary {
  background: linear-gradient(135deg, var(--color-primary), #d16a50);
  color: white;
  border: none;
  border-radius: var(--radius-md);
  padding: 0.75rem 1.5rem;
  font-weight: 600;
  box-shadow: var(--shadow-md), 0 0 20px rgba(224, 122, 95, 0.2);
}

.btn-primary:hover:not(:disabled) {
  background: linear-gradient(135deg, var(--color-primary-hover), #b85a42);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg), 0 0 30px rgba(224, 122, 95, 0.3);
}

.btn-primary:active:not(:disabled) {
  transform: translateY(0);
}

/* Links */
a {
  color: var(--color-primary);
  text-decoration: none;
  transition: color 0.15s ease;
}

a:hover {
  color: var(--color-primary-hover);
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { 
    opacity: 0; 
    transform: translateY(12px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

@keyframes slideIn {
  from { 
    opacity: 0; 
    transform: translateX(-12px); 
  }
  to { 
    opacity: 1; 
    transform: translateX(0); 
  }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes modalIn {
  from {
    opacity: 0;
    transform: scale(0.96) translateY(8px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

@keyframes pulse-glow {
  0%, 100% { 
    box-shadow: 0 0 20px rgba(224, 122, 95, 0.2);
  }
  50% { 
    box-shadow: 0 0 30px rgba(224, 122, 95, 0.4);
  }
}

.animate-fade-in {
  animation: fadeIn 0.3s ease;
}

.animate-slide-up {
  animation: slideUp 0.3s ease;
}

.animate-slide-in {
  animation: slideIn 0.3s ease;
}

.animate-scale-in {
  animation: scaleIn 0.2s ease;
}

.modal-enter {
  animation: modalIn 0.25s cubic-bezier(0.16, 1, 0.3, 1);
}

.animate-float {
  animation: float 3s ease-in-out infinite;
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

/* Staggered animations */
.stagger-1 { animation-delay: 0.05s; }
.stagger-2 { animation-delay: 0.1s; }
.stagger-3 { animation-delay: 0.15s; }
.stagger-4 { animation-delay: 0.2s; }
.stagger-5 { animation-delay: 0.25s; }

/* Cards with depth */
.card {
  background: var(--bg-surface);
  border: 1px solid var(--border-default);
  border-radius: var(--radius-lg);
  transition: all 0.25s ease;
}

.card:hover {
  border-color: var(--border-hover);
  box-shadow: var(--shadow-md);
}

/* Form section styling */
.form-section {
  position: relative;
  overflow: hidden;
}

.form-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.form-section:focus-within::before {
  opacity: 1;
}

/* Section labels */
.section-label {
  font-family: 'Syne', system-ui, sans-serif;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--text-muted);
}

/* Accent underline */
.accent-underline {
  position: relative;
  display: inline-block;
}

.accent-underline::after {
  content: '';
  position: absolute;
  bottom: -3px;
  left: 0;
  width: 100%;
  height: 3px;
  background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
  border-radius: 2px;
}

/* Pill badges */
.pill {
  display: inline-flex;
  align-items: center;
  padding: 0.25rem 0.75rem;
  font-size: 0.75rem;
  font-weight: 500;
  border-radius: 9999px;
  background: var(--bg-elevated);
  color: var(--text-secondary);
  border: 1px solid var(--border-default);
}

.pill-primary {
  background: rgba(224, 122, 95, 0.12);
  color: var(--color-primary);
  border-color: rgba(224, 122, 95, 0.25);
}

.pill-success {
  background: rgba(129, 178, 154, 0.12);
  color: var(--color-success);
  border-color: rgba(129, 178, 154, 0.25);
}

.pill-warning {
  background: rgba(242, 204, 143, 0.12);
  color: var(--color-warning);
  border-color: rgba(242, 204, 143, 0.25);
}

/* Divider */
.divider {
  height: 1px;
  background: linear-gradient(
    to right,
    transparent,
    var(--border-default) 15%,
    var(--border-default) 85%,
    transparent
  );
}

/* Skip to content */
.skip-to-content {
  position: absolute;
  top: -48px;
  left: 0;
  background: var(--color-primary);
  color: white;
  padding: 12px 20px;
  z-index: 100;
  transition: top 0.2s ease;
  border-radius: 0 0 var(--radius-md) 0;
  font-weight: 600;
}

.skip-to-content:focus {
  top: 0;
}

/* Screen reader only */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Text gradient */
.text-gradient {
  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Glass effect */
.glass {
  background: rgba(22, 22, 25, 0.8);
  backdrop-filter: blur(16px);
  border: 1px solid var(--border-default);
}

.light .glass {
  background: rgba(255, 255, 255, 0.8);
}

/* Pulse animation */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.animate-pulse {
  animation: pulse 2s ease-in-out infinite;
}

/* Dot indicator */
.dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--color-primary);
}

.dot-success {
  background: var(--color-success);
}

.dot-warning {
  background: var(--color-warning);
}

/* Hover lift effect */
.hover-lift {
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.hover-lift:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

/* Number/stat display */
.stat {
  font-family: 'JetBrains Mono', monospace;
  font-weight: 500;
  font-size: 1.5rem;
  color: var(--color-primary);
}

/* Compact mode */
.compact-mode {
  font-size: 13px;
}

.compact-mode input,
.compact-mode textarea,
.compact-mode select {
  padding: 0.5rem 0.75rem;
  font-size: 0.85rem;
}

/* Keyboard shortcut badge */
.kbd {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 22px;
  height: 22px;
  padding: 0 0.4rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  font-weight: 500;
  background: var(--bg-elevated);
  border: 1px solid var(--border-default);
  border-radius: 6px;
  color: var(--text-muted);
  box-shadow: 0 2px 0 var(--border-default);
}

/* Icon button */
.icon-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: var(--radius-md);
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-secondary);
  transition: all 0.2s ease;
}

.icon-btn:hover {
  background: var(--bg-elevated);
  color: var(--text-primary);
  border-color: var(--border-default);
}

.icon-btn:active {
  background: var(--bg-overlay);
}

/* Tooltip */
.tooltip {
  background: var(--bg-overlay);
  color: var(--text-primary);
  padding: 0.5rem 0.875rem;
  border-radius: var(--radius-sm);
  font-size: 0.8rem;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-default);
}

/* Print styles */
@media print {
  body {
    background: white !important;
    color: black !important;
  }
  
  body::before,
  body::after {
    display: none !important;
  }
  
  .no-print,
  nav,
  aside,
  button,
  .btn-primary,
  .icon-btn,
  .modal-content {
    display: none !important;
  }
  
  main {
    padding: 0 !important;
    margin: 0 !important;
  }
  
  a {
    color: black !important;
    text-decoration: underline;
  }
  
  a[href^="http"]::after {
    content: " (" attr(href) ")";
    font-size: 0.8em;
    color: #666;
  }
}

/* Mobile adjustments */
@media (max-width: 768px) {
  body {
    font-size: 15px;
  }
  
  button, 
  .btn-primary,
  input[type="submit"] {
    min-height: 48px;
    padding: 0.875rem 1.25rem;
  }
  
  input, textarea, select {
    font-size: 16px !important; /* Prevent zoom on iOS */
    min-height: 48px;
    padding: 0.875rem !important;
  }
  
  .icon-btn {
    width: 48px;
    height: 48px;
  }
  
  h1 { font-size: 1.75rem !important; }
  h2 { font-size: 1.375rem !important; }
  
  .modal-content {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0 !important;
    min-height: auto;
    max-height: 90vh;
  }
}

@media (max-width: 480px) {
  .section-label {
    font-size: 0.65rem;
  }
  
  .pill {
    padding: 0.2rem 0.5rem;
    font-size: 0.7rem;
  }
  
  .kbd {
    min-width: 18px;
    height: 18px;
    font-size: 0.6rem;
  }
}

/* Touch states */
@media (hover: none) {
  button:active,
  .card:active {
    transform: scale(0.98);
  }
  
  .hover-lift:hover {
    transform: none;
    box-shadow: none;
  }
}

/* Offline indicator */
.offline-indicator {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: var(--color-warning);
  color: #1a1a1a;
  text-align: center;
  padding: 0.625rem;
  font-size: 0.875rem;
  font-weight: 600;
  z-index: 100;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from { transform: translateY(-100%); }
  to { transform: translateY(0); }
}

/* Empty state styling */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 2rem;
  text-align: center;
}

.empty-state-icon {
  width: 64px;
  height: 64px;
  margin-bottom: 1.5rem;
  color: var(--text-muted);
  opacity: 0.3;
}

.empty-state-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
}

.empty-state-description {
  font-size: 0.875rem;
  color: var(--text-muted);
  max-width: 300px;
}

/* Loading skeleton */
.skeleton {
  background: linear-gradient(
    90deg,
    var(--bg-elevated) 0%,
    var(--bg-overlay) 50%,
    var(--bg-elevated) 100%
  );
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  border-radius: var(--radius-sm);
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Range input styling */
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 6px;
  background: var(--bg-elevated);
  border-radius: 3px;
  outline: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  background: var(--color-primary);
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(224, 122, 95, 0.3);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.15);
  box-shadow: 0 3px 10px rgba(224, 122, 95, 0.4);
}

input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  background: var(--color-primary);
  border-radius: 50%;
  cursor: pointer;
  border: none;
  box-shadow: 0 2px 6px rgba(224, 122, 95, 0.3);
}

/* Gradient border effect */
.gradient-border {
  position: relative;
  background: var(--bg-surface);
  border-radius: var(--radius-lg);
}

.gradient-border::before {
  content: '';
  position: absolute;
  inset: -1px;
  border-radius: inherit;
  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
  z-index: -1;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.gradient-border:hover::before,
.gradient-border:focus-within::before {
  opacity: 1;
}

/* Progress bar */
.progress-bar {
  height: 6px;
  background: var(--bg-elevated);
  border-radius: 3px;
  overflow: hidden;
}

.progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
  border-radius: 3px;
  transition: width 0.3s ease;
}

/* Glow effect for primary elements */
.glow {
  box-shadow: 0 0 20px rgba(224, 122, 95, 0.15);
}

.glow:hover {
  box-shadow: 0 0 30px rgba(224, 122, 95, 0.25);
}

/* Status indicators */
.status-online {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--color-success);
  box-shadow: 0 0 8px var(--color-success);
}

.status-offline {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--color-error);
}

.status-saving {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--color-warning);
  animation: pulse 1s ease-in-out infinite;
}

/* ========== HIGH CONTRAST MODE ========== */

.high-contrast {
  --color-primary: #ff6b35;
  --color-primary-hover: #e85a2a;
  --color-accent: #00d4aa;
  --color-accent-hover: #00b894;
  
  --bg-base: #000000;
  --bg-surface: #0a0a0a;
  --bg-elevated: #141414;
  --bg-overlay: #1e1e1e;
  
  --text-primary: #ffffff;
  --text-secondary: #e0e0e0;
  --text-muted: #a0a0a0;
  
  --border-default: #404040;
  --border-hover: #606060;
  
  --color-success: #00ff88;
  --color-warning: #ffcc00;
  --color-error: #ff4444;
}

.high-contrast.light {
  --bg-base: #ffffff;
  --bg-surface: #f5f5f5;
  --bg-elevated: #ebebeb;
  --bg-overlay: #e0e0e0;
  
  --text-primary: #000000;
  --text-secondary: #1a1a1a;
  --text-muted: #4a4a4a;
  
  --border-default: #000000;
  --border-hover: #333333;
}

.high-contrast input,
.high-contrast textarea,
.high-contrast select,
.high-contrast button {
  border-width: 2px !important;
}

.high-contrast :focus-visible {
  outline: 3px solid var(--color-primary) !important;
  outline-offset: 3px !important;
}

.high-contrast .card {
  border-width: 2px;
}

.high-contrast a {
  text-decoration: underline;
  text-underline-offset: 2px;
}

/* ========== LARGE TEXT MODE ========== */

.large-text {
  font-size: 18px;
}

.large-text h1 { font-size: 2.5rem !important; }
.large-text h2 { font-size: 2rem !important; }
.large-text h3 { font-size: 1.5rem !important; }

.large-text input,
.large-text textarea,
.large-text select {
  font-size: 1.1rem !important;
  padding: 1rem !important;
}

.large-text button {
  font-size: 1.1rem !important;
  padding: 0.875rem 1.5rem !important;
}

.large-text .section-label {
  font-size: 0.85rem !important;
}

/* Font size data attribute */
[data-font-size="large"] {
  font-size: 17px;
}

[data-font-size="extra-large"] {
  font-size: 20px;
}

/* ========== ENHANCED FOCUS MODE ========== */

.enhanced-focus :focus-visible {
  outline: 3px solid var(--color-primary) !important;
  outline-offset: 4px !important;
  box-shadow: 0 0 0 6px rgba(224, 122, 95, 0.2) !important;
}

.enhanced-focus button:focus-visible,
.enhanced-focus a:focus-visible {
  transform: scale(1.02);
}

/* ========== SCREEN READER OPTIMIZATIONS ========== */

.sr-optimized .decorative {
  display: none;
}

.sr-optimized [aria-hidden="true"] {
  display: none !important;
}

/* ========== REDUCED MOTION ========== */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* When explicitly set via settings */
html:has(.reduced-motion) *,
html:has(.reduced-motion) *::before,
html:has(.reduced-motion) *::after {
  animation-duration: 0.01ms !important;
  animation-iteration-count: 1 !important;
  transition-duration: 0.01ms !important;
}
</file>

<file path="src/lib/pdfGenerator.ts">
import jsPDF from "jspdf";

// PDF Generator - No footer version
export interface PDFOptions {
  documentType: string;
  bodyText: string;
  signatoryName: string;
  signatoryTitle: string;
  signatoryCompany?: string;
  signatoryPhone?: string;
  signatoryEmail?: string;
  recipientName?: string;
  recipientTitle?: string;
  recipientAddress?: string;
  subject?: string;
  fontSize?: number;
  lineSpacing?: number;
}

export async function generatePDF(options: PDFOptions): Promise<Blob> {
  const doc = new jsPDF({
    orientation: "portrait",
    unit: "mm",
    format: "letter",
  });

  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const margin = 20;
  const contentWidth = pageWidth - 2 * margin;

  // Add header image
  try {
    // Try to load the header image from /public/header.png or /public/header.jpg
    let imageResponse = await fetch("/header.png");
    let imageType = "PNG";
    
    if (!imageResponse.ok) {
      // Try JPG if PNG not found
      imageResponse = await fetch("/header.jpg");
      imageType = "JPEG";
    }
    
    if (imageResponse.ok) {
      const imageBlob = await imageResponse.blob();
      const imageUrl = URL.createObjectURL(imageBlob);
      
      // Get image dimensions to maintain aspect ratio
      const img = new Image();
      await new Promise((resolve, reject) => {
        img.onload = resolve;
        img.onerror = reject;
        img.src = imageUrl;
      });
      
      // Calculate dimensions to fill entire page width while maintaining aspect ratio
      const fullPageWidth = pageWidth; // Full page width (no margins)
      
      let headerWidth = img.width;
      let headerHeight = img.height;
      
      // Scale to fill entire page width while maintaining aspect ratio
      const scale = fullPageWidth / headerWidth;
      
      headerWidth = headerWidth * scale;
      headerHeight = headerHeight * scale;
      
      // Position at top-left corner (no margin)
      const imageX = 0;
      const imageY = 0;
      
      // Add full template image
      doc.addImage(imageUrl, imageType, imageX, imageY, headerWidth, headerHeight);
      
      // Cover the footer area with white rectangle to hide footer text
      // Footer is in bottom ~15% of the template image
      const footerCoverY = pageHeight - 35; // Start covering 35mm from bottom
      doc.setFillColor(255, 255, 255); // White
      doc.rect(0, footerCoverY, pageWidth, 35, "F"); // Fill rectangle to cover footer
      
      URL.revokeObjectURL(imageUrl);
    } else {
      // Fallback: create a placeholder rectangle if image not found (full page width)
      doc.setFillColor(240, 240, 240);
      doc.rect(0, 0, pageWidth, 40, "F");
      
      doc.setFontSize(12);
      doc.setTextColor(100, 100, 100);
      doc.text("Header Image (add header.png to public folder)", pageWidth / 2, 20, {
        align: "center",
      });
    }
  } catch (error) {
    console.error("Error loading header image:", error);
    // Fallback placeholder (full page width)
    doc.setFillColor(240, 240, 240);
    doc.rect(0, 0, pageWidth, 40, "F");
    
    doc.setFontSize(12);
    doc.setTextColor(100, 100, 100);
    doc.text("Header Image (add header.png to public folder)", pageWidth / 2, 20, {
      align: "center",
    });
  }

  // Calculate starting position after header
  const headerHeight = 40; // Approximate header height
  let yPosition = headerHeight + margin + 10;

  // Add recipient information (if provided)
  if (options.recipientName || options.recipientAddress) {
    yPosition += 5;
    doc.setFontSize(11);
    doc.setFont("helvetica", "normal");
    
    if (options.recipientName) {
      const recipientLine = options.recipientTitle
        ? `${options.recipientName}, ${options.recipientTitle}`
        : options.recipientName;
      doc.text(recipientLine, margin, yPosition);
      yPosition += 6;
    }
    
    if (options.recipientAddress) {
      const addressLines = options.recipientAddress.split("\n");
      for (const line of addressLines) {
        if (line.trim()) {
          doc.text(line.trim(), margin, yPosition);
          yPosition += 6;
        }
      }
    }
    yPosition += 5;
  }

  // Add subject (if provided)
  if (options.subject) {
    doc.setFontSize(11);
    doc.setFont("helvetica", "bold");
    doc.text(`Subject: ${options.subject}`, margin, yPosition);
    yPosition += 8;
  }

  // Add document type title
  yPosition += 5;
  doc.setFontSize(16);
  doc.setTextColor(0, 0, 0);
  doc.setFont("helvetica", "bold");
  doc.text(options.documentType, margin + contentWidth / 2, yPosition, {
    align: "center",
  });

  // Add body text
  yPosition += 15;
  const fontSize = options.fontSize || 11;
  const lineSpacing = options.lineSpacing || 1.5;
  doc.setFontSize(fontSize);
  doc.setFont("helvetica", "normal");
  const bodyLines = doc.splitTextToSize(options.bodyText, contentWidth);
  
  // Calculate where body text ends
  let currentY = yPosition;
  const lineHeight = fontSize * lineSpacing * 0.35; // Convert to mm
  for (let i = 0; i < bodyLines.length; i++) {
    if (currentY > pageHeight - margin - 60) {
      // Add new page if needed
      doc.addPage();
      currentY = margin + 20;
    }
    doc.text(bodyLines[i], margin, currentY);
    currentY += lineHeight;
  }

  // Add spacing before signature area (no signature line, just "Sincerely,")
  const spacingBeforeSignature = 20;
  let currentSignatoryY = currentY + spacingBeforeSignature;
  
  // Calculate total height needed for signatory info (including "Sincerely,")
  let signatoryInfoHeight = 8; // "Sincerely," with spacing
  signatoryInfoHeight += 6; // Name
  signatoryInfoHeight += 6; // Title
  if (options.signatoryCompany) signatoryInfoHeight += 6;
  if (options.signatoryPhone) signatoryInfoHeight += 5;
  if (options.signatoryEmail) signatoryInfoHeight += 5;
  
  // Ensure we have enough space - check if signatory info will fit
  const bottomMargin = 20; // Standard bottom margin
  if (currentSignatoryY + signatoryInfoHeight > pageHeight - bottomMargin) {
    // If doesn't fit, add new page
    doc.addPage();
    currentSignatoryY = margin + 20; // Start near top of new page
  }
  
  // Add "Sincerely," greeting below signature line
  doc.setFontSize(11);
  doc.setFont("helvetica", "normal");
  doc.text("Sincerely,", margin, currentSignatoryY);
  currentSignatoryY += 8; // Space after "Sincerely,"
  
  // Add signatory information
  doc.setFontSize(11);
  doc.setFont("helvetica", "normal");
  doc.text(options.signatoryName, margin, currentSignatoryY);
  currentSignatoryY += 6;
  
  doc.text(options.signatoryTitle, margin, currentSignatoryY);
  currentSignatoryY += 6;
  
  if (options.signatoryCompany) {
    doc.text(options.signatoryCompany, margin, currentSignatoryY);
    currentSignatoryY += 6;
  }
  
  if (options.signatoryPhone) {
    doc.setFontSize(10);
    doc.setTextColor(100, 100, 100);
    doc.text(options.signatoryPhone, margin, currentSignatoryY);
    currentSignatoryY += 5;
    doc.setTextColor(0, 0, 0);
  }
  
  if (options.signatoryEmail) {
    doc.setFontSize(10);
    doc.setTextColor(100, 100, 100);
    doc.text(options.signatoryEmail, margin, currentSignatoryY);
    doc.setTextColor(0, 0, 0);
  }

  // Add footer to all pages
  const totalPages = doc.internal.pages.length - 1; // jsPDF uses 1-based indexing
  for (let i = 1; i <= totalPages; i++) {
    doc.setPage(i);
    
    // Draw horizontal line above footer
    const footerLineY = pageHeight - 30;
    doc.setDrawColor(0, 51, 102); // Dark blue color
    doc.setLineWidth(0.5);
    doc.line(margin, footerLineY, pageWidth - margin, footerLineY);
    
    // Footer content positioning
    const footerStartY = pageHeight - 22;
    const footerWidth = pageWidth - 2 * margin;
    const columnWidth = footerWidth / 3;
    const column1X = margin;
    const column2X = margin + columnWidth;
    const column3X = margin + (columnWidth * 2);
    
    doc.setTextColor(0, 0, 0);
    
    // Column 1: Call
    doc.setFontSize(10);
    doc.setFont("helvetica", "bold");
    doc.text("Call", column1X, footerStartY);
    doc.setFontSize(9);
    doc.setFont("helvetica", "normal");
    doc.text("(213) 237-1454", column1X, footerStartY + 5);
    
    // Column 2: Message
    doc.setFontSize(10);
    doc.setFont("helvetica", "bold");
    doc.text("Message", column2X, footerStartY);
    doc.setFontSize(9);
    doc.setFont("helvetica", "normal");
    doc.text("support@fountain.net", column2X, footerStartY + 5);
    
    // Column 3: Office Address
    doc.setFontSize(10);
    doc.setFont("helvetica", "bold");
    doc.text("Office Address", column3X, footerStartY);
    doc.setFontSize(9);
    doc.setFont("helvetica", "normal");
    doc.text("2064 Park St, Jacksonville", column3X, footerStartY + 5);
    doc.text("FL 32204", column3X, footerStartY + 9);
  }

  // Return to last page
  doc.setPage(totalPages);

  // Generate PDF blob
  const pdfBlob = doc.output("blob");
  return pdfBlob;
}
</file>

<file path="src/app/page.tsx">
"use client";

import { useState, useEffect, useCallback, useRef } from "react";
import { Toaster, toast } from "react-hot-toast";
import Link from "next/link";
import dynamic from "next/dynamic";

// Store
import { useDocumentStore, useUIStore } from "@/store/documentStore";

// Data
import { signatories } from "@/data/signatories";
import { documentTemplates, DocumentTemplate } from "@/data/templates";

// Lib
import { generatePDF } from "@/lib/pdfGenerator";

// Utils
import { saveToHistory, DocumentHistoryItem } from "@/utils/documentHistory";
import { updateStats } from "@/utils/statistics";
import { saveLastUsedSettings, saveFavorite, FavoriteSettings } from "@/utils/favorites";

// Hooks
import { useKeyboardShortcuts } from "@/hooks/useKeyboardShortcuts";
import { useSoundEffects } from "@/hooks/useSoundEffects";

// Components - Forms
import {
  DocumentTypeSelector,
  RecipientForm,
  SignatorySection,
  DocumentBodyEditor,
  FormattingOptions,
} from "@/components/forms";

// Components - UI
import SimplifiedSidebar from "@/components/SimplifiedSidebar";
import CommandPalette from "@/components/CommandPalette";
import PageHeader from "@/components/PageHeader";
import ActionButtons from "@/components/ActionButtons";
import SkipToContent from "@/components/SkipToContent";
import Confetti from "@/components/Confetti";
import AutoSaveIndicator from "@/components/AutoSaveIndicator";
import ProgressIndicator from "@/components/ProgressIndicator";
import QuickTemplates from "@/components/QuickTemplates";
import { Skeleton, FormSectionSkeleton } from "@/components/Skeleton";

// Components - Modals (frequently used - not lazy loaded)
import TemplateGallery from "@/components/TemplateGallery";
import StatisticsPanel from "@/components/StatisticsPanel";
import DocumentHistory from "@/components/DocumentHistory";
import UserGuide from "@/components/UserGuide";
import FavoritesPanel from "@/components/FavoritesPanel";
import PrivacySettings from "@/components/PrivacySettings";
import SettingsPanel, { AppSettings, DEFAULT_SETTINGS } from "@/components/SettingsPanel";
import ProfileManager, { SenderProfile, RecipientProfile } from "@/components/ProfileManager";
import VersionHistory from "@/components/VersionHistory";
import FindReplace from "@/components/FindReplace";
import PDFThemes from "@/components/PDFThemes";
import CustomBranding, { useBranding } from "@/components/CustomBranding";
import AIWritingAssistant from "@/components/AIWritingAssistant";
import StreakDisplay, { useStreak } from "@/components/StreakTracker";
import TemplateAnalytics, { useTemplateAnalytics } from "@/components/TemplateAnalytics";
import { useTimeTracker, TimeStatsModal } from "@/components/TimeTracker";
import { usePDFThemes } from "@/components/PDFThemes";

// Components - Modals (lazy loaded)
import {
  LazyTeamWorkspaces,
  LazyAPIAccess,
  LazyWebhookIntegration,
  LazyDocumentScheduling,
  LazyBulkGeneration,
  LazyDocumentComparison,
  LazyAuditTrail,
  LazyExportHistory,
  LazyDocumentExpiration,
} from "@/components/LazyModals";

// New Components
import WelcomeModal from "@/components/WelcomeModal";
import TemplateCategories from "@/components/TemplateCategories";
import SaveAsTemplate, { useUserTemplates } from "@/components/SaveAsTemplate";
import Dashboard from "@/components/Dashboard";
import ShareDraft from "@/components/ShareDraft";
import EmailDocument from "@/components/EmailDocument";
import AccessibilitySettings from "@/components/AccessibilitySettings";

// Auth Components
import AuthModal from "@/components/AuthModal";
import UserMenu from "@/components/UserMenu";
import MyTemplates from "@/components/MyTemplates";

// Icons
import {
  HelpCircle,
  Shield,
  Sparkles,
  MessageSquare,
  LayoutDashboard,
  Share2,
  Mail,
  Accessibility,
  FilePlus,
  User,
} from "lucide-react";

export default function Home() {
  // Zustand stores
  const {
    documentType,
    bodyText,
    recipient,
    subject,
    formatting,
    useCustomSignatory,
    customSignatory,
    selectedSignatoryId,
    hasUnsavedChanges,
    lastSaved,
    setBodyText,
    setDocumentType,
    setRecipient,
    setCustomSignatory,
    setSelectedSignatory,
    setFormatting,
    markSaved,
    clearDocument,
    getSignatory,
  } = useDocumentStore();

  const {
    theme,
    sidebarOpen,
    activeModal,
    focusMode,
    compactMode,
    soundEffects,
    confettiEnabled,
    openModal,
    closeModal,
    setFocusMode,
    setCompactMode,
  } = useUIStore();

  // Local state for UI
  const [isGenerating, setIsGenerating] = useState(false);
  const [previewUrl, setPreviewUrl] = useState<string | null>(null);
  const [showPreview, setShowPreview] = useState(false);
  const [showConfetti, setShowConfetti] = useState(false);
  const [mounted, setMounted] = useState(false);
  const [isLoading, setIsLoading] = useState(true);
  const [isSaving, setIsSaving] = useState(false);
  const [showLivePreview, setShowLivePreview] = useState(false);
  const [livePreviewUrl, setLivePreviewUrl] = useState<string | null>(null);
  const [appSettings, setAppSettings] = useState<AppSettings>(DEFAULT_SETTINGS);
  const [isOnline, setIsOnline] = useState(true);
  
  // Auth state
  const [showAuthModal, setShowAuthModal] = useState(false);
  const [showMyTemplates, setShowMyTemplates] = useState(false);

  // Refs
  const previewDebounceRef = useRef<NodeJS.Timeout | null>(null);

  // Hooks
  const { recordDocument } = useStreak();
  const { playSound } = useSoundEffects(soundEffects);
  const { recordTemplateUse } = useTemplateAnalytics();
  const { branding, saveBranding } = useBranding();
  const { selectedTheme, selectTheme } = usePDFThemes();
  const { templates: userTemplates, addTemplate: addUserTemplate } = useUserTemplates();
  const {
    isTracking,
    currentSessionSeconds,
    timeStats,
    startTracking,
    stopTracking,
    formatTime,
    formatMinutes,
  } = useTimeTracker();

  // Initialize
  useEffect(() => {
    setMounted(true);
    setTimeout(() => setIsLoading(false), 300);

    if (typeof window !== "undefined") {
      // Load app settings
      const savedSettings = localStorage.getItem("appSettings");
      if (savedSettings) {
        try {
          setAppSettings(JSON.parse(savedSettings));
        } catch (e) {
          console.error("Error loading settings:", e);
        }
      }

      // Online status
      setIsOnline(navigator.onLine);
      const handleOnline = () => setIsOnline(true);
      const handleOffline = () => setIsOnline(false);
      window.addEventListener("online", handleOnline);
      window.addEventListener("offline", handleOffline);

      return () => {
        window.removeEventListener("online", handleOnline);
        window.removeEventListener("offline", handleOffline);
      };
    }
  }, []);

  // Start time tracking when user starts typing
  useEffect(() => {
    if (mounted && bodyText && !isTracking && bodyText.length > 10) {
      startTracking();
    }
  }, [bodyText, mounted, isTracking, startTracking]);

  // Live preview debounce
  useEffect(() => {
    if (!showLivePreview || !bodyText.trim()) {
      if (livePreviewUrl) {
        URL.revokeObjectURL(livePreviewUrl);
        setLivePreviewUrl(null);
      }
      return;
    }

    if (previewDebounceRef.current) clearTimeout(previewDebounceRef.current);

    previewDebounceRef.current = setTimeout(async () => {
      try {
        const signatory = getSignatory();
        const pdfBlob = await generatePDF({
          documentType,
          bodyText,
          signatoryName: signatory.name,
          signatoryTitle: signatory.title,
          signatoryCompany: signatory.company,
          signatoryPhone: signatory.phone,
          signatoryEmail: signatory.email,
          recipientName: recipient.name,
          recipientTitle: recipient.title,
          recipientAddress: recipient.address,
          subject,
          fontSize: formatting.fontSize,
          lineSpacing: formatting.lineSpacing,
        });

        if (livePreviewUrl) URL.revokeObjectURL(livePreviewUrl);
        setLivePreviewUrl(URL.createObjectURL(pdfBlob));
      } catch (e) {
        console.error("Live preview error:", e);
      }
    }, 1000);

    return () => {
      if (previewDebounceRef.current) clearTimeout(previewDebounceRef.current);
    };
  }, [showLivePreview, bodyText, documentType, recipient, subject, formatting, getSignatory, livePreviewUrl]);

  // Auto-save
  const handleAutoSave = useCallback(() => {
    setIsSaving(true);
    markSaved();
    setTimeout(() => setIsSaving(false), 500);
  }, [markSaved]);

  // Auto-save every 30 seconds
  useEffect(() => {
    if (!mounted) return;
    const interval = setInterval(() => {
      if (hasUnsavedChanges && bodyText.trim()) handleAutoSave();
    }, 30000);
    return () => clearInterval(interval);
  }, [hasUnsavedChanges, bodyText, mounted, handleAutoSave]);

  // Warn about unsaved changes
  useEffect(() => {
    if (!mounted) return;
    const handleBeforeUnload = (e: BeforeUnloadEvent) => {
      if (hasUnsavedChanges && bodyText.trim()) {
        e.preventDefault();
        e.returnValue = "";
      }
    };
    window.addEventListener("beforeunload", handleBeforeUnload);
    return () => window.removeEventListener("beforeunload", handleBeforeUnload);
  }, [hasUnsavedChanges, bodyText, mounted]);

  // Keyboard shortcuts
  useKeyboardShortcuts([
    { key: "s", ctrl: true, action: () => handleSaveDraft(), description: "Save draft" },
    { key: "p", ctrl: true, action: () => { if (bodyText.trim()) handlePreviewPDF(); }, description: "Preview PDF" },
    { key: "f", ctrl: true, action: () => openModal("findReplace"), description: "Find & Replace" },
  ]);

  // Handlers
  const handleSaveDraft = () => {
    handleAutoSave();
    playSound("save");
    toast.success("Draft saved");
  };

  const handleClearDraft = () => {
    clearDocument();
    toast.success("Document cleared");
  };

  const handlePreviewPDF = async () => {
    if (!bodyText.trim()) {
      toast.error("Please enter document body text");
      return;
    }
    setIsGenerating(true);
    try {
      const signatory = getSignatory();
      if (!signatory.name) throw new Error("Signatory name is required");

      const pdfBlob = await generatePDF({
        documentType,
        bodyText,
        signatoryName: signatory.name,
        signatoryTitle: signatory.title,
        signatoryCompany: signatory.company,
        signatoryPhone: signatory.phone,
        signatoryEmail: signatory.email,
        recipientName: recipient.name,
        recipientTitle: recipient.title,
        recipientAddress: recipient.address,
        subject,
        fontSize: formatting.fontSize,
        lineSpacing: formatting.lineSpacing,
      });
      const url = URL.createObjectURL(pdfBlob);
      setPreviewUrl(url);
      setShowPreview(true);
    } catch (error: any) {
      toast.error(error.message || "Error generating PDF preview");
    } finally {
      setIsGenerating(false);
    }
  };

  const handleGeneratePDF = async () => {
    if (!bodyText.trim()) {
      toast.error("Please enter document body text");
      playSound("error");
      return;
    }
    setIsGenerating(true);
    try {
      const signatory = getSignatory();
      if (!signatory.name) throw new Error("Signatory name is required");

      const pdfBlob = await generatePDF({
        documentType,
        bodyText,
        signatoryName: signatory.name,
        signatoryTitle: signatory.title,
        signatoryCompany: signatory.company,
        signatoryPhone: signatory.phone,
        signatoryEmail: signatory.email,
        recipientName: recipient.name,
        recipientTitle: recipient.title,
        recipientAddress: recipient.address,
        subject,
        fontSize: formatting.fontSize,
        lineSpacing: formatting.lineSpacing,
      });

      const url = URL.createObjectURL(pdfBlob);
      const link = document.createElement("a");
      link.href = url;
      const dateStr = new Date().toISOString().split("T")[0];
      link.download = `${documentType.replace(/\s+/g, "-")}-${signatory.name.replace(/\s+/g, "-")}-${dateStr}.pdf`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

      // Stop time tracking and record
      const timeSpent = stopTracking(documentType);

      const isPrivateMode = localStorage.getItem("privateMode") === "true";
      if (!isPrivateMode) {
        saveToHistory({ documentType, signatoryName: signatory.name });
        const { newAchievements } = updateStats(documentType, signatory.name);
        const streakAchievements = recordDocument();
        const allAchievements = [...newAchievements, ...streakAchievements];

        recordTemplateUse(documentType, documentType, timeSpent);

        if (allAchievements.length > 0 && confettiEnabled) {
          setShowConfetti(true);
          allAchievements.forEach((a) => toast.success(`Achievement: ${a}`, { duration: 5000 }));
        }
      }

      saveLastUsedSettings({
        documentType,
        selectedSignatory: selectedSignatoryId,
        useCustomSignatory,
        customSignatoryName: customSignatory.name,
        customSignatoryTitle: customSignatory.title,
        customSignatoryCompany: customSignatory.company,
        customSignatoryPhone: customSignatory.phone,
        customSignatoryEmail: customSignatory.email,
        fontSize: formatting.fontSize,
        lineSpacing: formatting.lineSpacing,
      });

      playSound("complete");
      toast.success(`PDF downloaded${timeSpent > 0 ? ` (${timeSpent}m)` : ""}`);
    } catch (error: any) {
      playSound("error");
      toast.error(error.message || "Error generating PDF");
    } finally {
      setIsGenerating(false);
    }
  };

  const handleExportWord = async () => {
    if (!bodyText.trim()) {
      toast.error("Please enter document body text");
      return;
    }

    try {
      const { Document, Packer, Paragraph, TextRun } = await import("docx");
      const { saveAs } = await import("file-saver");
      const signatory = getSignatory();

      const paragraphs = bodyText.split("\n").map(
        (line) => new Paragraph({ children: [new TextRun({ text: line, size: formatting.fontSize * 2 })] })
      );

      const doc = new Document({
        sections: [{
          properties: {},
          children: [
            new Paragraph({ children: [new TextRun({ text: documentType, bold: true, size: 28 })] }),
            new Paragraph({ children: [] }),
            ...paragraphs,
            new Paragraph({ children: [] }),
            new Paragraph({ children: [new TextRun({ text: signatory.name, bold: true })] }),
            new Paragraph({ children: [new TextRun({ text: signatory.title })] }),
          ],
        }],
      });

      const blob = await Packer.toBlob(doc);
      const dateStr = new Date().toISOString().split("T")[0];
      saveAs(blob, `${documentType.replace(/\s+/g, "-")}-${dateStr}.docx`);
      toast.success("Word document downloaded");
    } catch (error) {
      console.error("Error exporting Word:", error);
      toast.error("Error exporting Word document");
    }
  };

  const handleSelectTemplate = (template: DocumentTemplate) => {
    setDocumentType(template.documentType);
    setBodyText(template.bodyText);
    toast.success("Template loaded");
  };

  const handleLoadFromHistory = (item: DocumentHistoryItem) => {
    setDocumentType(item.documentType);
    const signatory = signatories.find((s) => s.name === item.signatoryName);
    if (signatory) {
      setSelectedSignatory(signatory.id);
    } else {
      setCustomSignatory({ name: item.signatoryName });
    }
    toast.success("Document loaded from history");
  };

  const handleLoadFavorite = (favorite: FavoriteSettings) => {
    setDocumentType(favorite.documentType);
    setSelectedSignatory(favorite.selectedSignatory);
    if (favorite.useCustomSignatory) {
      setCustomSignatory({
        name: favorite.customSignatoryName || "",
        title: favorite.customSignatoryTitle || "",
        company: favorite.customSignatoryCompany || "",
        phone: favorite.customSignatoryPhone || "",
        email: favorite.customSignatoryEmail || "",
      });
    }
    setRecipient({
      name: favorite.recipientName || "",
      title: favorite.recipientTitle || "",
      address: favorite.recipientAddress || "",
    });
    setFormatting({
      fontSize: favorite.fontSize,
      lineSpacing: favorite.lineSpacing,
    });
    toast.success(`Loaded "${favorite.name}"`);
  };

  const handleSaveAsFavorite = () => {
    if (!bodyText.trim()) {
      toast.error("Please enter document content first");
      return;
    }
    const favoriteName = prompt("Name this favorite:");
    if (!favoriteName) return;
    saveFavorite({
      name: favoriteName,
      documentType,
      selectedSignatory: selectedSignatoryId,
      useCustomSignatory,
      customSignatoryName: customSignatory.name,
      customSignatoryTitle: customSignatory.title,
      customSignatoryCompany: customSignatory.company,
      customSignatoryPhone: customSignatory.phone,
      customSignatoryEmail: customSignatory.email,
      recipientName: recipient.name,
      recipientTitle: recipient.title,
      recipientAddress: recipient.address,
      subject,
      fontSize: formatting.fontSize,
      lineSpacing: formatting.lineSpacing,
    });
    toast.success(`Saved as "${favoriteName}"`);
  };

  const handleSettingsChange = (newSettings: AppSettings) => {
    setAppSettings(newSettings);
    localStorage.setItem("appSettings", JSON.stringify(newSettings));
    if (newSettings.focusMode !== focusMode) setFocusMode(newSettings.focusMode);
    if (newSettings.compactMode !== compactMode) setCompactMode(newSettings.compactMode);
  };

  const handleSelectSenderProfile = (profile: SenderProfile) => {
    setCustomSignatory({
      name: profile.name,
      title: profile.title,
      company: profile.company,
      phone: profile.phone,
      email: profile.email,
    });
    playSound("success");
    toast.success(`Loaded profile: ${profile.name}`);
  };

  const handleSelectRecipientProfile = (profile: RecipientProfile) => {
    setRecipient({
      name: profile.name,
      title: profile.title,
      address: profile.address,
    });
    playSound("success");
    toast.success(`Loaded recipient: ${profile.name}`);
  };

  // Navigation handler for sidebar
  const handleNavigate = (section: string) => {
    openModal(section);
  };

  // Command palette action handler
  const handleCommandAction = (action: string) => {
    switch (action) {
      case "preview":
        handlePreviewPDF();
        break;
      case "download":
        handleGeneratePDF();
        break;
      case "save":
        handleSaveDraft();
        break;
    }
  };

  // Loading state
  if (isLoading) {
    return (
      <div className="min-h-screen p-8">
        <div className="max-w-4xl mx-auto space-y-6">
          <Skeleton className="h-12 w-64 mb-8" />
          <FormSectionSkeleton />
          <FormSectionSkeleton />
          <FormSectionSkeleton />
        </div>
      </div>
    );
  }

  return (
    <>
      <SkipToContent />
      <Toaster
        position="bottom-right"
        toastOptions={{
          style: {
            background: theme === "light" ? "#fff" : "#161619",
            color: theme === "light" ? "#2d2a26" : "#f4f1ed",
            border: `1px solid ${theme === "light" ? "#e5e0d8" : "#2a2a32"}`,
            borderRadius: "12px",
            boxShadow: "0 10px 40px rgba(0, 0, 0, 0.3)",
          },
        }}
      />

      {/* Sidebar */}
      {mounted && !focusMode && (
        <SimplifiedSidebar onNavigate={handleNavigate} />
      )}

      {/* Command Palette */}
      <CommandPalette onAction={handleCommandAction} />

      <div
        className={`min-h-screen transition-all duration-300 ${
          compactMode ? "compact-mode" : ""
        } ${sidebarOpen && !focusMode ? "ml-64" : !focusMode ? "ml-[72px]" : ""}`}
      >
        <main
          id="main-content"
          className={`${compactMode ? "py-4 px-4" : "py-8 px-6 lg:px-8"} ${
            showLivePreview ? "lg:pr-[420px]" : ""
          }`}
          role="main"
          tabIndex={-1}
        >
          <div className={`${compactMode ? "max-w-2xl" : "max-w-4xl"} mx-auto`}>
            {/* Header */}
            {!focusMode && (
              <PageHeader
                isTracking={isTracking}
                currentSessionSeconds={currentSessionSeconds}
                formatTime={formatTime}
                onSave={handleSaveDraft}
                onClear={handleClearDraft}
                onTogglePreview={() => setShowLivePreview(!showLivePreview)}
                showPreview={showLivePreview}
                onShowStreaks={() => openModal("streaks")}
                onShowSettings={() => openModal("settings")}
                isSaving={isSaving}
                onShowAuth={() => setShowAuthModal(true)}
                onShowMyTemplates={() => setShowMyTemplates(true)}
              />
            )}

            {/* Quick Templates */}
            {!focusMode && (
              <QuickTemplates
                templates={[...documentTemplates]}
                onSelectTemplate={handleSelectTemplate}
              />
            )}

            {/* Form Sections */}
            <div className="space-y-6 mt-6">
              <DocumentTypeSelector theme={theme} />
              <RecipientForm theme={theme} />
              <SignatorySection theme={theme} />
              <FormattingOptions theme={theme} />
              <DocumentBodyEditor
                theme={theme}
                onOpenAI={() => openModal("ai")}
                onOpenFindReplace={() => openModal("findReplace")}
              />
            </div>

            {/* Action Buttons */}
            <ActionButtons
              onPreview={handlePreviewPDF}
              onDownload={handleGeneratePDF}
              onExportWord={handleExportWord}
              isGenerating={isGenerating}
              disabled={!bodyText.trim()}
            />

            {/* Progress Indicator */}
            <section className="py-4 mt-4">
              <ProgressIndicator
                bodyText={bodyText}
                recipientName={recipient.name}
                signatorySelected={!!selectedSignatoryId || (useCustomSignatory && !!customSignatory.name)}
                documentType={documentType}
                compact={compactMode}
              />
            </section>

            {/* Quick Links */}
            {!focusMode && (
              <section className="flex flex-wrap gap-3 pt-4 border-t border-[--border-default] text-sm">
                <button
                  onClick={() => openModal("dashboard")}
                  className="text-[--color-primary] hover:text-[--color-primary-hover] transition-colors flex items-center gap-1"
                >
                  <LayoutDashboard className="w-3.5 h-3.5" />
                  Dashboard
                </button>
                <span className="text-[--text-muted]">¬∑</span>
                <button
                  onClick={() => openModal("saveTemplate")}
                  className="text-[--color-accent] hover:opacity-80 transition-colors flex items-center gap-1"
                >
                  <FilePlus className="w-3.5 h-3.5" />
                  Save as Template
                </button>
                <span className="text-[--text-muted]">¬∑</span>
                <button
                  onClick={() => openModal("share")}
                  className="text-purple-400 hover:opacity-80 transition-colors flex items-center gap-1"
                >
                  <Share2 className="w-3.5 h-3.5" />
                  Share
                </button>
                <span className="text-[--text-muted]">¬∑</span>
                <button
                  onClick={() => openModal("email")}
                  className="text-blue-400 hover:opacity-80 transition-colors flex items-center gap-1"
                >
                  <Mail className="w-3.5 h-3.5" />
                  Email
                </button>
                <span className="text-[--text-muted]">¬∑</span>
                <button
                  onClick={() => openModal("accessibility")}
                  className="text-pink-400 hover:opacity-80 transition-colors flex items-center gap-1"
                >
                  <Accessibility className="w-3.5 h-3.5" />
                  Accessibility
                </button>
                <span className="text-[--text-muted]">¬∑</span>
                <button
                  onClick={() => openModal("help")}
                  className="text-emerald-400 hover:opacity-80 transition-colors flex items-center gap-1"
                >
                  <HelpCircle className="w-3.5 h-3.5" />
                  Help
                </button>
                <div className="flex-1" />
                <Link
                  href="/suggestions"
                  className="text-[--color-warning] hover:opacity-80 transition-colors flex items-center gap-1"
                >
                  <MessageSquare className="w-3.5 h-3.5" />
                  Feedback
                </Link>
              </section>
            )}
          </div>
        </main>

        {/* Live Preview Panel */}
        {showLivePreview && (
          <div className="fixed right-0 top-0 bottom-0 w-[400px] bg-[--bg-surface] border-l border-[--border-default] p-4 hidden lg:flex flex-col z-30">
            <div className="flex items-center justify-between mb-4">
              <h3 className="font-semibold">Live Preview</h3>
              <button
                onClick={() => setShowLivePreview(false)}
                className="text-[--text-muted] hover:text-[--text-primary] text-xl"
              >
                √ó
              </button>
            </div>
            <div className="flex-1 rounded-xl bg-[--bg-elevated] overflow-hidden">
              {livePreviewUrl ? (
                <iframe
                  src={livePreviewUrl}
                  className="w-full h-full bg-white"
                  title="Live Preview"
                />
              ) : (
                <div className="flex items-center justify-center h-full text-[--text-muted] text-sm">
                  Start typing to see preview...
                </div>
              )}
            </div>
          </div>
        )}
      </div>

      {/* PDF Preview Modal */}
      {showPreview && previewUrl && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="card max-w-4xl w-full max-h-[90vh] flex flex-col rounded-2xl overflow-hidden modal-enter">
            <div className="flex items-center justify-between p-5 border-b border-[--border-default]">
              <h2 className="text-lg font-semibold">Preview</h2>
              <button
                onClick={() => {
                  setShowPreview(false);
                  if (previewUrl) {
                    URL.revokeObjectURL(previewUrl);
                    setPreviewUrl(null);
                  }
                }}
                className="text-[--text-muted] hover:text-[--text-primary] text-xl"
              >
                √ó
              </button>
            </div>
            <div className="flex-1 overflow-auto p-4 bg-[--bg-elevated]">
              <iframe
                src={previewUrl}
                className="w-full h-full min-h-[600px] bg-white rounded-xl"
                title="PDF Preview"
              />
            </div>
            <div className="p-4 border-t border-[--border-default] flex gap-3">
              <button
                onClick={() => {
                  const link = document.createElement("a");
                  link.href = previewUrl;
                  const dateStr = new Date().toISOString().split("T")[0];
                  const signatory = getSignatory();
                  link.download = `${documentType.replace(/\s+/g, "-")}-${signatory.name.replace(/\s+/g, "-") || "document"}-${dateStr}.pdf`;
                  link.click();
                  toast.success("PDF downloaded");
                }}
                className="flex-1 btn-primary"
              >
                Download
              </button>
              <button
                onClick={() => {
                  setShowPreview(false);
                  if (previewUrl) {
                    URL.revokeObjectURL(previewUrl);
                    setPreviewUrl(null);
                  }
                }}
                className="flex-1 px-4 py-2 rounded-xl bg-[--bg-elevated] border border-[--border-default] hover:bg-[--bg-overlay] transition-colors"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Modals - Frequently Used */}
      <TemplateGallery
        isOpen={activeModal === "templates"}
        onClose={closeModal}
        onSelectTemplate={handleSelectTemplate}
      />
      <StatisticsPanel isOpen={activeModal === "statistics"} onClose={closeModal} />
      <DocumentHistory
        isOpen={activeModal === "history"}
        onClose={closeModal}
        onLoadDocument={handleLoadFromHistory}
      />
      {activeModal === "help" && <UserGuide onClose={closeModal} />}
      <FavoritesPanel
        isOpen={activeModal === "favorites"}
        onClose={closeModal}
        onLoad={handleLoadFavorite}
      />
      <PrivacySettings isOpen={activeModal === "privacy"} onClose={closeModal} />
      <SettingsPanel
        isOpen={activeModal === "settings"}
        onClose={closeModal}
        settings={appSettings}
        onSettingsChange={handleSettingsChange}
      />
      <ProfileManager
        isOpen={activeModal === "profiles"}
        onClose={closeModal}
        onSelectSender={handleSelectSenderProfile}
        onSelectRecipient={handleSelectRecipientProfile}
      />
      <VersionHistory
        isOpen={activeModal === "versions"}
        onClose={closeModal}
        onRestore={(text) => {
          setBodyText(text);
          toast.success("Version restored");
        }}
        currentBodyText={bodyText}
        documentType={documentType}
      />
      <FindReplace
        isOpen={activeModal === "findReplace"}
        onClose={closeModal}
        text={bodyText}
        onTextChange={setBodyText}
      />
      <PDFThemes
        isOpen={activeModal === "themes"}
        onClose={closeModal}
        selectedTheme={selectedTheme}
        onThemeChange={selectTheme}
      />
      <CustomBranding
        isOpen={activeModal === "branding"}
        onClose={closeModal}
        branding={branding}
        onBrandingChange={saveBranding}
      />
      <AIWritingAssistant
        isOpen={activeModal === "ai"}
        onClose={closeModal}
        onInsert={(text) => {
          setBodyText(bodyText + text);
          toast.success("Text inserted");
        }}
        selectedText={typeof window !== "undefined" ? (window.getSelection?.()?.toString() || "") : ""}
      />
      <TemplateAnalytics isOpen={activeModal === "analytics"} onClose={closeModal} />
      <TimeStatsModal
        isOpen={activeModal === "time"}
        onClose={closeModal}
        timeStats={timeStats}
        formatMinutes={formatMinutes}
      />

      {/* Streak Modal */}
      {activeModal === "streaks" && (
        <div
          className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={closeModal}
        >
          <div onClick={(e) => e.stopPropagation()} className="max-w-md w-full modal-enter">
            <StreakDisplay />
            <button
              onClick={closeModal}
              className="mt-4 w-full py-3 rounded-xl bg-[--bg-elevated] hover:bg-[--bg-overlay] transition-colors font-medium"
            >
              Close
            </button>
          </div>
        </div>
      )}

      {/* Modals - Lazy Loaded */}
      {activeModal === "teams" && (
        <LazyTeamWorkspaces isOpen={true} onClose={closeModal} />
      )}
      {activeModal === "api" && (
        <LazyAPIAccess isOpen={true} onClose={closeModal} />
      )}
      {activeModal === "webhooks" && (
        <LazyWebhookIntegration isOpen={true} onClose={closeModal} />
      )}
      {activeModal === "schedule" && (
        <LazyDocumentScheduling
          isOpen={true}
          onClose={closeModal}
          currentDocumentType={documentType}
          currentBodyText={bodyText}
          currentRecipientName={recipient.name}
          onGenerate={handleGeneratePDF}
        />
      )}
      {activeModal === "bulk" && (
        <LazyBulkGeneration
          isOpen={true}
          onClose={closeModal}
          templateBody={bodyText}
          documentType={documentType}
          onGenerate={(records) => {
            toast.success(`Generating ${records.length} documents...`);
            closeModal();
          }}
        />
      )}
      {activeModal === "comparison" && (
        <LazyDocumentComparison
          isOpen={true}
          onClose={closeModal}
          currentText={bodyText}
        />
      )}
      {activeModal === "audit" && (
        <LazyAuditTrail isOpen={true} onClose={closeModal} />
      )}
      {activeModal === "exports" && (
        <LazyExportHistory isOpen={true} onClose={closeModal} />
      )}
      {activeModal === "expiration" && (
        <LazyDocumentExpiration isOpen={true} onClose={closeModal} />
      )}

      {/* New Feature Modals */}
      <WelcomeModal onComplete={() => {}} />
      
      <TemplateCategories
        isOpen={activeModal === "templateCategories"}
        onClose={closeModal}
        onSelectTemplate={handleSelectTemplate}
        userTemplates={userTemplates}
      />
      
      <SaveAsTemplate
        isOpen={activeModal === "saveTemplate"}
        onClose={closeModal}
        currentDocumentType={documentType}
        currentBodyText={bodyText}
        onSave={addUserTemplate}
        onShowAuth={() => setShowAuthModal(true)}
      />
      
      <Dashboard
        isOpen={activeModal === "dashboard"}
        onClose={closeModal}
        onNavigate={handleNavigate}
      />
      
      <ShareDraft
        isOpen={activeModal === "share"}
        onClose={closeModal}
        documentType={documentType}
        bodyText={bodyText}
        recipientName={recipient.name}
      />
      
      <EmailDocument
        isOpen={activeModal === "email"}
        onClose={closeModal}
        documentType={documentType}
        bodyText={bodyText}
        recipientName={recipient.name}
        onGeneratePDF={async () => {
          const signatory = getSignatory();
          return await generatePDF({
            documentType,
            bodyText,
            signatoryName: signatory.name,
            signatoryTitle: signatory.title,
            signatoryCompany: signatory.company,
            signatoryPhone: signatory.phone,
            signatoryEmail: signatory.email,
            recipientName: recipient.name,
            recipientTitle: recipient.title,
            recipientAddress: recipient.address,
            subject,
            fontSize: formatting.fontSize,
            lineSpacing: formatting.lineSpacing,
          });
        }}
      />
      
      <AccessibilitySettings
        isOpen={activeModal === "accessibility"}
        onClose={closeModal}
      />

      {/* Auth Modal */}
      <AuthModal
        isOpen={showAuthModal}
        onClose={() => setShowAuthModal(false)}
        onSuccess={() => {
          // Refresh templates after login
          userTemplates;
        }}
      />

      {/* My Templates Modal */}
      <MyTemplates
        isOpen={showMyTemplates}
        onClose={() => setShowMyTemplates(false)}
        onSelectTemplate={(template) => {
          setDocumentType(template.documentType);
          setBodyText(template.bodyText);
          toast.success(`Loaded template: ${template.name}`);
        }}
        onCreateNew={() => {
          setShowMyTemplates(false);
          openModal("saveTemplate");
        }}
      />

      {/* Confetti */}
      <Confetti trigger={showConfetti && confettiEnabled} onComplete={() => setShowConfetti(false)} />

      {/* Focus Mode Exit */}
      {focusMode && (
        <button
          onClick={() => handleSettingsChange({ ...appSettings, focusMode: false })}
          className="fixed top-4 right-4 px-4 py-2 rounded-xl bg-[--bg-elevated] border border-[--border-default] text-sm z-50 hover:bg-[--bg-overlay] transition-colors"
        >
          Exit Focus Mode
        </button>
      )}

      {/* Offline Indicator */}
      {!isOnline && (
        <div className="offline-indicator">
          üì¥ You&apos;re offline. Changes will be saved locally.
        </div>
      )}
    </>
  );
}
</file>

</files>
